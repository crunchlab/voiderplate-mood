var hy=Object.defineProperty,py=Object.defineProperties,dy=Object.getOwnPropertyDescriptors,hg=Object.getOwnPropertySymbols,fy=Object.prototype.hasOwnProperty,my=Object.prototype.propertyIsEnumerable,fo=Math.pow,pg=(zo,Si,Vt)=>Si in zo?hy(zo,Si,{enumerable:!0,configurable:!0,writable:!0,value:Vt}):zo[Si]=Vt,dg=(zo,Si)=>{for(var Vt in Si||(Si={}))fy.call(Si,Vt)&&pg(zo,Vt,Si[Vt]);if(hg)for(var Vt of hg(Si))my.call(Si,Vt)&&pg(zo,Vt,Si[Vt]);return zo},fg=(zo,Si)=>py(zo,dy(Si));(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1644],{5320:function(zo){zo.exports=function(){"use strict";var Si,Vt,Ti;function Dr(m,Xi){if(Si)if(Vt){var Re="var sharedChunk = {}; ("+Si+")(sharedChunk); ("+Vt+")(sharedChunk);",jn={};Si(jn),Ti=Xi(jn),"undefined"!=typeof window&&(Ti.workerUrl=window.URL.createObjectURL(new Blob([Re],{type:"text/javascript"})))}else Vt=Xi;else Si=Xi}return Dr(0,function(m){function Xi(e,r){return e(r={exports:{}},r.exports),r.exports}var Re=jn;function jn(e,r,a,c){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=c,this.p2x=a,this.p2y=c}jn.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},jn.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},jn.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},jn.prototype.solveCurveX=function(e,r){var a,c,d,g,v;for(void 0===r&&(r=1e-6),d=e,v=0;v<8;v++){if(g=this.sampleCurveX(d)-e,Math.abs(g)<r)return d;var w=this.sampleCurveDerivativeX(d);if(Math.abs(w)<1e-6)break;d-=g/w}if((d=e)<(a=0))return a;if(d>(c=1))return c;for(;a<c;){if(g=this.sampleCurveX(d),Math.abs(g-e)<r)return d;e>g?a=d:c=d,d=.5*(c-a)+a}return d},jn.prototype.solve=function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))};var yt=Or;function Or(e,r){this.x=e,this.y=r}Or.prototype={clone:function(){return new Or(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,a=e.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),a=Math.sin(e),c=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=c,this},_rotateAround:function(e,r){var a=Math.cos(e),c=Math.sin(e),d=r.y+c*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-c*(this.y-r.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Or.convert=function(e){return e instanceof Or?e:Array.isArray(e)?new Or(e[0],e[1]):e};var at="undefined"!=typeof self?self:{},Ms=Math.pow(2,53)-1;function or(e,r,a,c){var d=new Re(e,r,a,c);return function(g){return d.solve(g)}}var di=or(.25,.1,.25,1);function Yi(e,r,a){return Math.min(a,Math.max(r,e))}function Qn(e,r,a){var c=a-r,d=((e-r)%c+c)%c+r;return d===r?a:d}function yi(e){for(var r=[],a=arguments.length-1;a-- >0;)r[a]=arguments[a+1];for(var c=0,d=r;c<d.length;c+=1){var g=d[c];for(var v in g)e[v]=g[v]}return e}var zr=1;function Yr(){return zr++}function Kr(){return function e(r){return r?(r^16*Math.random()>>r/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Ga(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Ha(e,r){e.forEach(function(a){r[a]&&(r[a]=r[a].bind(r))})}function da(e,r){return-1!==e.indexOf(r,e.length-r.length)}function xt(e,r,a){var c={};for(var d in e)c[d]=r.call(a||this,e[d],d,e);return c}function mo(e,r,a){var c={};for(var d in e)r.call(a||this,e[d],d,e)&&(c[d]=e[d]);return c}function Lr(e){return Array.isArray(e)?e.map(Lr):"object"==typeof e&&e?xt(e,Lr):e}var Wa={};function Nn(e){Wa[e]||("undefined"!=typeof console&&console.warn(e),Wa[e]=!0)}function Ki(e,r,a){return(a.y-e.y)*(r.x-e.x)>(r.y-e.y)*(a.x-e.x)}function bl(e){for(var r=0,a=0,c=e.length,d=c-1,g=void 0,v=void 0;a<c;d=a++)r+=((v=e[d]).x-(g=e[a]).x)*(g.y+v.y);return r}function mr(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function As(e){var r={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(c,d,g,v){var w=g||v;return r[d]=!w||w.toLowerCase(),""}),r["max-age"]){var a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}var Ps=null;function zu(e){if(null==Ps){var r=e.navigator?e.navigator.userAgent:null;Ps=!!e.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Ps}function fa(e){try{var r=at[e];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(a){return!1}}var Qr,Jr,ma,ga,Lo=at.performance&&at.performance.now?at.performance.now.bind(at.performance):Date.now.bind(Date),qc=at.requestAnimationFrame||at.mozRequestAnimationFrame||at.webkitRequestAnimationFrame||at.msRequestAnimationFrame,Di=at.cancelAnimationFrame||at.mozCancelAnimationFrame||at.webkitCancelAnimationFrame||at.msCancelAnimationFrame,go={now:Lo,frame:function(e){var r=qc(e);return{cancel:function(){return Di(r)}}},getImageData:function(e,r){void 0===r&&(r=0);var a=at.document.createElement("canvas"),c=a.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return a.width=e.width,a.height=e.height,c.drawImage(e,0,0,e.width,e.height),c.getImageData(-r,-r,e.width+2*r,e.height+2*r)},resolveURL:function(e){return Qr||(Qr=at.document.createElement("a")),Qr.href=e,Qr.href},hardwareConcurrency:at.navigator&&at.navigator.hardwareConcurrency||4,get devicePixelRatio(){return at.devicePixelRatio},get prefersReducedMotion(){return!!at.matchMedia&&(null==Jr&&(Jr=at.matchMedia("(prefers-reduced-motion: reduce)")),Jr.matches)}},sn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},_o={supported:!1,testSupport:function(e){!Za&&ga&&(eo?qt(e):ma=e)}},Za=!1,eo=!1;function qt(e){var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,ga),e.isContextLost())return;_o.supported=!0}catch(a){}e.deleteTexture(r),Za=!0}at.document&&((ga=at.document.createElement("img")).onload=function(){ma&&qt(ma),ma=null,eo=!0},ga.onerror=function(){Za=!0,ma=null},ga.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ro="01",$i=function(e,r){this._transformRequestFn=e,this._customAccessToken=r,this._createSkuToken()};function Rr(e){return 0===e.indexOf("mapbox:")}$i.prototype._createSkuToken=function(){var e=function(){for(var r="",a=0;a<10;a++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ro,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},$i.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},$i.prototype.transformRequest=function(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}},$i.prototype.normalizeStyleURL=function(e,r){if(!Rr(e))return e;var a=gr(e);return a.path="/styles/v1"+a.path,this._makeAPIURL(a,this._customAccessToken||r)},$i.prototype.normalizeGlyphsURL=function(e,r){if(!Rr(e))return e;var a=gr(e);return a.path="/fonts/v1"+a.path,this._makeAPIURL(a,this._customAccessToken||r)},$i.prototype.normalizeSourceURL=function(e,r){if(!Rr(e))return e;var a=gr(e);return a.path="/v4/"+a.authority+".json",a.params.push("secure"),this._makeAPIURL(a,this._customAccessToken||r)},$i.prototype.normalizeSpriteURL=function(e,r,a,c){var d=gr(e);return Rr(e)?(d.path="/styles/v1"+d.path+"/sprite"+r+a,this._makeAPIURL(d,this._customAccessToken||c)):(d.path+=""+r+a,_a(d))},$i.prototype.normalizeTileURL=function(e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Rr(e))return e;var a=gr(e);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,(go.devicePixelRatio>=2||512===r?"@2x":"")+(_o.supported?".webp":"$1")),a.path=a.path.replace(/^.+\/v4\//,"/"),a.path="/v4"+a.path;var c=this._customAccessToken||function(d){for(var g=0,v=d;g<v.length;g+=1){var w=v[g].match(/^access_token=(.*)$/);if(w)return w[1]}return null}(a.params)||sn.ACCESS_TOKEN;return sn.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&a.params.push("sku="+this._skuToken),this._makeAPIURL(a,c)},$i.prototype.canonicalizeTileURL=function(e,r){var a=gr(e);if(!a.path.match(/(^\/v4\/)/)||!a.path.match(/\.[\w]+$/))return e;var c="mapbox://tiles/";c+=a.path.replace("/v4/","");var d=a.params;return r&&(d=d.filter(function(g){return!g.match(/^access_token=/)})),d.length&&(c+="?"+d.join("&")),c},$i.prototype.canonicalizeTileset=function(e,r){for(var a=!!r&&Rr(r),c=[],d=0,g=e.tiles||[];d<g.length;d+=1){var v=g[d];Fr(v)?c.push(this.canonicalizeTileURL(v,a)):c.push(v)}return c},$i.prototype._makeAPIURL=function(e,r){var a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=gr(sn.API_URL);if(e.protocol=c.protocol,e.authority=c.authority,"http"===e.protocol){var d=e.params.indexOf("secure");d>=0&&e.params.splice(d,1)}if("/"!==c.path&&(e.path=""+c.path+e.path),!sn.REQUIRE_ACCESS_TOKEN)return _a(e);if(!(r=r||sn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+a);if("s"===r[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+a);return e.params=e.params.filter(function(g){return-1===g.indexOf("access_token")}),e.params.push("access_token="+r),_a(e)},$i.prototype.setTransformRequest=function(e){this._transformRequestFn=e};var Lu=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Fr(e){return Lu.test(e)}var ks=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function gr(e){var r=e.match(ks);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function _a(e){var r=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+r}function Xa(e){if(!e)return null;var r=e.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(at.atob(r[1]).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(a){return null}}var _r=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};_r.prototype.getStorageKey=function(e){var r,a=Xa(sn.ACCESS_TOKEN);return r=a&&a.u?at.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,function(c,d){return String.fromCharCode(Number("0x"+d))})):sn.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+r:"mapbox.eventData:"+r},_r.prototype.fetchEventData=function(){var e=fa("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{var c=at.localStorage.getItem(r);c&&(this.eventData=JSON.parse(c));var d=at.localStorage.getItem(a);d&&(this.anonId=d)}catch(g){Nn("Unable to read from LocalStorage")}},_r.prototype.saveEventData=function(){var e=fa("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{at.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&at.localStorage.setItem(r,JSON.stringify(this.eventData))}catch(c){Nn("Unable to write to LocalStorage")}},_r.prototype.processRequests=function(e){},_r.prototype.postEvent=function(e,r,a,c){var d=this;if(sn.EVENTS_URL){var g=gr(sn.EVENTS_URL);g.params.push("access_token="+(c||sn.ACCESS_TOKEN||""));var v={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.15.2",skuId:Ro,userId:this.anonId},w=r?yi(v,r):v,T={url:_a(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=z(T,function(P){d.pendingRequest=null,a(P),d.saveEventData(),d.processRequests(c)})}},_r.prototype.queueRequest=function(e,r){this.queue.push(e),this.processRequests(r)};var vr,va,Nr=function(e){function r(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.postMapLoadEvent=function(a,c,d,g){this.skuToken=d,(sn.EVENTS_URL&&g||sn.ACCESS_TOKEN&&Array.isArray(a)&&a.some(function(v){return Rr(v)||Fr(v)}))&&this.queueRequest({id:c,timestamp:Date.now()},g)},r.prototype.processRequests=function(a){var c=this;if(!this.pendingRequest&&0!==this.queue.length){var d=this.queue.shift(),g=d.id,v=d.timestamp;g&&this.success[g]||(this.anonId||this.fetchEventData(),Ga(this.anonId)||(this.anonId=Kr()),this.postEvent(v,{skuToken:this.skuToken},function(w){w||g&&(c.success[g]=!0)},a))}},r}(_r),Ru=new(function(e){function r(a){e.call(this,"appUserTurnstile"),this._customAccessToken=a}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.postTurnstileEvent=function(a,c){sn.EVENTS_URL&&sn.ACCESS_TOKEN&&Array.isArray(a)&&a.some(function(d){return Rr(d)||Fr(d)})&&this.queueRequest(Date.now(),c)},r.prototype.processRequests=function(a){var c=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var d=Xa(sn.ACCESS_TOKEN),g=d?d.u:sn.ACCESS_TOKEN,v=g!==this.eventData.tokenU;Ga(this.anonId)||(this.anonId=Kr(),v=!0);var w=this.queue.shift();if(this.eventData.lastSuccess){var T=new Date(this.eventData.lastSuccess),P=new Date(w),D=(w-this.eventData.lastSuccess)/864e5;v=v||D>=1||D<-1||T.getDate()!==P.getDate()}else v=!0;if(!v)return this.processRequests();this.postEvent(w,{"enabled.telemetry":!1},function(O){O||(c.eventData.lastSuccess=w,c.eventData.tokenU=g)},a)}},r}(_r)),wl=Ru.postTurnstileEvent.bind(Ru),Cl=new Nr,El=Cl.postMapLoadEvent.bind(Cl),Ds=500,Sl=50;function Ya(){at.caches&&!vr&&(vr=at.caches.open("mapbox-tiles"))}function Os(e){var r=e.indexOf("?");return r<0?e:e.slice(0,r)}var ya,Tl=1/0;function zs(){return null==ya&&(ya=at.OffscreenCanvas&&new at.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof at.createImageBitmap),ya}var Il={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Il);var Ml=function(e){function r(a,c,d){401===c&&Fr(d)&&(a+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,a),this.status=c,this.url=d,this.name=this.constructor.name,this.message=a}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},r}(Error),xa=mr()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===at.location.protocol?at.parent:at).location.href};function ba(e,r){var a,c=new at.AbortController,d=new at.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:xa(),signal:c.signal}),g=!1,v=!1,w=(a=d.url).indexOf("sku=")>0&&Fr(a);"json"===e.type&&d.headers.set("Accept","application/json");var T=function(D,O,N){if(!v){if(D&&"SecurityError"!==D.message&&Nn(D),O&&N)return P(O);var U=Date.now();at.fetch(d).then(function(Y){if(Y.ok){var K=w?Y.clone():null;return P(Y,K,U)}return r(new Ml(Y.statusText,Y.status,e.url))}).catch(function(Y){20!==Y.code&&r(new Error(Y.message))})}},P=function(D,O,N){("arrayBuffer"===e.type?D.arrayBuffer():"json"===e.type?D.json():D.text()).then(function(U){v||(O&&N&&function(Y,K,le){if(Ya(),vr){var oe={status:K.status,statusText:K.statusText,headers:new at.Headers};K.headers.forEach(function(me,ve){return oe.headers.set(ve,me)});var de=As(K.headers.get("Cache-Control")||"");de["no-store"]||(de["max-age"]&&oe.headers.set("Expires",new Date(le+1e3*de["max-age"]).toUTCString()),new Date(oe.headers.get("Expires")).getTime()-le<42e4||function(me,ve){if(void 0===va)try{new Response(new ReadableStream),va=!0}catch(be){va=!1}va?ve(me.body):me.blob().then(ve)}(K,function(me){var ve=new at.Response(me,oe);Ya(),vr&&vr.then(function(be){return be.put(Os(Y.url),ve)}).catch(function(be){return Nn(be.message)})}))}}(d,O,N),g=!0,r(null,U,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(function(U){v||r(new Error(U.message))})};return w?function(D,O){if(Ya(),!vr)return O(null);var N=Os(D.url);vr.then(function(U){U.match(N).then(function(Y){var K=function(le){if(!le)return!1;var oe=new Date(le.headers.get("Expires")||0),de=As(le.headers.get("Cache-Control")||"");return oe>Date.now()&&!de["no-cache"]}(Y);U.delete(N),K&&U.put(N,Y.clone()),O(null,Y,K)}).catch(O)}).catch(O)}(d,T):T(null,null),{cancel:function(){v=!0,g||c.abort()}}}var Fo,Ka,Ls=function(e,r){if(/:\/\//.test(e.url)&&!/^https?:|^file:/.test(e.url)){if(mr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,r);if(!mr()){var a=e.url.substring(0,e.url.indexOf("://"));return(sn.REGISTERED_PROTOCOLS[a]||ba)(e,r)}}if(!(/^file:/.test(c=e.url)||/^file:/.test(xa())&&!/^\w+:/.test(c))){if(at.fetch&&at.Request&&at.AbortController&&at.Request.prototype.hasOwnProperty("signal"))return ba(e,r);if(mr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,r,void 0,!0)}var c;return function(d,g){var v=new at.XMLHttpRequest;for(var w in v.open(d.method||"GET",d.url,!0),"arrayBuffer"===d.type&&(v.responseType="arraybuffer"),d.headers)v.setRequestHeader(w,d.headers[w]);return"json"===d.type&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials="include"===d.credentials,v.onerror=function(){g(new Error(v.statusText))},v.onload=function(){if((v.status>=200&&v.status<300||0===v.status)&&null!==v.response){var T=v.response;if("json"===d.type)try{T=JSON.parse(v.response)}catch(P){return g(P)}g(null,T,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else g(new Ml(v.statusText,v.status,d.url))},v.send(d.body),{cancel:function(){return v.abort()}}}(e,r)},Bn=function(e,r){return Ls(yi(e,{type:"arrayBuffer"}),r)},z=function(e,r){return Ls(yi(e,{method:"POST"}),r)},B="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Fo=[],Ka=0;var V=function(e,r){if(_o.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Ka>=sn.MAX_PARALLEL_IMAGE_REQUESTS){var a={requestParameters:e,callback:r,cancelled:!1,cancel:function(){this.cancelled=!0}};return Fo.push(a),a}Ka++;var c=!1,d=function(){if(!c)for(c=!0,Ka--;Fo.length&&Ka<sn.MAX_PARALLEL_IMAGE_REQUESTS;){var v=Fo.shift();v.cancelled||(v.cancel=V(v.requestParameters,v.callback).cancel)}},g=Bn(e,function(v,w,T,P){var O,N;d(),v?r(v):w&&(zs()?(O=r,N=new at.Blob([new Uint8Array(w)],{type:"image/png"}),at.createImageBitmap(N).then(function(U){O(null,U)}).catch(function(U){O(new Error("Could not load image because of "+U.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})):function(D,O,N,U){var Y=new at.Image,K=at.URL;Y.onload=function(){O(null,Y),K.revokeObjectURL(Y.src),Y.onload=null,at.requestAnimationFrame(function(){Y.src=B})},Y.onerror=function(){return O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var le=new at.Blob([new Uint8Array(D)],{type:"image/png"});Y.cacheControl=N,Y.expires=U,Y.src=D.byteLength?K.createObjectURL(le):B}(w,r,T,P))});return{cancel:function(){g.cancel(),d()}}};function Z(e,r,a){a[e]&&-1!==a[e].indexOf(r)||(a[e]=a[e]||[],a[e].push(r))}function te(e,r,a){if(a&&a[e]){var c=a[e].indexOf(r);-1!==c&&a[e].splice(c,1)}}var ce=function(e,r){void 0===r&&(r={}),yi(this,r),this.type=e},he=function(e){function r(a,c){void 0===c&&(c={}),e.call(this,"error",yi({error:a},c))}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(ce),ue=function(){};ue.prototype.on=function(e,r){return this._listeners=this._listeners||{},Z(e,r,this._listeners),this},ue.prototype.off=function(e,r){return te(e,r,this._listeners),te(e,r,this._oneTimeListeners),this},ue.prototype.once=function(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},Z(e,r,this._oneTimeListeners),this},ue.prototype.fire=function(e,r){"string"==typeof e&&(e=new ce(e,r||{}));var a=e.type;if(this.listens(a)){e.target=this;for(var c=0,d=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];c<d.length;c+=1)d[c].call(this,e);for(var g=0,v=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];g<v.length;g+=1){var w=v[g];te(a,w,this._oneTimeListeners),w.call(this,e)}var T=this._eventedParent;T&&(yi(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),T.fire(e))}else e instanceof he&&console.error(e.error);return this},ue.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},ue.prototype.setEventedParent=function(e,r){return this._eventedParent=e,this._eventedParentData=r,this};var X={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},ie=function(e,r,a,c){this.message=(e?e+": ":"")+a,c&&(this.identifier=c),null!=r&&r.__line__&&(this.line=r.__line__)};function ze(e){var r=e.value;return r?[new ie(e.key,r,"constants have been deprecated as of v8")]:[]}function $e(e){for(var r=[],a=arguments.length-1;a-- >0;)r[a]=arguments[a+1];for(var c=0,d=r;c<d.length;c+=1){var g=d[c];for(var v in g)e[v]=g[v]}return e}function ye(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ne(e){if(Array.isArray(e))return e.map(Ne);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var r={};for(var a in e)r[a]=Ne(e[a]);return r}return ye(e)}var et=function(e){function r(a,c){e.call(this,c),this.message=c,this.key=a}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(Error),it=function(e,r){void 0===r&&(r=[]),this.parent=e,this.bindings={};for(var a=0,c=r;a<c.length;a+=1){var d=c[a];this.bindings[d[0]]=d[1]}};it.prototype.concat=function(e){return new it(this,e)},it.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},it.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var ut={kind:"null"},Ae={kind:"number"},We={kind:"string"},ke={kind:"boolean"},Pt={kind:"color"},kt={kind:"object"},ot={kind:"value"},gn={kind:"collator"},Ut={kind:"formatted"},wn={kind:"resolvedImage"};function Mn(e,r){return{kind:"array",itemType:e,N:r}}function Zt(e){if("array"===e.kind){var r=Zt(e.itemType);return"number"==typeof e.N?"array<"+r+", "+e.N+">":"value"===e.itemType.kind?"array":"array<"+r+">"}return e.kind}var _n=[ut,Ae,We,ke,Pt,Ut,kt,Mn(ot),wn];function Vn(e,r){if("error"===r.kind)return null;if("array"===e.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!Vn(e.itemType,r.itemType))&&("number"!=typeof e.N||e.N===r.N))return null}else{if(e.kind===r.kind)return null;if("value"===e.kind)for(var a=0,c=_n;a<c.length;a+=1)if(!Vn(c[a],r))return null}return"Expected "+Zt(e)+" but found "+Zt(r)+" instead."}function ln(e,r){return r.some(function(a){return a.kind===e.kind})}function ht(e,r){return r.some(function(a){return"null"===a?null===e:"array"===a?Array.isArray(e):"object"===a?e&&!Array.isArray(e)&&"object"==typeof e:a===typeof e})}var Qa=Xi(function(e,r){var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(w){return(w=Math.round(w))<0?0:w>255?255:w}function d(w){return c("%"===w[w.length-1]?parseFloat(w)/100*255:parseInt(w))}function g(w){return(T="%"===w[w.length-1]?parseFloat(w)/100:parseFloat(w))<0?0:T>1?1:T;var T}function v(w,T,P){return P<0?P+=1:P>1&&(P-=1),6*P<1?w+(T-w)*P*6:2*P<1?T:3*P<2?w+(T-w)*(2/3-P)*6:w}try{r.parseCSSColor=function(w){var T,P=w.replace(/ /g,"").toLowerCase();if(P in a)return a[P].slice();if("#"===P[0])return 4===P.length?(T=parseInt(P.substr(1),16))>=0&&T<=4095?[(3840&T)>>4|(3840&T)>>8,240&T|(240&T)>>4,15&T|(15&T)<<4,1]:null:7===P.length&&(T=parseInt(P.substr(1),16))>=0&&T<=16777215?[(16711680&T)>>16,(65280&T)>>8,255&T,1]:null;var D=P.indexOf("("),O=P.indexOf(")");if(-1!==D&&O+1===P.length){var N=P.substr(0,D),U=P.substr(D+1,O-(D+1)).split(","),Y=1;switch(N){case"rgba":if(4!==U.length)return null;Y=g(U.pop());case"rgb":return 3!==U.length?null:[d(U[0]),d(U[1]),d(U[2]),Y];case"hsla":if(4!==U.length)return null;Y=g(U.pop());case"hsl":if(3!==U.length)return null;var K=(parseFloat(U[0])%360+360)%360/360,le=g(U[1]),oe=g(U[2]),de=oe<=.5?oe*(le+1):oe+le-oe*le,me=2*oe-de;return[c(255*v(me,de,K+1/3)),c(255*v(me,de,K)),c(255*v(me,de,K-1/3)),Y];default:return null}}return null}}catch(w){}}).parseCSSColor,Nt=function(e,r,a,c){void 0===c&&(c=1),this.r=e,this.g=r,this.b=a,this.a=c};Nt.parse=function(e){if(e){if(e instanceof Nt)return e;if("string"==typeof e){var r=Qa(e);if(r)return new Nt(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3])}}},Nt.prototype.toString=function(){var e=this.toArray(),r=e[1],a=e[2],c=e[3];return"rgba("+Math.round(e[0])+","+Math.round(r)+","+Math.round(a)+","+c+")"},Nt.prototype.toArray=function(){var e=this.a;return 0===e?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Nt.black=new Nt(0,0,0,1),Nt.white=new Nt(1,1,1,1),Nt.transparent=new Nt(0,0,0,0),Nt.red=new Nt(1,0,0,1);var Br=function(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Br.prototype.compare=function(e,r){return this.collator.compare(e,r)},Br.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Al=function(e,r,a,c,d){this.text=e,this.image=r,this.scale=a,this.fontStack=c,this.textColor=d},fi=function(e){this.sections=e};fi.fromString=function(e){return new fi([new Al(e,null,null,null,null)])},fi.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some(function(e){return 0!==e.text.length||e.image&&0!==e.image.name.length})},fi.factory=function(e){return e instanceof fi?e:fi.fromString(e)},fi.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map(function(e){return e.text}).join("")},fi.prototype.serialize=function(){for(var e=["format"],r=0,a=this.sections;r<a.length;r+=1){var c=a[r];if(c.image)e.push(["image",c.image.name]);else{e.push(c.text);var d={};c.fontStack&&(d["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(d["font-scale"]=c.scale),c.textColor&&(d["text-color"]=["rgba"].concat(c.textColor.toArray())),e.push(d)}}return e};var xi=function(e){this.name=e.name,this.available=e.available};function Fu(e,r,a,c){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:"Invalid rgba value ["+[e,r,a,c].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof c?[e,r,a,c]:[e,r,a]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function mi(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof Nt||e instanceof Br||e instanceof fi||e instanceof xi)return!0;if(Array.isArray(e)){for(var r=0,a=e;r<a.length;r+=1)if(!mi(a[r]))return!1;return!0}if("object"==typeof e){for(var c in e)if(!mi(e[c]))return!1;return!0}return!1}function Un(e){if(null===e)return ut;if("string"==typeof e)return We;if("boolean"==typeof e)return ke;if("number"==typeof e)return Ae;if(e instanceof Nt)return Pt;if(e instanceof Br)return gn;if(e instanceof fi)return Ut;if(e instanceof xi)return wn;if(Array.isArray(e)){for(var r,a=e.length,c=0,d=e;c<d.length;c+=1){var g=Un(d[c]);if(r){if(r===g)continue;r=ot;break}r=g}return Mn(r||ot,a)}return kt}function Vr(e){var r=typeof e;return null===e?"":"string"===r||"number"===r||"boolean"===r?String(e):e instanceof Nt||e instanceof fi||e instanceof xi?e.toString():JSON.stringify(e)}xi.prototype.toString=function(){return this.name},xi.fromString=function(e){return e?new xi({name:e,available:!1}):null},xi.prototype.serialize=function(){return["image",this.name]};var Qi=function(e,r){this.type=e,this.value=r};Qi.parse=function(e,r){if(2!==e.length)return r.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!mi(e[1]))return r.error("invalid value");var a=e[1],c=Un(a),d=r.expectedType;return"array"!==c.kind||0!==c.N||!d||"array"!==d.kind||"number"==typeof d.N&&0!==d.N||(c=d),new Qi(c,a)},Qi.prototype.evaluate=function(){return this.value},Qi.prototype.eachChild=function(){},Qi.prototype.outputDefined=function(){return!0},Qi.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Nt?["rgba"].concat(this.value.toArray()):this.value instanceof fi?this.value.serialize():this.value};var An=function(e){this.name="ExpressionEvaluationError",this.message=e};An.prototype.toJSON=function(){return this.message};var Oi={string:We,number:Ae,boolean:ke,object:kt},gi=function(e,r){this.type=e,this.args=r};gi.parse=function(e,r){if(e.length<2)return r.error("Expected at least one argument.");var a,c=1,d=e[0];if("array"===d){var g,v;if(e.length>2){var w=e[1];if("string"!=typeof w||!(w in Oi)||"object"===w)return r.error('The item type argument of "array" must be one of string, number, boolean',1);g=Oi[w],c++}else g=ot;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=e[2],c++}a=Mn(g,v)}else a=Oi[d];for(var T=[];c<e.length;c++){var P=r.parse(e[c],c,ot);if(!P)return null;T.push(P)}return new gi(a,T)},gi.prototype.evaluate=function(e){for(var r=0;r<this.args.length;r++){var a=this.args[r].evaluate(e);if(!Vn(this.type,Un(a)))return a;if(r===this.args.length-1)throw new An("Expected value to be of type "+Zt(this.type)+", but found "+Zt(Un(a))+" instead.")}return null},gi.prototype.eachChild=function(e){this.args.forEach(e)},gi.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},gi.prototype.serialize=function(){var e=this.type,r=[e.kind];if("array"===e.kind){var a=e.itemType;if("string"===a.kind||"number"===a.kind||"boolean"===a.kind){r.push(a.kind);var c=e.N;("number"==typeof c||this.args.length>1)&&r.push(c)}}return r.concat(this.args.map(function(d){return d.serialize()}))};var Ji=function(e){this.type=Ut,this.sections=e};Ji.parse=function(e,r){if(e.length<2)return r.error("Expected at least one argument.");var a=e[1];if(!Array.isArray(a)&&"object"==typeof a)return r.error("First argument must be an image or text section.");for(var c=[],d=!1,g=1;g<=e.length-1;++g){var v=e[g];if(d&&"object"==typeof v&&!Array.isArray(v)){d=!1;var w=null;if(v["font-scale"]&&!(w=r.parse(v["font-scale"],1,Ae)))return null;var T=null;if(v["text-font"]&&!(T=r.parse(v["text-font"],1,Mn(We))))return null;var P=null;if(v["text-color"]&&!(P=r.parse(v["text-color"],1,Pt)))return null;var D=c[c.length-1];D.scale=w,D.font=T,D.textColor=P}else{var O=r.parse(e[g],1,ot);if(!O)return null;var N=O.type.kind;if("string"!==N&&"value"!==N&&"null"!==N&&"resolvedImage"!==N)return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:O,scale:null,font:null,textColor:null})}}return new Ji(c)},Ji.prototype.evaluate=function(e){return new fi(this.sections.map(function(r){var a=r.content.evaluate(e);return Un(a)===wn?new Al("",a,null,null,null):new Al(Vr(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))},Ji.prototype.eachChild=function(e){for(var r=0,a=this.sections;r<a.length;r+=1){var c=a[r];e(c.content),c.scale&&e(c.scale),c.font&&e(c.font),c.textColor&&e(c.textColor)}},Ji.prototype.outputDefined=function(){return!1},Ji.prototype.serialize=function(){for(var e=["format"],r=0,a=this.sections;r<a.length;r+=1){var c=a[r];e.push(c.content.serialize());var d={};c.scale&&(d["font-scale"]=c.scale.serialize()),c.font&&(d["text-font"]=c.font.serialize()),c.textColor&&(d["text-color"]=c.textColor.serialize()),e.push(d)}return e};var vo=function(e){this.type=wn,this.input=e};vo.parse=function(e,r){if(2!==e.length)return r.error("Expected two arguments.");var a=r.parse(e[1],1,We);return a?new vo(a):r.error("No image name provided.")},vo.prototype.evaluate=function(e){var r=this.input.evaluate(e),a=xi.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a},vo.prototype.eachChild=function(e){e(this.input)},vo.prototype.outputDefined=function(){return!1},vo.prototype.serialize=function(){return["image",this.input.serialize()]};var Nu={"to-boolean":ke,"to-color":Pt,"to-number":Ae,"to-string":We},yr=function(e,r){this.type=e,this.args=r};yr.parse=function(e,r){if(e.length<2)return r.error("Expected at least one argument.");var a=e[0];if(("to-boolean"===a||"to-string"===a)&&2!==e.length)return r.error("Expected one argument.");for(var c=Nu[a],d=[],g=1;g<e.length;g++){var v=r.parse(e[g],g,ot);if(!v)return null;d.push(v)}return new yr(c,d)},yr.prototype.evaluate=function(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){for(var r,a,c=0,d=this.args;c<d.length;c+=1){if(a=null,(r=d[c].evaluate(e))instanceof Nt)return r;if("string"==typeof r){var g=e.parseColor(r);if(g)return g}else if(Array.isArray(r)&&!(a=r.length<3||r.length>4?"Invalid rbga value "+JSON.stringify(r)+": expected an array containing either three or four numeric values.":Fu(r[0],r[1],r[2],r[3])))return new Nt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new An(a||"Could not parse color from value '"+("string"==typeof r?r:String(JSON.stringify(r)))+"'")}if("number"===this.type.kind){for(var v=null,w=0,T=this.args;w<T.length;w+=1){if(null===(v=T[w].evaluate(e)))return 0;var P=Number(v);if(!isNaN(P))return P}throw new An("Could not convert "+JSON.stringify(v)+" to number.")}return"formatted"===this.type.kind?fi.fromString(Vr(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?xi.fromString(Vr(this.args[0].evaluate(e))):Vr(this.args[0].evaluate(e))},yr.prototype.eachChild=function(e){this.args.forEach(e)},yr.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},yr.prototype.serialize=function(){if("formatted"===this.type.kind)return new Ji([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new vo(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(r){e.push(r.serialize())}),e};var Gc=["Unknown","Point","LineString","Polygon"],yo=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};yo.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},yo.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?Gc[this.feature.type]:this.feature.type:null},yo.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},yo.prototype.canonicalID=function(){return this.canonical},yo.prototype.properties=function(){return this.feature&&this.feature.properties||{}},yo.prototype.parseColor=function(e){var r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Nt.parse(e)),r};var _i=function(e,r,a,c){this.name=e,this.type=r,this._evaluate=a,this.args=c};_i.prototype.evaluate=function(e){return this._evaluate(e,this.args)},_i.prototype.eachChild=function(e){this.args.forEach(e)},_i.prototype.outputDefined=function(){return!1},_i.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},_i.parse=function(e,r){var a,c=e[0],d=_i.definitions[c];if(!d)return r.error('Unknown expression "'+c+'". If you wanted a literal array, use ["literal", [...]].',0);for(var g=Array.isArray(d)?d[0]:d.type,v=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,w=v.filter(function(lt){var He=lt[0];return!Array.isArray(He)||He.length===e.length-1}),T=null,P=0,D=w;P<D.length;P+=1){var O=D[P],N=O[0],U=O[1];T=new Bo(r.registry,r.path,null,r.scope);for(var Y=[],K=!1,le=1;le<e.length;le++){var oe=e[le],de=Array.isArray(N)?N[le-1]:N.type,me=T.parse(oe,1+Y.length,de);if(!me){K=!0;break}Y.push(me)}if(!K)if(Array.isArray(N)&&N.length!==Y.length)T.error("Expected "+N.length+" arguments, but found "+Y.length+" instead.");else{for(var ve=0;ve<Y.length;ve++){var be=Array.isArray(N)?N[ve]:N.type,Me=Y[ve];T.concat(ve+1).checkSubtype(be,Me.type)}if(0===T.errors.length)return new _i(c,g,U,Y)}}if(1===w.length)(a=r.errors).push.apply(a,T.errors);else{for(var Le=(w.length?w:v).map(function(lt){var He;return He=lt[0],Array.isArray(He)?"("+He.map(Zt).join(", ")+")":"("+Zt(He.type)+"...)"}).join(" | "),je=[],st=1;st<e.length;st++){var qe=r.parse(e[st],1+je.length);if(!qe)return null;je.push(Zt(qe.type))}r.error("Expected arguments of type "+Le+", but found ("+je.join(", ")+") instead.")}return null},_i.register=function(e,r){for(var a in _i.definitions=r,r)e[a]=_i};var ii=function(e,r,a){this.type=gn,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r};function Ja(e,r){e[0]=Math.min(e[0],r[0]),e[1]=Math.min(e[1],r[1]),e[2]=Math.max(e[2],r[0]),e[3]=Math.max(e[3],r[1])}function Pl(e,r){return!(e[0]<=r[0]||e[2]>=r[2]||e[1]<=r[1]||e[3]>=r[3])}function np(e,r){var a=(180+e[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,d=Math.pow(2,r.z);return[Math.round(a*d*8192),Math.round(c*d*8192)]}function ip(e,r,a){return r[1]>e[1]!=a[1]>e[1]&&e[0]<(a[0]-r[0])*(e[1]-r[1])/(a[1]-r[1])+r[0]}function Bu(e,r){for(var a,c,d,g,v,w,T,P=!1,D=0,O=r.length;D<O;D++)for(var N=r[D],U=0,Y=N.length;U<Y-1;U++){if((g=(a=e)[0]-(c=N[U])[0])*(T=a[1]-(d=N[U+1])[1])-(w=a[0]-d[0])*(v=a[1]-c[1])==0&&g*w<=0&&v*T<=0)return!1;ip(e,N[U],N[U+1])&&(P=!P)}return P}function rp(e,r){for(var a=0;a<r.length;a++)if(Bu(e,r[a]))return!0;return!1}function Hc(e,r,a,c){var d=c[0]-a[0],g=c[1]-a[1],v=(e[0]-a[0])*g-d*(e[1]-a[1]),w=(r[0]-a[0])*g-d*(r[1]-a[1]);return v>0&&w<0||v<0&&w>0}function op(e,r,a){for(var c=0,d=a;c<d.length;c+=1)for(var g=d[c],v=0;v<g.length-1;++v)if((O=[(D=g[v+1])[0]-(P=g[v])[0],D[1]-P[1]])[0]*(N=[(T=r)[0]-(w=e)[0],T[1]-w[1]])[1]-O[1]*N[0]!=0&&Hc(w,T,P,D)&&Hc(P,D,w,T))return!0;var w,T,P,D,O,N;return!1}function Vu(e,r){for(var a=0;a<e.length;++a)if(!Bu(e[a],r))return!1;for(var c=0;c<e.length-1;++c)if(op(e[c],e[c+1],r))return!1;return!0}function kl(e,r){for(var a=0;a<r.length;a++)if(Vu(e,r[a]))return!0;return!1}function Dl(e,r,a){for(var c=[],d=0;d<e.length;d++){for(var g=[],v=0;v<e[d].length;v++){var w=np(e[d][v],a);Ja(r,w),g.push(w)}c.push(g)}return c}function Rs(e,r,a){for(var c=[],d=0;d<e.length;d++){var g=Dl(e[d],r,a);c.push(g)}return c}function Wc(e,r,a,c){if(e[0]<a[0]||e[0]>a[2]){var d=.5*c,g=e[0]-a[0]>d?-c:a[0]-e[0]>d?c:0;0===g&&(g=e[0]-a[2]>d?-c:a[2]-e[0]>d?c:0),e[0]+=g}Ja(r,e)}function Ol(e,r,a,c){for(var d=8192*Math.pow(2,c.z),g=[8192*c.x,8192*c.y],v=[],w=0,T=e;w<T.length;w+=1)for(var P=0,D=T[w];P<D.length;P+=1){var O=D[P],N=[O.x+g[0],O.y+g[1]];Wc(N,r,a,d),v.push(N)}return v}function Uu(e,r,a,c){for(var d,g=8192*Math.pow(2,c.z),v=[8192*c.x,8192*c.y],w=[],T=0,P=e;T<P.length;T+=1){for(var D=[],O=0,N=P[T];O<N.length;O+=1){var U=N[O],Y=[U.x+v[0],U.y+v[1]];Ja(r,Y),D.push(Y)}w.push(D)}if(r[2]-r[0]<=g/2){(d=r)[0]=d[1]=1/0,d[2]=d[3]=-1/0;for(var K=0,le=w;K<le.length;K+=1)for(var oe=0,de=le[K];oe<de.length;oe+=1)Wc(de[oe],r,a,g)}return w}ii.parse=function(e,r){if(2!==e.length)return r.error("Expected one argument.");var a=e[1];if("object"!=typeof a||Array.isArray(a))return r.error("Collator options argument must be an object.");var c=r.parse(void 0!==a["case-sensitive"]&&a["case-sensitive"],1,ke);if(!c)return null;var d=r.parse(void 0!==a["diacritic-sensitive"]&&a["diacritic-sensitive"],1,ke);if(!d)return null;var g=null;return a.locale&&!(g=r.parse(a.locale,1,We))?null:new ii(c,d,g)},ii.prototype.evaluate=function(e){return new Br(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},ii.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},ii.prototype.outputDefined=function(){return!1},ii.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var ji=function(e,r){this.type=ke,this.geojson=e,this.geometries=r};function wa(e){if(e instanceof _i&&("get"===e.name&&1===e.args.length||"feature-state"===e.name||"has"===e.name&&1===e.args.length||"properties"===e.name||"geometry-type"===e.name||"id"===e.name||/^filter-/.test(e.name))||e instanceof ji)return!1;var r=!0;return e.eachChild(function(a){r&&!wa(a)&&(r=!1)}),r}function xo(e){if(e instanceof _i&&"feature-state"===e.name)return!1;var r=!0;return e.eachChild(function(a){r&&!xo(a)&&(r=!1)}),r}function zl(e,r){if(e instanceof _i&&r.indexOf(e.name)>=0)return!1;var a=!0;return e.eachChild(function(c){a&&!zl(c,r)&&(a=!1)}),a}ji.parse=function(e,r){if(2!==e.length)return r.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(mi(e[1])){var a=e[1];if("FeatureCollection"===a.type)for(var c=0;c<a.features.length;++c){var d=a.features[c].geometry.type;if("Polygon"===d||"MultiPolygon"===d)return new ji(a,a.features[c].geometry)}else if("Feature"===a.type){var g=a.geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new ji(a,a.geometry)}else if("Polygon"===a.type||"MultiPolygon"===a.type)return new ji(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ji.prototype.evaluate=function(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(r,a){var c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if("Polygon"===a.type){var v=Dl(a.coordinates,d,g),w=Ol(r.geometry(),c,d,g);if(!Pl(c,d))return!1;for(var T=0,P=w;T<P.length;T+=1)if(!Bu(P[T],v))return!1}if("MultiPolygon"===a.type){var D=Rs(a.coordinates,d,g),O=Ol(r.geometry(),c,d,g);if(!Pl(c,d))return!1;for(var N=0,U=O;N<U.length;N+=1)if(!rp(U[N],D))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(r,a){var c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=r.canonicalID();if("Polygon"===a.type){var v=Dl(a.coordinates,d,g),w=Uu(r.geometry(),c,d,g);if(!Pl(c,d))return!1;for(var T=0,P=w;T<P.length;T+=1)if(!Vu(P[T],v))return!1}if("MultiPolygon"===a.type){var D=Rs(a.coordinates,d,g),O=Uu(r.geometry(),c,d,g);if(!Pl(c,d))return!1;for(var N=0,U=O;N<U.length;N+=1)if(!kl(U[N],D))return!1}return!0}(e,this.geometries)}return!1},ji.prototype.eachChild=function(){},ji.prototype.outputDefined=function(){return!0},ji.prototype.serialize=function(){return["within",this.geojson]};var No=function(e,r){this.type=r.type,this.name=e,this.boundExpression=r};No.parse=function(e,r){if(2!==e.length||"string"!=typeof e[1])return r.error("'var' expression requires exactly one string literal argument.");var a=e[1];return r.scope.has(a)?new No(a,r.scope.get(a)):r.error('Unknown variable "'+a+'". Make sure "'+a+'" has been bound in an enclosing "let" expression before using it.',1)},No.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},No.prototype.eachChild=function(){},No.prototype.outputDefined=function(){return!1},No.prototype.serialize=function(){return["var",this.name]};var Bo=function(e,r,a,c,d){void 0===r&&(r=[]),void 0===c&&(c=new it),void 0===d&&(d=[]),this.registry=e,this.path=r,this.key=r.map(function(g){return"["+g+"]"}).join(""),this.scope=c,this.errors=d,this.expectedType=a};function bo(e,r){for(var a,c=e.length-1,d=0,g=c,v=0;d<=g;)if((a=e[v=Math.floor((d+g)/2)])<=r){if(v===c||r<e[v+1])return v;d=v+1}else{if(!(a>r))throw new An("Input is not a number.");g=v-1}return 0}Bo.prototype.parse=function(e,r,a,c,d){return void 0===d&&(d={}),r?this.concat(r,a,c)._parse(e,d):this._parse(e,d)},Bo.prototype._parse=function(e,r){function a(P,D,O){return"assert"===O?new gi(D,[P]):"coerce"===O?new yr(D,[P]):P}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var c=e[0];if("string"!=typeof c)return this.error("Expression name must be a string, but found "+typeof c+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var d=this.registry[c];if(d){var g=d.parse(e,this);if(!g)return null;if(this.expectedType){var v=this.expectedType,w=g.type;if("string"!==v.kind&&"number"!==v.kind&&"boolean"!==v.kind&&"object"!==v.kind&&"array"!==v.kind||"value"!==w.kind)if("color"!==v.kind&&"formatted"!==v.kind&&"resolvedImage"!==v.kind||"value"!==w.kind&&"string"!==w.kind){if(this.checkSubtype(v,w))return null}else g=a(g,v,r.typeAnnotation||"coerce");else g=a(g,v,r.typeAnnotation||"assert")}if(!(g instanceof Qi)&&"resolvedImage"!==g.type.kind&&function P(D){if(D instanceof No)return P(D.boundExpression);if(D instanceof _i&&"error"===D.name||D instanceof ii||D instanceof ji)return!1;var O=D instanceof yr||D instanceof gi,N=!0;return D.eachChild(function(U){N=O?N&&P(U):N&&U instanceof Qi}),!!N&&wa(D)&&zl(D,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(g)){var T=new yo;try{g=new Qi(g.type,g.evaluate(T))}catch(P){return this.error(P.message),null}}return g}return this.error('Unknown expression "'+c+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},Bo.prototype.concat=function(e,r,a){var c="number"==typeof e?this.path.concat(e):this.path,d=a?this.scope.concat(a):this.scope;return new Bo(this.registry,c,r||null,d,this.errors)},Bo.prototype.error=function(e){for(var r=[],a=arguments.length-1;a-- >0;)r[a]=arguments[a+1];var c=""+this.key+r.map(function(d){return"["+d+"]"}).join("");this.errors.push(new et(c,e))},Bo.prototype.checkSubtype=function(e,r){var a=Vn(e,r);return a&&this.error(a),a};var Ur=function(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(var c=0,d=a;c<d.length;c+=1){var g=d[c],v=g[1];this.labels.push(g[0]),this.outputs.push(v)}};function Jn(e,r,a){return e*(1-a)+r*a}Ur.parse=function(e,r){if(e.length-1<4)return r.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");var a=r.parse(e[1],1,Ae);if(!a)return null;var c=[],d=null;r.expectedType&&"value"!==r.expectedType.kind&&(d=r.expectedType);for(var g=1;g<e.length;g+=2){var v=1===g?-1/0:e[g],w=e[g+1],T=g,P=g+1;if("number"!=typeof v)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(c.length&&c[c.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);var D=r.parse(w,P,d);if(!D)return null;d=d||D.type,c.push([v,D])}return new Ur(d,a,c)},Ur.prototype.evaluate=function(e){var r=this.labels,a=this.outputs;if(1===r.length)return a[0].evaluate(e);var c=this.input.evaluate(e);if(c<=r[0])return a[0].evaluate(e);var d=r.length;return c>=r[d-1]?a[d-1].evaluate(e):a[bo(r,c)].evaluate(e)},Ur.prototype.eachChild=function(e){e(this.input);for(var r=0,a=this.outputs;r<a.length;r+=1)e(a[r])},Ur.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Ur.prototype.serialize=function(){for(var e=["step",this.input.serialize()],r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e};var Ll=Object.freeze({__proto__:null,number:Jn,color:function(e,r,a){return new Nt(Jn(e.r,r.r,a),Jn(e.g,r.g,a),Jn(e.b,r.b,a),Jn(e.a,r.a,a))},array:function(e,r,a){return e.map(function(c,d){return Jn(c,r[d],a)})}}),Zc=6/29*3*(6/29),ap=Math.PI/180,sp=180/Math.PI;function $u(e){return e>.008856451679035631?Math.pow(e,1/3):e/Zc+4/29}function ju(e){return e>6/29?e*e*e:Zc*(e-4/29)}function qu(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Gu(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Xc(e){var r=Gu(e.r),a=Gu(e.g),c=Gu(e.b),d=$u((.4124564*r+.3575761*a+.1804375*c)/.95047),g=$u((.2126729*r+.7151522*a+.072175*c)/1);return{l:116*g-16,a:500*(d-g),b:200*(g-$u((.0193339*r+.119192*a+.9503041*c)/1.08883)),alpha:e.a}}function Yc(e){var r=(e.l+16)/116,a=isNaN(e.a)?r:r+e.a/500,c=isNaN(e.b)?r:r-e.b/200;return r=1*ju(r),a=.95047*ju(a),c=1.08883*ju(c),new Nt(qu(3.2404542*a-1.5371385*r-.4985314*c),qu(-.969266*a+1.8760108*r+.041556*c),qu(.0556434*a-.2040259*r+1.0572252*c),e.alpha)}function lp(e,r,a){var c=r-e;return e+a*(c>180||c<-180?c-360*Math.round(c/360):c)}var Fs={forward:Xc,reverse:Yc,interpolate:function(e,r,a){return{l:Jn(e.l,r.l,a),a:Jn(e.a,r.a,a),b:Jn(e.b,r.b,a),alpha:Jn(e.alpha,r.alpha,a)}}},Ns={forward:function(e){var r=Xc(e),a=r.l,c=r.a,d=r.b,g=Math.atan2(d,c)*sp;return{h:g<0?g+360:g,c:Math.sqrt(c*c+d*d),l:a,alpha:e.a}},reverse:function(e){var r=e.h*ap,a=e.c;return Yc({l:e.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:e.alpha})},interpolate:function(e,r,a){return{h:lp(e.h,r.h,a),c:Jn(e.c,r.c,a),l:Jn(e.l,r.l,a),alpha:Jn(e.alpha,r.alpha,a)}}},Kc=Object.freeze({__proto__:null,lab:Fs,hcl:Ns}),bi=function(e,r,a,c,d){this.type=e,this.operator=r,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(var g=0,v=d;g<v.length;g+=1){var w=v[g],T=w[1];this.labels.push(w[0]),this.outputs.push(T)}};function Hu(e,r,a,c){var d=c-a,g=e-a;return 0===d?0:1===r?g/d:(Math.pow(r,g)-1)/(Math.pow(r,d)-1)}bi.interpolationFactor=function(e,r,a,c){var d=0;if("exponential"===e.name)d=Hu(r,e.base,a,c);else if("linear"===e.name)d=Hu(r,1,a,c);else if("cubic-bezier"===e.name){var g=e.controlPoints;d=new Re(g[0],g[1],g[2],g[3]).solve(Hu(r,1,a,c))}return d},bi.parse=function(e,r){var a=e[0],c=e[1],d=e[2],g=e.slice(3);if(!Array.isArray(c)||0===c.length)return r.error("Expected an interpolation type expression.",1);if("linear"===c[0])c={name:"linear"};else if("exponential"===c[0]){var v=c[1];if("number"!=typeof v)return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:v}}else{if("cubic-bezier"!==c[0])return r.error("Unknown interpolation type "+String(c[0]),1,0);var w=c.slice(1);if(4!==w.length||w.some(function(le){return"number"!=typeof le||le<0||le>1}))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}if(e.length-1<4)return r.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(!(d=r.parse(d,2,Ae)))return null;var T=[],P=null;"interpolate-hcl"===a||"interpolate-lab"===a?P=Pt:r.expectedType&&"value"!==r.expectedType.kind&&(P=r.expectedType);for(var D=0;D<g.length;D+=2){var O=g[D],N=g[D+1],U=D+3,Y=D+4;if("number"!=typeof O)return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(T.length&&T[T.length-1][0]>=O)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);var K=r.parse(N,Y,P);if(!K)return null;P=P||K.type,T.push([O,K])}return"number"===P.kind||"color"===P.kind||"array"===P.kind&&"number"===P.itemType.kind&&"number"==typeof P.N?new bi(P,a,c,d,T):r.error("Type "+Zt(P)+" is not interpolatable.")},bi.prototype.evaluate=function(e){var r=this.labels,a=this.outputs;if(1===r.length)return a[0].evaluate(e);var c=this.input.evaluate(e);if(c<=r[0])return a[0].evaluate(e);var d=r.length;if(c>=r[d-1])return a[d-1].evaluate(e);var g=bo(r,c),v=bi.interpolationFactor(this.interpolation,c,r[g],r[g+1]),w=a[g].evaluate(e),T=a[g+1].evaluate(e);return"interpolate"===this.operator?Ll[this.type.kind.toLowerCase()](w,T,v):"interpolate-hcl"===this.operator?Ns.reverse(Ns.interpolate(Ns.forward(w),Ns.forward(T),v)):Fs.reverse(Fs.interpolate(Fs.forward(w),Fs.forward(T),v))},bi.prototype.eachChild=function(e){e(this.input);for(var r=0,a=this.outputs;r<a.length;r+=1)e(a[r])},bi.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},bi.prototype.serialize=function(){var e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var r=[this.operator,e,this.input.serialize()],a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r};var wo=function(e,r){this.type=e,this.args=r};wo.parse=function(e,r){if(e.length<2)return r.error("Expectected at least one argument.");var a=null,c=r.expectedType;c&&"value"!==c.kind&&(a=c);for(var d=[],g=0,v=e.slice(1);g<v.length;g+=1){var w=r.parse(v[g],1+d.length,a,void 0,{typeAnnotation:"omit"});if(!w)return null;a=a||w.type,d.push(w)}var T=c&&d.some(function(P){return Vn(c,P.type)});return new wo(T?ot:a,d)},wo.prototype.evaluate=function(e){for(var r,a=null,c=0,d=0,g=this.args;d<g.length&&(c++,(a=g[d].evaluate(e))&&a instanceof xi&&!a.available&&(r||(r=a.name),a=null,c===this.args.length&&(a=r)),null===a);d+=1);return a},wo.prototype.eachChild=function(e){this.args.forEach(e)},wo.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},wo.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(r){e.push(r.serialize())}),e};var Vo=function(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r};Vo.prototype.evaluate=function(e){return this.result.evaluate(e)},Vo.prototype.eachChild=function(e){for(var r=0,a=this.bindings;r<a.length;r+=1)e(a[r][1]);e(this.result)},Vo.parse=function(e,r){if(e.length<4)return r.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var a=[],c=1;c<e.length-1;c+=2){var d=e[c];if("string"!=typeof d)return r.error("Expected string, but found "+typeof d+" instead.",c);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",c);var g=r.parse(e[c+1],c+1);if(!g)return null;a.push([d,g])}var v=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return v?new Vo(a,v):null},Vo.prototype.outputDefined=function(){return this.result.outputDefined()},Vo.prototype.serialize=function(){for(var e=["let"],r=0,a=this.bindings;r<a.length;r+=1){var c=a[r];e.push(c[0],c[1].serialize())}return e.push(this.result.serialize()),e};var Ca=function(e,r,a){this.type=e,this.index=r,this.input=a};Ca.parse=function(e,r){if(3!==e.length)return r.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1,Ae),c=r.parse(e[2],2,Mn(r.expectedType||ot));return a&&c?new Ca(c.type.itemType,a,c):null},Ca.prototype.evaluate=function(e){var r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new An("Array index out of bounds: "+r+" < 0.");if(r>=a.length)throw new An("Array index out of bounds: "+r+" > "+(a.length-1)+".");if(r!==Math.floor(r))throw new An("Array index must be an integer, but found "+r+" instead.");return a[r]},Ca.prototype.eachChild=function(e){e(this.index),e(this.input)},Ca.prototype.outputDefined=function(){return!1},Ca.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Uo=function(e,r){this.type=ke,this.needle=e,this.haystack=r};Uo.parse=function(e,r){if(3!==e.length)return r.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1,ot),c=r.parse(e[2],2,ot);return a&&c?ln(a.type,[ke,We,Ae,ut,ot])?new Uo(a,c):r.error("Expected first argument to be of type boolean, string, number or null, but found "+Zt(a.type)+" instead"):null},Uo.prototype.evaluate=function(e){var r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!ht(r,["boolean","string","number","null"]))throw new An("Expected first argument to be of type boolean, string, number or null, but found "+Zt(Un(r))+" instead.");if(!ht(a,["string","array"]))throw new An("Expected second argument to be of type array or string, but found "+Zt(Un(a))+" instead.");return a.indexOf(r)>=0},Uo.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},Uo.prototype.outputDefined=function(){return!0},Uo.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var $o=function(e,r,a){this.type=Ae,this.needle=e,this.haystack=r,this.fromIndex=a};$o.parse=function(e,r){if(e.length<=2||e.length>=5)return r.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1,ot),c=r.parse(e[2],2,ot);if(!a||!c)return null;if(!ln(a.type,[ke,We,Ae,ut,ot]))return r.error("Expected first argument to be of type boolean, string, number or null, but found "+Zt(a.type)+" instead");if(4===e.length){var d=r.parse(e[3],3,Ae);return d?new $o(a,c,d):null}return new $o(a,c)},$o.prototype.evaluate=function(e){var r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!ht(r,["boolean","string","number","null"]))throw new An("Expected first argument to be of type boolean, string, number or null, but found "+Zt(Un(r))+" instead.");if(!ht(a,["string","array"]))throw new An("Expected second argument to be of type array or string, but found "+Zt(Un(a))+" instead.");if(this.fromIndex){var c=this.fromIndex.evaluate(e);return a.indexOf(r,c)}return a.indexOf(r)},$o.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},$o.prototype.outputDefined=function(){return!1},$o.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var jo=function(e,r,a,c,d,g){this.inputType=e,this.type=r,this.input=a,this.cases=c,this.outputs=d,this.otherwise=g};jo.parse=function(e,r){if(e.length<5)return r.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return r.error("Expected an even number of arguments.");var a,c;r.expectedType&&"value"!==r.expectedType.kind&&(c=r.expectedType);for(var d={},g=[],v=2;v<e.length-1;v+=2){var w=e[v],T=e[v+1];Array.isArray(w)||(w=[w]);var P=r.concat(v);if(0===w.length)return P.error("Expected at least one branch label.");for(var D=0,O=w;D<O.length;D+=1){var N=O[D];if("number"!=typeof N&&"string"!=typeof N)return P.error("Branch labels must be numbers or strings.");if("number"==typeof N&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return P.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof N&&Math.floor(N)!==N)return P.error("Numeric branch labels must be integer values.");if(a){if(P.checkSubtype(a,Un(N)))return null}else a=Un(N);if(void 0!==d[String(N)])return P.error("Branch labels must be unique.");d[String(N)]=g.length}var U=r.parse(T,v,c);if(!U)return null;c=c||U.type,g.push(U)}var Y=r.parse(e[1],1,ot);if(!Y)return null;var K=r.parse(e[e.length-1],e.length-1,c);return K?"value"!==Y.type.kind&&r.concat(1).checkSubtype(a,Y.type)?null:new jo(a,c,Y,d,g,K):null},jo.prototype.evaluate=function(e){var r=this.input.evaluate(e);return(Un(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)},jo.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},jo.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},jo.prototype.serialize=function(){for(var e=this,r=["match",this.input.serialize()],a=[],c={},d=0,g=Object.keys(this.cases).sort();d<g.length;d+=1){var v=g[d];void 0===(O=c[this.cases[v]])?(c[this.cases[v]]=a.length,a.push([this.cases[v],[v]])):a[O][1].push(v)}for(var w=function(U){return"number"===e.inputType.kind?Number(U):U},T=0,P=a;T<P.length;T+=1){var D=P[T],O=D[0],N=D[1];r.push(1===N.length?w(N[0]):N.map(w)),r.push(this.outputs[outputIndex$1].serialize())}return r.push(this.otherwise.serialize()),r};var Ea=function(e,r,a){this.type=e,this.branches=r,this.otherwise=a};Ea.parse=function(e,r){if(e.length<4)return r.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return r.error("Expected an odd number of arguments.");var a;r.expectedType&&"value"!==r.expectedType.kind&&(a=r.expectedType);for(var c=[],d=1;d<e.length-1;d+=2){var g=r.parse(e[d],d,ke);if(!g)return null;var v=r.parse(e[d+1],d+1,a);if(!v)return null;c.push([g,v]),a=a||v.type}var w=r.parse(e[e.length-1],e.length-1,a);return w?new Ea(a,c,w):null},Ea.prototype.evaluate=function(e){for(var r=0,a=this.branches;r<a.length;r+=1){var c=a[r],d=c[1];if(c[0].evaluate(e))return d.evaluate(e)}return this.otherwise.evaluate(e)},Ea.prototype.eachChild=function(e){for(var r=0,a=this.branches;r<a.length;r+=1){var c=a[r],d=c[1];e(c[0]),e(d)}e(this.otherwise)},Ea.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},Ea.prototype.serialize=function(){var e=["case"];return this.eachChild(function(r){e.push(r.serialize())}),e};var qo=function(e,r,a,c){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=c};function Qc(e,r){return"=="===e||"!="===e?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function Cn(e,r,a,c){return 0===c.compare(r,a)}function es(e,r,a){var c="=="!==e&&"!="!==e;return function(){function d(g,v,w){this.type=ke,this.lhs=g,this.rhs=v,this.collator=w,this.hasUntypedArgument="value"===g.type.kind||"value"===v.type.kind}return d.parse=function(g,v){if(3!==g.length&&4!==g.length)return v.error("Expected two or three arguments.");var w=g[0],T=v.parse(g[1],1,ot);if(!T)return null;if(!Qc(w,T.type))return v.concat(1).error('"'+w+"\" comparisons are not supported for type '"+Zt(T.type)+"'.");var P=v.parse(g[2],2,ot);if(!P)return null;if(!Qc(w,P.type))return v.concat(2).error('"'+w+"\" comparisons are not supported for type '"+Zt(P.type)+"'.");if(T.type.kind!==P.type.kind&&"value"!==T.type.kind&&"value"!==P.type.kind)return v.error("Cannot compare types '"+Zt(T.type)+"' and '"+Zt(P.type)+"'.");c&&("value"===T.type.kind&&"value"!==P.type.kind?T=new gi(P.type,[T]):"value"!==T.type.kind&&"value"===P.type.kind&&(P=new gi(T.type,[P])));var D=null;if(4===g.length){if("string"!==T.type.kind&&"string"!==P.type.kind&&"value"!==T.type.kind&&"value"!==P.type.kind)return v.error("Cannot use collator to compare non-string types.");if(!(D=v.parse(g[3],3,gn)))return null}return new d(T,P,D)},d.prototype.evaluate=function(g){var v=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){var T=Un(v),P=Un(w);if(T.kind!==P.kind||"string"!==T.kind&&"number"!==T.kind)throw new An('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+T.kind+", "+P.kind+") instead.")}if(this.collator&&!c&&this.hasUntypedArgument){var D=Un(v),O=Un(w);if("string"!==D.kind||"string"!==O.kind)return r(g,v,w)}return this.collator?a(g,v,w,this.collator.evaluate(g)):r(g,v,w)},d.prototype.eachChild=function(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)},d.prototype.outputDefined=function(){return!0},d.prototype.serialize=function(){var g=[e];return this.eachChild(function(v){g.push(v.serialize())}),g},d}()}qo.parse=function(e,r){if(e.length<=2||e.length>=5)return r.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1,ot),c=r.parse(e[2],2,Ae);if(!a||!c)return null;if(!ln(a.type,[Mn(ot),We,ot]))return r.error("Expected first argument to be of type array or string, but found "+Zt(a.type)+" instead");if(4===e.length){var d=r.parse(e[3],3,Ae);return d?new qo(a.type,a,c,d):null}return new qo(a.type,a,c)},qo.prototype.evaluate=function(e){var r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!ht(r,["string","array"]))throw new An("Expected first argument to be of type array or string, but found "+Zt(Un(r))+" instead.");if(this.endIndex){var c=this.endIndex.evaluate(e);return r.slice(a,c)}return r.slice(a)},qo.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},qo.prototype.outputDefined=function(){return!1},qo.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Rl=es("==",function(e,r,a){return r===a},Cn),Jc=es("!=",function(e,r,a){return r!==a},function(e,r,a,c){return!Cn(0,r,a,c)}),eh=es("<",function(e,r,a){return r<a},function(e,r,a,c){return c.compare(r,a)<0}),th=es(">",function(e,r,a){return r>a},function(e,r,a,c){return c.compare(r,a)>0}),nh=es("<=",function(e,r,a){return r<=a},function(e,r,a,c){return c.compare(r,a)<=0}),up=es(">=",function(e,r,a){return r>=a},function(e,r,a,c){return c.compare(r,a)>=0}),Go=function(e,r,a,c,d){this.type=We,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=c,this.maxFractionDigits=d};Go.parse=function(e,r){if(3!==e.length)return r.error("Expected two arguments.");var a=r.parse(e[1],1,Ae);if(!a)return null;var c=e[2];if("object"!=typeof c||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");var d=null;if(c.locale&&!(d=r.parse(c.locale,1,We)))return null;var g=null;if(c.currency&&!(g=r.parse(c.currency,1,We)))return null;var v=null;if(c["min-fraction-digits"]&&!(v=r.parse(c["min-fraction-digits"],1,Ae)))return null;var w=null;return c["max-fraction-digits"]&&!(w=r.parse(c["max-fraction-digits"],1,Ae))?null:new Go(a,d,g,v,w)},Go.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Go.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Go.prototype.outputDefined=function(){return!1},Go.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Ho=function(e){this.type=Ae,this.input=e};Ho.parse=function(e,r){if(2!==e.length)return r.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1);return a?"array"!==a.type.kind&&"string"!==a.type.kind&&"value"!==a.type.kind?r.error("Expected argument of type string or array, but found "+Zt(a.type)+" instead."):new Ho(a):null},Ho.prototype.evaluate=function(e){var r=this.input.evaluate(e);if("string"==typeof r||Array.isArray(r))return r.length;throw new An("Expected value to be of type string or array, but found "+Zt(Un(r))+" instead.")},Ho.prototype.eachChild=function(e){e(this.input)},Ho.prototype.outputDefined=function(){return!1},Ho.prototype.serialize=function(){var e=["length"];return this.eachChild(function(r){e.push(r.serialize())}),e};var ts={"==":Rl,"!=":Jc,">":th,"<":eh,">=":up,"<=":nh,array:gi,at:Ca,boolean:gi,case:Ea,coalesce:wo,collator:ii,format:Ji,image:vo,in:Uo,"index-of":$o,interpolate:bi,"interpolate-hcl":bi,"interpolate-lab":bi,length:Ho,let:Vo,literal:Qi,match:jo,number:gi,"number-format":Go,object:gi,slice:qo,step:Ur,string:gi,"to-boolean":yr,"to-color":yr,"to-number":yr,"to-string":yr,var:No,within:ji};function ih(e,r){var a=r[0],c=r[1],d=r[2],g=r[3];a=a.evaluate(e),c=c.evaluate(e),d=d.evaluate(e);var v=g?g.evaluate(e):1,w=Fu(a,c,d,v);if(w)throw new An(w);return new Nt(a/255*v,c/255*v,d/255*v,v)}function rh(e,r){return e in r}function Fl(e,r){var a=r[e];return void 0===a?null:a}function Sa(e){return{type:e}}function Bs(e){return{result:"success",value:e}}function Co(e){return{result:"error",value:e}}function Ii(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Wo(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Wu(e){return!!e.expression&&e.expression.interpolated}function En(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Zu(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function cp(e){return e}function Vs(e,r,a){return void 0!==e?e:void 0!==r?r:void 0!==a?a:void 0}function Qp(e,r,a,c,d){return Vs(typeof a===d?c[a]:void 0,e.default,r.default)}function Jp(e,r,a){if("number"!==En(a))return Vs(e.default,r.default);var c=e.stops.length;if(1===c||a<=e.stops[0][0])return e.stops[0][1];if(a>=e.stops[c-1][0])return e.stops[c-1][1];var d=bo(e.stops.map(function(g){return g[0]}),a);return e.stops[d][1]}function Nl(e,r,a){var c=void 0!==e.base?e.base:1;if("number"!==En(a))return Vs(e.default,r.default);var d=e.stops.length;if(1===d||a<=e.stops[0][0])return e.stops[0][1];if(a>=e.stops[d-1][0])return e.stops[d-1][1];var N,U,K,le,g=bo(e.stops.map(function(O){return O[0]}),a),v=(N=c,le=a-(U=e.stops[g][0]),0==(K=e.stops[g+1][0]-U)?0:1===N?le/K:(Math.pow(N,le)-1)/(Math.pow(N,K)-1)),w=e.stops[g][1],T=e.stops[g+1][1],P=Ll[r.type]||cp;if(e.colorSpace&&"rgb"!==e.colorSpace){var D=Kc[e.colorSpace];P=function(O,N){return D.reverse(D.interpolate(D.forward(O),D.forward(N),v))}}return"function"==typeof w.evaluate?{evaluate:function(){for(var O=[],N=arguments.length;N--;)O[N]=arguments[N];var U=w.evaluate.apply(void 0,O),Y=T.evaluate.apply(void 0,O);if(void 0!==U&&void 0!==Y)return P(U,Y,v)}}:P(w,T,v)}function hp(e,r,a){return"color"===r.type?a=Nt.parse(a):"formatted"===r.type?a=fi.fromString(a.toString()):"resolvedImage"===r.type?a=xi.fromString(a.toString()):En(a)===r.type||"enum"===r.type&&r.values[a]||(a=void 0),Vs(a,e.default,r.default)}_i.register(ts,{error:[{kind:"error"},[We],function(e,r){throw new An(r[0].evaluate(e))}],typeof:[We,[ot],function(e,r){return Zt(Un(r[0].evaluate(e)))}],"to-rgba":[Mn(Ae,4),[Pt],function(e,r){return r[0].evaluate(e).toArray()}],rgb:[Pt,[Ae,Ae,Ae],ih],rgba:[Pt,[Ae,Ae,Ae,Ae],ih],has:{type:ke,overloads:[[[We],function(e,r){return rh(r[0].evaluate(e),e.properties())}],[[We,kt],function(e,r){var a=r[1];return rh(r[0].evaluate(e),a.evaluate(e))}]]},get:{type:ot,overloads:[[[We],function(e,r){return Fl(r[0].evaluate(e),e.properties())}],[[We,kt],function(e,r){var a=r[1];return Fl(r[0].evaluate(e),a.evaluate(e))}]]},"feature-state":[ot,[We],function(e,r){return Fl(r[0].evaluate(e),e.featureState||{})}],properties:[kt,[],function(e){return e.properties()}],"geometry-type":[We,[],function(e){return e.geometryType()}],id:[ot,[],function(e){return e.id()}],zoom:[Ae,[],function(e){return e.globals.zoom}],"heatmap-density":[Ae,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[Ae,[],function(e){return e.globals.lineProgress||0}],accumulated:[ot,[],function(e){return void 0===e.globals.accumulated?null:e.globals.accumulated}],"+":[Ae,Sa(Ae),function(e,r){for(var a=0,c=0,d=r;c<d.length;c+=1)a+=d[c].evaluate(e);return a}],"*":[Ae,Sa(Ae),function(e,r){for(var a=1,c=0,d=r;c<d.length;c+=1)a*=d[c].evaluate(e);return a}],"-":{type:Ae,overloads:[[[Ae,Ae],function(e,r){var a=r[1];return r[0].evaluate(e)-a.evaluate(e)}],[[Ae],function(e,r){return-r[0].evaluate(e)}]]},"/":[Ae,[Ae,Ae],function(e,r){var a=r[1];return r[0].evaluate(e)/a.evaluate(e)}],"%":[Ae,[Ae,Ae],function(e,r){var a=r[1];return r[0].evaluate(e)%a.evaluate(e)}],ln2:[Ae,[],function(){return Math.LN2}],pi:[Ae,[],function(){return Math.PI}],e:[Ae,[],function(){return Math.E}],"^":[Ae,[Ae,Ae],function(e,r){var a=r[1];return Math.pow(r[0].evaluate(e),a.evaluate(e))}],sqrt:[Ae,[Ae],function(e,r){return Math.sqrt(r[0].evaluate(e))}],log10:[Ae,[Ae],function(e,r){return Math.log(r[0].evaluate(e))/Math.LN10}],ln:[Ae,[Ae],function(e,r){return Math.log(r[0].evaluate(e))}],log2:[Ae,[Ae],function(e,r){return Math.log(r[0].evaluate(e))/Math.LN2}],sin:[Ae,[Ae],function(e,r){return Math.sin(r[0].evaluate(e))}],cos:[Ae,[Ae],function(e,r){return Math.cos(r[0].evaluate(e))}],tan:[Ae,[Ae],function(e,r){return Math.tan(r[0].evaluate(e))}],asin:[Ae,[Ae],function(e,r){return Math.asin(r[0].evaluate(e))}],acos:[Ae,[Ae],function(e,r){return Math.acos(r[0].evaluate(e))}],atan:[Ae,[Ae],function(e,r){return Math.atan(r[0].evaluate(e))}],min:[Ae,Sa(Ae),function(e,r){return Math.min.apply(Math,r.map(function(a){return a.evaluate(e)}))}],max:[Ae,Sa(Ae),function(e,r){return Math.max.apply(Math,r.map(function(a){return a.evaluate(e)}))}],abs:[Ae,[Ae],function(e,r){return Math.abs(r[0].evaluate(e))}],round:[Ae,[Ae],function(e,r){var a=r[0].evaluate(e);return a<0?-Math.round(-a):Math.round(a)}],floor:[Ae,[Ae],function(e,r){return Math.floor(r[0].evaluate(e))}],ceil:[Ae,[Ae],function(e,r){return Math.ceil(r[0].evaluate(e))}],"filter-==":[ke,[We,ot],function(e,r){var a=r[0],c=r[1];return e.properties()[a.value]===c.value}],"filter-id-==":[ke,[ot],function(e,r){var a=r[0];return e.id()===a.value}],"filter-type-==":[ke,[We],function(e,r){var a=r[0];return e.geometryType()===a.value}],"filter-<":[ke,[We,ot],function(e,r){var a=r[0],c=r[1],d=e.properties()[a.value],g=c.value;return typeof d==typeof g&&d<g}],"filter-id-<":[ke,[ot],function(e,r){var a=r[0],c=e.id(),d=a.value;return typeof c==typeof d&&c<d}],"filter->":[ke,[We,ot],function(e,r){var a=r[0],c=r[1],d=e.properties()[a.value],g=c.value;return typeof d==typeof g&&d>g}],"filter-id->":[ke,[ot],function(e,r){var a=r[0],c=e.id(),d=a.value;return typeof c==typeof d&&c>d}],"filter-<=":[ke,[We,ot],function(e,r){var a=r[0],c=r[1],d=e.properties()[a.value],g=c.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[ke,[ot],function(e,r){var a=r[0],c=e.id(),d=a.value;return typeof c==typeof d&&c<=d}],"filter->=":[ke,[We,ot],function(e,r){var a=r[0],c=r[1],d=e.properties()[a.value],g=c.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[ke,[ot],function(e,r){var a=r[0],c=e.id(),d=a.value;return typeof c==typeof d&&c>=d}],"filter-has":[ke,[ot],function(e,r){return r[0].value in e.properties()}],"filter-has-id":[ke,[],function(e){return null!==e.id()&&void 0!==e.id()}],"filter-type-in":[ke,[Mn(We)],function(e,r){return r[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[ke,[Mn(ot)],function(e,r){return r[0].value.indexOf(e.id())>=0}],"filter-in-small":[ke,[We,Mn(ot)],function(e,r){var a=r[0];return r[1].value.indexOf(e.properties()[a.value])>=0}],"filter-in-large":[ke,[We,Mn(ot)],function(e,r){var a=r[0],c=r[1];return function(d,g,v,w){for(;v<=w;){var T=v+w>>1;if(g[T]===d)return!0;g[T]>d?w=T-1:v=T+1}return!1}(e.properties()[a.value],c.value,0,c.value.length-1)}],all:{type:ke,overloads:[[[ke,ke],function(e,r){var a=r[1];return r[0].evaluate(e)&&a.evaluate(e)}],[Sa(ke),function(e,r){for(var a=0,c=r;a<c.length;a+=1)if(!c[a].evaluate(e))return!1;return!0}]]},any:{type:ke,overloads:[[[ke,ke],function(e,r){var a=r[1];return r[0].evaluate(e)||a.evaluate(e)}],[Sa(ke),function(e,r){for(var a=0,c=r;a<c.length;a+=1)if(c[a].evaluate(e))return!0;return!1}]]},"!":[ke,[ke],function(e,r){return!r[0].evaluate(e)}],"is-supported-script":[ke,[We],function(e,r){var a=e.globals&&e.globals.isSupportedScript;return!a||a(r[0].evaluate(e))}],upcase:[We,[We],function(e,r){return r[0].evaluate(e).toUpperCase()}],downcase:[We,[We],function(e,r){return r[0].evaluate(e).toLowerCase()}],concat:[We,Sa(ot),function(e,r){return r.map(function(a){return Vr(a.evaluate(e))}).join("")}],"resolved-locale":[We,[gn],function(e,r){return r[0].evaluate(e).resolvedLocale()}]});var Us=function(e,r){var a;this.expression=e,this._warningHistory={},this._evaluator=new yo,this._defaultValue=r?"color"===(a=r).type&&Zu(a.default)?new Nt(0,0,0,0):"color"===a.type?Nt.parse(a.default)||null:void 0===a.default?null:a.default:null,this._enumValues=r&&"enum"===r.type?r.values:null};function Xu(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in ts}function Yu(e,r){var d,g,a=new Bo(ts,[],r?(g={color:Pt,string:We,number:Ae,enum:We,boolean:ke,formatted:Ut,resolvedImage:wn},"array"===(d=r).type?Mn(g[d.value]||ot,d.length):g[d.type]):void 0),c=a.parse(e,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return c?Bs(new Us(c,r)):Co(a.errors)}Us.prototype.evaluateWithoutErrorHandling=function(e,r,a,c,d,g){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)},Us.prototype.evaluate=function(e,r,a,c,d,g){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g||null;try{var v=this.expression.evaluate(this._evaluator);if(null==v||"number"==typeof v&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new An("Expected value to be one of "+Object.keys(this._enumValues).map(function(w){return JSON.stringify(w)}).join(", ")+", but found "+JSON.stringify(v)+" instead.");return v}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,"undefined"!=typeof console&&console.warn(w.message)),this._defaultValue}};var Bl=function(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent="constant"!==e&&!xo(r.expression)};Bl.prototype.evaluateWithoutErrorHandling=function(e,r,a,c,d,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,c,d,g)},Bl.prototype.evaluate=function(e,r,a,c,d,g){return this._styleExpression.evaluate(e,r,a,c,d,g)};var $s=function(e,r,a,c){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent="camera"!==e&&!xo(r.expression),this.interpolationType=c};function oh(e,r){if("error"===(e=Yu(e,r)).result)return e;var a=e.value.expression,c=wa(a);if(!c&&!Ii(r))return Co([new et("","data expressions not supported")]);var d=zl(a,["zoom"]);if(!d&&!Wo(r))return Co([new et("","zoom expressions not supported")]);var g=function v(w){var T=null;if(w instanceof Vo)T=v(w.result);else if(w instanceof wo)for(var P=0,D=w.args;P<D.length&&!(T=v(D[P]));P+=1);else(w instanceof Ur||w instanceof bi)&&w.input instanceof _i&&"zoom"===w.input.name&&(T=w);return T instanceof et||w.eachChild(function(O){var N=v(O);N instanceof et?T=N:!T&&N?T=new et("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):T&&N&&T!==N&&(T=new et("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),T}(a);return g||d?g instanceof et?Co([g]):g instanceof bi&&!Wu(r)?Co([new et("",'"interpolate" expressions cannot be used with this property')]):Bs(g?new $s(c?"camera":"composite",e.value,g.labels,g instanceof bi?g.interpolation:void 0):new Bl(c?"constant":"source",e.value)):Co([new et("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}$s.prototype.evaluateWithoutErrorHandling=function(e,r,a,c,d,g){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,c,d,g)},$s.prototype.evaluate=function(e,r,a,c,d,g){return this._styleExpression.evaluate(e,r,a,c,d,g)},$s.prototype.interpolationFactor=function(e,r,a){return this.interpolationType?bi.interpolationFactor(this.interpolationType,e,r,a):0};var Vl=function(e,r){this._parameters=e,this._specification=r,$e(this,function a(c,d){var g,v,w,T="color"===d.type,P=c.stops&&"object"==typeof c.stops[0][0],D=P||!(P||void 0!==c.property),O=c.type||(Wu(d)?"exponential":"interval");if(T&&((c=$e({},c)).stops&&(c.stops=c.stops.map(function(qe){return[qe[0],Nt.parse(qe[1])]})),c.default=Nt.parse(c.default?c.default:d.default)),c.colorSpace&&"rgb"!==c.colorSpace&&!Kc[c.colorSpace])throw new Error("Unknown color space: "+c.colorSpace);if("exponential"===O)g=Nl;else if("interval"===O)g=Jp;else if("categorical"===O){g=Qp,v=Object.create(null);for(var N=0,U=c.stops;N<U.length;N+=1){var Y=U[N];v[Y[0]]=Y[1]}w=typeof c.stops[0][0]}else{if("identity"!==O)throw new Error('Unknown function type "'+O+'"');g=hp}if(P){for(var K={},le=[],oe=0;oe<c.stops.length;oe++){var de=c.stops[oe],me=de[0].zoom;void 0===K[me]&&(K[me]={zoom:me,type:c.type,property:c.property,default:c.default,stops:[]},le.push(me)),K[me].stops.push([de[0].value,de[1]])}for(var ve=[],be=0,Me=le;be<Me.length;be+=1){var Le=Me[be];ve.push([K[Le].zoom,a(K[Le],d)])}var je={name:"linear"};return{kind:"composite",interpolationType:je,interpolationFactor:bi.interpolationFactor.bind(void 0,je),zoomStops:ve.map(function(qe){return qe[0]}),evaluate:function(qe,lt){var He=qe.zoom;return Nl({stops:ve,base:c.base},d,He).evaluate(He,lt)}}}if(D){var st="exponential"===O?{name:"exponential",base:void 0!==c.base?c.base:1}:null;return{kind:"camera",interpolationType:st,interpolationFactor:bi.interpolationFactor.bind(void 0,st),zoomStops:c.stops.map(function(qe){return qe[0]}),evaluate:function(qe){return g(c,d,qe.zoom,v,w)}}}return{kind:"source",evaluate:function(qe,lt){var He=lt&&lt.properties?lt.properties[c.property]:void 0;return void 0===He?Vs(c.default,d.default):g(c,d,He,v,w)}}}(this._parameters,this._specification))};function to(e){var r=e.key,a=e.value,c=e.valueSpec||{},d=e.objectElementValidators||{},g=e.style,v=e.styleSpec,w=[],T=En(a);if("object"!==T)return[new ie(r,a,"object expected, "+T+" found")];for(var P in a){var D=P.split(".")[0],O=c[D]||c["*"],N=void 0;if(d[D])N=d[D];else if(c[D])N=Ht;else if(d["*"])N=d["*"];else{if(!c["*"]){w.push(new ie(r,a[P],'unknown property "'+P+'"'));continue}N=Ht}w=w.concat(N({key:(r&&r+".")+P,value:a[P],valueSpec:O,style:g,styleSpec:v,object:a,objectKey:P},a))}for(var U in c)d[U]||c[U].required&&void 0===c[U].default&&void 0===a[U]&&w.push(new ie(r,a,'missing required property "'+U+'"'));return w}function pp(e){var r=e.value,a=e.valueSpec,c=e.style,d=e.styleSpec,g=e.key,v=e.arrayElementValidator||Ht;if("array"!==En(r))return[new ie(g,r,"array expected, "+En(r)+" found")];if(a.length&&r.length!==a.length)return[new ie(g,r,"array length "+a.length+" expected, length "+r.length+" found")];if(a["min-length"]&&r.length<a["min-length"])return[new ie(g,r,"array length at least "+a["min-length"]+" expected, length "+r.length+" found")];var w={type:a.value,values:a.values};d.$version<7&&(w.function=a.function),"object"===En(a.value)&&(w=a.value);for(var T=[],P=0;P<r.length;P++)T=T.concat(v({array:r,arrayIndex:P,value:r[P],valueSpec:w,style:c,styleSpec:d,key:g+"["+P+"]"}));return T}function dp(e){var r=e.key,a=e.value,c=e.valueSpec,d=En(a);return"number"===d&&a!=a&&(d="NaN"),"number"!==d?[new ie(r,a,"number expected, "+d+" found")]:"minimum"in c&&a<c.minimum?[new ie(r,a,a+" is less than the minimum value "+c.minimum)]:"maximum"in c&&a>c.maximum?[new ie(r,a,a+" is greater than the maximum value "+c.maximum)]:[]}function ah(e){var r,a,c,d=e.valueSpec,g=ye(e.value.type),v={},w="categorical"!==g&&void 0===e.value.property,T=!w,P="array"===En(e.value.stops)&&"array"===En(e.value.stops[0])&&"object"===En(e.value.stops[0][0]),D=to({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(U){if("identity"===g)return[new ie(U.key,U.value,'identity function may not have a "stops" property')];var Y=[],K=U.value;return Y=Y.concat(pp({key:U.key,value:K,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:O})),"array"===En(K)&&0===K.length&&Y.push(new ie(U.key,K,"array must have at least one stop")),Y},default:function(U){return Ht({key:U.key,value:U.value,valueSpec:d,style:U.style,styleSpec:U.styleSpec})}}});return"identity"===g&&w&&D.push(new ie(e.key,e.value,'missing required property "property"')),"identity"===g||e.value.stops||D.push(new ie(e.key,e.value,'missing required property "stops"')),"exponential"===g&&e.valueSpec.expression&&!Wu(e.valueSpec)&&D.push(new ie(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(T&&!Ii(e.valueSpec)?D.push(new ie(e.key,e.value,"property functions not supported")):w&&!Wo(e.valueSpec)&&D.push(new ie(e.key,e.value,"zoom functions not supported"))),"categorical"!==g&&!P||void 0!==e.value.property||D.push(new ie(e.key,e.value,'"property" property is required')),D;function O(U){var Y=[],K=U.value,le=U.key;if("array"!==En(K))return[new ie(le,K,"array expected, "+En(K)+" found")];if(2!==K.length)return[new ie(le,K,"array length 2 expected, length "+K.length+" found")];if(P){if("object"!==En(K[0]))return[new ie(le,K,"object expected, "+En(K[0])+" found")];if(void 0===K[0].zoom)return[new ie(le,K,"object stop key must have zoom")];if(void 0===K[0].value)return[new ie(le,K,"object stop key must have value")];if(c&&c>ye(K[0].zoom))return[new ie(le,K[0].zoom,"stop zoom values must appear in ascending order")];ye(K[0].zoom)!==c&&(c=ye(K[0].zoom),a=void 0,v={}),Y=Y.concat(to({key:le+"[0]",value:K[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:dp,value:N}}))}else Y=Y.concat(N({key:le+"[0]",value:K[0],valueSpec:{},style:U.style,styleSpec:U.styleSpec},K));return Xu(Ne(K[1]))?Y.concat([new ie(le+"[1]",K[1],"expressions are not allowed in function stops.")]):Y.concat(Ht({key:le+"[1]",value:K[1],valueSpec:d,style:U.style,styleSpec:U.styleSpec}))}function N(U,Y){var K=En(U.value),le=ye(U.value),oe=null!==U.value?U.value:Y;if(r){if(K!==r)return[new ie(U.key,oe,K+" stop domain type must match previous stop domain type "+r)]}else r=K;if("number"!==K&&"string"!==K&&"boolean"!==K)return[new ie(U.key,oe,"stop domain value must be a number, string, or boolean")];if("number"!==K&&"categorical"!==g){var de="number expected, "+K+" found";return Ii(d)&&void 0===g&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ie(U.key,oe,de)]}return"categorical"!==g||"number"!==K||isFinite(le)&&Math.floor(le)===le?"categorical"!==g&&"number"===K&&void 0!==a&&le<a?[new ie(U.key,oe,"stop domain values must appear in ascending order")]:(a=le,"categorical"===g&&le in v?[new ie(U.key,oe,"stop domain values must be unique")]:(v[le]=!0,[])):[new ie(U.key,oe,"integer expected, found "+le)]}}function ns(e){var r=("property"===e.expressionContext?oh:Yu)(Ne(e.value),e.valueSpec);if("error"===r.result)return r.value.map(function(c){return new ie(""+e.key+c.key,e.value,c.message)});var a=r.value.expression||r.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!a.outputDefined())return[new ie(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===e.expressionContext&&"layout"===e.propertyType&&!xo(a))return[new ie(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!xo(a))return[new ie(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!zl(a,["zoom","feature-state"]))return[new ie(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!wa(a))return[new ie(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ul(e){var r=e.key,a=e.value,c=e.valueSpec,d=[];return Array.isArray(c.values)?-1===c.values.indexOf(ye(a))&&d.push(new ie(r,a,"expected one of ["+c.values.join(", ")+"], "+JSON.stringify(a)+" found")):-1===Object.keys(c.values).indexOf(ye(a))&&d.push(new ie(r,a,"expected one of ["+Object.keys(c.values).join(", ")+"], "+JSON.stringify(a)+" found")),d}function $l(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var r=0,a=e.slice(1);r<a.length;r+=1){var c=a[r];if(!$l(c)&&"boolean"!=typeof c)return!1}return!0;default:return!0}}Vl.deserialize=function(e){return new Vl(e._parameters,e._specification)},Vl.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var fp={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function $r(e){if(null==e)return{filter:function(){return!0},needGeometry:!1};$l(e)||(e=jl(e));var r=Yu(e,fp);if("error"===r.result)throw new Error(r.value.map(function(a){return a.key+": "+a.message}).join(", "));return{filter:function(a,c,d){return r.value.evaluate(a,c,{},d)},needGeometry:function a(c){if(!Array.isArray(c))return!1;if("within"===c[0])return!0;for(var d=1;d<c.length;d++)if(a(c[d]))return!0;return!1}(e)}}function mp(e,r){return e<r?-1:e>r?1:0}function jl(e){if(!e)return!0;var r,a=e[0];return e.length<=1?"any"!==a:"=="===a?Ku(e[1],e[2],"=="):"!="===a?is(Ku(e[1],e[2],"==")):"<"===a||">"===a||"<="===a||">="===a?Ku(e[1],e[2],a):"any"===a?(r=e.slice(1),["any"].concat(r.map(jl))):"all"===a?["all"].concat(e.slice(1).map(jl)):"none"===a?["all"].concat(e.slice(1).map(jl).map(is)):"in"===a?sh(e[1],e.slice(2)):"!in"===a?is(sh(e[1],e.slice(2))):"has"===a?xr(e[1]):"!has"===a?is(xr(e[1])):"within"!==a||e}function Ku(e,r,a){switch(e){case"$type":return["filter-type-"+a,r];case"$id":return["filter-id-"+a,r];default:return["filter-"+a,e,r]}}function sh(e,r){if(0===r.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(function(a){return typeof a!=typeof r[0]})?["filter-in-large",e,["literal",r.sort(mp)]]:["filter-in-small",e,["literal",r]]}}function xr(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function is(e){return["!",e]}function Ze(e){return $l(Ne(e.value))?ns($e({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function r(a){var c=a.value,d=a.key;if("array"!==En(c))return[new ie(d,c,"array expected, "+En(c)+" found")];var g,v=a.styleSpec,w=[];if(c.length<1)return[new ie(d,c,"filter array must have at least 1 element")];switch(w=w.concat(Ul({key:d+"[0]",value:c[0],valueSpec:v.filter_operator,style:a.style,styleSpec:a.styleSpec})),ye(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&"$type"===ye(c[1])&&w.push(new ie(d,c,'"$type" cannot be use with operator "'+c[0]+'"'));case"==":case"!=":3!==c.length&&w.push(new ie(d,c,'filter array for operator "'+c[0]+'" must have 3 elements'));case"in":case"!in":c.length>=2&&"string"!==(g=En(c[1]))&&w.push(new ie(d+"[1]",c[1],"string expected, "+g+" found"));for(var T=2;T<c.length;T++)g=En(c[T]),"$type"===ye(c[1])?w=w.concat(Ul({key:d+"["+T+"]",value:c[T],valueSpec:v.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==g&&"number"!==g&&"boolean"!==g&&w.push(new ie(d+"["+T+"]",c[T],"string, number, or boolean expected, "+g+" found"));break;case"any":case"all":case"none":for(var P=1;P<c.length;P++)w=w.concat(r({key:d+"["+P+"]",value:c[P],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":g=En(c[1]),2!==c.length?w.push(new ie(d,c,'filter array for "'+c[0]+'" operator must have 2 elements')):"string"!==g&&w.push(new ie(d+"[1]",c[1],"string expected, "+g+" found"));break;case"within":g=En(c[1]),2!==c.length?w.push(new ie(d,c,'filter array for "'+c[0]+'" operator must have 2 elements')):"object"!==g&&w.push(new ie(d+"[1]",c[1],"object expected, "+g+" found"))}return w}(e)}function Zo(e,r){var a=e.key,c=e.style,d=e.styleSpec,g=e.value,v=e.objectKey,w=d[r+"_"+e.layerType];if(!w)return[];var T=v.match(/^(.*)-transition$/);if("paint"===r&&T&&w[T[1]]&&w[T[1]].transition)return Ht({key:a,value:g,valueSpec:d.transition,style:c,styleSpec:d});var P,D=e.valueSpec||w[v];if(!D)return[new ie(a,g,'unknown property "'+v+'"')];if("string"===En(g)&&Ii(D)&&!D.tokens&&(P=/^{([^}]+)}$/.exec(g)))return[new ie(a,g,'"'+v+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(P[1])+" }`.")];var O=[];return"symbol"===e.layerType&&("text-field"===v&&c&&!c.glyphs&&O.push(new ie(a,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&Zu(Ne(g))&&"identity"===ye(g.type)&&O.push(new ie(a,g,'"text-font" does not support identity functions'))),O.concat(Ht({key:e.key,value:g,valueSpec:D,style:c,styleSpec:d,expressionContext:"property",propertyType:r,propertyKey:v}))}function rs(e){return Zo(e,"paint")}function lh(e){return Zo(e,"layout")}function js(e){var r=[],a=e.value,c=e.key,d=e.style,g=e.styleSpec;a.type||a.ref||r.push(new ie(c,a,'either "type" or "ref" is required'));var v,w=ye(a.type),T=ye(a.ref);if(a.id)for(var P=ye(a.id),D=0;D<e.arrayIndex;D++){var O=d.layers[D];ye(O.id)===P&&r.push(new ie(c,a.id,'duplicate layer id "'+a.id+'", previously used at line '+O.id.__line__))}if("ref"in a)["type","source","source-layer","filter","layout"].forEach(function(Y){Y in a&&r.push(new ie(c,a[Y],'"'+Y+'" is prohibited for ref layers'))}),d.layers.forEach(function(Y){ye(Y.id)===T&&(v=Y)}),v?v.ref?r.push(new ie(c,a.ref,"ref cannot reference another ref layer")):w=ye(v.type):r.push(new ie(c,a.ref,'ref layer "'+T+'" not found'));else if("background"!==w)if(a.source){var N=d.sources&&d.sources[a.source],U=N&&ye(N.type);N?"vector"===U&&"raster"===w?r.push(new ie(c,a.source,'layer "'+a.id+'" requires a raster source')):"raster"===U&&"raster"!==w?r.push(new ie(c,a.source,'layer "'+a.id+'" requires a vector source')):"vector"!==U||a["source-layer"]?"raster-dem"===U&&"hillshade"!==w?r.push(new ie(c,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==w||!a.paint||!a.paint["line-gradient"]||"geojson"===U&&N.lineMetrics||r.push(new ie(c,a,'layer "'+a.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):r.push(new ie(c,a,'layer "'+a.id+'" must specify a "source-layer"')):r.push(new ie(c,a.source,'source "'+a.source+'" not found'))}else r.push(new ie(c,a,'missing required property "source"'));return r=r.concat(to({key:c,value:a,valueSpec:g.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Ht({key:c+".type",value:a.type,valueSpec:g.layer.type,style:e.style,styleSpec:e.styleSpec,object:a,objectKey:"type"})},filter:Ze,layout:function(Y){return to({layer:a,key:Y.key,value:Y.value,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{"*":function(K){return lh($e({layerType:w},K))}}})},paint:function(Y){return to({layer:a,key:Y.key,value:Y.value,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{"*":function(K){return rs($e({layerType:w},K))}}})}}}))}function an(e){var r=e.value,a=e.key,c=En(r);return"string"!==c?[new ie(a,r,"string expected, "+c+" found")]:[]}var Ta={promoteId:function(e){var r=e.key,a=e.value;if("string"===En(a))return an({key:r,value:a});var c=[];for(var d in a)c.push.apply(c,an({key:r+"."+d,value:a[d]}));return c}};function Xo(e){var r=e.value,a=e.key,c=e.styleSpec,d=e.style;if(!r.type)return[new ie(a,r,'"type" is required')];var g,v=ye(r.type);switch(v){case"vector":case"raster":case"raster-dem":return to({key:a,value:r,valueSpec:c["source_"+v.replace("-","_")],style:e.style,styleSpec:c,objectElementValidators:Ta});case"geojson":if(g=to({key:a,value:r,valueSpec:c.source_geojson,style:d,styleSpec:c,objectElementValidators:Ta}),r.cluster)for(var w in r.clusterProperties){var T=r.clusterProperties[w],P=T[0],D="string"==typeof P?[P,["accumulated"],["get",w]]:P;g.push.apply(g,ns({key:a+"."+w+".map",value:T[1],expressionContext:"cluster-map"})),g.push.apply(g,ns({key:a+"."+w+".reduce",value:D,expressionContext:"cluster-reduce"}))}return g;case"video":return to({key:a,value:r,valueSpec:c.source_video,style:d,styleSpec:c});case"image":return to({key:a,value:r,valueSpec:c.source_image,style:d,styleSpec:c});case"canvas":return[new ie(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ul({key:a+".type",value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:c})}}function Yo(e){var r=e.value,a=e.styleSpec,c=a.light,d=e.style,g=[],v=En(r);if(void 0===r)return g;if("object"!==v)return g.concat([new ie("light",r,"object expected, "+v+" found")]);for(var w in r){var T=w.match(/^(.*)-transition$/);g=g.concat(T&&c[T[1]]&&c[T[1]].transition?Ht({key:w,value:r[w],valueSpec:a.transition,style:d,styleSpec:a}):c[w]?Ht({key:w,value:r[w],valueSpec:c[w],style:d,styleSpec:a}):[new ie(w,r[w],'unknown property "'+w+'"')])}return g}var rn={"*":function(){return[]},array:pp,boolean:function(e){var r=e.value,a=e.key,c=En(r);return"boolean"!==c?[new ie(a,r,"boolean expected, "+c+" found")]:[]},number:dp,color:function(e){var r=e.key,a=e.value,c=En(a);return"string"!==c?[new ie(r,a,"color expected, "+c+" found")]:null===Qa(a)?[new ie(r,a,'color expected, "'+a+'" found')]:[]},constants:ze,enum:Ul,filter:Ze,function:ah,layer:js,object:to,source:Xo,light:Yo,string:an,formatted:function(e){return 0===an(e).length?[]:ns(e)},resolvedImage:function(e){return 0===an(e).length?[]:ns(e)}};function Ht(e){var r=e.value,a=e.valueSpec,c=e.styleSpec;return a.expression&&Zu(ye(r))?ah(e):a.expression&&Xu(Ne(r))?ns(e):a.type&&rn[a.type]?rn[a.type](e):to($e({},e,{valueSpec:a.type?c[a.type]:a}))}function Eo(e){var r=e.value,a=e.key,c=an(e);return c.length||(-1===r.indexOf("{fontstack}")&&c.push(new ie(a,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&c.push(new ie(a,r,'"glyphs" url must include a "{range}" token'))),c}function So(e,r){void 0===r&&(r=X);var a=[];return a=a.concat(Ht({key:"",value:e,valueSpec:r.$root,styleSpec:r,style:e,objectElementValidators:{glyphs:Eo,"*":function(){return[]}}})),e.constants&&(a=a.concat(ze({key:"constants",value:e.constants,style:e,styleSpec:r}))),qs(a)}function qs(e){return[].concat(e).sort(function(r,a){return r.line-a.line})}function Ia(e){return function(){for(var r=[],a=arguments.length;a--;)r[a]=arguments[a];return qs(e.apply(this,r))}}So.source=Ia(Xo),So.light=Ia(Yo),So.layer=Ia(js),So.filter=Ia(Ze),So.paintProperty=Ia(rs),So.layoutProperty=Ia(lh);var Gs=So,ed=Gs.light,ql=Gs.paintProperty,Gl=Gs.layoutProperty;function Hl(e,r){var a=!1;if(r&&r.length)for(var c=0,d=r;c<d.length;c+=1)e.fire(new he(new Error(d[c].message))),a=!0;return a}var zi=br;function br(e,r,a){var c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var d=new Int32Array(this.arrayBuffer);e=d[0],this.d=(r=d[1])+2*(a=d[2]);for(var g=0;g<this.d*this.d;g++){var v=d[3+g],w=d[3+g+1];c.push(v===w?null:d.subarray(v,w))}var T=d[3+c.length+1];this.keys=d.subarray(d[3+c.length],T),this.bboxes=d.subarray(T),this.insert=this._insertReadonly}else{this.d=r+2*a;for(var P=0;P<this.d*this.d;P++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;var D=a/r*e;this.min=-D,this.max=e+D}br.prototype.insert=function(e,r,a,c,d){this._forEachCell(r,a,c,d,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(d)},br.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},br.prototype._insertCell=function(e,r,a,c,d,g){this.cells[d].push(g)},br.prototype.query=function(e,r,a,c,d){var g=this.min,v=this.max;if(e<=g&&r<=g&&v<=a&&v<=c&&!d)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(e,r,a,c,this._queryCell,w,{},d),w},br.prototype._queryCell=function(e,r,a,c,d,g,v,w){var T=this.cells[d];if(null!==T)for(var P=this.keys,D=this.bboxes,O=0;O<T.length;O++){var N=T[O];if(void 0===v[N]){var U=4*N;(w?w(D[U+0],D[U+1],D[U+2],D[U+3]):e<=D[U+2]&&r<=D[U+3]&&a>=D[U+0]&&c>=D[U+1])?(v[N]=!0,g.push(P[N])):v[N]=!1}}},br.prototype._forEachCell=function(e,r,a,c,d,g,v,w){for(var T=this._convertToCellCoord(e),P=this._convertToCellCoord(r),D=this._convertToCellCoord(a),O=this._convertToCellCoord(c),N=T;N<=D;N++)for(var U=P;U<=O;U++){var Y=this.d*U+N;if((!w||w(this._convertFromCellCoord(N),this._convertFromCellCoord(U),this._convertFromCellCoord(N+1),this._convertFromCellCoord(U+1)))&&d.call(this,e,r,a,c,Y,g,v,w))return}},br.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},br.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},br.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,r=3+this.cells.length+1+1,a=0,c=0;c<this.cells.length;c++)a+=this.cells[c].length;var d=new Int32Array(r+a+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var g=r,v=0;v<e.length;v++){var w=e[v];d[3+v]=g,d.set(w,g),g+=w.length}return d[3+e.length]=g,d.set(this.keys,g),d[3+e.length+1]=g+=this.keys.length,d.set(this.bboxes,g),g+=this.bboxes.length,d.buffer};var no=at.ImageData,wi=at.ImageBitmap,er={};function Je(e,r,a){void 0===a&&(a={}),Object.defineProperty(r,"_classRegistryKey",{value:e,writeable:!1}),er[e]={klass:r,omit:a.omit||[],shallow:a.shallow||[]}}for(var Wl in Je("Object",Object),zi.serialize=function(e,r){var a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}},zi.deserialize=function(e){return new zi(e.buffer)},Je("Grid",zi),Je("Color",Nt),Je("Error",Error),Je("ResolvedImage",xi),Je("StylePropertyFunction",Vl),Je("StyleExpression",Us,{omit:["_evaluator"]}),Je("ZoomDependentExpression",$s),Je("ZoomConstantExpression",Bl),Je("CompoundExpression",_i,{omit:["_evaluate"]}),ts)ts[Wl]._classRegistryKey||Je("Expression_"+Wl,ts[Wl]);function Hs(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Ko(e){return wi&&e instanceof wi}function Li(e,r){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Hs(e)||Ko(e))return r&&r.push(e),e;if(ArrayBuffer.isView(e)){var a=e;return r&&r.push(a.buffer),a}if(e instanceof no)return r&&r.push(e.data.buffer),e;if(Array.isArray(e)){for(var c=[],d=0,g=e;d<g.length;d+=1)c.push(Li(g[d],r));return c}if("object"==typeof e){var v=e.constructor,w=v._classRegistryKey;if(!w)throw new Error("can't serialize object of unregistered class");var T=v.serialize?v.serialize(e,r):{};if(!v.serialize){for(var P in e)if(e.hasOwnProperty(P)&&!(er[w].omit.indexOf(P)>=0)){var D=e[P];T[P]=er[w].shallow.indexOf(P)>=0?D:Li(D,r)}e instanceof Error&&(T.message=e.message)}if(T.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==w&&(T.$name=w),T}throw new Error("can't serialize object of type "+typeof e)}function os(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Hs(e)||Ko(e)||ArrayBuffer.isView(e)||e instanceof no)return e;if(Array.isArray(e))return e.map(os);if("object"==typeof e){var r=e.$name||"Object",a=er[r].klass;if(!a)throw new Error("can't deserialize unregistered class "+r);if(a.deserialize)return a.deserialize(e);for(var c=Object.create(a.prototype),d=0,g=Object.keys(e);d<g.length;d+=1){var v=g[d];if("$name"!==v){var w=e[v];c[v]=er[r].shallow.indexOf(v)>=0?w:os(w)}}return c}throw new Error("can't deserialize object of type "+typeof e)}var qi=function(){this.first=!0};qi.prototype.update=function(e,r){var a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))};var tt={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Qo(e){for(var r=0,a=e;r<a.length;r+=1)if(ri(a[r].charCodeAt(0)))return!0;return!1}function ri(e){return!(746!==e&&747!==e&&(e<4352||!(tt["Bopomofo Extended"](e)||tt.Bopomofo(e)||tt["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||tt["CJK Compatibility Ideographs"](e)||tt["CJK Compatibility"](e)||tt["CJK Radicals Supplement"](e)||tt["CJK Strokes"](e)||!(!tt["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||tt["CJK Unified Ideographs Extension A"](e)||tt["CJK Unified Ideographs"](e)||tt["Enclosed CJK Letters and Months"](e)||tt["Hangul Compatibility Jamo"](e)||tt["Hangul Jamo Extended-A"](e)||tt["Hangul Jamo Extended-B"](e)||tt["Hangul Jamo"](e)||tt["Hangul Syllables"](e)||tt.Hiragana(e)||tt["Ideographic Description Characters"](e)||tt.Kanbun(e)||tt["Kangxi Radicals"](e)||tt["Katakana Phonetic Extensions"](e)||tt.Katakana(e)&&12540!==e||!(!tt["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!tt["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||tt["Unified Canadian Aboriginal Syllabics"](e)||tt["Unified Canadian Aboriginal Syllabics Extended"](e)||tt["Vertical Forms"](e)||tt["Yijing Hexagram Symbols"](e)||tt["Yi Syllables"](e)||tt["Yi Radicals"](e))))}function Gi(e){return!(ri(e)||(r=e,tt["Latin-1 Supplement"](r)&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||tt["General Punctuation"](r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||tt["Letterlike Symbols"](r)||tt["Number Forms"](r)||tt["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||tt["Control Pictures"](r)&&9251!==r||tt["Optical Character Recognition"](r)||tt["Enclosed Alphanumerics"](r)||tt["Geometric Shapes"](r)||tt["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||tt["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||tt["CJK Symbols and Punctuation"](r)||tt.Katakana(r)||tt["Private Use Area"](r)||tt["CJK Compatibility Forms"](r)||tt["Small Form Variants"](r)||tt["Halfwidth and Fullwidth Forms"](r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r}function tr(e){return e>=1424&&e<=2303||tt["Arabic Presentation Forms-A"](e)||tt["Arabic Presentation Forms-B"](e)}function Qu(e,r){return!(!r&&tr(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||tt.Khmer(e))}function uh(e){for(var r=0,a=e;r<a.length;r+=1)if(tr(a[r].charCodeAt(0)))return!0;return!1}var Ju=null,qn="unavailable",ar=null,Ws=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(qn="error"),Ju&&Ju(e)};function as(){Zs.fire(new ce("pluginStateChange",{pluginStatus:qn,pluginURL:ar}))}var Zs=new ue,wr=function(){return qn},ch=function(){if("deferred"!==qn||!ar)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");qn="loading",as(),ar&&Bn({url:ar},function(e){e?Ws(e):(qn="loaded",as())})},Dn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===qn||null!=Dn.applyArabicShaping},isLoading:function(){return"loading"===qn},setState:function(e){qn=e.pluginStatus,ar=e.pluginURL},isParsed:function(){return null!=Dn.applyArabicShaping&&null!=Dn.processBidirectionalText&&null!=Dn.processStyledBidirectionalText},getPluginURL:function(){return ar}},on=function(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qi,this.transition={})};on.prototype.isSupportedScript=function(e){return function(r,a){for(var c=0,d=r;c<d.length;c+=1)if(!Qu(d[c].charCodeAt(0),a))return!1;return!0}(e,Dn.isLoaded())},on.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},on.prototype.getCrossfadeParameters=function(){var e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}};var Cr=function(e,r){this.property=e,this.value=r,this.expression=function(a,c){if(Zu(a))return new Vl(a,c);if(Xu(a)){var d=oh(a,c);if("error"===d.result)throw new Error(d.value.map(function(v){return v.key+": "+v.message}).join(", "));return d.value}var g=a;return"string"==typeof a&&"color"===c.type&&(g=Nt.parse(a)),{kind:"constant",evaluate:function(){return g}}}(void 0===r?e.specification.default:r,e.specification)};Cr.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},Cr.prototype.possiblyEvaluate=function(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)};var sr=function(e){this.property=e,this.value=new Cr(e,void 0)};sr.prototype.transitioned=function(e,r){return new ss(this.property,this.value,r,yi({},e.transition,this.transition),e.now)},sr.prototype.untransitioned=function(){return new ss(this.property,this.value,null,{},0)};var lr=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};lr.prototype.getValue=function(e){return Lr(this._values[e].value.value)},lr.prototype.setValue=function(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new sr(this._values[e].property)),this._values[e].value=new Cr(this._values[e].property,null===r?void 0:Lr(r))},lr.prototype.getTransition=function(e){return Lr(this._values[e].transition)},lr.prototype.setTransition=function(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new sr(this._values[e].property)),this._values[e].transition=Lr(r)||void 0},lr.prototype.serialize=function(){for(var e={},r=0,a=Object.keys(this._values);r<a.length;r+=1){var c=a[r],d=this.getValue(c);void 0!==d&&(e[c]=d);var g=this.getTransition(c);void 0!==g&&(e[c+"-transition"]=g)}return e},lr.prototype.transitioned=function(e,r){for(var a=new io(this._properties),c=0,d=Object.keys(this._values);c<d.length;c+=1){var g=d[c];a._values[g]=this._values[g].transitioned(e,r._values[g])}return a},lr.prototype.untransitioned=function(){for(var e=new io(this._properties),r=0,a=Object.keys(this._values);r<a.length;r+=1){var c=a[r];e._values[c]=this._values[c].untransitioned()}return e};var ss=function(e,r,a,c,d){this.property=e,this.value=r,this.begin=d+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)};ss.prototype.possiblyEvaluate=function(e,r,a){var c=e.now||0,d=this.value.possiblyEvaluate(e,r,a),g=this.prior;if(g){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return g.possiblyEvaluate(e,r,a);var v=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,r,a),d,function(w){if(w<=0)return 0;if(w>=1)return 1;var T=w*w,P=T*w;return 4*(w<.5?P:3*(w-T)+P-.75)}(v))}return d};var io=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};io.prototype.possiblyEvaluate=function(e,r,a){for(var c=new jr(this._properties),d=0,g=Object.keys(this._values);d<g.length;d+=1){var v=g[d];c._values[v]=this._values[v].possiblyEvaluate(e,r,a)}return c},io.prototype.hasTransition=function(){for(var e=0,r=Object.keys(this._values);e<r.length;e+=1)if(this._values[r[e]].prior)return!0;return!1};var ro=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};ro.prototype.getValue=function(e){return Lr(this._values[e].value)},ro.prototype.setValue=function(e,r){this._values[e]=new Cr(this._values[e].property,null===r?void 0:Lr(r))},ro.prototype.serialize=function(){for(var e={},r=0,a=Object.keys(this._values);r<a.length;r+=1){var c=a[r],d=this.getValue(c);void 0!==d&&(e[c]=d)}return e},ro.prototype.possiblyEvaluate=function(e,r,a){for(var c=new jr(this._properties),d=0,g=Object.keys(this._values);d<g.length;d+=1){var v=g[d];c._values[v]=this._values[v].possiblyEvaluate(e,r,a)}return c};var Er=function(e,r,a){this.property=e,this.value=r,this.parameters=a};Er.prototype.isConstant=function(){return"constant"===this.value.kind},Er.prototype.constantOr=function(e){return"constant"===this.value.kind?this.value.value:e},Er.prototype.evaluate=function(e,r,a,c){return this.property.evaluate(this.value,this.parameters,e,r,a,c)};var jr=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};jr.prototype.get=function(e){return this._values[e]};var Ke=function(e){this.specification=e};Ke.prototype.possiblyEvaluate=function(e,r){return e.expression.evaluate(r)},Ke.prototype.interpolate=function(e,r,a){var c=Ll[this.specification.type];return c?c(e,r,a):e};var bt=function(e,r){this.specification=e,this.overrides=r};bt.prototype.possiblyEvaluate=function(e,r,a,c){return new Er(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(r,null,{},a,c)}:e.expression,r)},bt.prototype.interpolate=function(e,r,a){if("constant"!==e.value.kind||"constant"!==r.value.kind)return e;if(void 0===e.value.value||void 0===r.value.value)return new Er(this,{kind:"constant",value:void 0},e.parameters);var c=Ll[this.specification.type];return c?new Er(this,{kind:"constant",value:c(e.value.value,r.value.value,a)},e.parameters):e},bt.prototype.evaluate=function(e,r,a,c,d,g){return"constant"===e.kind?e.value:e.evaluate(r,a,c,d,g)};var ur=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.possiblyEvaluate=function(a,c,d,g){if(void 0===a.value)return new Er(this,{kind:"constant",value:void 0},c);if("constant"===a.expression.kind){var v=a.expression.evaluate(c,null,{},d,g),w="resolvedImage"===a.property.specification.type&&"string"!=typeof v?v.name:v,T=this._calculate(w,w,w,c);return new Er(this,{kind:"constant",value:T},c)}if("camera"===a.expression.kind){var P=this._calculate(a.expression.evaluate({zoom:c.zoom-1}),a.expression.evaluate({zoom:c.zoom}),a.expression.evaluate({zoom:c.zoom+1}),c);return new Er(this,{kind:"constant",value:P},c)}return new Er(this,a.expression,c)},r.prototype.evaluate=function(a,c,d,g,v,w){if("source"===a.kind){var T=a.evaluate(c,d,g,v,w);return this._calculate(T,T,T,c)}return"composite"===a.kind?this._calculate(a.evaluate({zoom:Math.floor(c.zoom)-1},d,g),a.evaluate({zoom:Math.floor(c.zoom)},d,g),a.evaluate({zoom:Math.floor(c.zoom)+1},d,g),c):a.value},r.prototype._calculate=function(a,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:a,to:c}:{from:d,to:c}},r.prototype.interpolate=function(a){return a},r}(bt),Sr=function(e){this.specification=e};Sr.prototype.possiblyEvaluate=function(e,r,a,c){if(void 0!==e.value){if("constant"===e.expression.kind){var d=e.expression.evaluate(r,null,{},a,c);return this._calculate(d,d,d,r)}return this._calculate(e.expression.evaluate(new on(Math.floor(r.zoom-1),r)),e.expression.evaluate(new on(Math.floor(r.zoom),r)),e.expression.evaluate(new on(Math.floor(r.zoom+1),r)),r)}},Sr.prototype._calculate=function(e,r,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}},Sr.prototype.interpolate=function(e){return e};var Tr=function(e){this.specification=e};Tr.prototype.possiblyEvaluate=function(e,r,a,c){return!!e.expression.evaluate(r,null,{},a,c)},Tr.prototype.interpolate=function(){return!1};var nr=function(e){for(var r in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var a=e[r];a.specification.overridable&&this.overridableProperties.push(r);var c=this.defaultPropertyValues[r]=new Cr(a,void 0),d=this.defaultTransitionablePropertyValues[r]=new sr(a);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}};Je("DataDrivenProperty",bt),Je("DataConstantProperty",Ke),Je("CrossFadedDataDrivenProperty",ur),Je("CrossFadedProperty",Sr),Je("ColorRampProperty",Tr);var Ir=function(e){function r(a,c){if(e.call(this),this.id=a.id,this.type=a.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==a.type&&(this.metadata=(a=a).metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,"background"!==a.type&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),c.layout&&(this._unevaluatedLayout=new ro(c.layout)),c.paint)){for(var d in this._transitionablePaint=new lr(c.paint),a.paint)this.setPaintProperty(d,a.paint[d],{validate:!1});for(var g in a.layout)this.setLayoutProperty(g,a.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new jr(c.paint)}}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},r.prototype.getLayoutProperty=function(a){return"visibility"===a?this.visibility:this._unevaluatedLayout.getValue(a)},r.prototype.setLayoutProperty=function(a,c,d){void 0===d&&(d={}),null!=c&&this._validate(Gl,"layers."+this.id+".layout."+a,a,c,d)||("visibility"!==a?this._unevaluatedLayout.setValue(a,c):this.visibility=c)},r.prototype.getPaintProperty=function(a){return da(a,"-transition")?this._transitionablePaint.getTransition(a.slice(0,-"-transition".length)):this._transitionablePaint.getValue(a)},r.prototype.setPaintProperty=function(a,c,d){if(void 0===d&&(d={}),null!=c&&this._validate(ql,"layers."+this.id+".paint."+a,a,c,d))return!1;if(da(a,"-transition"))return this._transitionablePaint.setTransition(a.slice(0,-"-transition".length),c||void 0),!1;var g=this._transitionablePaint._values[a],v="cross-faded-data-driven"===g.property.specification["property-type"],w=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(a,c),this._handleSpecialPaintPropertyUpdate(a);var P=this._transitionablePaint._values[a].value;return P.isDataDriven()||w||v||this._handleOverridablePaintPropertyUpdate(a,T,P)},r.prototype._handleSpecialPaintPropertyUpdate=function(a){},r.prototype._handleOverridablePaintPropertyUpdate=function(a,c,d){return!1},r.prototype.isHidden=function(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||"none"===this.visibility},r.prototype.updateTransitions=function(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)},r.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},r.prototype.recalculate=function(a,c){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,c)},r.prototype.serialize=function(){var a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),mo(a,function(c,d){return!(void 0===c||"layout"===d&&!Object.keys(c).length||"paint"===d&&!Object.keys(c).length)})},r.prototype._validate=function(a,c,d,g,v){return void 0===v&&(v={}),(!v||!1!==v.validate)&&Hl(this,a.call(Gs,{key:c,layerType:this.type,objectKey:d,value:g,styleSpec:X,style:{glyphs:!0,sprite:!0}}))},r.prototype.is3D=function(){return!1},r.prototype.isTileClipped=function(){return!1},r.prototype.hasOffscreenPass=function(){return!1},r.prototype.resize=function(){},r.prototype.isStateDependent=function(){for(var a in this.paint._values){var c=this.paint.get(a);if(c instanceof Er&&Ii(c.property.specification)&&("source"===c.value.kind||"composite"===c.value.kind)&&c.value.isStateDependent)return!0}return!1},r}(ue),gp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},To=function(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Sn=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ci(e,r){void 0===r&&(r=1);var a=0,c=0;return{members:e.map(function(d){var g=gp[d.type].BYTES_PER_ELEMENT,v=a=ec(a,Math.max(r,g)),w=d.components||1;return c=Math.max(c,g),a+=g*w,{name:d.name,type:d.type,components:w,offset:v}}),size:ec(a,Math.max(c,r)),alignment:r}}function ec(e,r){return Math.ceil(e/r)*r}Sn.serialize=function(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Sn.deserialize=function(e){var r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r},Sn.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Sn.prototype.clear=function(){this.length=0},Sn.prototype.resize=function(e){this.reserve(e),this.length=e},Sn.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}},Sn.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ma=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c){var d=this.length;return this.resize(d+1),this.emplace(d,a,c)},r.prototype.emplace=function(a,c,d){var g=2*a;return this.int16[g+0]=c,this.int16[g+1]=d,a},r}(Sn);Ma.prototype.bytesPerElement=4,Je("StructArrayLayout2i4",Ma);var cr=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d,g){var v=this.length;return this.resize(v+1),this.emplace(v,a,c,d,g)},r.prototype.emplace=function(a,c,d,g,v){var w=4*a;return this.int16[w+0]=c,this.int16[w+1]=d,this.int16[w+2]=g,this.int16[w+3]=v,a},r}(Sn);cr.prototype.bytesPerElement=8,Je("StructArrayLayout4i8",cr);var si=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d,g,v,w){var T=this.length;return this.resize(T+1),this.emplace(T,a,c,d,g,v,w)},r.prototype.emplace=function(a,c,d,g,v,w,T){var P=6*a;return this.int16[P+0]=c,this.int16[P+1]=d,this.int16[P+2]=g,this.int16[P+3]=v,this.int16[P+4]=w,this.int16[P+5]=T,a},r}(Sn);si.prototype.bytesPerElement=12,Je("StructArrayLayout2i4i12",si);var Zl=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d,g,v,w){var T=this.length;return this.resize(T+1),this.emplace(T,a,c,d,g,v,w)},r.prototype.emplace=function(a,c,d,g,v,w,T){var P=4*a,D=8*a;return this.int16[P+0]=c,this.int16[P+1]=d,this.uint8[D+4]=g,this.uint8[D+5]=v,this.uint8[D+6]=w,this.uint8[D+7]=T,a},r}(Sn);Zl.prototype.bytesPerElement=8,Je("StructArrayLayout2i4ub8",Zl);var Aa=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c){var d=this.length;return this.resize(d+1),this.emplace(d,a,c)},r.prototype.emplace=function(a,c,d){var g=2*a;return this.float32[g+0]=c,this.float32[g+1]=d,a},r}(Sn);Aa.prototype.bytesPerElement=8,Je("StructArrayLayout2f8",Aa);var Io=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d,g,v,w,T,P,D,O){var N=this.length;return this.resize(N+1),this.emplace(N,a,c,d,g,v,w,T,P,D,O)},r.prototype.emplace=function(a,c,d,g,v,w,T,P,D,O,N){var U=10*a;return this.uint16[U+0]=c,this.uint16[U+1]=d,this.uint16[U+2]=g,this.uint16[U+3]=v,this.uint16[U+4]=w,this.uint16[U+5]=T,this.uint16[U+6]=P,this.uint16[U+7]=D,this.uint16[U+8]=O,this.uint16[U+9]=N,a},r}(Sn);Io.prototype.bytesPerElement=20,Je("StructArrayLayout10ui20",Io);var ls=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d,g,v,w,T,P,D,O,N,U){var Y=this.length;return this.resize(Y+1),this.emplace(Y,a,c,d,g,v,w,T,P,D,O,N,U)},r.prototype.emplace=function(a,c,d,g,v,w,T,P,D,O,N,U,Y){var K=12*a;return this.int16[K+0]=c,this.int16[K+1]=d,this.int16[K+2]=g,this.int16[K+3]=v,this.uint16[K+4]=w,this.uint16[K+5]=T,this.uint16[K+6]=P,this.uint16[K+7]=D,this.int16[K+8]=O,this.int16[K+9]=N,this.int16[K+10]=U,this.int16[K+11]=Y,a},r}(Sn);ls.prototype.bytesPerElement=24,Je("StructArrayLayout4i4ui4i24",ls);var Pa=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d){var g=this.length;return this.resize(g+1),this.emplace(g,a,c,d)},r.prototype.emplace=function(a,c,d,g){var v=3*a;return this.float32[v+0]=c,this.float32[v+1]=d,this.float32[v+2]=g,a},r}(Sn);Pa.prototype.bytesPerElement=12,Je("StructArrayLayout3f12",Pa);var pn=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a){var c=this.length;return this.resize(c+1),this.emplace(c,a)},r.prototype.emplace=function(a,c){return this.uint32[1*a+0]=c,a},r}(Sn);pn.prototype.bytesPerElement=4,Je("StructArrayLayout1ul4",pn);var us=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d,g,v,w,T,P,D){var O=this.length;return this.resize(O+1),this.emplace(O,a,c,d,g,v,w,T,P,D)},r.prototype.emplace=function(a,c,d,g,v,w,T,P,D,O){var N=10*a,U=5*a;return this.int16[N+0]=c,this.int16[N+1]=d,this.int16[N+2]=g,this.int16[N+3]=v,this.int16[N+4]=w,this.int16[N+5]=T,this.uint32[U+3]=P,this.uint16[N+8]=D,this.uint16[N+9]=O,a},r}(Sn);us.prototype.bytesPerElement=20,Je("StructArrayLayout6i1ul2ui20",us);var Jo=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d,g,v,w){var T=this.length;return this.resize(T+1),this.emplace(T,a,c,d,g,v,w)},r.prototype.emplace=function(a,c,d,g,v,w,T){var P=6*a;return this.int16[P+0]=c,this.int16[P+1]=d,this.int16[P+2]=g,this.int16[P+3]=v,this.int16[P+4]=w,this.int16[P+5]=T,a},r}(Sn);Jo.prototype.bytesPerElement=12,Je("StructArrayLayout2i2i2i12",Jo);var tc=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d,g,v){var w=this.length;return this.resize(w+1),this.emplace(w,a,c,d,g,v)},r.prototype.emplace=function(a,c,d,g,v,w){var T=4*a,P=8*a;return this.float32[T+0]=c,this.float32[T+1]=d,this.float32[T+2]=g,this.int16[P+6]=v,this.int16[P+7]=w,a},r}(Sn);tc.prototype.bytesPerElement=16,Je("StructArrayLayout2f1f2i16",tc);var nc=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d,g){var v=this.length;return this.resize(v+1),this.emplace(v,a,c,d,g)},r.prototype.emplace=function(a,c,d,g,v){var w=12*a,T=3*a;return this.uint8[w+0]=c,this.uint8[w+1]=d,this.float32[T+1]=g,this.float32[T+2]=v,a},r}(Sn);nc.prototype.bytesPerElement=12,Je("StructArrayLayout2ub2f12",nc);var ir=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d){var g=this.length;return this.resize(g+1),this.emplace(g,a,c,d)},r.prototype.emplace=function(a,c,d,g){var v=3*a;return this.uint16[v+0]=c,this.uint16[v+1]=d,this.uint16[v+2]=g,a},r}(Sn);ir.prototype.bytesPerElement=6,Je("StructArrayLayout3ui6",ir);var ic=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d,g,v,w,T,P,D,O,N,U,Y,K,le,oe,de){var me=this.length;return this.resize(me+1),this.emplace(me,a,c,d,g,v,w,T,P,D,O,N,U,Y,K,le,oe,de)},r.prototype.emplace=function(a,c,d,g,v,w,T,P,D,O,N,U,Y,K,le,oe,de,me){var ve=24*a,be=12*a,Me=48*a;return this.int16[ve+0]=c,this.int16[ve+1]=d,this.uint16[ve+2]=g,this.uint16[ve+3]=v,this.uint32[be+2]=w,this.uint32[be+3]=T,this.uint32[be+4]=P,this.uint16[ve+10]=D,this.uint16[ve+11]=O,this.uint16[ve+12]=N,this.float32[be+7]=U,this.float32[be+8]=Y,this.uint8[Me+36]=K,this.uint8[Me+37]=le,this.uint8[Me+38]=oe,this.uint32[be+10]=de,this.int16[ve+22]=me,a},r}(Sn);ic.prototype.bytesPerElement=48,Je("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ic);var cs=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d,g,v,w,T,P,D,O,N,U,Y,K,le,oe,de,me,ve,be,Me,Le,je,st,qe,lt,He,St){var gt=this.length;return this.resize(gt+1),this.emplace(gt,a,c,d,g,v,w,T,P,D,O,N,U,Y,K,le,oe,de,me,ve,be,Me,Le,je,st,qe,lt,He,St)},r.prototype.emplace=function(a,c,d,g,v,w,T,P,D,O,N,U,Y,K,le,oe,de,me,ve,be,Me,Le,je,st,qe,lt,He,St,gt){var Qe=34*a,Rt=17*a;return this.int16[Qe+0]=c,this.int16[Qe+1]=d,this.int16[Qe+2]=g,this.int16[Qe+3]=v,this.int16[Qe+4]=w,this.int16[Qe+5]=T,this.int16[Qe+6]=P,this.int16[Qe+7]=D,this.uint16[Qe+8]=O,this.uint16[Qe+9]=N,this.uint16[Qe+10]=U,this.uint16[Qe+11]=Y,this.uint16[Qe+12]=K,this.uint16[Qe+13]=le,this.uint16[Qe+14]=oe,this.uint16[Qe+15]=de,this.uint16[Qe+16]=me,this.uint16[Qe+17]=ve,this.uint16[Qe+18]=be,this.uint16[Qe+19]=Me,this.uint16[Qe+20]=Le,this.uint16[Qe+21]=je,this.uint16[Qe+22]=st,this.uint32[Rt+12]=qe,this.float32[Rt+13]=lt,this.float32[Rt+14]=He,this.float32[Rt+15]=St,this.float32[Rt+16]=gt,a},r}(Sn);cs.prototype.bytesPerElement=68,Je("StructArrayLayout8i15ui1ul4f68",cs);var hr=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a){var c=this.length;return this.resize(c+1),this.emplace(c,a)},r.prototype.emplace=function(a,c){return this.float32[1*a+0]=c,a},r}(Sn);hr.prototype.bytesPerElement=4,Je("StructArrayLayout1f4",hr);var Xl=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d){var g=this.length;return this.resize(g+1),this.emplace(g,a,c,d)},r.prototype.emplace=function(a,c,d,g){var v=3*a;return this.int16[v+0]=c,this.int16[v+1]=d,this.int16[v+2]=g,a},r}(Sn);Xl.prototype.bytesPerElement=6,Je("StructArrayLayout3i6",Xl);var Yl=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d){var g=this.length;return this.resize(g+1),this.emplace(g,a,c,d)},r.prototype.emplace=function(a,c,d,g){var v=4*a;return this.uint32[2*a+0]=c,this.uint16[v+2]=d,this.uint16[v+3]=g,a},r}(Sn);Yl.prototype.bytesPerElement=8,Je("StructArrayLayout1ul2ui8",Yl);var Xs=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c){var d=this.length;return this.resize(d+1),this.emplace(d,a,c)},r.prototype.emplace=function(a,c,d){var g=2*a;return this.uint16[g+0]=c,this.uint16[g+1]=d,a},r}(Sn);Xs.prototype.bytesPerElement=4,Je("StructArrayLayout2ui4",Xs);var Kl=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a){var c=this.length;return this.resize(c+1),this.emplace(c,a)},r.prototype.emplace=function(a,c){return this.uint16[1*a+0]=c,a},r}(Sn);Kl.prototype.bytesPerElement=2,Je("StructArrayLayout1ui2",Kl);var s=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,c,d,g){var v=this.length;return this.resize(v+1),this.emplace(v,a,c,d,g)},r.prototype.emplace=function(a,c,d,g,v){var w=4*a;return this.float32[w+0]=c,this.float32[w+1]=d,this.float32[w+2]=g,this.float32[w+3]=v,a},r}(Sn);s.prototype.bytesPerElement=16,Je("StructArrayLayout4f16",s);var u=function(e){function r(){e.apply(this,arguments)}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var a={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return a.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},a.x1.get=function(){return this._structArray.int16[this._pos2+2]},a.y1.get=function(){return this._structArray.int16[this._pos2+3]},a.x2.get=function(){return this._structArray.int16[this._pos2+4]},a.y2.get=function(){return this._structArray.int16[this._pos2+5]},a.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},a.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},a.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},a.anchorPoint.get=function(){return new yt(this.anchorPointX,this.anchorPointY)},Object.defineProperties(r.prototype,a),r}(To);u.prototype.size=20;var l=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.get=function(a){return new u(this,a)},r}(us);Je("CollisionBoxArray",l);var h=function(e){function r(){e.apply(this,arguments)}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var a={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return a.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},a.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},a.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},a.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},a.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},a.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},a.segment.get=function(){return this._structArray.uint16[this._pos2+10]},a.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},a.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},a.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},a.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},a.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},a.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},a.placedOrientation.set=function(c){this._structArray.uint8[this._pos1+37]=c},a.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},a.hidden.set=function(c){this._structArray.uint8[this._pos1+38]=c},a.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},a.crossTileID.set=function(c){this._structArray.uint32[this._pos4+10]=c},a.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(r.prototype,a),r}(To);h.prototype.size=48;var _=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.get=function(a){return new h(this,a)},r}(ic);Je("PlacedSymbolArray",_);var x=function(e){function r(){e.apply(this,arguments)}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var a={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return a.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},a.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},a.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},a.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},a.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},a.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},a.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},a.key.get=function(){return this._structArray.uint16[this._pos2+8]},a.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},a.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},a.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},a.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},a.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},a.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},a.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},a.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},a.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},a.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},a.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},a.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},a.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},a.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},a.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},a.crossTileID.set=function(c){this._structArray.uint32[this._pos4+12]=c},a.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},a.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},a.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},a.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(r.prototype,a),r}(To);x.prototype.size=68;var b=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.get=function(a){return new x(this,a)},r}(cs);Je("SymbolInstanceArray",b);var S=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getoffsetX=function(a){return this.float32[1*a+0]},r}(hr);Je("GlyphOffsetArray",S);var k=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getx=function(a){return this.int16[3*a+0]},r.prototype.gety=function(a){return this.int16[3*a+1]},r.prototype.gettileUnitDistanceFromAnchor=function(a){return this.int16[3*a+2]},r}(Xl);Je("SymbolLineVertexArray",k);var L=function(e){function r(){e.apply(this,arguments)}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var a={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return a.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},a.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},a.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(r.prototype,a),r}(To);L.prototype.size=8;var j=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.get=function(a){return new L(this,a)},r}(Yl);Je("FeatureIndexArray",j);var H=Ci([{name:"a_pos",components:2,type:"Int16"}],4).members,q=function(e){void 0===e&&(e=[]),this.segments=e};function ee(e,r){return 256*(e=Yi(Math.floor(e),0,255))+Yi(Math.floor(r),0,255)}q.prototype.prepareSegment=function(e,r,a,c){var d=this.segments[this.segments.length-1];return e>q.MAX_VERTEX_ARRAY_LENGTH&&Nn("Max vertices per segment is "+q.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!d||d.vertexLength+e>q.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},void 0!==c&&(d.sortKey=c),this.segments.push(d)),d},q.prototype.get=function(){return this.segments},q.prototype.destroy=function(){for(var e=0,r=this.segments;e<r.length;e+=1){var a=r[e];for(var c in a.vaos)a.vaos[c].destroy()}},q.simpleSegment=function(e,r,a,c){return new q([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])},q.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Je("SegmentVector",q);var J=Ci([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ae=Xi(function(e){e.exports=function(r,a){var c,d,g,v,w,T,P,D;for(d=r.length-(c=3&r.length),g=a,w=3432918353,T=461845907,D=0;D<d;)P=255&r.charCodeAt(D)|(255&r.charCodeAt(++D))<<8|(255&r.charCodeAt(++D))<<16|(255&r.charCodeAt(++D))<<24,++D,g=27492+(65535&(v=5*(65535&(g=(g^=P=(65535&(P=(P=(65535&P)*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*T+(((P>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(P=0,c){case 3:P^=(255&r.charCodeAt(D+2))<<16;case 2:P^=(255&r.charCodeAt(D+1))<<8;case 1:g^=P=(65535&(P=(P=(65535&(P^=255&r.charCodeAt(D)))*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*T+(((P>>>16)*T&65535)<<16)&4294967295}return g^=r.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),Q=Xi(function(e){e.exports=function(r,a){for(var c,d=r.length,g=a^d,v=0;d>=4;)c=1540483477*(65535&(c=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++v;switch(d){case 3:g^=(255&r.charCodeAt(v+2))<<16;case 2:g^=(255&r.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&r.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),re=ae,pe=Q;re.murmur3=ae,re.murmur2=pe;var fe=function(){this.ids=[],this.positions=[],this.indexed=!1};fe.prototype.add=function(e,r,a,c){this.ids.push(xe(e)),this.positions.push(r,a,c)},fe.prototype.getPositions=function(e){for(var r=xe(e),a=0,c=this.ids.length-1;a<c;){var d=a+c>>1;this.ids[d]>=r?c=d:a=d+1}for(var g=[];this.ids[a]===r;)g.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return g},fe.serialize=function(e,r){var a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return function d(g,v,w,T){for(;w<T;){for(var P=g[w+T>>1],D=w-1,O=T+1;;){do{D++}while(g[D]<P);do{O--}while(g[O]>P);if(D>=O)break;Ee(g,D,O),Ee(v,3*D,3*O),Ee(v,3*D+1,3*O+1),Ee(v,3*D+2,3*O+2)}O-w<T-O?(d(g,v,w,O),w=O+1):(d(g,v,O+1,T),T=O)}}(a,c,0,a.length-1),r&&r.push(a.buffer,c.buffer),{ids:a,positions:c}},fe.deserialize=function(e){var r=new fe;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r};var Ce=Math.pow(2,53)-1;function xe(e){var r=+e;return!isNaN(r)&&r<=Ce?r:re(String(e))}function Ee(e,r,a){var c=e[r];e[r]=e[a],e[a]=c}Je("FeaturePositionMap",fe);var Ie=function(e,r){this.gl=e.gl,this.location=r},Ue=function(e){function r(a,c){e.call(this,a,c),this.current=0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))},r}(Ie),Be=function(e){function r(a,c){e.call(this,a,c),this.current=0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))},r}(Ie),Xe=function(e){function r(a,c){e.call(this,a,c),this.current=[0,0]}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))},r}(Ie),pt=function(e){function r(a,c){e.call(this,a,c),this.current=[0,0,0]}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))},r}(Ie),mt=function(e){function r(a,c){e.call(this,a,c),this.current=[0,0,0,0]}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))},r}(Ie),dt=function(e){function r(a,c){e.call(this,a,c),this.current=Nt.transparent}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))},r}(Ie),Wt=new Float32Array(16),nt=function(e){function r(a,c){e.call(this,a,c),this.current=Wt}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(var c=1;c<16;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}},r}(Ie);function It(e){return[ee(255*e.r,255*e.g),ee(255*e.b,255*e.a)]}var Dt=function(e,r,a){this.value=e,this.uniformNames=r.map(function(c){return"u_"+c}),this.type=a};Dt.prototype.setUniform=function(e,r,a){e.set(a.constantOr(this.value))},Dt.prototype.getBinding=function(e,r,a){return"color"===this.type?new dt(e,r):new Be(e,r)};var Mt=function(e,r){this.uniformNames=r.map(function(a){return"u_"+a}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Mt.prototype.setConstantPatternPositions=function(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr},Mt.prototype.setUniform=function(e,r,a,c){var d="u_pattern_to"===c?this.patternTo:"u_pattern_from"===c?this.patternFrom:"u_pixel_ratio_to"===c?this.pixelRatioTo:"u_pixel_ratio_from"===c?this.pixelRatioFrom:null;d&&e.set(d)},Mt.prototype.getBinding=function(e,r,a){return"u_pattern"===a.substr(0,9)?new mt(e,r):new Be(e,r)};var Et=function(e,r,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(function(d){return{name:"a_"+d,type:"Float32",components:"color"===a?2:1,offset:0}}),this.paintVertexArray=new c};Et.prototype.populatePaintArray=function(e,r,a,c,d){var g=this.paintVertexArray.length,v=this.expression.evaluate(new on(0),r,{},c,[],d);this.paintVertexArray.resize(e),this._setPaintValue(g,e,v)},Et.prototype.updatePaintArray=function(e,r,a,c){var d=this.expression.evaluate({zoom:0},a,c);this._setPaintValue(e,r,d)},Et.prototype._setPaintValue=function(e,r,a){if("color"===this.type)for(var c=It(a),d=e;d<r;d++)this.paintVertexArray.emplace(d,c[0],c[1]);else{for(var g=e;g<r;g++)this.paintVertexArray.emplace(g,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}},Et.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Et.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Ct=function(e,r,a,c,d,g){this.expression=e,this.uniformNames=r.map(function(v){return"u_"+v+"_t"}),this.type=a,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(function(v){return{name:"a_"+v,type:"Float32",components:"color"===a?4:2,offset:0}}),this.paintVertexArray=new g};Ct.prototype.populatePaintArray=function(e,r,a,c,d){var g=this.expression.evaluate(new on(this.zoom),r,{},c,[],d),v=this.expression.evaluate(new on(this.zoom+1),r,{},c,[],d),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,g,v)},Ct.prototype.updatePaintArray=function(e,r,a,c){var d=this.expression.evaluate({zoom:this.zoom},a,c),g=this.expression.evaluate({zoom:this.zoom+1},a,c);this._setPaintValue(e,r,d,g)},Ct.prototype._setPaintValue=function(e,r,a,c){if("color"===this.type)for(var d=It(a),g=It(c),v=e;v<r;v++)this.paintVertexArray.emplace(v,d[0],d[1],g[0],g[1]);else{for(var w=e;w<r;w++)this.paintVertexArray.emplace(w,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}},Ct.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ct.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Ct.prototype.setUniform=function(e,r){var a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=Yi(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(c)},Ct.prototype.getBinding=function(e,r,a){return new Be(e,r)};var wt=function(e,r,a,c,d,g){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d};wt.prototype.populatePaintArray=function(e,r,a){var c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],a)},wt.prototype.updatePaintArray=function(e,r,a,c,d){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],d)},wt.prototype._setPaintValues=function(e,r,a,c){if(c&&a){var d=c[a.min],g=c[a.mid],v=c[a.max];if(d&&g&&v)for(var w=e;w<r;w++)this.zoomInPaintVertexArray.emplace(w,g.tl[0],g.tl[1],g.br[0],g.br[1],d.tl[0],d.tl[1],d.br[0],d.br[1],g.pixelRatio,d.pixelRatio),this.zoomOutPaintVertexArray.emplace(w,g.tl[0],g.tl[1],g.br[0],g.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],g.pixelRatio,v.pixelRatio)}},wt.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,J.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,J.members,this.expression.isStateDependent))},wt.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var _t=function(e,r,a){this.binders={},this._buffers=[];var c=[];for(var d in e.paint._values)if(a(d)){var g=e.paint.get(d);if(g instanceof Er&&Ii(g.property.specification)){var v=Gn(d,e.type),w=g.value,T=g.property.specification.type,P=g.property.useIntegerZoom,D=g.property.specification["property-type"],O="cross-faded"===D||"cross-faded-data-driven"===D;if("constant"===w.kind)this.binders[d]=O?new Mt(w.value,v):new Dt(w.value,v,T),c.push("/u_"+d);else if("source"===w.kind||O){var N=Ri(d,T,"source");this.binders[d]=O?new wt(w,T,P,r,N,e.id):new Et(w,v,T,N),c.push("/a_"+d)}else{var U=Ri(d,T,"composite");this.binders[d]=new Ct(w,v,T,P,r,U),c.push("/z_"+d)}}}this.cacheKey=c.sort().join("")};_t.prototype.getMaxValue=function(e){var r=this.binders[e];return r instanceof Et||r instanceof Ct?r.maxValue:0},_t.prototype.populatePaintArrays=function(e,r,a,c,d){for(var g in this.binders){var v=this.binders[g];(v instanceof Et||v instanceof Ct||v instanceof wt)&&v.populatePaintArray(e,r,a,c,d)}},_t.prototype.setConstantPatternPositions=function(e,r){for(var a in this.binders){var c=this.binders[a];c instanceof Mt&&c.setConstantPatternPositions(e,r)}},_t.prototype.updatePaintArrays=function(e,r,a,c,d){var g=!1;for(var v in e)for(var w=0,T=r.getPositions(v);w<T.length;w+=1){var P=T[w],D=a.feature(P.index);for(var O in this.binders){var N=this.binders[O];if((N instanceof Et||N instanceof Ct||N instanceof wt)&&!0===N.expression.isStateDependent){var U=c.paint.get(O);N.expression=U.value,N.updatePaintArray(P.start,P.end,D,e[v],d),g=!0}}}return g},_t.prototype.defines=function(){var e=[];for(var r in this.binders){var a=this.binders[r];(a instanceof Dt||a instanceof Mt)&&e.push.apply(e,a.uniformNames.map(function(c){return"#define HAS_UNIFORM_"+c}))}return e},_t.prototype.getBinderAttributes=function(){var e=[];for(var r in this.binders){var a=this.binders[r];if(a instanceof Et||a instanceof Ct)for(var c=0;c<a.paintVertexAttributes.length;c++)e.push(a.paintVertexAttributes[c].name);else if(a instanceof wt)for(var d=0;d<J.members.length;d++)e.push(J.members[d].name)}return e},_t.prototype.getBinderUniforms=function(){var e=[];for(var r in this.binders){var a=this.binders[r];if(a instanceof Dt||a instanceof Mt||a instanceof Ct)for(var c=0,d=a.uniformNames;c<d.length;c+=1)e.push(d[c])}return e},_t.prototype.getPaintVertexBuffers=function(){return this._buffers},_t.prototype.getUniforms=function(e,r){var a=[];for(var c in this.binders){var d=this.binders[c];if(d instanceof Dt||d instanceof Mt||d instanceof Ct)for(var g=0,v=d.uniformNames;g<v.length;g+=1){var w=v[g];if(r[w]){var T=d.getBinding(e,r[w],w);a.push({name:w,property:c,binding:T})}}}return a},_t.prototype.setUniforms=function(e,r,a,c){for(var d=0,g=r;d<g.length;d+=1){var v=g[d],w=v.name,T=v.property;this.binders[T].setUniform(v.binding,c,a.get(T),w)}},_t.prototype.updatePaintBuffers=function(e){for(var r in this._buffers=[],this.binders){var a=this.binders[r];if(e&&a instanceof wt){var c=2===e.fromScale?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(a instanceof Et||a instanceof Ct)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}},_t.prototype.upload=function(e){for(var r in this.binders){var a=this.binders[r];(a instanceof Et||a instanceof Ct||a instanceof wt)&&a.upload(e)}this.updatePaintBuffers()},_t.prototype.destroy=function(){for(var e in this.binders){var r=this.binders[e];(r instanceof Et||r instanceof Ct||r instanceof wt)&&r.destroy()}};var un=function(e,r,a){void 0===a&&(a=function(){return!0}),this.programConfigurations={};for(var c=0,d=e;c<d.length;c+=1){var g=d[c];this.programConfigurations[g.id]=new _t(g,r,a)}this.needsUpload=!1,this._featureMap=new fe,this._bufferOffset=0};function Gn(e,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(r+"-","").replace(/-/g,"_")]}function Ri(e,r,a){var d={"line-pattern":{source:Io,composite:Io},"fill-pattern":{source:Io,composite:Io},"fill-extrusion-pattern":{source:Io,composite:Io}}[e];return d&&d[a]||{color:{source:Aa,composite:s},number:{source:hr,composite:Aa}}[r][a]}un.prototype.populatePaintArrays=function(e,r,a,c,d,g){for(var v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,r,c,d,g);void 0!==r.id&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},un.prototype.updatePaintArrays=function(e,r,a,c){for(var d=0,g=a;d<g.length;d+=1){var v=g[d];this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(e,this._featureMap,r,v,c)||this.needsUpload}},un.prototype.get=function(e){return this.programConfigurations[e]},un.prototype.upload=function(e){if(this.needsUpload){for(var r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}},un.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Je("ConstantBinder",Dt),Je("CrossFadedConstantBinder",Mt),Je("SourceExpressionBinder",Et),Je("CrossFadedCompositeBinder",wt),Je("CompositeExpressionBinder",Ct),Je("ProgramConfiguration",_t,{omit:["_buffers"]}),Je("ProgramConfigurationSet",un);var li=Math.pow(2,14)-1,ui=-li-1;function Hn(e){for(var r=8192/e.extent,a=e.loadGeometry(),c=0;c<a.length;c++)for(var d=a[c],g=0;g<d.length;g++){var v=d[g],w=Math.round(v.x*r),T=Math.round(v.y*r);v.x=Yi(w,ui,li),v.y=Yi(T,ui,li),(w<v.x||w>v.x+1||T<v.y||T>v.y+1)&&Nn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return a}function Mi(e,r){return{type:e.type,id:e.id,properties:e.properties,geometry:r?Hn(e):[]}}function oo(e,r,a,c,d){e.emplaceBack(2*r+(c+1)/2,2*a+(d+1)/2)}var Fi=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ma,this.indexArray=new ir,this.segments=new q,this.programConfigurations=new un(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};function Ni(e,r){for(var a=0;a<e.length;a++)if(Ao(r,e[a]))return!0;for(var c=0;c<r.length;c++)if(Ao(e,r[c]))return!0;return!!qr(e,r)}function Mr(e,r,a){return!!Ao(e,r)||!!ps(r,e,a)}function pr(e,r){if(1===e.length)return ka(r,e[0]);for(var a=0;a<r.length;a++)for(var c=r[a],d=0;d<c.length;d++)if(Ao(e,c[d]))return!0;for(var g=0;g<e.length;g++)if(ka(r,e[g]))return!0;for(var v=0;v<r.length;v++)if(qr(e,r[v]))return!0;return!1}function Mo(e,r,a){if(e.length>1){if(qr(e,r))return!0;for(var c=0;c<r.length;c++)if(ps(r[c],e,a))return!0}for(var d=0;d<e.length;d++)if(ps(e[d],r,a))return!0;return!1}function qr(e,r){if(0===e.length||0===r.length)return!1;for(var a=0;a<e.length-1;a++)for(var c=e[a],d=e[a+1],g=0;g<r.length-1;g++)if(hs(c,d,r[g],r[g+1]))return!0;return!1}function hs(e,r,a,c){return Ki(e,a,c)!==Ki(r,a,c)&&Ki(e,r,a)!==Ki(e,r,c)}function ps(e,r,a){var c=a*a;if(1===r.length)return e.distSqr(r[0])<c;for(var d=1;d<r.length;d++)if(ea(e,r[d-1],r[d])<c)return!0;return!1}function ea(e,r,a){var c=r.distSqr(a);if(0===c)return e.distSqr(r);var d=((e.x-r.x)*(a.x-r.x)+(e.y-r.y)*(a.y-r.y))/c;return e.distSqr(d<0?r:d>1?a:a.sub(r)._mult(d)._add(r))}function ka(e,r){for(var a,c,d,g=!1,v=0;v<e.length;v++)for(var w=0,T=(a=e[v]).length-1;w<a.length;T=w++)(c=a[w]).y>r.y!=(d=a[T]).y>r.y&&r.x<(d.x-c.x)*(r.y-c.y)/(d.y-c.y)+c.x&&(g=!g);return g}function Ao(e,r){for(var a=!1,c=0,d=e.length-1;c<e.length;d=c++){var g=e[c],v=e[d];g.y>r.y!=v.y>r.y&&r.x<(v.x-g.x)*(r.y-g.y)/(v.y-g.y)+g.x&&(a=!a)}return a}function Ys(e,r,a){var c=a[0],d=a[2];if(e.x<c.x&&r.x<c.x||e.x>d.x&&r.x>d.x||e.y<c.y&&r.y<c.y||e.y>d.y&&r.y>d.y)return!1;var g=Ki(e,r,a[0]);return g!==Ki(e,r,a[1])||g!==Ki(e,r,a[2])||g!==Ki(e,r,a[3])}function oi(e,r,a){var c=r.paint.get(e).value;return"constant"===c.kind?c.value:a.programConfigurations.get(r.id).getMaxValue(e)}function Bi(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Gr(e,r,a,c,d){if(!r[0]&&!r[1])return e;var g=yt.convert(r)._mult(d);"viewport"===a&&g._rotate(-c);for(var v=[],w=0;w<e.length;w++)v.push(e[w].sub(g));return v}Fi.prototype.populate=function(e,r,a){var c=this.layers[0],d=[],g=null,v=!1;"circle"===c.type&&(v=!(g=c.layout.get("circle-sort-key")).isConstant());for(var w=0,T=e;w<T.length;w+=1){var P=T[w],D=P.feature,O=P.id,N=P.index,U=P.sourceLayerIndex,Y=this.layers[0]._featureFilter.needGeometry,K=Mi(D,Y);if(this.layers[0]._featureFilter.filter(new on(this.zoom),K,a)){var le=v?g.evaluate(K,{},a):void 0,oe={id:O,properties:D.properties,type:D.type,sourceLayerIndex:U,index:N,geometry:Y?K.geometry:Hn(D),patterns:{},sortKey:le};d.push(oe)}}v&&d.sort(function(st,qe){return st.sortKey-qe.sortKey});for(var de=0,me=d;de<me.length;de+=1){var ve=me[de],be=ve.geometry,Me=ve.index,Le=ve.sourceLayerIndex,je=e[Me].feature;this.addFeature(ve,be,Me,a),r.featureIndex.insert(je,be,Me,Le,this.index)}},Fi.prototype.update=function(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)},Fi.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Fi.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Fi.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,H),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Fi.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Fi.prototype.addFeature=function(e,r,a,c){for(var d=0,g=r;d<g.length;d+=1)for(var v=0,w=g[d];v<w.length;v+=1){var T=w[v],P=T.x,D=T.y;if(!(P<0||P>=8192||D<0||D>=8192)){var O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),N=O.vertexLength;oo(this.layoutVertexArray,P,D,-1,-1),oo(this.layoutVertexArray,P,D,1,-1),oo(this.layoutVertexArray,P,D,1,1),oo(this.layoutVertexArray,P,D,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),O.vertexLength+=4,O.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c)},Je("CircleBucket",Fi,{omit:["layers"]});var Da=new nr({"circle-sort-key":new bt(X.layout_circle["circle-sort-key"])}),Wn={paint:new nr({"circle-radius":new bt(X.paint_circle["circle-radius"]),"circle-color":new bt(X.paint_circle["circle-color"]),"circle-blur":new bt(X.paint_circle["circle-blur"]),"circle-opacity":new bt(X.paint_circle["circle-opacity"]),"circle-translate":new Ke(X.paint_circle["circle-translate"]),"circle-translate-anchor":new Ke(X.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ke(X.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ke(X.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bt(X.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bt(X.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bt(X.paint_circle["circle-stroke-opacity"])}),layout:Da},$n="undefined"!=typeof Float32Array?Float32Array:Array;function Hi(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ql(e,r,a){var c=r[0],d=r[1],g=r[2],v=r[3],w=r[4],T=r[5],P=r[6],D=r[7],O=r[8],N=r[9],U=r[10],Y=r[11],K=r[12],le=r[13],oe=r[14],de=r[15],me=a[0],ve=a[1],be=a[2],Me=a[3];return e[0]=me*c+ve*w+be*O+Me*K,e[1]=me*d+ve*T+be*N+Me*le,e[2]=me*g+ve*P+be*U+Me*oe,e[3]=me*v+ve*D+be*Y+Me*de,e[4]=(me=a[4])*c+(ve=a[5])*w+(be=a[6])*O+(Me=a[7])*K,e[5]=me*d+ve*T+be*N+Me*le,e[6]=me*g+ve*P+be*U+Me*oe,e[7]=me*v+ve*D+be*Y+Me*de,e[8]=(me=a[8])*c+(ve=a[9])*w+(be=a[10])*O+(Me=a[11])*K,e[9]=me*d+ve*T+be*N+Me*le,e[10]=me*g+ve*P+be*U+Me*oe,e[11]=me*v+ve*D+be*Y+Me*de,e[12]=(me=a[12])*c+(ve=a[13])*w+(be=a[14])*O+(Me=a[15])*K,e[13]=me*d+ve*T+be*N+Me*le,e[14]=me*g+ve*P+be*U+Me*oe,e[15]=me*v+ve*D+be*Y+Me*de,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,r=0,a=arguments.length;a--;)r+=e[a]*e[a];return Math.sqrt(r)});var ds,e,fs=Ql;function rc(e,r,a){var c=r[0],d=r[1],g=r[2],v=r[3];return e[0]=a[0]*c+a[4]*d+a[8]*g+a[12]*v,e[1]=a[1]*c+a[5]*d+a[9]*g+a[13]*v,e[2]=a[2]*c+a[6]*d+a[10]*g+a[14]*v,e[3]=a[3]*c+a[7]*d+a[11]*g+a[15]*v,e}ds=new $n(3),$n!=Float32Array&&(ds[0]=0,ds[1]=0,ds[2]=0),e=new $n(4),$n!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0);var oc=(function(){var e=new $n(2);$n!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function r(a){e.call(this,a,Wn)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.createBucket=function(a){return new Fi(a)},r.prototype.queryRadius=function(a){var c=a;return oi("circle-radius",this,c)+oi("circle-stroke-width",this,c)+Bi(this.paint.get("circle-translate"))},r.prototype.queryIntersectsFeature=function(a,c,d,g,v,w,T,P){for(var D=Gr(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,T),O=this.paint.get("circle-radius").evaluate(c,d)+this.paint.get("circle-stroke-width").evaluate(c,d),N="map"===this.paint.get("circle-pitch-alignment"),U=N?D:function(Le,je){return Le.map(function(st){return hh(st,je)})}(D,P),Y=N?O*T:O,K=0,le=g;K<le.length;K+=1)for(var oe=0,de=le[K];oe<de.length;oe+=1){var me=de[oe],ve=N?me:hh(me,P),be=Y,Me=rc([],[me.x,me.y,0,1],P);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?be*=Me[3]/w.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(be*=w.cameraToCenterDistance/Me[3]),Mr(U,ve,be))return!0}return!1},r}(Ir));function hh(e,r){var a=rc([],[e.x,e.y,0,1],r);return new yt(a[0]/a[3],a[1]/a[3])}var Ks=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(Fi);function Po(e,r,a,c){var d=r.width,g=r.height;if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==d*g*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(d*g*a);return e.width=d,e.height=g,e.data=c,e}function ph(e,r,a){var c=r.width,d=r.height;if(c!==e.width||d!==e.height){var g=Po({},{width:c,height:d},a);dh(e,g,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,c),height:Math.min(e.height,d)},a),e.width=c,e.height=d,e.data=g.data}}function dh(e,r,a,c,d,g){if(0===d.width||0===d.height)return r;if(d.width>e.width||d.height>e.height||a.x>e.width-d.width||a.y>e.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>r.width||d.height>r.height||c.x>r.width-d.width||c.y>r.height-d.height)throw new RangeError("out of range destination coordinates for image copy");for(var v=e.data,w=r.data,T=0;T<d.height;T++)for(var P=((a.y+T)*e.width+a.x)*g,D=((c.y+T)*r.width+c.x)*g,O=0;O<d.width*g;O++)w[D+O]=v[P+O];return r}Je("HeatmapBucket",Ks,{omit:["layers"]});var Qs=function(e,r){Po(this,e,1,r)};Qs.prototype.resize=function(e){ph(this,e,1)},Qs.prototype.clone=function(){return new Qs({width:this.width,height:this.height},new Uint8Array(this.data))},Qs.copy=function(e,r,a,c,d){dh(e,r,a,c,d,1)};var Vi=function(e,r){Po(this,e,4,r)};Vi.prototype.resize=function(e){ph(this,e,4)},Vi.prototype.replace=function(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},Vi.prototype.clone=function(){return new Vi({width:this.width,height:this.height},new Uint8Array(this.data))},Vi.copy=function(e,r,a,c,d){dh(e,r,a,c,d,4)},Je("AlphaImage",Qs),Je("RGBAImage",Vi);var td={paint:new nr({"heatmap-radius":new bt(X.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bt(X.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ke(X.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Tr(X.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ke(X.paint_heatmap["heatmap-opacity"])})};function fh(e){var r={},a=e.resolution||256,c=e.clips?e.clips.length:1,d=e.image||new Vi({width:a,height:c}),g=function(Y,K,le){r[e.evaluationKey]=le;var oe=e.expression.evaluate(r);d.data[Y+K+0]=Math.floor(255*oe.r/oe.a),d.data[Y+K+1]=Math.floor(255*oe.g/oe.a),d.data[Y+K+2]=Math.floor(255*oe.b/oe.a),d.data[Y+K+3]=Math.floor(255*oe.a)};if(e.clips)for(var v=0,w=0;v<c;++v,w+=4*a)for(var T=0,P=0;T<a;T++,P+=4){var D=T/(a-1),O=e.clips[v];g(w,P,O.start*(1-D)+O.end*D)}else for(var N=0,U=0;N<a;N++,U+=4)g(0,U,N/(a-1));return d}var nd=function(e){function r(a){e.call(this,a,td),this._updateColorRamp()}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.createBucket=function(a){return new Ks(a)},r.prototype._handleSpecialPaintPropertyUpdate=function(a){"heatmap-color"===a&&this._updateColorRamp()},r.prototype._updateColorRamp=function(){this.colorRamp=fh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},r.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},r.prototype.queryRadius=function(){return 0},r.prototype.queryIntersectsFeature=function(){return!1},r.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},r}(Ir),mf={paint:new nr({"hillshade-illumination-direction":new Ke(X.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ke(X.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ke(X.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ke(X.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ke(X.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ke(X.paint_hillshade["hillshade-accent-color"])})},gf=function(e){function r(a){e.call(this,a,mf)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},r}(Ir),_f=Ci([{name:"a_pos",components:2,type:"Int16"}],4).members,mh=gh,vf=gh;function gh(e,r,a){a=a||2;var c,d,g,v,w,T,P,D=r&&r.length,O=D?r[0]*a:e.length,N=_p(e,0,O,a,!0),U=[];if(!N||N.next===N.prev)return U;if(D&&(N=function(K,le,oe,de){var me,ve,be,Me=[];for(me=0,ve=le.length;me<ve;me++)(be=_p(K,le[me]*de,me<ve-1?le[me+1]*de:K.length,de,!1))===be.next&&(be.steiner=!0),Me.push(eu(be));for(Me.sort(bf),me=0;me<Me.length;me++)rd(Me[me],oe),oe=ms(oe,oe.next);return oe}(e,r,N,a)),e.length>80*a){c=g=e[0],d=v=e[1];for(var Y=a;Y<O;Y+=a)(w=e[Y])<c&&(c=w),(T=e[Y+1])<d&&(d=T),w>g&&(g=w),T>v&&(v=T);P=0!==(P=Math.max(g-c,v-d))?1/P:0}return Jl(N,U,a,c,d,P),U}function _p(e,r,a,c,d){var g,v;if(d===tu(e,r,a,c)>0)for(g=r;g<a;g+=c)v=ko(g,e[g],e[g+1],v);else for(g=a-c;g>=r;g-=c)v=ko(g,e[g],e[g+1],v);return v&&ta(v,v.next)&&(Ei(v),v=v.next),v}function ms(e,r){if(!e)return e;r||(r=e);var a,c=e;do{if(a=!1,c.steiner||!ta(c,c.next)&&0!==On(c.prev,c,c.next))c=c.next;else{if(Ei(c),(c=r=c.prev)===c.next)break;a=!0}}while(a||c!==r);return r}function Jl(e,r,a,c,d,g,v){if(e){!v&&g&&function(D,O,N,U){var Y=D;do{null===Y.z&&(Y.z=ac(Y.x,Y.y,O,N,U)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next}while(Y!==D);Y.prevZ.nextZ=null,Y.prevZ=null,function(K){var le,oe,de,me,ve,be,Me,Le,je=1;do{for(oe=K,K=null,ve=null,be=0;oe;){for(be++,de=oe,Me=0,le=0;le<je&&(Me++,de=de.nextZ);le++);for(Le=je;Me>0||Le>0&&de;)0!==Me&&(0===Le||!de||oe.z<=de.z)?(me=oe,oe=oe.nextZ,Me--):(me=de,de=de.nextZ,Le--),ve?ve.nextZ=me:K=me,me.prevZ=ve,ve=me;oe=de}ve.nextZ=null,je*=2}while(be>1)}(Y)}(e,c,d,g);for(var w,T,P=e;e.prev!==e.next;)if(w=e.prev,T=e.next,g?vp(e,c,d,g):id(e))r.push(w.i/a),r.push(e.i/a),r.push(T.i/a),Ei(e),e=T.next,P=T.next;else if((e=T)===P){v?1===v?Jl(e=yf(ms(e),r,a),r,a,c,d,g,2):2===v&&xf(e,r,a,c,d,g):Jl(ms(e),r,a,c,d,g,1);break}}}function id(e){var r=e.prev,a=e,c=e.next;if(On(r,a,c)>=0)return!1;for(var d=e.next.next;d!==e.prev;){if(el(r.x,r.y,a.x,a.y,c.x,c.y,d.x,d.y)&&On(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function vp(e,r,a,c){var d=e.prev,g=e,v=e.next;if(On(d,g,v)>=0)return!1;for(var w=d.x>g.x?d.x>v.x?d.x:v.x:g.x>v.x?g.x:v.x,T=d.y>g.y?d.y>v.y?d.y:v.y:g.y>v.y?g.y:v.y,P=ac(d.x<g.x?d.x<v.x?d.x:v.x:g.x<v.x?g.x:v.x,d.y<g.y?d.y<v.y?d.y:v.y:g.y<v.y?g.y:v.y,r,a,c),D=ac(w,T,r,a,c),O=e.prevZ,N=e.nextZ;O&&O.z>=P&&N&&N.z<=D;){if(O!==e.prev&&O!==e.next&&el(d.x,d.y,g.x,g.y,v.x,v.y,O.x,O.y)&&On(O.prev,O,O.next)>=0||(O=O.prevZ,N!==e.prev&&N!==e.next&&el(d.x,d.y,g.x,g.y,v.x,v.y,N.x,N.y)&&On(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;O&&O.z>=P;){if(O!==e.prev&&O!==e.next&&el(d.x,d.y,g.x,g.y,v.x,v.y,O.x,O.y)&&On(O.prev,O,O.next)>=0)return!1;O=O.prevZ}for(;N&&N.z<=D;){if(N!==e.prev&&N!==e.next&&el(d.x,d.y,g.x,g.y,v.x,v.y,N.x,N.y)&&On(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function yf(e,r,a){var c=e;do{var d=c.prev,g=c.next.next;!ta(d,g)&&yp(d,c,c.next,g)&&Oa(d,g)&&Oa(g,d)&&(r.push(d.i/a),r.push(c.i/a),r.push(g.i/a),Ei(c),Ei(c.next),c=e=g),c=c.next}while(c!==e);return ms(c)}function xf(e,r,a,c,d,g){var v=e;do{for(var w=v.next.next;w!==v.prev;){if(v.i!==w.i&&od(v,w)){var T=_h(v,w);return v=ms(v,v.next),T=ms(T,T.next),Jl(v,r,a,c,d,g),void Jl(T,r,a,c,d,g)}w=w.next}v=v.next}while(v!==e)}function bf(e,r){return e.x-r.x}function rd(e,r){if(r=function(c,d){var g,v=d,w=c.x,T=c.y,P=-1/0;do{if(T<=v.y&&T>=v.next.y&&v.next.y!==v.y){var D=v.x+(T-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(D<=w&&D>P){if(P=D,D===w){if(T===v.y)return v;if(T===v.next.y)return v.next}g=v.x<v.next.x?v:v.next}}v=v.next}while(v!==d);if(!g)return null;if(w===P)return g;var O,N=g,U=g.x,Y=g.y,K=1/0;v=g;do{w>=v.x&&v.x>=U&&w!==v.x&&el(T<Y?w:P,T,U,Y,T<Y?P:w,T,v.x,v.y)&&(O=Math.abs(T-v.y)/(w-v.x),Oa(v,c)&&(O<K||O===K&&(v.x>g.x||v.x===g.x&&Js(g,v)))&&(g=v,K=O)),v=v.next}while(v!==N);return g}(e,r)){var a=_h(r,e);ms(r,r.next),ms(a,a.next)}}function Js(e,r){return On(e.prev,e,r.prev)<0&&On(r.next,e,e.next)<0}function ac(e,r,a,c,d){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)*d)|e<<8))|e<<4))|e<<2))|e<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-c)*d)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function eu(e){var r=e,a=e;do{(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next}while(r!==e);return a}function el(e,r,a,c,d,g,v,w){return(d-v)*(r-w)-(e-v)*(g-w)>=0&&(e-v)*(c-w)-(a-v)*(r-w)>=0&&(a-v)*(g-w)-(d-v)*(c-w)>=0}function od(e,r){return e.next.i!==r.i&&e.prev.i!==r.i&&!function(a,c){var d=a;do{if(d.i!==a.i&&d.next.i!==a.i&&d.i!==c.i&&d.next.i!==c.i&&yp(d,d.next,a,c))return!0;d=d.next}while(d!==a);return!1}(e,r)&&(Oa(e,r)&&Oa(r,e)&&function(a,c){var d=a,g=!1,v=(a.x+c.x)/2,w=(a.y+c.y)/2;do{d.y>w!=d.next.y>w&&d.next.y!==d.y&&v<(d.next.x-d.x)*(w-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next}while(d!==a);return g}(e,r)&&(On(e.prev,e,r.prev)||On(e,r.prev,r))||ta(e,r)&&On(e.prev,e,e.next)>0&&On(r.prev,r,r.next)>0)}function On(e,r,a){return(r.y-e.y)*(a.x-r.x)-(r.x-e.x)*(a.y-r.y)}function ta(e,r){return e.x===r.x&&e.y===r.y}function yp(e,r,a,c){var d=vi(On(e,r,a)),g=vi(On(e,r,c)),v=vi(On(a,c,e)),w=vi(On(a,c,r));return d!==g&&v!==w||!(0!==d||!sc(e,a,r))||!(0!==g||!sc(e,c,r))||!(0!==v||!sc(a,e,c))||!(0!==w||!sc(a,r,c))}function sc(e,r,a){return r.x<=Math.max(e.x,a.x)&&r.x>=Math.min(e.x,a.x)&&r.y<=Math.max(e.y,a.y)&&r.y>=Math.min(e.y,a.y)}function vi(e){return e>0?1:e<0?-1:0}function Oa(e,r){return On(e.prev,e,e.next)<0?On(e,r,e.next)>=0&&On(e,e.prev,r)>=0:On(e,r,e.prev)<0||On(e,e.next,r)<0}function _h(e,r){var a=new xp(e.i,e.x,e.y),c=new xp(r.i,r.x,r.y),d=e.next,g=r.prev;return e.next=r,r.prev=e,a.next=d,d.prev=a,c.next=a,a.prev=c,g.next=c,c.prev=g,c}function ko(e,r,a,c){var d=new xp(e,r,a);return c?(d.next=c.next,d.prev=c,c.next.prev=d,c.next=d):(d.prev=d,d.next=d),d}function Ei(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function xp(e,r,a){this.i=e,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function tu(e,r,a,c){for(var d=0,g=r,v=a-c;g<a;g+=c)d+=(e[v]-e[g])*(e[g+1]+e[v+1]),v=g;return d}function wf(e,r,a,c,d){!function g(v,w,T,P,D){for(;P>T;){if(P-T>600){var O=P-T+1,N=w-T+1,U=Math.log(O),Y=.5*Math.exp(2*U/3),K=.5*Math.sqrt(U*Y*(O-Y)/O)*(N-O/2<0?-1:1);g(v,w,Math.max(T,Math.floor(w-N*Y/O+K)),Math.min(P,Math.floor(w+(O-N)*Y/O+K)),D)}var le=v[w],oe=T,de=P;for(Hr(v,T,w),D(v[P],le)>0&&Hr(v,T,P);oe<de;){for(Hr(v,oe,de),oe++,de--;D(v[oe],le)<0;)oe++;for(;D(v[de],le)>0;)de--}0===D(v[T],le)?Hr(v,T,de):Hr(v,++de,P),de<=w&&(T=de+1),w<=de&&(P=de-1)}}(e,r,a||0,c||e.length-1,d||na)}function Hr(e,r,a){var c=e[r];e[r]=e[a],e[a]=c}function na(e,r){return e<r?-1:e>r?1:0}function za(e,r){var a=e.length;if(a<=1)return[e];for(var c,d,g=[],v=0;v<a;v++){var w=bl(e[v]);0!==w&&(e[v].area=Math.abs(w),void 0===d&&(d=w<0),d===w<0?(c&&g.push(c),c=[e[v]]):c.push(e[v]))}if(c&&g.push(c),r>1)for(var T=0;T<g.length;T++)g[T].length<=r||(wf(g[T],r,1,g[T].length-1,Cf),g[T]=g[T].slice(0,r));return g}function Cf(e,r){return r.area-e.area}function tl(e,r,a){for(var c=a.patternDependencies,d=!1,g=0,v=r;g<v.length;g+=1){var w=v[g].paint.get(e+"-pattern");w.isConstant()||(d=!0);var T=w.constantOr(null);T&&(d=!0,c[T.to]=!0,c[T.from]=!0)}return d}function lc(e,r,a,c,d){for(var g=d.patternDependencies,v=0,w=r;v<w.length;v+=1){var T=w[v],P=T.paint.get(e+"-pattern").value;if("constant"!==P.kind){var D=P.evaluate({zoom:c-1},a,{},d.availableImages),O=P.evaluate({zoom:c},a,{},d.availableImages),N=P.evaluate({zoom:c+1},a,{},d.availableImages);O=O&&O.name?O.name:O,N=N&&N.name?N.name:N,g[D=D&&D.name?D.name:D]=!0,g[O]=!0,g[N]=!0,a.patterns[T.id]={min:D,mid:O,max:N}}}return a}gh.deviation=function(e,r,a,c){var d=r&&r.length,g=Math.abs(tu(e,0,d?r[0]*a:e.length,a));if(d)for(var v=0,w=r.length;v<w;v++)g-=Math.abs(tu(e,r[v]*a,v<w-1?r[v+1]*a:e.length,a));var T=0;for(v=0;v<c.length;v+=3){var P=c[v]*a,D=c[v+1]*a,O=c[v+2]*a;T+=Math.abs((e[P]-e[O])*(e[D+1]-e[P+1])-(e[P]-e[D])*(e[O+1]-e[P+1]))}return 0===g&&0===T?0:Math.abs((T-g)/g)},gh.flatten=function(e){for(var r=e[0][0].length,a={vertices:[],holes:[],dimensions:r},c=0,d=0;d<e.length;d++){for(var g=0;g<e[d].length;g++)for(var v=0;v<r;v++)a.vertices.push(e[d][g][v]);d>0&&a.holes.push(c+=e[d-1].length)}return a},mh.default=vf;var ao=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ma,this.indexArray=new ir,this.indexArray2=new Xs,this.programConfigurations=new un(e.layers,e.zoom),this.segments=new q,this.segments2=new q,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};ao.prototype.populate=function(e,r,a){this.hasPattern=tl("fill",this.layers,r);for(var c=this.layers[0].layout.get("fill-sort-key"),d=!c.isConstant(),g=[],v=0,w=e;v<w.length;v+=1){var T=w[v],P=T.feature,D=T.id,O=T.index,N=T.sourceLayerIndex,U=this.layers[0]._featureFilter.needGeometry,Y=Mi(P,U);if(this.layers[0]._featureFilter.filter(new on(this.zoom),Y,a)){var K=d?c.evaluate(Y,{},a,r.availableImages):void 0,le={id:D,properties:P.properties,type:P.type,sourceLayerIndex:N,index:O,geometry:U?Y.geometry:Hn(P),patterns:{},sortKey:K};g.push(le)}}d&&g.sort(function(je,st){return je.sortKey-st.sortKey});for(var oe=0,de=g;oe<de.length;oe+=1){var me=de[oe],ve=me.geometry,be=me.index,Me=me.sourceLayerIndex;if(this.hasPattern){var Le=lc("fill",this.layers,me,this.zoom,r);this.patternFeatures.push(Le)}else this.addFeature(me,ve,be,a,{});r.featureIndex.insert(e[be].feature,ve,be,Me,this.index)}},ao.prototype.update=function(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)},ao.prototype.addFeatures=function(e,r,a){for(var c=0,d=this.patternFeatures;c<d.length;c+=1){var g=d[c];this.addFeature(g,g.geometry,g.index,r,a)}},ao.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ao.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ao.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_f),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},ao.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ao.prototype.addFeature=function(e,r,a,c,d){for(var g=0,v=za(r,500);g<v.length;g+=1){for(var w=v[g],T=0,P=0,D=w;P<D.length;P+=1)T+=D[P].length;for(var O=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),N=O.vertexLength,U=[],Y=[],K=0,le=w;K<le.length;K+=1){var oe=le[K];if(0!==oe.length){oe!==w[0]&&Y.push(U.length/2);var de=this.segments2.prepareSegment(oe.length,this.layoutVertexArray,this.indexArray2),me=de.vertexLength;this.layoutVertexArray.emplaceBack(oe[0].x,oe[0].y),this.indexArray2.emplaceBack(me+oe.length-1,me),U.push(oe[0].x),U.push(oe[0].y);for(var ve=1;ve<oe.length;ve++)this.layoutVertexArray.emplaceBack(oe[ve].x,oe[ve].y),this.indexArray2.emplaceBack(me+ve-1,me+ve),U.push(oe[ve].x),U.push(oe[ve].y);de.vertexLength+=oe.length,de.primitiveLength+=oe.length}}for(var be=mh(U,Y),Me=0;Me<be.length;Me+=3)this.indexArray.emplaceBack(N+be[Me],N+be[Me+1],N+be[Me+2]);O.vertexLength+=T,O.primitiveLength+=be.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,c)},Je("FillBucket",ao,{omit:["layers","patternFeatures"]});var Ui=new nr({"fill-sort-key":new bt(X.layout_fill["fill-sort-key"])}),ad={paint:new nr({"fill-antialias":new Ke(X.paint_fill["fill-antialias"]),"fill-opacity":new bt(X.paint_fill["fill-opacity"]),"fill-color":new bt(X.paint_fill["fill-color"]),"fill-outline-color":new bt(X.paint_fill["fill-outline-color"]),"fill-translate":new Ke(X.paint_fill["fill-translate"]),"fill-translate-anchor":new Ke(X.paint_fill["fill-translate-anchor"]),"fill-pattern":new ur(X.paint_fill["fill-pattern"])}),layout:Ui},Ef=function(e){function r(a){e.call(this,a,ad)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.recalculate=function(a,c){e.prototype.recalculate.call(this,a,c);var d=this.paint._values["fill-outline-color"];"constant"===d.value.kind&&void 0===d.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},r.prototype.createBucket=function(a){return new ao(a)},r.prototype.queryRadius=function(){return Bi(this.paint.get("fill-translate"))},r.prototype.queryIntersectsFeature=function(a,c,d,g,v,w,T){return pr(Gr(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,T),g)},r.prototype.isTileClipped=function(){return!0},r}(Ir),Sf=Ci([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,sd=nu;function nu(e,r,a,c,d){this.properties={},this.extent=a,this.type=0,this._pbf=e,this._geometry=-1,this._keys=c,this._values=d,e.readFields(ld,this,r)}function ld(e,r,a){1==e?r.id=a.readVarint():2==e?function(c,d){for(var g=c.readVarint()+c.pos;c.pos<g;){var v=d._keys[c.readVarint()],w=d._values[c.readVarint()];d.properties[v]=w}}(a,r):3==e?r.type=a.readVarint():4==e&&(r._geometry=a.pos)}function bp(e){for(var r,a,c=0,d=0,g=e.length,v=g-1;d<g;v=d++)c+=((a=e[v]).x-(r=e[d]).x)*(r.y+a.y);return c}nu.types=["Unknown","Point","LineString","Polygon"],nu.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var r,a=e.readVarint()+e.pos,c=1,d=0,g=0,v=0,w=[];e.pos<a;){if(d<=0){var T=e.readVarint();c=7&T,d=T>>3}if(d--,1===c||2===c)g+=e.readSVarint(),v+=e.readSVarint(),1===c&&(r&&w.push(r),r=[]),r.push(new yt(g,v));else{if(7!==c)throw new Error("unknown command "+c);r&&r.push(r[0].clone())}}return r&&w.push(r),w},nu.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var r=e.readVarint()+e.pos,a=1,c=0,d=0,g=0,v=1/0,w=-1/0,T=1/0,P=-1/0;e.pos<r;){if(c<=0){var D=e.readVarint();a=7&D,c=D>>3}if(c--,1===a||2===a)(d+=e.readSVarint())<v&&(v=d),d>w&&(w=d),(g+=e.readSVarint())<T&&(T=g),g>P&&(P=g);else if(7!==a)throw new Error("unknown command "+a)}return[v,T,w,P]},nu.prototype.toGeoJSON=function(e,r,a){var c,d,g=this.extent*Math.pow(2,a),v=this.extent*e,w=this.extent*r,T=this.loadGeometry(),P=nu.types[this.type];function D(U){for(var Y=0;Y<U.length;Y++){var K=U[Y];U[Y]=[360*(K.x+v)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+w)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(c=0;c<T.length;c++)O[c]=T[c][0];D(T=O);break;case 2:for(c=0;c<T.length;c++)D(T[c]);break;case 3:for(T=function(U){var Y=U.length;if(Y<=1)return[U];for(var K,le,oe=[],de=0;de<Y;de++){var me=bp(U[de]);0!==me&&(void 0===le&&(le=me<0),le===me<0?(K&&oe.push(K),K=[U[de]]):K.push(U[de]))}return K&&oe.push(K),oe}(T),c=0;c<T.length;c++)for(d=0;d<T[c].length;d++)D(T[c][d])}1===T.length?T=T[0]:P="Multi"+P;var N={type:"Feature",geometry:{type:P,coordinates:T},properties:this.properties};return"id"in this&&(N.id=this.id),N};var uc=nl;function nl(e,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Tf,this,r),this.length=this._features.length}function Tf(e,r,a){15===e?r.version=a.readVarint():1===e?r.name=a.readString():5===e?r.extent=a.readVarint():2===e?r._features.push(a.pos):3===e?r._keys.push(a.readString()):4===e&&r._values.push(function(c){for(var d=null,g=c.readVarint()+c.pos;c.pos<g;){var v=c.readVarint()>>3;d=1===v?c.readString():2===v?c.readFloat():3===v?c.readDouble():4===v?c.readVarint64():5===v?c.readVarint():6===v?c.readSVarint():7===v?c.readBoolean():null}return d}(a))}function cc(e,r,a){if(3===e){var c=new uc(a,a.readVarint()+a.pos);c.length&&(r[c.name]=c)}}nl.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var r=this._pbf.readVarint()+this._pbf.pos;return new sd(this._pbf,r,this.extent,this._keys,this._values)};var iu={VectorTile:function(e,r){this.layers=e.readFields(cc,{},r)},VectorTileFeature:sd,VectorTileLayer:uc},If=iu.VectorTileFeature.types,il=Math.pow(2,13);function gs(e,r,a,c,d,g,v,w){e.emplaceBack(r,a,2*Math.floor(c*il)+v,d*il*2,g*il*2,Math.round(w))}var so=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new si,this.indexArray=new ir,this.programConfigurations=new un(e.layers,e.zoom),this.segments=new q,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};function ud(e,r){return e.x===r.x&&(e.x<0||e.x>8192)||e.y===r.y&&(e.y<0||e.y>8192)}so.prototype.populate=function(e,r,a){this.features=[],this.hasPattern=tl("fill-extrusion",this.layers,r);for(var c=0,d=e;c<d.length;c+=1){var g=d[c],v=g.feature,w=g.id,T=g.index,P=g.sourceLayerIndex,D=this.layers[0]._featureFilter.needGeometry,O=Mi(v,D);if(this.layers[0]._featureFilter.filter(new on(this.zoom),O,a)){var N={id:w,sourceLayerIndex:P,index:T,geometry:D?O.geometry:Hn(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(lc("fill-extrusion",this.layers,N,this.zoom,r)):this.addFeature(N,N.geometry,T,a,{}),r.featureIndex.insert(v,N.geometry,T,P,this.index,!0)}}},so.prototype.addFeatures=function(e,r,a){for(var c=0,d=this.features;c<d.length;c+=1){var g=d[c];this.addFeature(g,g.geometry,g.index,r,a)}},so.prototype.update=function(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)},so.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},so.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},so.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},so.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},so.prototype.addFeature=function(e,r,a,c,d){for(var g=0,v=za(r,500);g<v.length;g+=1){for(var w=v[g],T=0,P=0,D=w;P<D.length;P+=1)T+=D[P].length;for(var O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),N=0,U=w;N<U.length;N+=1){var Y=U[N];if(0!==Y.length&&!((Rt=Y).every(function(At){return At.x<0})||Rt.every(function(At){return At.x>8192})||Rt.every(function(At){return At.y<0})||Rt.every(function(At){return At.y>8192})))for(var K=0,le=0;le<Y.length;le++){var oe=Y[le];if(le>=1){var de=Y[le-1];if(!ud(oe,de)){O.vertexLength+4>q.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var me=oe.sub(de)._perp()._unit(),ve=de.dist(oe);K+ve>32768&&(K=0),gs(this.layoutVertexArray,oe.x,oe.y,me.x,me.y,0,0,K),gs(this.layoutVertexArray,oe.x,oe.y,me.x,me.y,0,1,K),gs(this.layoutVertexArray,de.x,de.y,me.x,me.y,0,0,K+=ve),gs(this.layoutVertexArray,de.x,de.y,me.x,me.y,0,1,K);var be=O.vertexLength;this.indexArray.emplaceBack(be,be+2,be+1),this.indexArray.emplaceBack(be+1,be+2,be+3),O.vertexLength+=4,O.primitiveLength+=2}}}}if(O.vertexLength+T>q.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),"Polygon"===If[e.type]){for(var Me=[],Le=[],je=O.vertexLength,st=0,qe=w;st<qe.length;st+=1){var lt=qe[st];if(0!==lt.length){lt!==w[0]&&Le.push(Me.length/2);for(var He=0;He<lt.length;He++){var St=lt[He];gs(this.layoutVertexArray,St.x,St.y,0,0,1,1,0),Me.push(St.x),Me.push(St.y)}}}for(var gt=mh(Me,Le),Qe=0;Qe<gt.length;Qe+=3)this.indexArray.emplaceBack(je+gt[Qe],je+gt[Qe+2],je+gt[Qe+1]);O.primitiveLength+=gt.length/3,O.vertexLength+=T}}var Rt;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,c)},Je("FillExtrusionBucket",so,{omit:["layers","features"]});var cd={paint:new nr({"fill-extrusion-opacity":new Ke(X["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bt(X["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ke(X["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ke(X["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ur(X["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bt(X["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bt(X["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ke(X["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},hd=function(e){function r(a){e.call(this,a,cd)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.createBucket=function(a){return new so(a)},r.prototype.queryRadius=function(){return Bi(this.paint.get("fill-extrusion-translate"))},r.prototype.is3D=function(){return!0},r.prototype.queryIntersectsFeature=function(a,c,d,g,v,w,T,P){var D=Gr(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,T),O=this.paint.get("fill-extrusion-height").evaluate(c,d),N=this.paint.get("fill-extrusion-base").evaluate(c,d),U=function(K,le,oe,de){for(var me=[],ve=0,be=K;ve<be.length;ve+=1){var Me=be[ve],Le=[Me.x,Me.y,0,1];rc(Le,Le,le),me.push(new yt(Le[0]/Le[3],Le[1]/Le[3]))}return me}(D,P),Y=function(K,le,oe,de){for(var me=[],ve=[],be=de[8]*le,Me=de[9]*le,Le=de[10]*le,je=de[11]*le,st=de[8]*oe,qe=de[9]*oe,lt=de[10]*oe,He=de[11]*oe,St=0,gt=K;St<gt.length;St+=1){for(var Qe=[],Rt=[],At=0,Bt=gt[St];At<Bt.length;At+=1){var ft=Bt[At],Yt=ft.x,dn=ft.y,In=de[0]*Yt+de[4]*dn+de[12],kn=de[1]*Yt+de[5]*dn+de[13],fn=de[2]*Yt+de[6]*dn+de[14],mn=de[3]*Yt+de[7]*dn+de[15],ti=fn+Le,ci=mn+je,Gt=In+st,xn=kn+qe,hi=fn+lt,Ln=mn+He,pi=new yt((In+be)/ci,(kn+Me)/ci);pi.z=ti/ci,Qe.push(pi);var Ft=new yt(Gt/Ln,xn/Ln);Ft.z=hi/Ln,Rt.push(Ft)}me.push(Qe),ve.push(Rt)}return[me,ve]}(g,N,O,P);return function(K,le,oe){var de=1/0;pr(oe,le)&&(de=wp(oe,le[0]));for(var me=0;me<le.length;me++)for(var ve=le[me],be=K[me],Me=0;Me<ve.length-1;Me++){var Le=ve[Me],je=[Le,ve[Me+1],be[Me+1],be[Me],Le];Ni(oe,je)&&(de=Math.min(de,wp(oe,je)))}return de!==1/0&&de}(Y[0],Y[1],U)},r}(Ir);function ru(e,r){return e.x*r.x+e.y*r.y}function wp(e,r){if(1===e.length){for(var a,c=0,d=r[c++];!a||d.equals(a);)if(!(a=r[c++]))return 1/0;for(;c<r.length;c++){var g=r[c],v=e[0],w=a.sub(d),T=g.sub(d),P=v.sub(d),D=ru(w,w),O=ru(w,T),N=ru(T,T),U=ru(P,w),Y=ru(P,T),K=D*N-O*O,le=(N*U-O*Y)/K,oe=(D*Y-O*U)/K,de=d.z*(1-le-oe)+a.z*le+g.z*oe;if(isFinite(de))return de}return 1/0}for(var me=1/0,ve=0,be=r;ve<be.length;ve+=1)me=Math.min(me,be[ve].z);return me}var pd=Ci([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Cp=Ci([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,dd=iu.VectorTileFeature.types,fd=Math.cos(Math.PI/180*37.5),vh=Math.pow(2,14)/.5,Wi=function(e){var r=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(a){r.gradients[a.id]={}}),this.layoutVertexArray=new Zl,this.layoutVertexArray2=new Aa,this.indexArray=new ir,this.programConfigurations=new un(e.layers,e.zoom),this.segments=new q,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};Wi.prototype.populate=function(e,r,a){this.hasPattern=tl("line",this.layers,r);for(var c=this.layers[0].layout.get("line-sort-key"),d=!c.isConstant(),g=[],v=0,w=e;v<w.length;v+=1){var T=w[v],P=T.feature,D=T.id,O=T.index,N=T.sourceLayerIndex,U=this.layers[0]._featureFilter.needGeometry,Y=Mi(P,U);if(this.layers[0]._featureFilter.filter(new on(this.zoom),Y,a)){var K=d?c.evaluate(Y,{},a):void 0,le={id:D,properties:P.properties,type:P.type,sourceLayerIndex:N,index:O,geometry:U?Y.geometry:Hn(P),patterns:{},sortKey:K};g.push(le)}}d&&g.sort(function(je,st){return je.sortKey-st.sortKey});for(var oe=0,de=g;oe<de.length;oe+=1){var me=de[oe],ve=me.geometry,be=me.index,Me=me.sourceLayerIndex;if(this.hasPattern){var Le=lc("line",this.layers,me,this.zoom,r);this.patternFeatures.push(Le)}else this.addFeature(me,ve,be,a,{});r.featureIndex.insert(e[be].feature,ve,be,Me,this.index)}},Wi.prototype.update=function(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)},Wi.prototype.addFeatures=function(e,r,a){for(var c=0,d=this.patternFeatures;c<d.length;c+=1){var g=d[c];this.addFeature(g,g.geometry,g.index,r,a)}},Wi.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Wi.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Wi.prototype.upload=function(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Cp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Wi.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Wi.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},Wi.prototype.addFeature=function(e,r,a,c,d){var g=this.layers[0].layout,v=g.get("line-join").evaluate(e,{}),w=g.get("line-cap"),T=g.get("line-miter-limit"),P=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var D=0,O=r;D<O.length;D+=1)this.addLine(O[D],e,v,w,T,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,d,c)},Wi.prototype.addLine=function(e,r,a,c,d,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var v=0;v<e.length-1;v++)this.totalDistance+=e[v].dist(e[v+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var w="Polygon"===dd[r.type],T=e.length;T>=2&&e[T-1].equals(e[T-2]);)T--;for(var P=0;P<T-1&&e[P].equals(e[P+1]);)P++;if(!(T<(w?3:2))){"bevel"===a&&(d=1.05);var D,O=this.overscaling<=16?122880/(512*this.overscaling):0,N=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray),U=void 0,Y=void 0,K=void 0,le=void 0;this.e1=this.e2=-1,w&&(le=e[P].sub(D=e[T-2])._unit()._perp());for(var oe=P;oe<T;oe++)if(!(Y=oe===T-1?w?e[P+1]:void 0:e[oe+1])||!e[oe].equals(Y)){le&&(K=le),D&&(U=D),D=e[oe],le=Y?Y.sub(D)._unit()._perp():K;var de=(K=K||le).add(le);0===de.x&&0===de.y||de._unit();var me=K.x*le.x+K.y*le.y,ve=de.x*le.x+de.y*le.y,be=0!==ve?1/ve:1/0,Me=2*Math.sqrt(2-2*ve),Le=ve<fd&&U&&Y,je=K.x*le.y-K.y*le.x>0;if(Le&&oe>P){var st=D.dist(U);if(st>2*O){var qe=D.sub(D.sub(U)._mult(O/st)._round());this.updateDistance(U,qe),this.addCurrentVertex(qe,K,0,0,N),U=qe}}var lt=U&&Y,He=lt?a:w?"butt":c;if(lt&&"round"===He&&(be<g?He="miter":be<=2&&(He="fakeround")),"miter"===He&&be>d&&(He="bevel"),"bevel"===He&&(be>2&&(He="flipbevel"),be<d&&(He="miter")),U&&this.updateDistance(U,D),"miter"===He)de._mult(be),this.addCurrentVertex(D,de,0,0,N);else if("flipbevel"===He){if(be>100)de=le.mult(-1);else{var St=be*K.add(le).mag()/K.sub(le).mag();de._perp()._mult(St*(je?-1:1))}this.addCurrentVertex(D,de,0,0,N),this.addCurrentVertex(D,de.mult(-1),0,0,N)}else if("bevel"===He||"fakeround"===He){var gt=-Math.sqrt(be*be-1),Qe=je?gt:0,Rt=je?0:gt;if(U&&this.addCurrentVertex(D,K,Qe,Rt,N),"fakeround"===He)for(var At=Math.round(180*Me/Math.PI/20),Bt=1;Bt<At;Bt++){var ft=Bt/At;if(.5!==ft){var Yt=ft-.5;ft+=ft*Yt*(ft-1)*((1.0904+me*(me*(3.55645-1.43519*me)-3.2452))*Yt*Yt+(.848013+me*(.215638*me-1.06021)))}var dn=le.sub(K)._mult(ft)._add(K)._unit()._mult(je?-1:1);this.addHalfVertex(D,dn.x,dn.y,!1,je,0,N)}Y&&this.addCurrentVertex(D,le,-Qe,-Rt,N)}else if("butt"===He)this.addCurrentVertex(D,de,0,0,N);else if("square"===He){var In=U?1:-1;this.addCurrentVertex(D,de,In,In,N)}else"round"===He&&(U&&(this.addCurrentVertex(D,K,0,0,N),this.addCurrentVertex(D,K,1,1,N,!0)),Y&&(this.addCurrentVertex(D,le,-1,-1,N,!0),this.addCurrentVertex(D,le,0,0,N)));if(Le&&oe<T-1){var kn=D.dist(Y);if(kn>2*O){var fn=D.add(Y.sub(D)._mult(O/kn)._round());this.updateDistance(D,fn),this.addCurrentVertex(fn,le,0,0,N),D=fn}}}}},Wi.prototype.addCurrentVertex=function(e,r,a,c,d,g){void 0===g&&(g=!1);var v=r.y*c-r.x,w=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,g,!1,a,d),this.addHalfVertex(e,v,w,g,!0,-c,d),this.distance>vh/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(e,r,a,c,d,g))},Wi.prototype.addHalfVertex=function(e,r,a,c,d,g,v){var w=.5*(this.lineClips?this.scaledDistance*(vh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(c?1:0),(e.y<<1)+(d?1:0),Math.round(63*r)+128,Math.round(63*a)+128,1+(0===g?0:g<0?-1:1)|(63&w)<<2,w>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var T=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),v.primitiveLength++),d?this.e2=T:this.e1=T},Wi.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Wi.prototype.updateDistance=function(e,r){this.distance+=e.dist(r),this.updateScaledDistance()},Je("LineBucket",Wi,{omit:["layers","patternFeatures"]});var md=new nr({"line-cap":new Ke(X.layout_line["line-cap"]),"line-join":new bt(X.layout_line["line-join"]),"line-miter-limit":new Ke(X.layout_line["line-miter-limit"]),"line-round-limit":new Ke(X.layout_line["line-round-limit"]),"line-sort-key":new bt(X.layout_line["line-sort-key"])}),gd={paint:new nr({"line-opacity":new bt(X.paint_line["line-opacity"]),"line-color":new bt(X.paint_line["line-color"]),"line-translate":new Ke(X.paint_line["line-translate"]),"line-translate-anchor":new Ke(X.paint_line["line-translate-anchor"]),"line-width":new bt(X.paint_line["line-width"]),"line-gap-width":new bt(X.paint_line["line-gap-width"]),"line-offset":new bt(X.paint_line["line-offset"]),"line-blur":new bt(X.paint_line["line-blur"]),"line-dasharray":new Sr(X.paint_line["line-dasharray"]),"line-pattern":new ur(X.paint_line["line-pattern"]),"line-gradient":new Tr(X.paint_line["line-gradient"])}),layout:md},yh=new(function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.possiblyEvaluate=function(a,c){return c=new on(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),e.prototype.possiblyEvaluate.call(this,a,c)},r.prototype.evaluate=function(a,c,d,g){return c=yi({},c,{zoom:Math.floor(c.zoom)}),e.prototype.evaluate.call(this,a,c,d,g)},r}(bt))(gd.paint.properties["line-width"].specification);yh.useIntegerZoom=!0;var Ep=function(e){function r(a){e.call(this,a,gd),this.gradientVersion=0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._handleSpecialPaintPropertyUpdate=function(a){"line-gradient"===a&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ur,this.gradientVersion=(this.gradientVersion+1)%Ms)},r.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},r.prototype.recalculate=function(a,c){e.prototype.recalculate.call(this,a,c),this.paint._values["line-floorwidth"]=yh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)},r.prototype.createBucket=function(a){return new Wi(a)},r.prototype.queryRadius=function(a){var c=a,d=xh(oi("line-width",this,c),oi("line-gap-width",this,c)),g=oi("line-offset",this,c);return d/2+Math.abs(g)+Bi(this.paint.get("line-translate"))},r.prototype.queryIntersectsFeature=function(a,c,d,g,v,w,T){var P=Gr(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,T),D=T/2*xh(this.paint.get("line-width").evaluate(c,d),this.paint.get("line-gap-width").evaluate(c,d)),O=this.paint.get("line-offset").evaluate(c,d);return O&&(g=function(N,U){for(var Y=[],K=new yt(0,0),le=0;le<N.length;le++){for(var oe=N[le],de=[],me=0;me<oe.length;me++){var ve=oe[me],be=oe[me+1],Me=0===me?K:ve.sub(oe[me-1])._unit()._perp(),Le=me===oe.length-1?K:be.sub(ve)._unit()._perp(),je=Me._add(Le)._unit();je._mult(1/(je.x*Le.x+je.y*Le.y)),de.push(je._mult(U)._add(ve))}Y.push(de)}return Y}(g,O*T)),function(N,U,Y){for(var K=0;K<U.length;K++){var le=U[K];if(N.length>=3)for(var oe=0;oe<le.length;oe++)if(Ao(N,le[oe]))return!0;if(Mo(N,le,Y))return!0}return!1}(P,g,D)},r.prototype.isTileClipped=function(){return!0},r}(Ir);function xh(e,r){return r>0?r+2*e:e}var Mf=Ci([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Af=Ci([{name:"a_projected_pos",components:3,type:"Float32"}],4),_d=(Ci([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ci([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),vd=(Ci([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ci([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Pf=Ci([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function kf(e,r,a){return e.sections.forEach(function(c){var d,v,w;c.text=(d=c.text,v=a,"uppercase"===(w=r.layout.get("text-transform").evaluate(v,{}))?d=d.toLocaleUpperCase():"lowercase"===w&&(d=d.toLocaleLowerCase()),Dn.applyArabicShaping&&(d=Dn.applyArabicShaping(d)),d)}),e}Ci([{name:"triangle",components:3,type:"Uint16"}]),Ci([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ci([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ci([{type:"Float32",name:"offsetX"}]),Ci([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var ou={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"},Sp=function(e,r,a,c,d){var g,v,w=8*d-c-1,T=(1<<w)-1,P=T>>1,D=-7,O=a?d-1:0,N=a?-1:1,U=e[r+O];for(O+=N,g=U&(1<<-D)-1,U>>=-D,D+=w;D>0;g=256*g+e[r+O],O+=N,D-=8);for(v=g&(1<<-D)-1,g>>=-D,D+=c;D>0;v=256*v+e[r+O],O+=N,D-=8);if(0===g)g=1-P;else{if(g===T)return v?NaN:1/0*(U?-1:1);v+=Math.pow(2,c),g-=P}return(U?-1:1)*v*Math.pow(2,g-c)},Tp=function(e,r,a,c,d,g){var v,w,T,P=8*g-d-1,D=(1<<P)-1,O=D>>1,N=23===d?Math.pow(2,-24)-Math.pow(2,-77):0,U=c?0:g-1,Y=c?1:-1,K=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(w=isNaN(r)?1:0,v=D):(v=Math.floor(Math.log(r)/Math.LN2),r*(T=Math.pow(2,-v))<1&&(v--,T*=2),(r+=v+O>=1?N/T:N*Math.pow(2,1-O))*T>=2&&(v++,T/=2),v+O>=D?(w=0,v=D):v+O>=1?(w=(r*T-1)*Math.pow(2,d),v+=O):(w=r*Math.pow(2,O-1)*Math.pow(2,d),v=0));d>=8;e[a+U]=255&w,U+=Y,w/=256,d-=8);for(v=v<<d|w,P+=d;P>0;e[a+U]=255&v,U+=Y,v/=256,P-=8);e[a+U-Y]|=128*K},bh=vn;function vn(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}vn.Varint=0,vn.Fixed64=1,vn.Bytes=2,vn.Fixed32=5;var yd="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function La(e){return e.type===vn.Bytes?e.readVarint()+e.pos:e.pos+1}function Ip(e,r,a){var c=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(c);for(var d=a.pos-1;d>=e;d--)a.buf[d+c]=a.buf[d]}function xd(e,r){for(var a=0;a<e.length;a++)r.writeVarint(e[a])}function Df(e,r){for(var a=0;a<e.length;a++)r.writeSVarint(e[a])}function Of(e,r){for(var a=0;a<e.length;a++)r.writeFloat(e[a])}function zf(e,r){for(var a=0;a<e.length;a++)r.writeDouble(e[a])}function _s(e,r){for(var a=0;a<e.length;a++)r.writeBoolean(e[a])}function Mp(e,r){for(var a=0;a<e.length;a++)r.writeFixed32(e[a])}function Lf(e,r){for(var a=0;a<e.length;a++)r.writeSFixed32(e[a])}function Rf(e,r){for(var a=0;a<e.length;a++)r.writeFixed64(e[a])}function wh(e,r){for(var a=0;a<e.length;a++)r.writeSFixed64(e[a])}function Ra(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16)+16777216*e[r+3]}function rl(e,r,a){e[a]=r,e[a+1]=r>>>8,e[a+2]=r>>>16,e[a+3]=r>>>24}function bd(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16)+(e[r+3]<<24)}function Ff(e,r,a){1===e&&a.readMessage(Nf,r)}function Nf(e,r,a){if(3===e){var c=a.readMessage(Bf,{}),d=c.width,g=c.height,v=c.left,w=c.top,T=c.advance;r.push({id:c.id,bitmap:new Qs({width:d+6,height:g+6},c.bitmap),metrics:{width:d,height:g,left:v,top:w,advance:T}})}}function Bf(e,r,a){1===e?r.id=a.readVarint():2===e?r.bitmap=a.readBytes():3===e?r.width=a.readVarint():4===e?r.height=a.readVarint():5===e?r.left=a.readSVarint():6===e?r.top=a.readSVarint():7===e&&(r.advance=a.readVarint())}function Ch(e){for(var r=0,a=0,c=0,d=e;c<d.length;c+=1){var g=d[c];r+=g.w*g.h,a=Math.max(a,g.w)}e.sort(function(K,le){return le.h-K.h});for(var v=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}],w=0,T=0,P=0,D=e;P<D.length;P+=1)for(var O=D[P],N=v.length-1;N>=0;N--){var U=v[N];if(!(O.w>U.w||O.h>U.h)){if(O.x=U.x,O.y=U.y,T=Math.max(T,O.y+O.h),w=Math.max(w,O.x+O.w),O.w===U.w&&O.h===U.h){var Y=v.pop();N<v.length&&(v[N]=Y)}else O.h===U.h?(U.x+=O.w,U.w-=O.w):O.w===U.w?(U.y+=O.h,U.h-=O.h):(v.push({x:U.x+O.w,y:U.y,w:U.w-O.w,h:O.h}),U.y+=O.h,U.h-=O.h);break}}return{w,h:T,fill:r/(w*T)||0}}vn.prototype={destroy:function(){this.buf=null},readFields:function(e,r,a){for(a=a||this.length;this.pos<a;){var c=this.readVarint(),d=c>>3,g=this.pos;this.type=7&c,e(d,r,this),this.pos===g&&this.skip(c)}return r},readMessage:function(e,r){return this.readFields(e,r,this.readVarint()+this.pos)},readFixed32:function(){var e=Ra(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=bd(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Ra(this.buf,this.pos)+4294967296*Ra(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=Ra(this.buf,this.pos)+4294967296*bd(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Sp(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Sp(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var r,a,c=this.buf;return r=127&(a=c[this.pos++]),a<128?r:(r|=(127&(a=c[this.pos++]))<<7,a<128?r:(r|=(127&(a=c[this.pos++]))<<14,a<128?r:(r|=(127&(a=c[this.pos++]))<<21,a<128?r:function(d,g,v){var w,T,P=v.buf;if(w=(112&(T=P[v.pos++]))>>4,T<128||(w|=(127&(T=P[v.pos++]))<<3,T<128)||(w|=(127&(T=P[v.pos++]))<<10,T<128)||(w|=(127&(T=P[v.pos++]))<<17,T<128)||(w|=(127&(T=P[v.pos++]))<<24,T<128)||(w|=(1&(T=P[v.pos++]))<<31,T<128))return function(e,r,a){return a?4294967296*r+(e>>>0):4294967296*(r>>>0)+(e>>>0)}(d,w,g);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(a=c[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,r=this.pos;return this.pos=e,e-r>=12&&yd?yd.decode(this.buf.subarray(r,e)):function(a,c,d){for(var g="",v=c;v<d;){var w,T,P,D=a[v],O=null,N=D>239?4:D>223?3:D>191?2:1;if(v+N>d)break;1===N?D<128&&(O=D):2===N?128==(192&(w=a[v+1]))&&(O=(31&D)<<6|63&w)<=127&&(O=null):3===N?(T=a[v+2],128==(192&(w=a[v+1]))&&128==(192&T)&&((O=(15&D)<<12|(63&w)<<6|63&T)<=2047||O>=55296&&O<=57343)&&(O=null)):4===N&&(T=a[v+2],P=a[v+3],128==(192&(w=a[v+1]))&&128==(192&T)&&128==(192&P)&&((O=(15&D)<<18|(63&w)<<12|(63&T)<<6|63&P)<=65535||O>=1114112)&&(O=null)),null===O?(O=65533,N=1):O>65535&&(O-=65536,g+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),g+=String.fromCharCode(O),v+=N}return g}(this.buf,r,e)},readBytes:function(){var e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r},readPackedVarint:function(e,r){if(this.type!==vn.Bytes)return e.push(this.readVarint(r));var a=La(this);for(e=e||[];this.pos<a;)e.push(this.readVarint(r));return e},readPackedSVarint:function(e){if(this.type!==vn.Bytes)return e.push(this.readSVarint());var r=La(this);for(e=e||[];this.pos<r;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==vn.Bytes)return e.push(this.readBoolean());var r=La(this);for(e=e||[];this.pos<r;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==vn.Bytes)return e.push(this.readFloat());var r=La(this);for(e=e||[];this.pos<r;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==vn.Bytes)return e.push(this.readDouble());var r=La(this);for(e=e||[];this.pos<r;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==vn.Bytes)return e.push(this.readFixed32());var r=La(this);for(e=e||[];this.pos<r;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==vn.Bytes)return e.push(this.readSFixed32());var r=La(this);for(e=e||[];this.pos<r;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==vn.Bytes)return e.push(this.readFixed64());var r=La(this);for(e=e||[];this.pos<r;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==vn.Bytes)return e.push(this.readSFixed64());var r=La(this);for(e=e||[];this.pos<r;)e.push(this.readSFixed64());return e},skip:function(e){var r=7&e;if(r===vn.Varint)for(;this.buf[this.pos++]>127;);else if(r===vn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===vn.Fixed32)this.pos+=4;else{if(r!==vn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(e,r){this.writeVarint(e<<3|r)},realloc:function(e){for(var r=this.length||16;r<this.pos+e;)r*=2;if(r!==this.length){var a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),rl(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),rl(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),rl(this.buf,-1&e,this.pos),rl(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),rl(this.buf,-1&e,this.pos),rl(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(r,a){var c,d,g,w;if(r>=0?(c=r%4294967296|0,d=r/4294967296|0):(d=~(-r/4294967296),4294967295^(c=~(-r%4294967296))?c=c+1|0:(c=0,d=d+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),g=c,(w=a).buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7),function(g,v){var w=(7&g)<<4;v.buf[v.pos++]|=w|((g>>>=3)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g|((g>>>=7)?128:0),g&&(v.buf[v.pos++]=127&g)))))}(d,a)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var r=this.pos;this.pos=function(c,d,g){for(var v,w,T=0;T<d.length;T++){if((v=d.charCodeAt(T))>55295&&v<57344){if(!w){v>56319||T+1===d.length?(c[g++]=239,c[g++]=191,c[g++]=189):w=v;continue}if(v<56320){c[g++]=239,c[g++]=191,c[g++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(c[g++]=239,c[g++]=191,c[g++]=189,w=null);v<128?c[g++]=v:(v<2048?c[g++]=v>>6|192:(v<65536?c[g++]=v>>12|224:(c[g++]=v>>18|240,c[g++]=v>>12&63|128),c[g++]=v>>6&63|128),c[g++]=63&v|128)}return g}(this.buf,e,this.pos);var a=this.pos-r;a>=128&&Ip(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeFloat:function(e){this.realloc(4),Tp(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Tp(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var r=e.length;this.writeVarint(r),this.realloc(r);for(var a=0;a<r;a++)this.buf[this.pos++]=e[a]},writeRawMessage:function(e,r){this.pos++;var a=this.pos;e(r,this);var c=this.pos-a;c>=128&&Ip(a,c,this),this.pos=a-1,this.writeVarint(c),this.pos+=c},writeMessage:function(e,r,a){this.writeTag(e,vn.Bytes),this.writeRawMessage(r,a)},writePackedVarint:function(e,r){r.length&&this.writeMessage(e,xd,r)},writePackedSVarint:function(e,r){r.length&&this.writeMessage(e,Df,r)},writePackedBoolean:function(e,r){r.length&&this.writeMessage(e,_s,r)},writePackedFloat:function(e,r){r.length&&this.writeMessage(e,Of,r)},writePackedDouble:function(e,r){r.length&&this.writeMessage(e,zf,r)},writePackedFixed32:function(e,r){r.length&&this.writeMessage(e,Mp,r)},writePackedSFixed32:function(e,r){r.length&&this.writeMessage(e,Lf,r)},writePackedFixed64:function(e,r){r.length&&this.writeMessage(e,Rf,r)},writePackedSFixed64:function(e,r){r.length&&this.writeMessage(e,wh,r)},writeBytesField:function(e,r){this.writeTag(e,vn.Bytes),this.writeBytes(r)},writeFixed32Field:function(e,r){this.writeTag(e,vn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(e,r){this.writeTag(e,vn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(e,r){this.writeTag(e,vn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(e,r){this.writeTag(e,vn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(e,r){this.writeTag(e,vn.Varint),this.writeVarint(r)},writeSVarintField:function(e,r){this.writeTag(e,vn.Varint),this.writeSVarint(r)},writeStringField:function(e,r){this.writeTag(e,vn.Bytes),this.writeString(r)},writeFloatField:function(e,r){this.writeTag(e,vn.Fixed32),this.writeFloat(r)},writeDoubleField:function(e,r){this.writeTag(e,vn.Fixed64),this.writeDouble(r)},writeBooleanField:function(e,r){this.writeVarintField(e,Boolean(r))}};var hc=function(e,r){var a=r.pixelRatio,c=r.version,d=r.stretchX,g=r.stretchY,v=r.content;this.paddedRect=e,this.pixelRatio=a,this.stretchX=d,this.stretchY=g,this.content=v,this.version=c},pc={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};pc.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},pc.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},pc.tlbr.get=function(){return this.tl.concat(this.br)},pc.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(hc.prototype,pc);var su=function(e,r){var a={},c={};this.haveRenderCallbacks=[];var d=[];this.addImages(e,a,d),this.addImages(r,c,d);var g=Ch(d),v=new Vi({width:g.w||1,height:g.h||1});for(var w in e){var T=e[w],P=a[w].paddedRect;Vi.copy(T.data,v,{x:0,y:0},{x:P.x+1,y:P.y+1},T.data)}for(var D in r){var O=r[D],N=c[D].paddedRect,U=N.x+1,Y=N.y+1,K=O.data.width,le=O.data.height;Vi.copy(O.data,v,{x:0,y:0},{x:U,y:Y},O.data),Vi.copy(O.data,v,{x:0,y:le-1},{x:U,y:Y-1},{width:K,height:1}),Vi.copy(O.data,v,{x:0,y:0},{x:U,y:Y+le},{width:K,height:1}),Vi.copy(O.data,v,{x:K-1,y:0},{x:U-1,y:Y},{width:1,height:le}),Vi.copy(O.data,v,{x:0,y:0},{x:U+K,y:Y},{width:1,height:le})}this.image=v,this.iconPositions=a,this.patternPositions=c};su.prototype.addImages=function(e,r,a){for(var c in e){var d=e[c],g={x:0,y:0,w:d.data.width+2,h:d.data.height+2};a.push(g),r[c]=new hc(g,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}},su.prototype.patchUpdatedImages=function(e,r){for(var a in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)},su.prototype.patchUpdatedImage=function(e,r,a){if(e&&r&&e.version!==r.version){e.version=r.version;var c=e.tl;a.update(r.data,void 0,{x:c[0],y:c[1]})}},Je("ImagePosition",hc),Je("ImageAtlas",su);var Ar={horizontal:1,vertical:2,horizontalOnly:3},ol=function(){this.scale=1,this.fontStack="",this.imageName=null};ol.forText=function(e,r){var a=new ol;return a.scale=e||1,a.fontStack=r,a},ol.forImage=function(e){var r=new ol;return r.imageName=e,r};var Ai=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function dc(e,r,a,c,d,g,v,w,T,P,D,O,N,U,Y,K){var le,oe=Ai.fromFeature(e,d);O===Ar.vertical&&oe.verticalizePunctuation();var de=Dn.processBidirectionalText,me=Dn.processStyledBidirectionalText;if(de&&1===oe.sections.length){le=[];for(var ve=0,be=de(oe.toString(),Eh(oe,P,g,r,c,U,Y));ve<be.length;ve+=1){var Me=be[ve],Le=new Ai;Le.text=Me,Le.sections=oe.sections;for(var je=0;je<Me.length;je++)Le.sectionIndex.push(0);le.push(Le)}}else if(me){le=[];for(var st=0,qe=me(oe.text,oe.sectionIndex,Eh(oe,P,g,r,c,U,Y));st<qe.length;st+=1){var lt=qe[st],He=new Ai;He.text=lt[0],He.sectionIndex=lt[1],He.sections=oe.sections,le.push(He)}}else le=function(Qe,Rt){for(var At=[],Bt=Qe.text,ft=0,Yt=0,dn=Rt;Yt<dn.length;Yt+=1){var In=dn[Yt];At.push(Qe.substring(ft,In)),ft=In}return ft<Bt.length&&At.push(Qe.substring(ft,Bt.length)),At}(oe,Eh(oe,P,g,r,c,U,Y));var St=[],gt={positionedLines:St,text:oe.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(Qe,Rt,At,Bt,ft,Yt,dn,In,kn,fn,mn,ti){for(var ci=0,Gt=-17,xn=0,hi=0,Ln="right"===In?1:"left"===In?0:.5,pi=0,Ft=0,Kt=ft;Ft<Kt.length;Ft+=1){var nn=Kt[Ft];nn.trim();var Ot=nn.getMaxScale(),Pi=24*(Ot-1),ni={positionedGlyphs:[],lineOffset:0};Qe.positionedLines[pi]=ni;var bn=ni.positionedGlyphs,Rn=0;if(nn.length()){for(var ki=0;ki<nn.length();ki++){var Qt=nn.getSection(ki),aa=nn.getSectionIndex(ki),kr=nn.getCharCode(ki),sa=0,Yn=null,la=null,Zr=null,pl=24,dl=!(kn===Ar.horizontal||!mn&&!ri(kr)||mn&&(fc[kr]||(co=kr,tt.Arabic(co)||tt["Arabic Supplement"](co)||tt["Arabic Extended-A"](co)||tt["Arabic Presentation Forms-A"](co)||tt["Arabic Presentation Forms-B"](co))));if(Qt.imageName){var mu=Bt[Qt.imageName];if(!mu)continue;Zr=Qt.imageName,Qe.iconsInText=Qe.iconsInText||!0,la=mu.paddedRect;var Na=mu.displaySize;Qt.scale=24*Qt.scale/ti,sa=Pi+(24-Na[1]*Qt.scale),pl=(Yn={width:Na[0],height:Na[1],left:1,top:-3,advance:dl?Na[1]:Na[0]}).advance;var gu=dl?Na[0]*Qt.scale-24*Ot:Na[1]*Qt.scale-24*Ot;gu>0&&gu>Rn&&(Rn=gu)}else{var Rh=At[Qt.fontStack],_u=Rh&&Rh[kr];if(_u&&_u.rect)la=_u.rect,Yn=_u.metrics;else{var ws=Rt[Qt.fontStack],vu=ws&&ws[kr];if(!vu)continue;Yn=vu.metrics}sa=24*(Ot-Qt.scale)}dl?(Qe.verticalizable=!0,bn.push({glyph:kr,imageName:Zr,x:ci,y:Gt+sa,vertical:dl,scale:Qt.scale,fontStack:Qt.fontStack,sectionIndex:aa,metrics:Yn,rect:la}),ci+=pl*Qt.scale+fn):(bn.push({glyph:kr,imageName:Zr,x:ci,y:Gt+sa,vertical:dl,scale:Qt.scale,fontStack:Qt.fontStack,sectionIndex:aa,metrics:Yn,rect:la}),ci+=Yn.advance*Qt.scale+fn)}0!==bn.length&&(xn=Math.max(ci-fn,xn),Tn(bn,0,bn.length-1,Ln,Rn)),ci=0;var Cc=Yt*Ot+Rn;ni.lineOffset=Math.max(Rn,Pi),Gt+=Cc,hi=Math.max(Cc,hi),++pi}else Gt+=Yt,++pi}var co,Ec=Gt- -17,Cs=Sh(dn),Ba=Cs.horizontalAlign,fl=Cs.verticalAlign;(function(Fh,Nh,yu,ml,Bh,Sc,Tc,Ic,Mc){var Va,xu=(Nh-yu)*Bh;Va=Sc!==Tc?-Ic*ml- -17:(-ml*Mc+.5)*Tc;for(var gl=0,Ac=Fh;gl<Ac.length;gl+=1)for(var Es=0,_l=Ac[gl].positionedGlyphs;Es<_l.length;Es+=1){var bu=_l[Es];bu.x+=xu,bu.y+=Va}})(Qe.positionedLines,Ln,Ba,fl,xn,hi,Yt,Ec,ft.length),Qe.top+=-fl*Ec,Qe.bottom=Qe.top+Ec,Qe.left+=-Ba*xn,Qe.right=Qe.left+xn}(gt,r,a,c,le,v,w,T,O,P,N,K),!function(Qe){for(var Rt=0,At=Qe;Rt<At.length;Rt+=1)if(0!==At[Rt].positionedGlyphs.length)return!1;return!0}(St)&&gt}Ai.fromFeature=function(e,r){for(var a=new Ai,c=0;c<e.sections.length;c++){var d=e.sections[c];d.image?a.addImageSection(d):a.addTextSection(d,r)}return a},Ai.prototype.length=function(){return this.text.length},Ai.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},Ai.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},Ai.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},Ai.prototype.verticalizePunctuation=function(){this.text=function(e){for(var r="",a=0;a<e.length;a++){var c=e.charCodeAt(a+1)||null,d=e.charCodeAt(a-1)||null;r+=c&&Gi(c)&&!ou[e[a+1]]||d&&Gi(d)&&!ou[e[a-1]]||!ou[e[a]]?e[a]:ou[e[a]]}return r}(this.text)},Ai.prototype.trim=function(){for(var e=0,r=0;r<this.text.length&&fc[this.text.charCodeAt(r)];r++)e++;for(var a=this.text.length,c=this.text.length-1;c>=0&&c>=e&&fc[this.text.charCodeAt(c)];c--)a--;this.text=this.text.substring(e,a),this.sectionIndex=this.sectionIndex.slice(e,a)},Ai.prototype.substring=function(e,r){var a=new Ai;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a},Ai.prototype.toString=function(){return this.text},Ai.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(r,a){return Math.max(r,e.sections[a].scale)},0)},Ai.prototype.addTextSection=function(e,r){this.text+=e.text,this.sections.push(ol.forText(e.scale,e.fontStack||r));for(var a=this.sections.length-1,c=0;c<e.text.length;++c)this.sectionIndex.push(a)},Ai.prototype.addImageSection=function(e){var r=e.image?e.image.name:"";if(0!==r.length){var a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(ol.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Nn("Reached maximum number of images 6401")}else Nn("Can't add FormattedSection with an empty image.")},Ai.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var fc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dr={};function Ap(e,r,a,c,d,g){if(r.imageName){var v=c[r.imageName];return v?v.displaySize[0]*r.scale*24/g+d:0}var w=a[r.fontStack],T=w&&w[e];return T?T.metrics.advance*r.scale+d:0}function Pp(e,r,a,c){var d=Math.pow(e-r,2);return c?e<r?d/2:2*d:d+Math.abs(a)*a}function wd(e,r,a){var c=0;return 10===e&&(c-=1e4),a&&(c+=150),40!==e&&65288!==e||(c+=50),41!==r&&65289!==r||(c+=50),c}function mc(e,r,a,c,d,g){for(var v=null,w=Pp(r,a,d,g),T=0,P=c;T<P.length;T+=1){var D=P[T],O=Pp(r-D.x,a,d,g)+D.badness;O<=w&&(v=D,w=O)}return{index:e,x:r,priorBreak:v,badness:w}}function Eh(e,r,a,c,d,g,v){if("point"!==g)return[];if(!e)return[];for(var w,T=[],P=function(le,oe,de,me,ve,be){for(var Me=0,Le=0;Le<le.length();Le++){var je=le.getSection(Le);Me+=Ap(le.getCharCode(Le),je,me,ve,oe,be)}return Me/Math.max(1,Math.ceil(Me/de))}(e,r,a,c,d,v),D=e.text.indexOf("\u200b")>=0,O=0,N=0;N<e.length();N++){var U=e.getSection(N),Y=e.getCharCode(N);if(fc[Y]||(O+=Ap(Y,U,c,d,r,v)),N<e.length()-1){var K=!((w=Y)<11904||!(tt["Bopomofo Extended"](w)||tt.Bopomofo(w)||tt["CJK Compatibility Forms"](w)||tt["CJK Compatibility Ideographs"](w)||tt["CJK Compatibility"](w)||tt["CJK Radicals Supplement"](w)||tt["CJK Strokes"](w)||tt["CJK Symbols and Punctuation"](w)||tt["CJK Unified Ideographs Extension A"](w)||tt["CJK Unified Ideographs"](w)||tt["Enclosed CJK Letters and Months"](w)||tt["Halfwidth and Fullwidth Forms"](w)||tt.Hiragana(w)||tt["Ideographic Description Characters"](w)||tt["Kangxi Radicals"](w)||tt["Katakana Phonetic Extensions"](w)||tt.Katakana(w)||tt["Vertical Forms"](w)||tt["Yi Radicals"](w)||tt["Yi Syllables"](w)));(dr[Y]||K||U.imageName)&&T.push(mc(N+1,O,P,T,wd(Y,e.getCharCode(N+1),K&&D),!1))}}return function le(oe){return oe?le(oe.priorBreak).concat(oe.index):[]}(mc(e.length(),O,P,T,0,!0))}function Sh(e){var r=.5,a=.5;switch(e){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function Tn(e,r,a,c,d){if(c||d)for(var g=e[a],v=(e[a].x+g.metrics.advance*g.scale)*c,w=r;w<=a;w++)e[w].x-=v,e[w].y+=d}function cn(e,r,a,c,d,g){var v,w=e.image;if(w.content){var T=w.content,P=w.pixelRatio||1;v=[T[0]/P,T[1]/P,w.displaySize[0]-T[2]/P,w.displaySize[1]-T[3]/P]}var D,O,N,U,Y=r.left*g,K=r.right*g;"width"===a||"both"===a?(U=d[0]+Y-c[3],O=d[0]+K+c[1]):O=(U=d[0]+(Y+K-w.displaySize[0])/2)+w.displaySize[0];var le=r.top*g,oe=r.bottom*g;return"height"===a||"both"===a?(D=d[1]+le-c[0],N=d[1]+oe+c[2]):N=(D=d[1]+(le+oe-w.displaySize[1])/2)+w.displaySize[1],{image:w,top:D,right:O,bottom:N,left:U,collisionPadding:v}}dr[10]=!0,dr[32]=!0,dr[38]=!0,dr[40]=!0,dr[41]=!0,dr[43]=!0,dr[45]=!0,dr[47]=!0,dr[173]=!0,dr[183]=!0,dr[8203]=!0,dr[8208]=!0,dr[8211]=!0,dr[8231]=!0;var $t=function(e){function r(a,c,d,g){e.call(this,a,c),this.angle=d,void 0!==g&&(this.segment=g)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.clone=function(){return new r(this.x,this.y,this.angle,this.segment)},r}(yt);function ia(e,r){var a=r.expression;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new on(e+1))};if("source"===a.kind)return{kind:"source"};for(var c=a.zoomStops,d=a.interpolationType,g=0;g<c.length&&c[g]<=e;)g++;for(var v=g=Math.max(0,g-1);v<c.length&&c[v]<e+1;)v++;v=Math.min(c.length-1,v);var w=c[g],T=c[v];return"composite"===a.kind?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:d}:{kind:"camera",minZoom:w,maxZoom:T,minSize:a.evaluate(new on(w)),maxSize:a.evaluate(new on(T)),interpolationType:d}}function Pn(e,r,a){var c=r.uSize,d=a.lowerSize;return"source"===e.kind?d/128:"composite"===e.kind?Jn(d/128,a.upperSize/128,r.uSizeT):c}function Th(e,r){var a=0,c=0;if("constant"===e.kind)c=e.layoutSize;else if("source"!==e.kind){var d=e.interpolationType,g=d?Yi(bi.interpolationFactor(d,r,e.minZoom,e.maxZoom),0,1):0;"camera"===e.kind?c=Jn(e.minSize,e.maxSize,g):a=g}return{uSizeT:a,uSize:c}}Je("Anchor",$t);var Vf=Object.freeze({__proto__:null,getSizeData:ia,evaluateSizeForFeature:Pn,evaluateSizeForZoom:Th,SIZE_PACK_FACTOR:128});function lu(e,r,a,c,d){if(void 0===r.segment)return!0;for(var g=r,v=r.segment+1,w=0;w>-a/2;){if(--v<0)return!1;w-=e[v].dist(g),g=e[v]}w+=e[v].dist(e[v+1]),v++;for(var T=[],P=0;w<a/2;){var D=e[v],O=e[v+1];if(!O)return!1;var N=e[v-1].angleTo(D)-D.angleTo(O);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:N}),P+=N;w-T[0].distance>c;)P-=T.shift().angleDelta;if(P>d)return!1;v++,w+=D.dist(O)}return!0}function kp(e){for(var r=0,a=0;a<e.length-1;a++)r+=e[a].dist(e[a+1]);return r}function Zn(e,r,a){return e?.6*r*a:0}function Xt(e,r){return Math.max(e?e.right-e.left:0,r?r.right-r.left:0)}function fr(e,r,a,c,d,g){for(var v=Zn(a,d,g),w=Xt(a,c)*g,T=0,P=kp(e)/2,D=0;D<e.length-1;D++){var O=e[D],N=e[D+1],U=O.dist(N);if(T+U>P){var Y=(P-T)/U,K=Jn(O.x,N.x,Y),le=Jn(O.y,N.y,Y),oe=new $t(K,le,N.angleTo(O),D);return oe._round(),!v||lu(e,oe,w,v,r)?oe:void 0}T+=U}}function Uf(e,r,a,c,d,g,v,w,T){var P=Zn(c,g,v),D=Xt(c,d),O=D*v,N=0===e[0].x||e[0].x===T||0===e[0].y||e[0].y===T;return r-O<r/4&&(r=O+r/4),function U(Y,K,le,oe,de,me,ve,be,Me){for(var Le=me/2,je=kp(Y),st=0,qe=K-le,lt=[],He=0;He<Y.length-1;He++){for(var St=Y[He],gt=Y[He+1],Qe=St.dist(gt),Rt=gt.angleTo(St);qe+le<st+Qe;){var At=((qe+=le)-st)/Qe,Bt=Jn(St.x,gt.x,At),ft=Jn(St.y,gt.y,At);if(Bt>=0&&Bt<Me&&ft>=0&&ft<Me&&qe-Le>=0&&qe+Le<=je){var Yt=new $t(Bt,ft,Rt,He);Yt._round(),oe&&!lu(Y,Yt,me,oe,de)||lt.push(Yt)}}st+=Qe}return be||lt.length||ve||(lt=U(Y,st/2,le,oe,de,me,ve,!0,Me)),lt}(e,N?r/2*w%r:(D/2+2*g)*v*w%r,r,P,a,O,N,!1,T)}function Ih(e,r,a,c,d){for(var g=[],v=0;v<e.length;v++)for(var w=e[v],T=void 0,P=0;P<w.length-1;P++){var D=w[P],O=w[P+1];D.x<r&&O.x<r||(D.x<r?D=new yt(r,D.y+(r-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x<r&&(O=new yt(r,D.y+(r-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y<a&&O.y<a||(D.y<a?D=new yt(D.x+(a-D.y)/(O.y-D.y)*(O.x-D.x),a)._round():O.y<a&&(O=new yt(D.x+(a-D.y)/(O.y-D.y)*(O.x-D.x),a)._round()),D.x>=c&&O.x>=c||(D.x>=c?D=new yt(c,D.y+(c-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x>=c&&(O=new yt(c,D.y+(c-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y>=d&&O.y>=d||(D.y>=d?D=new yt(D.x+(d-D.y)/(O.y-D.y)*(O.x-D.x),d)._round():O.y>=d&&(O=new yt(D.x+(d-D.y)/(O.y-D.y)*(O.x-D.x),d)._round()),T&&D.equals(T[T.length-1])||g.push(T=[D]),T.push(O)))))}return g}function Wr(e,r,a,c){var d=[],g=e.image,v=g.pixelRatio,w=g.paddedRect.w-2,T=g.paddedRect.h-2,P=e.right-e.left,D=e.bottom-e.top,O=g.stretchX||[[0,w]],N=g.stretchY||[[0,T]],U=function(Bt,ft){return Bt+ft[1]-ft[0]},Y=O.reduce(U,0),K=N.reduce(U,0),le=w-Y,oe=T-K,de=0,me=Y,ve=0,be=K,Me=0,Le=le,je=0,st=oe;if(g.content&&c){var qe=g.content;de=Mh(O,0,qe[0]),ve=Mh(N,0,qe[1]),me=Mh(O,qe[0],qe[2]),be=Mh(N,qe[1],qe[3]),Me=qe[0]-de,je=qe[1]-ve,Le=qe[2]-qe[0]-me,st=qe[3]-qe[1]-be}var lt=function(Bt,ft,Yt,dn){var In=Ah(Bt.stretch-de,me,P,e.left),kn=gc(Bt.fixed-Me,Le,Bt.stretch,Y),fn=Ah(ft.stretch-ve,be,D,e.top),mn=gc(ft.fixed-je,st,ft.stretch,K),ti=Ah(Yt.stretch-de,me,P,e.left),ci=gc(Yt.fixed-Me,Le,Yt.stretch,Y),Gt=Ah(dn.stretch-ve,be,D,e.top),xn=gc(dn.fixed-je,st,dn.stretch,K),hi=new yt(In,fn),Ln=new yt(ti,fn),pi=new yt(ti,Gt),Ft=new yt(In,Gt),Kt=new yt(kn/v,mn/v),nn=new yt(ci/v,xn/v),Ot=r*Math.PI/180;if(Ot){var Pi=Math.sin(Ot),ni=Math.cos(Ot),bn=[ni,-Pi,Pi,ni];hi._matMult(bn),Ln._matMult(bn),Ft._matMult(bn),pi._matMult(bn)}var Rn=Bt.stretch+Bt.fixed,ki=ft.stretch+ft.fixed;return{tl:hi,tr:Ln,bl:Ft,br:pi,tex:{x:g.paddedRect.x+1+Rn,y:g.paddedRect.y+1+ki,w:Yt.stretch+Yt.fixed-Rn,h:dn.stretch+dn.fixed-ki},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Kt,pixelOffsetBR:nn,minFontScaleX:Le/v/P,minFontScaleY:st/v/D,isSDF:a}};if(c&&(g.stretchX||g.stretchY))for(var He=Cd(O,le,Y),St=Cd(N,oe,K),gt=0;gt<He.length-1;gt++)for(var Qe=He[gt],Rt=He[gt+1],At=0;At<St.length-1;At++)d.push(lt(Qe,St[At],Rt,St[At+1]));else d.push(lt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return d}function Mh(e,r,a){for(var c=0,d=0,g=e;d<g.length;d+=1){var v=g[d];c+=Math.max(r,Math.min(a,v[1]))-Math.max(r,Math.min(a,v[0]))}return c}function Cd(e,r,a){for(var c=[{fixed:-1,stretch:0}],d=0,g=e;d<g.length;d+=1){var v=g[d],w=v[0],T=v[1],P=c[c.length-1];c.push({fixed:w-P.stretch,stretch:P.stretch}),c.push({fixed:w-P.stretch,stretch:P.stretch+(T-w)})}return c.push({fixed:r+1,stretch:a}),c}function Ah(e,r,a,c){return e/r*a+c}function gc(e,r,a,c){return e-r*a/c}var ra=function(e,r,a,c,d,g,v,w,T,P){if(this.boxStartIndex=e.length,T){var D=g.top,O=g.bottom,N=g.collisionPadding;N&&(D-=N[1],O+=N[3]);var U=O-D;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{var Y=g.top*v-w,K=g.bottom*v+w,le=g.left*v-w,oe=g.right*v+w,de=g.collisionPadding;if(de&&(le-=de[0]*v,Y-=de[1]*v,oe+=de[2]*v,K+=de[3]*v),P){var me=new yt(le,Y),ve=new yt(oe,Y),be=new yt(le,K),Me=new yt(oe,K),Le=P*Math.PI/180;me._rotate(Le),ve._rotate(Le),be._rotate(Le),Me._rotate(Le),le=Math.min(me.x,ve.x,be.x,Me.x),oe=Math.max(me.x,ve.x,be.x,Me.x),Y=Math.min(me.y,ve.y,be.y,Me.y),K=Math.max(me.y,ve.y,be.y,Me.y)}e.emplaceBack(r.x,r.y,le,Y,oe,K,a,c,d)}this.boxEndIndex=e.length},vs=function(e,r){if(void 0===e&&(e=[]),void 0===r&&(r=_c),this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function _c(e,r){return e<r?-1:e>r?1:0}function $f(e,r,a){void 0===r&&(r=1),void 0===a&&(a=!1);for(var c=1/0,d=1/0,g=-1/0,v=-1/0,w=e[0],T=0;T<w.length;T++){var P=w[T];(!T||P.x<c)&&(c=P.x),(!T||P.y<d)&&(d=P.y),(!T||P.x>g)&&(g=P.x),(!T||P.y>v)&&(v=P.y)}var D=Math.min(g-c,v-d),O=D/2,N=new vs([],jf);if(0===D)return new yt(c,d);for(var U=c;U<g;U+=D)for(var Y=d;Y<v;Y+=D)N.push(new al(U+O,Y+O,O,e));for(var K=function(de){for(var me=0,ve=0,be=0,Me=de[0],Le=0,je=Me.length,st=je-1;Le<je;st=Le++){var qe=Me[Le],lt=Me[st],He=qe.x*lt.y-lt.x*qe.y;ve+=(qe.x+lt.x)*He,be+=(qe.y+lt.y)*He,me+=3*He}return new al(ve/me,be/me,0,de)}(e),le=N.length;N.length;){var oe=N.pop();(oe.d>K.d||!K.d)&&(K=oe,a&&console.log("found best %d after %d probes",Math.round(1e4*oe.d)/1e4,le)),oe.max-K.d<=r||(N.push(new al(oe.p.x-(O=oe.h/2),oe.p.y-O,O,e)),N.push(new al(oe.p.x+O,oe.p.y-O,O,e)),N.push(new al(oe.p.x-O,oe.p.y+O,O,e)),N.push(new al(oe.p.x+O,oe.p.y+O,O,e)),le+=4)}return a&&(console.log("num probes: "+le),console.log("best distance: "+K.d)),K.p}function jf(e,r){return r.max-e.max}function al(e,r,a,c){this.p=new yt(e,r),this.h=a,this.d=function(d,g){for(var v=!1,w=1/0,T=0;T<g.length;T++)for(var P=g[T],D=0,O=P.length,N=O-1;D<O;N=D++){var U=P[D],Y=P[N];U.y>d.y!=Y.y>d.y&&d.x<(Y.x-U.x)*(d.y-U.y)/(Y.y-U.y)+U.x&&(v=!v),w=Math.min(w,ea(d,U,Y))}return(v?1:-1)*Math.sqrt(w)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}vs.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},vs.prototype.pop=function(){if(0!==this.length){var e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}},vs.prototype.peek=function(){return this.data[0]},vs.prototype._up=function(e){for(var r=this.data,a=this.compare,c=r[e];e>0;){var d=e-1>>1,g=r[d];if(a(c,g)>=0)break;r[e]=g,e=d}r[e]=c},vs.prototype._down=function(e){for(var r=this.data,a=this.compare,c=this.length>>1,d=r[e];e<c;){var g=1+(e<<1),v=r[g],w=g+1;if(w<this.length&&a(r[w],v)<0&&(g=w,v=r[w]),a(v,d)>=0)break;r[e]=v,e=g}r[e]=d};var Dp=Number.POSITIVE_INFINITY;function Ed(e,r){return r[1]!==Dp?function(a,c,d){var g=0,v=0;switch(c=Math.abs(c),d=Math.abs(d),a){case"top-right":case"top-left":case"top":v=d-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-d}switch(a){case"top-right":case"bottom-right":case"right":g=-c;break;case"top-left":case"bottom-left":case"left":g=c}return[g,v]}(e,r[0],r[1]):function(a,c){var d=0,g=0;c<0&&(c=0);var v=c/Math.sqrt(2);switch(a){case"top-right":case"top-left":g=v-7;break;case"bottom-right":case"bottom-left":g=7-v;break;case"bottom":g=7-c;break;case"top":g=c-7}switch(a){case"top-right":case"bottom-right":d=-v;break;case"top-left":case"bottom-left":d=v;break;case"left":d=c;break;case"right":d=-c}return[d,g]}(e,r[0])}function Op(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function zp(e,r,a,c,d,g,v,w,T,P,D,O,N,U,Y){var K=function(ve,be,Me,Le,je,st,qe,lt){for(var He=Le.layout.get("text-rotate").evaluate(st,{})*Math.PI/180,St=[],gt=0,Qe=be.positionedLines;gt<Qe.length;gt+=1)for(var Rt=Qe[gt],At=0,Bt=Rt.positionedGlyphs;At<Bt.length;At+=1){var ft=Bt[At];if(ft.rect){var Yt=ft.rect||{},dn=4,In=!0,kn=1,fn=0,mn=(je||lt)&&ft.vertical,ti=ft.metrics.advance*ft.scale/2;if(lt&&be.verticalizable&&(fn=Rt.lineOffset/2-(ft.imageName?-(24-ft.metrics.width*ft.scale)/2:24*(ft.scale-1))),ft.imageName){var ci=qe[ft.imageName];In=ci.sdf,dn=1/(kn=ci.pixelRatio)}var Gt=je?[ft.x+ti,ft.y]:[0,0],xn=je?[0,0]:[ft.x+ti+Me[0],ft.y+Me[1]-fn],hi=[0,0];mn&&(hi=xn,xn=[0,0]);var Ln=(ft.metrics.left-dn)*ft.scale-ti+xn[0],pi=(-ft.metrics.top-dn)*ft.scale+xn[1],Ft=Ln+Yt.w*ft.scale/kn,Kt=pi+Yt.h*ft.scale/kn,nn=new yt(Ln,pi),Ot=new yt(Ft,pi),Pi=new yt(Ln,Kt),ni=new yt(Ft,Kt);if(mn){var bn=new yt(-ti,ti- -17),Rn=-Math.PI/2,ki=12-ti,Qt=new yt(22-ki,-(ft.imageName?ki:0)),aa=new(Function.prototype.bind.apply(yt,[null].concat(hi)));nn._rotateAround(Rn,bn)._add(Qt)._add(aa),Ot._rotateAround(Rn,bn)._add(Qt)._add(aa),Pi._rotateAround(Rn,bn)._add(Qt)._add(aa),ni._rotateAround(Rn,bn)._add(Qt)._add(aa)}if(He){var kr=Math.sin(He),sa=Math.cos(He),Yn=[sa,-kr,kr,sa];nn._matMult(Yn),Ot._matMult(Yn),Pi._matMult(Yn),ni._matMult(Yn)}var la=new yt(0,0),Zr=new yt(0,0);St.push({tl:nn,tr:Ot,bl:Pi,br:ni,tex:Yt,writingMode:be.writingMode,glyphOffset:Gt,sectionIndex:ft.sectionIndex,isSDF:In,pixelOffsetTL:la,pixelOffsetBR:Zr,minFontScaleX:0,minFontScaleY:0})}}return St}(0,a,w,d,g,v,c,e.allowVerticalPlacement),le=e.textSizeData,oe=null;"source"===le.kind?(oe=[128*d.layout.get("text-size").evaluate(v,{})])[0]>32640&&Nn(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===le.kind&&((oe=[128*U.compositeTextSizes[0].evaluate(v,{},Y),128*U.compositeTextSizes[1].evaluate(v,{},Y)])[0]>32640||oe[1]>32640)&&Nn(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,K,oe,w,g,v,P,r,T.lineStartIndex,T.lineLength,N,Y);for(var de=0,me=D;de<me.length;de+=1)O[me[de]]=e.text.placedSymbolArray.length-1;return 4*K.length}function ys(e){for(var r in e)return e[r];return null}function en(e,r,a,c){var d=e.compareText;if(r in d){for(var g=d[r],v=g.length-1;v>=0;v--)if(c.dist(g[v])<a)return!0}else d[r]=[];return d[r].push(c),!1}var Ph=iu.VectorTileFeature.types,kh=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function vc(e,r,a,c,d,g,v,w,T,P,D,O,N){var U=w?Math.min(32640,Math.round(w[0])):0,Y=w?Math.min(32640,Math.round(w[1])):0;e.emplaceBack(r,a,Math.round(32*c),Math.round(32*d),g,v,(U<<1)+(T?1:0),Y,16*P,16*D,256*O,256*N)}function lo(e,r,a){e.emplaceBack(r.x,r.y,a),e.emplaceBack(r.x,r.y,a),e.emplaceBack(r.x,r.y,a),e.emplaceBack(r.x,r.y,a)}function Dh(e){for(var r=0,a=e.sections;r<a.length;r+=1)if(uh(a[r].text))return!0;return!1}var rr=function(e){this.layoutVertexArray=new ls,this.indexArray=new ir,this.programConfigurations=e,this.segments=new q,this.dynamicLayoutVertexArray=new Pa,this.opacityVertexArray=new pn,this.placedSymbolArray=new _};rr.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},rr.prototype.upload=function(e,r,a,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Af.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,kh,!0),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))},rr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Je("SymbolBuffers",rr);var yc=function(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new q,this.collisionVertexArray=new nc};yc.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,_d.members,!0)},yc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Je("CollisionBuffers",yc);var Lt=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(g){return g.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Hi([]),this.placementViewportMatrix=Hi([]);var r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ia(this.zoom,r["text-size"]),this.iconSizeData=ia(this.zoom,r["icon-size"]);var a=this.layers[0].layout,c=a.get("symbol-sort-key"),d=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==d&&!c.isConstant(),this.sortFeaturesByY=("viewport-y"===d||"auto"===d&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===a.get("symbol-placement")&&(this.writingModes=a.get("text-writing-mode").map(function(g){return Ar[g]})),this.stateDependentLayerIds=this.layers.filter(function(g){return g.isStateDependent()}).map(function(g){return g.id}),this.sourceID=e.sourceID};Lt.prototype.createArrays=function(){this.text=new rr(new un(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new rr(new un(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new S,this.lineVertexArray=new k,this.symbolInstances=new b},Lt.prototype.calculateGlyphDependencies=function(e,r,a,c,d){for(var g=0;g<e.length;g++)if(r[e.charCodeAt(g)]=!0,(a||c)&&d){var v=ou[e.charAt(g)];v&&(r[v.charCodeAt(0)]=!0)}},Lt.prototype.populate=function(e,r,a){var c=this.layers[0],d=c.layout,g=d.get("text-font"),v=d.get("text-field"),w=d.get("icon-image"),T=("constant"!==v.value.kind||v.value.value instanceof fi&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&("constant"!==g.value.kind||g.value.value.length>0),P="constant"!==w.value.kind||!!w.value.value||Object.keys(w.parameters).length>0,D=d.get("symbol-sort-key");if(this.features=[],T||P){for(var O=r.iconDependencies,N=r.glyphDependencies,U=r.availableImages,Y=new on(this.zoom),K=0,le=e;K<le.length;K+=1){var oe=le[K],de=oe.feature,me=oe.id,ve=oe.index,be=oe.sourceLayerIndex,Me=c._featureFilter.needGeometry,Le=Mi(de,Me);if(c._featureFilter.filter(Y,Le,a)){Me||(Le.geometry=Hn(de));var je=void 0;if(T){var st=c.getValueAndResolveTokens("text-field",Le,a,U),qe=fi.factory(st);Dh(qe)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===wr()||this.hasRTLText&&Dn.isParsed())&&(je=kf(qe,c,Le))}var lt=void 0;if(P){var He=c.getValueAndResolveTokens("icon-image",Le,a,U);lt=He instanceof xi?He:xi.fromString(He)}if(je||lt){var St=this.sortFeaturesByKey?D.evaluate(Le,{},a):void 0;if(this.features.push({id:me,text:je,icon:lt,index:ve,sourceLayerIndex:be,geometry:Le.geometry,properties:de.properties,type:Ph[de.type],sortKey:St}),lt&&(O[lt.name]=!0),je){var gt=g.evaluate(Le,{},a).join(","),Qe="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ar.vertical)>=0;for(var Rt=0,At=je.sections;Rt<At.length;Rt+=1){var Bt=At[Rt];if(Bt.image)O[Bt.image.name]=!0;else{var ft=Qo(je.toString()),Yt=Bt.fontStack||gt,dn=N[Yt]=N[Yt]||{};this.calculateGlyphDependencies(Bt.text,dn,Qe,this.allowVerticalPlacement,ft)}}}}}}"line"===d.get("symbol-placement")&&(this.features=function(In){var kn={},fn={},mn=[],ti=0;function ci(bn){mn.push(In[bn]),ti++}function Gt(bn,Rn,ki){var Qt=fn[bn];return delete fn[bn],fn[Rn]=Qt,mn[Qt].geometry[0].pop(),mn[Qt].geometry[0]=mn[Qt].geometry[0].concat(ki[0]),Qt}function xn(bn,Rn,ki){var Qt=kn[Rn];return delete kn[Rn],kn[bn]=Qt,mn[Qt].geometry[0].shift(),mn[Qt].geometry[0]=ki[0].concat(mn[Qt].geometry[0]),Qt}function hi(bn,Rn,ki){var Qt=ki?Rn[0][Rn[0].length-1]:Rn[0][0];return bn+":"+Qt.x+":"+Qt.y}for(var Ln=0;Ln<In.length;Ln++){var pi=In[Ln],Ft=pi.geometry,Kt=pi.text?pi.text.toString():null;if(Kt){var nn=hi(Kt,Ft),Ot=hi(Kt,Ft,!0);if(nn in fn&&Ot in kn&&fn[nn]!==kn[Ot]){var Pi=xn(nn,Ot,Ft),ni=Gt(nn,Ot,mn[Pi].geometry);delete kn[nn],delete fn[Ot],fn[hi(Kt,mn[ni].geometry,!0)]=ni,mn[Pi].geometry=null}else nn in fn?Gt(nn,Ot,Ft):Ot in kn?xn(nn,Ot,Ft):(ci(Ln),kn[nn]=ti-1,fn[Ot]=ti-1)}else ci(Ln)}return mn.filter(function(bn){return bn.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(In,kn){return In.sortKey-kn.sortKey})}},Lt.prototype.update=function(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a))},Lt.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},Lt.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Lt.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Lt.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Lt.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Lt.prototype.addToLineVertexArray=function(e,r){var a=this.lineVertexArray.length;if(void 0!==e.segment){for(var c=e.dist(r[e.segment+1]),d=e.dist(r[e.segment]),g={},v=e.segment+1;v<r.length;v++)g[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:c},v<r.length-1&&(c+=r[v+1].dist(r[v]));for(var w=e.segment||0;w>=0;w--)g[w]={x:r[w].x,y:r[w].y,tileUnitDistanceFromAnchor:d},w>0&&(d+=r[w-1].dist(r[w]));for(var T=0;T<r.length;T++){var P=g[T];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}},Lt.prototype.addSymbols=function(e,r,a,c,d,g,v,w,T,P,D,O){for(var N=e.indexArray,U=e.layoutVertexArray,Y=e.segments.prepareSegment(4*r.length,U,N,this.canOverlap?g.sortKey:void 0),K=this.glyphOffsetArray.length,le=Y.vertexLength,oe=this.allowVerticalPlacement&&v===Ar.vertical?Math.PI/2:0,de=g.text&&g.text.sections,me=0;me<r.length;me++){var ve=r[me],be=ve.tl,Me=ve.tr,Le=ve.bl,je=ve.br,st=ve.tex,qe=ve.pixelOffsetTL,lt=ve.pixelOffsetBR,He=ve.minFontScaleX,St=ve.minFontScaleY,gt=ve.glyphOffset,Qe=ve.isSDF,Rt=ve.sectionIndex,At=Y.vertexLength,Bt=gt[1];vc(U,w.x,w.y,be.x,Bt+be.y,st.x,st.y,a,Qe,qe.x,qe.y,He,St),vc(U,w.x,w.y,Me.x,Bt+Me.y,st.x+st.w,st.y,a,Qe,lt.x,qe.y,He,St),vc(U,w.x,w.y,Le.x,Bt+Le.y,st.x,st.y+st.h,a,Qe,qe.x,lt.y,He,St),vc(U,w.x,w.y,je.x,Bt+je.y,st.x+st.w,st.y+st.h,a,Qe,lt.x,lt.y,He,St),lo(e.dynamicLayoutVertexArray,w,oe),N.emplaceBack(At,At+1,At+2),N.emplaceBack(At+1,At+2,At+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gt[0]),me!==r.length-1&&Rt===r[me+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,g,g.index,{},O,de&&de[Rt])}e.placedSymbolArray.emplaceBack(w.x,w.y,K,this.glyphOffsetArray.length-K,le,T,P,w.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],v,0,!1,0,D)},Lt.prototype._addCollisionDebugVertex=function(e,r,a,c,d,g){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,c,d,Math.round(g.x),Math.round(g.y))},Lt.prototype.addCollisionDebugVertices=function(e,r,a,c,d,g,v){var w=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),T=w.vertexLength,P=d.layoutVertexArray,D=d.collisionVertexArray,O=v.anchorX,N=v.anchorY;this._addCollisionDebugVertex(P,D,g,O,N,new yt(e,r)),this._addCollisionDebugVertex(P,D,g,O,N,new yt(a,r)),this._addCollisionDebugVertex(P,D,g,O,N,new yt(a,c)),this._addCollisionDebugVertex(P,D,g,O,N,new yt(e,c)),w.vertexLength+=4;var U=d.indexArray;U.emplaceBack(T,T+1),U.emplaceBack(T+1,T+2),U.emplaceBack(T+2,T+3),U.emplaceBack(T+3,T),w.primitiveLength+=4},Lt.prototype.addDebugCollisionBoxes=function(e,r,a,c){for(var d=e;d<r;d++){var g=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,a)}},Lt.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new yc(Jo,vd.members,Xs),this.iconCollisionBox=new yc(Jo,vd.members,Xs);for(var e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}},Lt.prototype._deserializeCollisionBoxesForSymbol=function(e,r,a,c,d,g,v,w,T){for(var P={},D=r;D<a;D++){var O=e.get(D);P.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},P.textFeatureIndex=O.featureIndex;break}for(var N=c;N<d;N++){var U=e.get(N);P.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},P.verticalTextFeatureIndex=U.featureIndex;break}for(var Y=g;Y<v;Y++){var K=e.get(Y);P.iconBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},P.iconFeatureIndex=K.featureIndex;break}for(var le=w;le<T;le++){var oe=e.get(le);P.verticalIconBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},P.verticalIconFeatureIndex=oe.featureIndex;break}return P},Lt.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var r=0;r<this.symbolInstances.length;r++){var a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}},Lt.prototype.hasTextData=function(){return this.text.segments.get().length>0},Lt.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Lt.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Lt.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Lt.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Lt.prototype.addIndicesForPlacedSymbol=function(e,r){for(var a=e.placedSymbolArray.get(r),c=a.vertexStartIndex+4*a.numGlyphs,d=a.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)},Lt.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var r=Math.sin(e),a=Math.cos(e),c=[],d=[],g=[],v=0;v<this.symbolInstances.length;++v){g.push(v);var w=this.symbolInstances.get(v);c.push(0|Math.round(r*w.anchorX+a*w.anchorY)),d.push(w.featureIndex)}return g.sort(function(T,P){return c[T]-c[P]||d[P]-d[T]}),g},Lt.prototype.addToSortKeyRanges=function(e,r){var a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})},Lt.prototype.sortFeatures=function(e){var r=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var a=0,c=this.symbolInstanceIndexes;a<c.length;a+=1){var d=this.symbolInstances.get(c[a]);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach(function(g,v,w){g>=0&&w.indexOf(g)===v&&r.addIndicesForPlacedSymbol(r.text,g)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Je("SymbolBucket",Lt,{omit:["layers","collisionBoxArray","features","compareText"]}),Lt.MAX_GLYPHS=65535,Lt.addDynamicAttributes=lo;var qf=new nr({"symbol-placement":new Ke(X.layout_symbol["symbol-placement"]),"symbol-spacing":new Ke(X.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ke(X.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bt(X.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ke(X.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ke(X.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ke(X.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ke(X.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ke(X.layout_symbol["icon-rotation-alignment"]),"icon-size":new bt(X.layout_symbol["icon-size"]),"icon-text-fit":new Ke(X.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ke(X.layout_symbol["icon-text-fit-padding"]),"icon-image":new bt(X.layout_symbol["icon-image"]),"icon-rotate":new bt(X.layout_symbol["icon-rotate"]),"icon-padding":new Ke(X.layout_symbol["icon-padding"]),"icon-keep-upright":new Ke(X.layout_symbol["icon-keep-upright"]),"icon-offset":new bt(X.layout_symbol["icon-offset"]),"icon-anchor":new bt(X.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ke(X.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ke(X.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ke(X.layout_symbol["text-rotation-alignment"]),"text-field":new bt(X.layout_symbol["text-field"]),"text-font":new bt(X.layout_symbol["text-font"]),"text-size":new bt(X.layout_symbol["text-size"]),"text-max-width":new bt(X.layout_symbol["text-max-width"]),"text-line-height":new Ke(X.layout_symbol["text-line-height"]),"text-letter-spacing":new bt(X.layout_symbol["text-letter-spacing"]),"text-justify":new bt(X.layout_symbol["text-justify"]),"text-radial-offset":new bt(X.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ke(X.layout_symbol["text-variable-anchor"]),"text-anchor":new bt(X.layout_symbol["text-anchor"]),"text-max-angle":new Ke(X.layout_symbol["text-max-angle"]),"text-writing-mode":new Ke(X.layout_symbol["text-writing-mode"]),"text-rotate":new bt(X.layout_symbol["text-rotate"]),"text-padding":new Ke(X.layout_symbol["text-padding"]),"text-keep-upright":new Ke(X.layout_symbol["text-keep-upright"]),"text-transform":new bt(X.layout_symbol["text-transform"]),"text-offset":new bt(X.layout_symbol["text-offset"]),"text-allow-overlap":new Ke(X.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ke(X.layout_symbol["text-ignore-placement"]),"text-optional":new Ke(X.layout_symbol["text-optional"])}),xc={paint:new nr({"icon-opacity":new bt(X.paint_symbol["icon-opacity"]),"icon-color":new bt(X.paint_symbol["icon-color"]),"icon-halo-color":new bt(X.paint_symbol["icon-halo-color"]),"icon-halo-width":new bt(X.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bt(X.paint_symbol["icon-halo-blur"]),"icon-translate":new Ke(X.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ke(X.paint_symbol["icon-translate-anchor"]),"text-opacity":new bt(X.paint_symbol["text-opacity"]),"text-color":new bt(X.paint_symbol["text-color"],{runtimeType:Pt,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new bt(X.paint_symbol["text-halo-color"]),"text-halo-width":new bt(X.paint_symbol["text-halo-width"]),"text-halo-blur":new bt(X.paint_symbol["text-halo-blur"]),"text-translate":new Ke(X.paint_symbol["text-translate"]),"text-translate-anchor":new Ke(X.paint_symbol["text-translate-anchor"])}),layout:qf},xs=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ut,this.defaultValue=e};xs.prototype.evaluate=function(e){if(e.formattedSection){var r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},xs.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},xs.prototype.outputDefined=function(){return!1},xs.prototype.serialize=function(){return null},Je("FormatSectionOverride",xs,{omit:["defaultValue"]});var Gf=function(e){function r(a){e.call(this,a,xc)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.recalculate=function(a,c){if(e.prototype.recalculate.call(this,a,c),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var d=this.layout.get("text-writing-mode");if(d){for(var g=[],v=0,w=d;v<w.length;v+=1){var T=w[v];g.indexOf(T)<0&&g.push(T)}this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},r.prototype.getValueAndResolveTokens=function(a,c,d,g){var T,v=this.layout.get(a).evaluate(c,{},d,g),w=this._unevaluatedLayout._values[a];return w.isDataDriven()||Xu(w.value)||!v?v:(T=c.properties,v.replace(/{([^{}]+)}/g,function(D,O){return O in T?String(T[O]):""}))},r.prototype.createBucket=function(a){return new Lt(a)},r.prototype.queryRadius=function(){return 0},r.prototype.queryIntersectsFeature=function(){return!1},r.prototype._setPaintOverrides=function(){for(var a=0,c=xc.paint.overridableProperties;a<c.length;a+=1){var d=c[a];if(r.hasPaintOverride(this.layout,d)){var g,v=this.paint.get(d),w=new xs(v),T=new Us(w,v.property.specification);g="constant"===v.value.kind||"source"===v.value.kind?new Bl("source",T):new $s("composite",T,v.value.zoomStops,v.value._interpolationType),this.paint._values[d]=new Er(v.property,g,v.parameters)}}},r.prototype._handleOverridablePaintPropertyUpdate=function(a,c,d){return!(!this.layout||c.isDataDriven()||d.isDataDriven())&&r.hasPaintOverride(this.layout,a)},r.hasPaintOverride=function(a,c){var d=a.get("text-field"),g=xc.paint.properties[c],v=!1,w=function(D){for(var O=0,N=D;O<N.length;O+=1)if(g.overrides&&g.overrides.hasOverride(N[O]))return void(v=!0)};if("constant"===d.value.kind&&d.value.value instanceof fi)w(d.value.value.sections);else if("source"===d.value.kind){var T=function(D){v||(D instanceof Qi&&Un(D.value)===Ut?w(D.value.sections):D instanceof Ji?w(D.sections):D.eachChild(T))},P=d.value;P._styleExpression&&T(P._styleExpression.expression)}return v},r}(Ir),Sd={paint:new nr({"background-color":new Ke(X.paint_background["background-color"]),"background-pattern":new Sr(X.paint_background["background-pattern"]),"background-opacity":new Ke(X.paint_background["background-opacity"])})},Td=function(e){function r(a){e.call(this,a,Sd)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(Ir),Id={paint:new nr({"raster-opacity":new Ke(X.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ke(X.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ke(X.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ke(X.paint_raster["raster-brightness-max"]),"raster-saturation":new Ke(X.paint_raster["raster-saturation"]),"raster-contrast":new Ke(X.paint_raster["raster-contrast"]),"raster-resampling":new Ke(X.paint_raster["raster-resampling"]),"raster-fade-duration":new Ke(X.paint_raster["raster-fade-duration"])})},uu=function(e){function r(a){e.call(this,a,Id)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(Ir),Md=function(e){function r(a){e.call(this,a,{}),this.implementation=a}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},r.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},r.prototype.recalculate=function(){},r.prototype.updateTransitions=function(){},r.prototype.hasTransition=function(){},r.prototype.serialize=function(){},r.prototype.onAdd=function(a){this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},r.prototype.onRemove=function(a){this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},r}(Ir),Ad={circle:oc,heatmap:nd,hillshade:gf,fill:Ef,"fill-extrusion":hd,line:Ep,symbol:Gf,background:Td,raster:uu},Pd=at.HTMLImageElement,kd=at.HTMLCanvasElement,Dd=at.HTMLVideoElement,zn=at.ImageData,Oh=at.ImageBitmap,sl=function(e,r,a,c){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,c)};sl.prototype.update=function(e,r,a){var c=e.width,d=e.height,g=!(this.size&&this.size[0]===c&&this.size[1]===d||a),v=this.context,w=v.gl;if(this.useMipmap=Boolean(r&&r.useMipmap),w.bindTexture(w.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!r||!1!==r.premultiply)),g)this.size=[c,d],e instanceof Pd||e instanceof kd||e instanceof Dd||e instanceof zn||Oh&&e instanceof Oh?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,e):w.texImage2D(w.TEXTURE_2D,0,this.format,c,d,0,this.format,w.UNSIGNED_BYTE,e.data);else{var T=a||{x:0,y:0},P=T.x,D=T.y;e instanceof Pd||e instanceof kd||e instanceof Dd||e instanceof zn||Oh&&e instanceof Oh?w.texSubImage2D(w.TEXTURE_2D,0,P,D,w.RGBA,w.UNSIGNED_BYTE,e):w.texSubImage2D(w.TEXTURE_2D,0,P,D,c,d,w.RGBA,w.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&w.generateMipmap(w.TEXTURE_2D)},sl.prototype.bind=function(e,r,a){var c=this.context.gl;c.bindTexture(c.TEXTURE_2D,this.texture),a!==c.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=c.LINEAR),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,a||e),this.filter=e),r!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r),this.wrap=r)},sl.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},sl.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var cu=function(e){var r=this;this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){r._triggered=!1,r._callback()})};cu.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},cu.prototype.remove=function(){delete this._channel,this._callback=function(){}};var bs=function(e,r,a){this.target=e,this.parent=r,this.mapId=a,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ha(["receive","process"],this),this.invoker=new cu(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=mr()?e:at};function ll(e,r,a){var c=2*Math.PI*6378137/256/Math.pow(2,a);return[e*c-2*Math.PI*6378137/2,r*c-2*Math.PI*6378137/2]}bs.prototype.send=function(e,r,a,c,d){var g=this;void 0===d&&(d=!1);var v=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(this.callbacks[v]=a);var w=zu(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:e,hasCallback:!!a,targetMapId:c,mustQueue:d,sourceMapId:this.mapId,data:Li(r,w)},w),{cancel:function(){a&&delete g.callbacks[v],g.target.postMessage({id:v,type:"<cancel>",targetMapId:c,sourceMapId:g.mapId})}}},bs.prototype.receive=function(e){var r=e.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){delete this.tasks[a];var c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c()}else mr()||r.mustQueue?(this.tasks[a]=r,this.taskQueue.push(a),this.invoker.trigger()):this.processTask(a,r)},bs.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),r=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),r&&this.processTask(e,r)}},bs.prototype.processTask=function(e,r){var a=this;if("<response>"===r.type){var c=this.callbacks[e];delete this.callbacks[e],c&&(r.error?c(os(r.error)):c(null,os(r.data)))}else{var d=!1,g=zu(this.globalScope)?void 0:[],v=r.hasCallback?function(D,O){d=!0,delete a.cancelCallbacks[e],a.target.postMessage({id:e,type:"<response>",sourceMapId:a.mapId,error:D?Li(D):null,data:Li(O,g)},g)}:function(D){d=!0},w=null,T=os(r.data);if(this.parent[r.type])w=this.parent[r.type](r.sourceMapId,T,v);else if(this.parent.getWorkerSource){var P=r.type.split(".");w=this.parent.getWorkerSource(r.sourceMapId,P[0],T.source)[P[1]](T,v)}else v(new Error("Could not find function "+r.type));!d&&w&&w.cancel&&(this.cancelCallbacks[e]=w.cancel)}},bs.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var yn=function(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};yn.prototype.setNorthEast=function(e){return this._ne=e instanceof hn?new hn(e.lng,e.lat):hn.convert(e),this},yn.prototype.setSouthWest=function(e){return this._sw=e instanceof hn?new hn(e.lng,e.lat):hn.convert(e),this},yn.prototype.extend=function(e){var r,a,c=this._sw,d=this._ne;if(e instanceof hn)r=e,a=e;else{if(!(e instanceof yn))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(yn.convert(e)):this.extend(hn.convert(e)):this;if(a=e._ne,!(r=e._sw)||!a)return this}return c||d?(c.lng=Math.min(r.lng,c.lng),c.lat=Math.min(r.lat,c.lat),d.lng=Math.max(a.lng,d.lng),d.lat=Math.max(a.lat,d.lat)):(this._sw=new hn(r.lng,r.lat),this._ne=new hn(a.lng,a.lat)),this},yn.prototype.getCenter=function(){return new hn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},yn.prototype.getSouthWest=function(){return this._sw},yn.prototype.getNorthEast=function(){return this._ne},yn.prototype.getNorthWest=function(){return new hn(this.getWest(),this.getNorth())},yn.prototype.getSouthEast=function(){return new hn(this.getEast(),this.getSouth())},yn.prototype.getWest=function(){return this._sw.lng},yn.prototype.getSouth=function(){return this._sw.lat},yn.prototype.getEast=function(){return this._ne.lng},yn.prototype.getNorth=function(){return this._ne.lat},yn.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},yn.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},yn.prototype.isEmpty=function(){return!(this._sw&&this._ne)},yn.prototype.contains=function(e){var r=hn.convert(e),a=r.lng,c=r.lat,d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d},yn.convert=function(e){return!e||e instanceof yn?e:new yn(e)};var hn=function(e,r){if(isNaN(e)||isNaN(r))throw new Error("Invalid LngLat object: ("+e+", "+r+")");if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};hn.prototype.wrap=function(){return new hn(Qn(this.lng,-180,180),this.lat)},hn.prototype.toArray=function(){return[this.lng,this.lat]},hn.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},hn.prototype.distanceTo=function(e){var r=Math.PI/180,a=this.lat*r,c=e.lat*r,d=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return 6371008.8*Math.acos(Math.min(d,1))},hn.prototype.toBounds=function(e){void 0===e&&(e=0);var r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new yn(new hn(this.lng-a,this.lat-r),new hn(this.lng+a,this.lat+r))},hn.convert=function(e){if(e instanceof hn)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new hn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new hn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var jt=2*Math.PI*6371008.8;function Od(e){return jt*Math.cos(e*Math.PI/180)}function hu(e){return(180+e)/360}function zd(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ei(e,r){return e/Od(r)}function bc(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var ul=function(e,r,a){void 0===a&&(a=0),this.x=+e,this.y=+r,this.z=+a};ul.fromLngLat=function(e,r){void 0===r&&(r=0);var a=hn.convert(e);return new ul(hu(a.lng),zd(a.lat),ei(r,a.lat))},ul.prototype.toLngLat=function(){return new hn(360*this.x-180,bc(this.y))},ul.prototype.toAltitude=function(){return this.z*Od(bc(this.y))},ul.prototype.meterInMercatorCoordinateUnits=function(){return 1/jt*(e=bc(this.y),1/Math.cos(e*Math.PI/180));var e};var Fa=function(e,r,a){this.z=e,this.x=r,this.y=a,this.key=pu(0,e,e,r,a)};Fa.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Fa.prototype.url=function(e,r){var a,c,d,g,v,w=(c=this.y,d=this.z,g=ll(256*(a=this.x),256*(c=Math.pow(2,d)-c-1),d),v=ll(256*(a+1),256*(c+1),d),g[0]+","+g[1]+","+v[0]+","+v[1]),T=function(P,D,O){for(var N,U="",Y=P;Y>0;Y--)U+=(D&(N=1<<Y-1)?1:0)+(O&N?2:0);return U}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===r?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",T).replace("{bbox-epsg-3857}",w)},Fa.prototype.getTilePoint=function(e){var r=Math.pow(2,this.z);return new yt(8192*(e.x*r-this.x),8192*(e.y*r-this.y))},Fa.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var cl=function(e,r){this.wrap=e,this.canonical=r,this.key=pu(e,r.z,r.z,r.x,r.y)},Xn=function(e,r,a,c,d){this.overscaledZ=e,this.wrap=r,this.canonical=new Fa(a,+c,+d),this.key=pu(r,e,a,c,d)};function pu(e,r,a,c,d){(e*=2)<0&&(e=-1*e-1);var g=1<<a;return(g*g*e+g*d+c).toString(36)+a.toString(36)+r.toString(36)}Xn.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},Xn.prototype.scaledTo=function(e){var r=this.canonical.z-e;return e>this.canonical.z?new Xn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xn(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)},Xn.prototype.calculateScaledKey=function(e,r){var a=this.canonical.z-e;return e>this.canonical.z?pu(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):pu(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)},Xn.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var r=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r},Xn.prototype.children=function(e){if(this.overscaledZ>=e)return[new Xn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var r=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new Xn(r,this.wrap,r,a,c),new Xn(r,this.wrap,r,a+1,c),new Xn(r,this.wrap,r,a,c+1),new Xn(r,this.wrap,r,a+1,c+1)]},Xn.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},Xn.prototype.wrapped=function(){return new Xn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Xn.prototype.unwrapTo=function(e){return new Xn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},Xn.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Xn.prototype.toUnwrapped=function(){return new cl(this.wrap,this.canonical)},Xn.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Xn.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new ul(e.x-this.wrap,e.y))},Je("CanonicalTileID",Fa),Je("OverscaledTileID",Xn,{omit:["posMatrix"]});var oa=function(e,r,a){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&"mapbox"!==a&&"terrarium"!==a)return Nn('"'+a+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=r.height;var c=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=a||"mapbox";for(var d=0;d<c;d++)this.data[this._idx(-1,d)]=this.data[this._idx(0,d)],this.data[this._idx(c,d)]=this.data[this._idx(c-1,d)],this.data[this._idx(d,-1)]=this.data[this._idx(d,0)],this.data[this._idx(d,c)]=this.data[this._idx(d,c-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(c,-1)]=this.data[this._idx(c-1,0)],this.data[this._idx(-1,c)]=this.data[this._idx(0,c-1)],this.data[this._idx(c,c)]=this.data[this._idx(c-1,c-1)]};oa.prototype.get=function(e,r){var a=new Uint8Array(this.data.buffer),c=4*this._idx(e,r);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(a[c],a[c+1],a[c+2])},oa.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},oa.prototype._idx=function(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)},oa.prototype._unpackMapbox=function(e,r,a){return(256*e*256+256*r+a)/10-1e4},oa.prototype._unpackTerrarium=function(e,r,a){return 256*e+r+a/256-32768},oa.prototype.getPixels=function(){return new Vi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},oa.prototype.backfillBorder=function(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var c=r*this.dim,d=r*this.dim+this.dim,g=a*this.dim,v=a*this.dim+this.dim;switch(r){case-1:c=d-1;break;case 1:d=c+1}switch(a){case-1:g=v-1;break;case 1:v=g+1}for(var w=-r*this.dim,T=-a*this.dim,P=g;P<v;P++)for(var D=c;D<d;D++)this.data[this._idx(D,P)]=e.data[this._idx(D+w,P+T)]},Je("DEMData",oa);var zh=function(e){this._stringToNumber={},this._numberToString=[];for(var r=0;r<e.length;r++){var a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}};zh.prototype.encode=function(e){return this._stringToNumber[e]},zh.prototype.decode=function(e){return this._numberToString[e]};var wc=function(e,r,a,c,d){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=a,e._y=c,this.properties=e.properties,this.id=d},Lh={geometry:{configurable:!0}};Lh.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Lh.geometry.set=function(e){this._geometry=e},wc.prototype.toJSON=function(){var e={geometry:this.geometry};for(var r in this)"_geometry"!==r&&"_vectorTileFeature"!==r&&(e[r]=this[r]);return e},Object.defineProperties(wc.prototype,Lh);var hl=function(){this.state={},this.stateChanges={},this.deletedStates={}};hl.prototype.updateState=function(e,r,a){var c=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},yi(this.stateChanges[e][c],a),null===this.deletedStates[e])for(var d in this.deletedStates[e]={},this.state[e])d!==c&&(this.deletedStates[e][d]=null);else if(this.deletedStates[e]&&null===this.deletedStates[e][c])for(var g in this.deletedStates[e][c]={},this.state[e][c])a[g]||(this.deletedStates[e][c][g]=null);else for(var v in a)this.deletedStates[e]&&this.deletedStates[e][c]&&null===this.deletedStates[e][c][v]&&delete this.deletedStates[e][c][v]},hl.prototype.removeFeatureState=function(e,r,a){if(null!==this.deletedStates[e]){var c=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&void 0!==r)null!==this.deletedStates[e][c]&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][a]=null);else if(void 0!==r)if(this.stateChanges[e]&&this.stateChanges[e][c])for(a in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][a]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}},hl.prototype.getState=function(e,r){var a=String(r),c=yi({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){var d=this.deletedStates[e][r];if(null===d)return{};for(var g in d)delete c[g]}return c},hl.prototype.initializeTileState=function(e,r){e.setFeatureState(this.state,r)},hl.prototype.coalesceChanges=function(e,r){var a={};for(var c in this.stateChanges){this.state[c]=this.state[c]||{};var d={};for(var g in this.stateChanges[c])this.state[c][g]||(this.state[c][g]={}),yi(this.state[c][g],this.stateChanges[c][g]),d[g]=this.state[c][g];a[c]=d}for(var v in this.deletedStates){this.state[v]=this.state[v]||{};var w={};if(null===this.deletedStates[v])for(var T in this.state[v])w[T]={},this.state[v][T]={};else for(var P in this.deletedStates[v]){if(null===this.deletedStates[v][P])this.state[v][P]={};else for(var D=0,O=Object.keys(this.deletedStates[v][P]);D<O.length;D+=1)delete this.state[v][P][O[D]];w[P]=this.state[v][P]}a[v]=a[v]||{},yi(a[v],w)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(a).length)for(var N in e)e[N].setFeatureState(a,r)};var Pr=function(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new zi(8192,16,0),this.grid3D=new zi(8192,16,0),this.featureIndexArray=new j,this.promoteId=r};function du(e,r,a,c,d){return xt(e,function(g,v){var w=r instanceof jr?r.get(v):null;return w&&w.evaluate?w.evaluate(a,c,d):w})}function fu(e){for(var r=1/0,a=1/0,c=-1/0,d=-1/0,g=0,v=e;g<v.length;g+=1){var w=v[g];r=Math.min(r,w.x),a=Math.min(a,w.y),c=Math.max(c,w.x),d=Math.max(d,w.y)}return{minX:r,minY:a,maxX:c,maxY:d}}function Hf(e,r){return r-e}Pr.prototype.insert=function(e,r,a,c,d,g){var v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,d);for(var w=g?this.grid3D:this.grid,T=0;T<r.length;T++){for(var P=r[T],D=[1/0,1/0,-1/0,-1/0],O=0;O<P.length;O++){var N=P[O];D[0]=Math.min(D[0],N.x),D[1]=Math.min(D[1],N.y),D[2]=Math.max(D[2],N.x),D[3]=Math.max(D[3],N.y)}D[0]<8192&&D[1]<8192&&D[2]>=0&&D[3]>=0&&w.insert(v,D[0],D[1],D[2],D[3])}},Pr.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new iu.VectorTile(new bh(this.rawTileData)).layers,this.sourceLayerCoder=new zh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Pr.prototype.query=function(e,r,a,c){var d=this;this.loadVTLayers();for(var g=e.params||{},v=8192/e.tileSize/e.scale,w=$r(g.filter),T=e.queryGeometry,P=e.queryPadding*v,D=fu(T),O=this.grid.query(D.minX-P,D.minY-P,D.maxX+P,D.maxY+P),N=fu(e.cameraQueryGeometry),Y=0,K=this.grid3D.query(N.minX-P,N.minY-P,N.maxX+P,N.maxY+P,function(ve,be,Me,Le){return function(je,st,qe,lt,He){for(var St=0,gt=je;St<gt.length;St+=1){var Qe=gt[St];if(st<=Qe.x&&qe<=Qe.y&&lt>=Qe.x&&He>=Qe.y)return!0}var Rt=[new yt(st,qe),new yt(st,He),new yt(lt,He),new yt(lt,qe)];if(je.length>2)for(var At=0,Bt=Rt;At<Bt.length;At+=1)if(Ao(je,Bt[At]))return!0;for(var ft=0;ft<je.length-1;ft++)if(Ys(je[ft],je[ft+1],Rt))return!0;return!1}(e.cameraQueryGeometry,ve-P,be-P,Me+P,Le+P)});Y<K.length;Y+=1)O.push(K[Y]);O.sort(Hf);for(var le,oe={},de=function(ve){var be=O[ve];if(be!==le){le=be;var Me=d.featureIndexArray.get(be),Le=null;d.loadMatchingFeature(oe,Me.bucketIndex,Me.sourceLayerIndex,Me.featureIndex,w,g.layers,g.availableImages,r,a,c,function(je,st,qe){return Le||(Le=Hn(je)),st.queryIntersectsFeature(T,je,qe,Le,d.z,e.transform,v,e.pixelPosMatrix)})}},me=0;me<O.length;me++)de(me);return oe},Pr.prototype.loadMatchingFeature=function(e,r,a,c,d,g,v,w,T,P,D){var O=this.bucketLayerIDs[r];if(!g||function(je,st){for(var qe=0;qe<je.length;qe++)if(st.indexOf(je[qe])>=0)return!0;return!1}(g,O)){var N=this.sourceLayerCoder.decode(a),U=this.vtLayers[N].feature(c);if(d.needGeometry){var Y=Mi(U,!0);if(!d.filter(new on(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!d.filter(new on(this.tileID.overscaledZ),U))return;for(var K=this.getId(U,N),le=0;le<O.length;le++){var oe=O[le];if(!(g&&g.indexOf(oe)<0)){var de=w[oe];if(de){var me={};void 0!==K&&P&&(me=P.getState(de.sourceLayer||"_geojsonTileLayer",K));var ve=yi({},T[oe]);ve.paint=du(ve.paint,de.paint,U,me,v),ve.layout=du(ve.layout,de.layout,U,me,v);var be=!D||D(U,de,me);if(be){var Me=new wc(U,this.z,this.x,this.y,K);Me.layer=ve;var Le=e[oe];void 0===Le&&(Le=e[oe]=[]),Le.push({featureIndex:c,feature:Me,intersectionZ:be})}}}}}},Pr.prototype.lookupSymbolFeatures=function(e,r,a,c,d,g,v,w){var T={};this.loadVTLayers();for(var P=$r(d),D=0,O=e;D<O.length;D+=1)this.loadMatchingFeature(T,a,c,O[D],P,g,v,w,r);return T},Pr.prototype.hasLayer=function(e){for(var r=0,a=this.bucketLayerIDs;r<a.length;r+=1)for(var c=0,d=a[r];c<d.length;c+=1)if(e===d[c])return!0;return!1},Pr.prototype.getId=function(e,r){var a=e.id;return this.promoteId&&"boolean"==typeof(a=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[r]])&&(a=Number(a)),a},Je("FeatureIndex",Pr,{omit:["rawTileData","sourceLayerCoder"]});var ai=function(e,r){this.tileID=e,this.uid=Yr(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ai.prototype.registerFadeDuration=function(e){var r=e+this.timeAdded;r<go.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)},ai.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},ai.prototype.loadVectorData=function(e,r,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var c in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(P,D){var O={};if(!D)return O;for(var N=function(){var K=Y[U],le=K.layerIds.map(function(me){return D.getLayer(me)}).filter(Boolean);if(0!==le.length){K.layers=le,K.stateDependentLayerIds&&(K.stateDependentLayers=K.stateDependentLayerIds.map(function(me){return le.filter(function(ve){return ve.id===me})[0]}));for(var oe=0,de=le;oe<de.length;oe+=1)O[de[oe].id]=K}},U=0,Y=P;U<Y.length;U+=1)N();return O}(e.buckets,r.style),this.hasSymbolBuckets=!1,this.buckets){var d=this.buckets[c];if(d instanceof Lt){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var g in this.buckets){var v=this.buckets[g];if(v instanceof Lt&&v.hasRTLText){this.hasRTLText=!0,Dn.isLoading()||Dn.isLoaded()||"deferred"!==wr()||ch();break}}for(var w in this.queryPadding=0,this.buckets){var T=this.buckets[w];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(w).queryRadius(T))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new l},ai.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ai.prototype.getBucket=function(e){return this.buckets[e.id]},ai.prototype.upload=function(e){for(var r in this.buckets){var a=this.buckets[r];a.uploadPending()&&a.upload(e)}var c=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new sl(e,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new sl(e,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)},ai.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},ai.prototype.queryRenderedFeatures=function(e,r,a,c,d,g,v,w,T,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:d,scale:g,tileSize:this.tileSize,pixelPosMatrix:P,transform:w,params:v,queryPadding:this.queryPadding*T},e,r,a):{}},ai.prototype.querySourceFeatures=function(e,r){var a=this.latestFeatureIndex;if(a&&a.rawTileData){var c=a.loadVTLayers(),d=r?r.sourceLayer:"",g=c._geojsonTileLayer||c[d];if(g)for(var v=$r(r&&r.filter),w=this.tileID.canonical,T=w.z,P=w.x,D=w.y,O={z:T,x:P,y:D},N=0;N<g.length;N++){var U=g.feature(N);if(v.needGeometry){var Y=Mi(U,!0);if(!v.filter(new on(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!v.filter(new on(this.tileID.overscaledZ),U))continue;var K=a.getId(U,d),le=new wc(U,T,P,D,K);le.tile=O,e.push(le)}}},ai.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},ai.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ai.prototype.setExpiryData=function(e){var r=this.expirationTime;if(e.cacheControl){var a=As(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var c=Date.now(),d=!1;if(this.expirationTime>c)d=!1;else if(r)if(this.expirationTime<r)d=!0;else{var g=this.expirationTime-r;g?this.expirationTime=c+Math.max(g,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ai.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},ai.prototype.setFeatureState=function(e,r){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length){var a=this.latestFeatureIndex.loadVTLayers();for(var c in this.buckets)if(r.style.hasLayer(c)){var d=this.buckets[c],g=d.layers[0].sourceLayer||"_geojsonTileLayer",v=a[g],w=e[g];if(v&&w&&0!==Object.keys(w).length){d.update(w,v,this.imageAtlas&&this.imageAtlas.patternPositions||{});var T=r&&r.style&&r.style.getLayer(c);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(d)))}}}},ai.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},ai.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<go.now()},ai.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ai.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=go.now()+e},ai.prototype.setDependencies=function(e,r){for(var a={},c=0,d=r;c<d.length;c+=1)a[d[c]]=!0;this.dependencies[e]=a},ai.prototype.hasDependency=function(e,r){for(var a=0,c=e;a<c.length;a+=1){var d=this.dependencies[c[a]];if(d)for(var g=0,v=r;g<v.length;g+=1)if(d[v[g]])return!0}return!1};var uo=at.performance,Ld=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},uo.mark(this._marks.start)};Ld.prototype.finish=function(){uo.mark(this._marks.end);var e=uo.getEntriesByName(this._marks.measure);return 0===e.length&&(uo.measure(this._marks.measure,this._marks.start,this._marks.end),e=uo.getEntriesByName(this._marks.measure),uo.clearMarks(this._marks.start),uo.clearMarks(this._marks.end),uo.clearMeasures(this._marks.measure)),e},m.Actor=bs,m.AlphaImage=Qs,m.CanonicalTileID=Fa,m.CollisionBoxArray=l,m.Color=Nt,m.DEMData=oa,m.DataConstantProperty=Ke,m.DictionaryCoder=zh,m.EXTENT=8192,m.ErrorEvent=he,m.EvaluationParameters=on,m.Event=ce,m.Evented=ue,m.FeatureIndex=Pr,m.FillBucket=ao,m.FillExtrusionBucket=so,m.ImageAtlas=su,m.ImagePosition=hc,m.LineBucket=Wi,m.LngLat=hn,m.LngLatBounds=yn,m.MercatorCoordinate=ul,m.ONE_EM=24,m.OverscaledTileID=Xn,m.Point=yt,m.Point$1=yt,m.Properties=nr,m.Protobuf=bh,m.RGBAImage=Vi,m.RequestManager=$i,m.RequestPerformance=Ld,m.ResourceType=Il,m.SegmentVector=q,m.SourceFeatureState=hl,m.StructArrayLayout1ui2=Kl,m.StructArrayLayout2f1f2i16=tc,m.StructArrayLayout2i4=Ma,m.StructArrayLayout3ui6=ir,m.StructArrayLayout4i8=cr,m.SymbolBucket=Lt,m.Texture=sl,m.Tile=ai,m.Transitionable=lr,m.Uniform1f=Be,m.Uniform1i=Ue,m.Uniform2f=Xe,m.Uniform3f=pt,m.Uniform4f=mt,m.UniformColor=dt,m.UniformMatrix4f=nt,m.UnwrappedTileID=cl,m.ValidationError=ie,m.WritingMode=Ar,m.ZoomHistory=qi,m.add=function(e,r,a){return e[0]=r[0]+a[0],e[1]=r[1]+a[1],e[2]=r[2]+a[2],e},m.addDynamicAttributes=lo,m.asyncAll=function(e,r,a){if(!e.length)return a(null,[]);var c=e.length,d=new Array(e.length),g=null;e.forEach(function(v,w){r(v,function(T,P){T&&(g=T),d[w]=P,0==--c&&a(g,d)})})},m.bezier=or,m.bindAll=Ha,m.browser=go,m.cacheEntryPossiblyAdded=function(e){++Tl>Sl&&(e.getActor().send("enforceCacheSizeLimit",Ds),Tl=0)},m.clamp=Yi,m.clearTileCache=function(e){var r=at.caches.delete("mapbox-tiles");e&&r.catch(e).then(function(){return e()})},m.clipLine=Ih,m.clone=function(e){var r=new $n(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},m.clone$1=Lr,m.clone$2=function(e){var r=new $n(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r},m.collisionCircleLayout=Pf,m.config=sn,m.create=function(){var e=new $n(16);return $n!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},m.create$1=function(){var e=new $n(9);return $n!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},m.create$2=function(){var e=new $n(4);return $n!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},m.createCommonjsModule=Xi,m.createExpression=Yu,m.createLayout=Ci,m.createStyleLayer=function(e){return"custom"===e.type?new Md(e):new Ad[e.type](e)},m.cross=function(e,r,a){var c=r[0],d=r[1],g=r[2],v=a[0],w=a[1],T=a[2];return e[0]=d*T-g*w,e[1]=g*v-c*T,e[2]=c*w-d*v,e},m.deepEqual=function e(r,a){if(Array.isArray(r)){if(!Array.isArray(a)||r.length!==a.length)return!1;for(var c=0;c<r.length;c++)if(!e(r[c],a[c]))return!1;return!0}if("object"==typeof r&&null!==r&&null!==a){if("object"!=typeof a||Object.keys(r).length!==Object.keys(a).length)return!1;for(var d in r)if(!e(r[d],a[d]))return!1;return!0}return r===a},m.dot=function(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]},m.dot$1=function(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]},m.ease=di,m.emitValidationErrors=Hl,m.endsWith=da,m.enforceCacheSizeLimit=function(e){Ya(),vr&&vr.then(function(r){r.keys().then(function(a){for(var c=0;c<a.length-e;c++)r.delete(a[c])})})},m.evaluateSizeForFeature=Pn,m.evaluateSizeForZoom=Th,m.evaluateVariableOffset=Ed,m.evented=Zs,m.extend=yi,m.featureFilter=$r,m.filterObject=mo,m.fromRotation=function(e,r){var a=Math.sin(r),c=Math.cos(r);return e[0]=c,e[1]=a,e[2]=0,e[3]=-a,e[4]=c,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},m.getAnchorAlignment=Sh,m.getAnchorJustification=Op,m.getArrayBuffer=Bn,m.getImage=V,m.getJSON=function(e,r){return Ls(yi(e,{type:"json"}),r)},m.getRTLTextPluginStatus=wr,m.getReferrer=xa,m.getVideo=function(e,r){var a,c,d=at.document.createElement("video");d.muted=!0,d.onloadstart=function(){r(null,d)};for(var g=0;g<e.length;g++){var v=at.document.createElement("source");a=e[g],c=void 0,(c=at.document.createElement("a")).href=a,(c.protocol!==at.document.location.protocol||c.host!==at.document.location.host)&&(d.crossOrigin="Anonymous"),v.src=e[g],d.appendChild(v)}return{cancel:function(){}}},m.identity=Hi,m.invert=function(e,r){var a=r[0],c=r[1],d=r[2],g=r[3],v=r[4],w=r[5],T=r[6],P=r[7],D=r[8],O=r[9],N=r[10],U=r[11],Y=r[12],K=r[13],le=r[14],oe=r[15],de=a*w-c*v,me=a*T-d*v,ve=a*P-g*v,be=c*T-d*w,Me=c*P-g*w,Le=d*P-g*T,je=D*K-O*Y,st=D*le-N*Y,qe=D*oe-U*Y,lt=O*le-N*K,He=O*oe-U*K,St=N*oe-U*le,gt=de*St-me*He+ve*lt+be*qe-Me*st+Le*je;return gt?(e[0]=(w*St-T*He+P*lt)*(gt=1/gt),e[1]=(d*He-c*St-g*lt)*gt,e[2]=(K*Le-le*Me+oe*be)*gt,e[3]=(N*Me-O*Le-U*be)*gt,e[4]=(T*qe-v*St-P*st)*gt,e[5]=(a*St-d*qe+g*st)*gt,e[6]=(le*ve-Y*Le-oe*me)*gt,e[7]=(D*Le-N*ve+U*me)*gt,e[8]=(v*He-w*qe+P*je)*gt,e[9]=(c*qe-a*He-g*je)*gt,e[10]=(Y*Me-K*ve+oe*de)*gt,e[11]=(O*ve-D*Me-U*de)*gt,e[12]=(w*st-v*lt-T*je)*gt,e[13]=(a*lt-c*st+d*je)*gt,e[14]=(K*me-Y*be-le*de)*gt,e[15]=(D*be-O*me+N*de)*gt,e):null},m.isChar=tt,m.isMapboxURL=Rr,m.keysDifference=function(e,r){var a=[];for(var c in e)c in r||a.push(c);return a},m.makeRequest=Ls,m.mapObject=xt,m.mercatorXfromLng=hu,m.mercatorYfromLat=zd,m.mercatorZfromAltitude=ei,m.mul=fs,m.multiply=Ql,m.mvt=iu,m.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},m.normalize=function(e,r){var a=r[0],c=r[1],d=r[2],g=a*a+c*c+d*d;return g>0&&(g=1/Math.sqrt(g)),e[0]=r[0]*g,e[1]=r[1]*g,e[2]=r[2]*g,e},m.number=Jn,m.offscreenCanvasSupported=zs,m.ortho=function(e,r,a,c,d,g,v){var w=1/(r-a),T=1/(c-d),P=1/(g-v);return e[0]=-2*w,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*T,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*P,e[11]=0,e[12]=(r+a)*w,e[13]=(d+c)*T,e[14]=(v+g)*P,e[15]=1,e},m.parseGlyphPBF=function(e){return new bh(e).readFields(Ff,[])},m.pbf=bh,m.performSymbolLayout=function(e,r,a,c,d,g,v){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var w=e.layers[0].layout,T=e.layers[0]._unevaluatedLayout._values,P={};if("composite"===e.textSizeData.kind){var D=e.textSizeData,O=D.maxZoom;P.compositeTextSizes=[T["text-size"].possiblyEvaluate(new on(D.minZoom),v),T["text-size"].possiblyEvaluate(new on(O),v)]}if("composite"===e.iconSizeData.kind){var N=e.iconSizeData,U=N.maxZoom;P.compositeIconSizes=[T["icon-size"].possiblyEvaluate(new on(N.minZoom),v),T["icon-size"].possiblyEvaluate(new on(U),v)]}P.layoutTextSize=T["text-size"].possiblyEvaluate(new on(e.zoom+1),v),P.layoutIconSize=T["icon-size"].possiblyEvaluate(new on(e.zoom+1),v),P.textMaxSize=T["text-size"].possiblyEvaluate(new on(18));for(var Y=24*w.get("text-line-height"),K="map"===w.get("text-rotation-alignment")&&"point"!==w.get("symbol-placement"),le=w.get("text-keep-upright"),oe=w.get("text-size"),de=function(){var be=ve[me],Me=w.get("text-font").evaluate(be,{},v).join(","),Le=oe.evaluate(be,{},v),je=P.layoutTextSize.evaluate(be,{},v),st=P.layoutIconSize.evaluate(be,{},v),qe={horizontal:{},vertical:void 0},lt=be.text,He=[0,0];if(lt){var St=lt.toString(),gt=24*w.get("text-letter-spacing").evaluate(be,{},v),Qe=function(Ft){for(var Kt=0,nn=Ft;Kt<nn.length;Kt+=1)if(Ot=nn[Kt].charCodeAt(0),tt.Arabic(Ot)||tt["Arabic Supplement"](Ot)||tt["Arabic Extended-A"](Ot)||tt["Arabic Presentation Forms-A"](Ot)||tt["Arabic Presentation Forms-B"](Ot))return!1;var Ot;return!0}(St)?gt:0,Rt=w.get("text-anchor").evaluate(be,{},v),At=w.get("text-variable-anchor");if(!At){var Bt=w.get("text-radial-offset").evaluate(be,{},v);He=Bt?Ed(Rt,[24*Bt,Dp]):w.get("text-offset").evaluate(be,{},v).map(function(Ft){return 24*Ft})}var ft=K?"center":w.get("text-justify").evaluate(be,{},v),Yt=w.get("symbol-placement"),dn="point"===Yt?24*w.get("text-max-width").evaluate(be,{},v):0,In=function(){e.allowVerticalPlacement&&Qo(St)&&(qe.vertical=dc(lt,r,a,d,Me,dn,Y,Rt,"left",Qe,He,Ar.vertical,!0,Yt,je,Le))};if(!K&&At){for(var kn="auto"===ft?At.map(function(Ft){return Op(Ft)}):[ft],fn=!1,mn=0;mn<kn.length;mn++){var ti=kn[mn];if(!qe.horizontal[ti])if(fn)qe.horizontal[ti]=qe.horizontal[0];else{var ci=dc(lt,r,a,d,Me,dn,Y,"center",ti,Qe,He,Ar.horizontal,!1,Yt,je,Le);ci&&(qe.horizontal[ti]=ci,fn=1===ci.positionedLines.length)}}In()}else{"auto"===ft&&(ft=Op(Rt));var Gt=dc(lt,r,a,d,Me,dn,Y,Rt,ft,Qe,He,Ar.horizontal,!1,Yt,je,Le);Gt&&(qe.horizontal[ft]=Gt),In(),Qo(St)&&K&&le&&(qe.vertical=dc(lt,r,a,d,Me,dn,Y,Rt,ft,Qe,He,Ar.vertical,!1,Yt,je,Le))}}var Ft,Kt,Ot,Pi,ni,xn=void 0,hi=!1;if(be.icon&&be.icon.name){var Ln=c[be.icon.name];Ln&&(Ft=d[be.icon.name],Kt=w.get("icon-offset").evaluate(be,{},v),Ot=Sh(w.get("icon-anchor").evaluate(be,{},v)),xn={image:Ft,top:ni=Kt[1]-Ft.displaySize[1]*Ot.verticalAlign,bottom:ni+Ft.displaySize[1],left:Pi=Kt[0]-Ft.displaySize[0]*Ot.horizontalAlign,right:Pi+Ft.displaySize[0]},hi=Ln.sdf,void 0===e.sdfIcons?e.sdfIcons=Ln.sdf:e.sdfIcons!==Ln.sdf&&Nn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ln.pixelRatio!==e.pixelRatio||0!==w.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}var pi=ys(qe.horizontal)||qe.vertical;e.iconsInText=!!pi&&pi.iconsInText,(pi||xn)&&function(Ft,Kt,nn,Ot,Pi,ni,bn,Rn,ki,Qt,aa){var kr=ni.textMaxSize.evaluate(Kt,{});void 0===kr&&(kr=bn);var sa,Yn=Ft.layers[0].layout,la=Yn.get("icon-offset").evaluate(Kt,{},aa),Zr=ys(nn.horizontal),pl=bn/24,dl=Ft.tilePixelRatio*pl,mu=Ft.tilePixelRatio*kr/24,Na=Ft.tilePixelRatio*Rn,gu=Ft.tilePixelRatio*Yn.get("symbol-spacing"),Rh=Yn.get("text-padding")*Ft.tilePixelRatio,_u=Yn.get("icon-padding")*Ft.tilePixelRatio,ws=Yn.get("text-max-angle")/180*Math.PI,vu="map"===Yn.get("text-rotation-alignment")&&"point"!==Yn.get("symbol-placement"),Cc="map"===Yn.get("icon-rotation-alignment")&&"point"!==Yn.get("symbol-placement"),co=Yn.get("symbol-placement"),Ec=gu/2,Cs=Yn.get("icon-text-fit");Ot&&"none"!==Cs&&(Ft.allowVerticalPlacement&&nn.vertical&&(sa=cn(Ot,nn.vertical,Cs,Yn.get("icon-text-fit-padding"),la,pl)),Zr&&(Ot=cn(Ot,Zr,Cs,Yn.get("icon-text-fit-padding"),la,pl)));var Ba=function(Wf,wu){wu.x<0||wu.x>=8192||wu.y<0||wu.y>=8192||function(Kn,ho,Nd,Ss,Vh,Pc,kc,ua,Uh,Dc,Cu,Oc,Np,Bd,Eu,Ua,Bp,Vp,$a,zc,Zi,$h,Vd,ca,Ud){var jh,vl,Xr,ha,Su,Tu=Kn.addToLineVertexArray(ho,Nd),$d=0,qh=0,jd=0,qd=0,Gh=-1,Iu=-1,ja={},yl=re(""),Hh=0,Wh=0;if(void 0===ua._unevaluatedLayout.getValue("text-radial-offset")?(Hh=(jh=ua.layout.get("text-offset").evaluate(Zi,{},ca).map(function(Do){return 24*Do}))[0],Wh=jh[1]):(Hh=24*ua.layout.get("text-radial-offset").evaluate(Zi,{},ca),Wh=Dp),Kn.allowVerticalPlacement&&Ss.vertical){var Up=ua.layout.get("text-rotate").evaluate(Zi,{},ca)+90;ha=new ra(Uh,ho,Dc,Cu,Oc,Ss.vertical,Np,Bd,Eu,Up),kc&&(Su=new ra(Uh,ho,Dc,Cu,Oc,kc,Bp,Vp,Eu,Up))}if(Vh){var Mu=ua.layout.get("icon-rotate").evaluate(Zi,{}),Lc="none"!==ua.layout.get("icon-text-fit"),Zh=Wr(Vh,Mu,Vd,Lc),Rc=kc?Wr(kc,Mu,Vd,Lc):void 0;Xr=new ra(Uh,ho,Dc,Cu,Oc,Vh,Bp,Vp,!1,Mu),$d=4*Zh.length;var Xh=Kn.iconSizeData,Fc=null;"source"===Xh.kind?(Fc=[128*ua.layout.get("icon-size").evaluate(Zi,{})])[0]>32640&&Nn(Kn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===Xh.kind&&((Fc=[128*$h.compositeIconSizes[0].evaluate(Zi,{},ca),128*$h.compositeIconSizes[1].evaluate(Zi,{},ca)])[0]>32640||Fc[1]>32640)&&Nn(Kn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Kn.addSymbols(Kn.icon,Zh,Fc,zc,$a,Zi,!1,ho,Tu.lineStartIndex,Tu.lineLength,-1,ca),Gh=Kn.icon.placedSymbolArray.length-1,Rc&&(qh=4*Rc.length,Kn.addSymbols(Kn.icon,Rc,Fc,zc,$a,Zi,Ar.vertical,ho,Tu.lineStartIndex,Tu.lineLength,-1,ca),Iu=Kn.icon.placedSymbolArray.length-1)}for(var Au in Ss.horizontal){var Yh=Ss.horizontal[Au];if(!vl){yl=re(Yh.text);var Zf=ua.layout.get("text-rotate").evaluate(Zi,{},ca);vl=new ra(Uh,ho,Dc,Cu,Oc,Yh,Np,Bd,Eu,Zf)}var Gd=1===Yh.positionedLines.length;if(jd+=zp(Kn,ho,Yh,Pc,ua,Eu,Zi,Ua,Tu,Ss.vertical?Ar.horizontal:Ar.horizontalOnly,Gd?Object.keys(Ss.horizontal):[Au],ja,Gh,$h,ca),Gd)break}Ss.vertical&&(qd+=zp(Kn,ho,Ss.vertical,Pc,ua,Eu,Zi,Ua,Tu,Ar.vertical,["vertical"],ja,Iu,$h,ca));var $p=vl?vl.boxStartIndex:Kn.collisionBoxArray.length,jp=vl?vl.boxEndIndex:Kn.collisionBoxArray.length,Xf=ha?ha.boxStartIndex:Kn.collisionBoxArray.length,Hd=ha?ha.boxEndIndex:Kn.collisionBoxArray.length,Yf=Xr?Xr.boxStartIndex:Kn.collisionBoxArray.length,Kf=Xr?Xr.boxEndIndex:Kn.collisionBoxArray.length,Wd=Su?Su.boxStartIndex:Kn.collisionBoxArray.length,qp=Su?Su.boxEndIndex:Kn.collisionBoxArray.length,po=-1,Pu=function(Do,Kh){return Do&&Do.circleDiameter?Math.max(Do.circleDiameter,Kh):Kh};po=Pu(vl,po),po=Pu(ha,po),po=Pu(Xr,po);var Nc=(po=Pu(Su,po))>-1?1:0;Nc&&(po*=Ud/24),Kn.glyphOffsetArray.length>=Lt.MAX_GLYPHS&&Nn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Zi.sortKey&&Kn.addToSortKeyRanges(Kn.symbolInstances.length,Zi.sortKey),Kn.symbolInstances.emplaceBack(ho.x,ho.y,ja.right>=0?ja.right:-1,ja.center>=0?ja.center:-1,ja.left>=0?ja.left:-1,ja.vertical||-1,Gh,Iu,yl,$p,jp,Xf,Hd,Yf,Kf,Wd,qp,Dc,jd,qd,$d,qh,Nc,0,Np,Hh,Wh,po)}(Ft,wu,Wf,nn,Ot,Pi,sa,Ft.layers[0],Ft.collisionBoxArray,Kt.index,Kt.sourceLayerIndex,Ft.index,dl,Rh,vu,ki,Na,_u,Cc,la,Kt,ni,Qt,aa,bn)};if("line"===co)for(var fl=0,Fh=Ih(Kt.geometry,0,0,8192,8192);fl<Fh.length;fl+=1)for(var Nh=Fh[fl],yu=0,ml=Uf(Nh,gu,ws,nn.vertical||Zr,Ot,24,mu,Ft.overscaling,8192);yu<ml.length;yu+=1){var Bh=ml[yu];Zr&&en(Ft,Zr.text,Ec,Bh)||Ba(Nh,Bh)}else if("line-center"===co)for(var Sc=0,Tc=Kt.geometry;Sc<Tc.length;Sc+=1){var Ic=Tc[Sc];if(Ic.length>1){var Mc=fr(Ic,ws,nn.vertical||Zr,Ot,24,mu);Mc&&Ba(Ic,Mc)}}else if("Polygon"===Kt.type)for(var Va=0,xu=za(Kt.geometry,0);Va<xu.length;Va+=1){var gl=xu[Va],Ac=$f(gl,16);Ba(gl[0],new $t(Ac.x,Ac.y,0))}else if("LineString"===Kt.type)for(var Es=0,_l=Kt.geometry;Es<_l.length;Es+=1){var bu=_l[Es];Ba(bu,new $t(bu[0].x,bu[0].y,0))}else if("Point"===Kt.type)for(var Lp=0,Rd=Kt.geometry;Lp<Rd.length;Lp+=1)for(var Rp=0,Fd=Rd[Lp];Rp<Fd.length;Rp+=1){var Fp=Fd[Rp];Ba([Fp],new $t(Fp.x,Fp.y,0))}}(e,be,qe,xn,c,P,je,st,He,hi,v)},me=0,ve=e.features;me<ve.length;me+=1)de();g&&e.generateCollisionDebugBuffers()},m.perspective=function(e,r,a,c,d){var g,v=1/Math.tan(r/2);return e[0]=v/a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=v,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=d&&d!==1/0?(e[10]=(d+c)*(g=1/(c-d)),e[14]=2*d*c*g):(e[10]=-1,e[14]=-2*c),e},m.pick=function(e,r){for(var a={},c=0;c<r.length;c++){var d=r[c];d in e&&(a[d]=e[d])}return a},m.plugin=Dn,m.polygonIntersectsPolygon=Ni,m.postMapLoadEvent=El,m.postTurnstileEvent=wl,m.potpack=Ch,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=Je,m.registerForPluginStateChange=function(e){return e({pluginStatus:qn,pluginURL:ar}),Zs.on("pluginStateChange",e),e},m.renderColorRamp=fh,m.rotate=function(e,r,a){var c=r[0],d=r[1],g=r[2],v=r[3],w=Math.sin(a),T=Math.cos(a);return e[0]=c*T+g*w,e[1]=d*T+v*w,e[2]=c*-w+g*T,e[3]=d*-w+v*T,e},m.rotateX=function(e,r,a){var c=Math.sin(a),d=Math.cos(a),g=r[4],v=r[5],w=r[6],T=r[7],P=r[8],D=r[9],O=r[10],N=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=g*d+P*c,e[5]=v*d+D*c,e[6]=w*d+O*c,e[7]=T*d+N*c,e[8]=P*d-g*c,e[9]=D*d-v*c,e[10]=O*d-w*c,e[11]=N*d-T*c,e},m.rotateZ=function(e,r,a){var c=Math.sin(a),d=Math.cos(a),g=r[0],v=r[1],w=r[2],T=r[3],P=r[4],D=r[5],O=r[6],N=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=g*d+P*c,e[1]=v*d+D*c,e[2]=w*d+O*c,e[3]=T*d+N*c,e[4]=P*d-g*c,e[5]=D*d-v*c,e[6]=O*d-w*c,e[7]=N*d-T*c,e},m.scale=function(e,r,a){var c=a[0],d=a[1],g=a[2];return e[0]=r[0]*c,e[1]=r[1]*c,e[2]=r[2]*c,e[3]=r[3]*c,e[4]=r[4]*d,e[5]=r[5]*d,e[6]=r[6]*d,e[7]=r[7]*d,e[8]=r[8]*g,e[9]=r[9]*g,e[10]=r[10]*g,e[11]=r[11]*g,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},m.scale$1=function(e,r,a){return e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e[3]=r[3]*a,e},m.scale$2=function(e,r,a){return e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e},m.setCacheLimits=function(e,r){Ds=e,Sl=r},m.setRTLTextPlugin=function(e,r,a){if(void 0===a&&(a=!1),"deferred"===qn||"loading"===qn||"loaded"===qn)throw new Error("setRTLTextPlugin cannot be called multiple times.");ar=go.resolveURL(e),qn="deferred",Ju=r,as(),a||ch()},m.sphericalToCartesian=function(e){var r=e[0],a=e[1],c=e[2];return a+=90,a*=Math.PI/180,c*=Math.PI/180,{x:r*Math.cos(a)*Math.sin(c),y:r*Math.sin(a)*Math.sin(c),z:r*Math.cos(c)}},m.sqrLen=function(e){var r=e[0],a=e[1];return r*r+a*a},m.styleSpec=X,m.sub=function(e,r,a){return e[0]=r[0]-a[0],e[1]=r[1]-a[1],e[2]=r[2]-a[2],e},m.symbolSize=Vf,m.transformMat3=function(e,r,a){var c=r[0],d=r[1],g=r[2];return e[0]=c*a[0]+d*a[3]+g*a[6],e[1]=c*a[1]+d*a[4]+g*a[7],e[2]=c*a[2]+d*a[5]+g*a[8],e},m.transformMat4=rc,m.translate=function(e,r,a){var c,d,g,v,w,T,P,D,O,N,U,Y,K=a[0],le=a[1],oe=a[2];return r===e?(e[12]=r[0]*K+r[4]*le+r[8]*oe+r[12],e[13]=r[1]*K+r[5]*le+r[9]*oe+r[13],e[14]=r[2]*K+r[6]*le+r[10]*oe+r[14],e[15]=r[3]*K+r[7]*le+r[11]*oe+r[15]):(d=r[1],g=r[2],v=r[3],w=r[4],T=r[5],P=r[6],D=r[7],O=r[8],N=r[9],U=r[10],Y=r[11],e[0]=c=r[0],e[1]=d,e[2]=g,e[3]=v,e[4]=w,e[5]=T,e[6]=P,e[7]=D,e[8]=O,e[9]=N,e[10]=U,e[11]=Y,e[12]=c*K+w*le+O*oe+r[12],e[13]=d*K+T*le+N*oe+r[13],e[14]=g*K+P*le+U*oe+r[14],e[15]=v*K+D*le+Y*oe+r[15]),e},m.triggerPluginCompletionEvent=Ws,m.uniqueId=Yr,m.validateCustomStyleLayer=function(e){var r=[],a=e.id;return void 0===a&&r.push({message:"layers."+a+': missing required property "id"'}),void 0===e.render&&r.push({message:"layers."+a+': missing required method "render"'}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&r.push({message:"layers."+a+': property "renderingMode" must be either "2d" or "3d"'}),r},m.validateLight=ed,m.validateStyle=Gs,m.values=function(e){var r=[];for(var a in e)r.push(e[a]);return r},m.vectorTile=iu,m.version="1.15.2",m.warnOnce=Nn,m.webpSupported=_o,m.window=at,m.wrap=Qn}),Dr(0,function(m){function Xi(z){var B=typeof z;if("number"===B||"boolean"===B||"string"===B||null==z)return JSON.stringify(z);if(Array.isArray(z)){for(var V="[",Z=0,te=z;Z<te.length;Z+=1)V+=Xi(te[Z])+",";return V+"]"}for(var ce=Object.keys(z).sort(),he="{",ue=0;ue<ce.length;ue++)he+=JSON.stringify(ce[ue])+":"+Xi(z[ce[ue]])+",";return he+"}"}function Re(z){for(var B="",V=0,Z=m.refProperties;V<Z.length;V+=1)B+="/"+Xi(z[Z[V]]);return B}var jn=function(z){this.keyCache={},z&&this.replace(z)};jn.prototype.replace=function(z){this._layerConfigs={},this._layers={},this.update(z,[])},jn.prototype.update=function(z,B){for(var V=this,Z=0,te=z;Z<te.length;Z+=1){var ce=te[Z];this._layerConfigs[ce.id]=ce;var he=this._layers[ce.id]=m.createStyleLayer(ce);he._featureFilter=m.featureFilter(he.filter),this.keyCache[ce.id]&&delete this.keyCache[ce.id]}for(var ue=0,X=B;ue<X.length;ue+=1){var ie=X[ue];delete this.keyCache[ie],delete this._layerConfigs[ie],delete this._layers[ie]}this.familiesBySource={};for(var ze=0,$e=function(We,ke){for(var Pt={},kt=0;kt<We.length;kt++){var ot=ke&&ke[We[kt].id]||Re(We[kt]);ke&&(ke[We[kt].id]=ot);var gn=Pt[ot];gn||(gn=Pt[ot]=[]),gn.push(We[kt])}var Ut=[];for(var wn in Pt)Ut.push(Pt[wn]);return Ut}(m.values(this._layerConfigs),this.keyCache);ze<$e.length;ze+=1){var ye=$e[ze].map(function(We){return V._layers[We.id]}),Ne=ye[0];if("none"!==Ne.visibility){var et=Ne.source||"",it=this.familiesBySource[et];it||(it=this.familiesBySource[et]={});var ut=Ne.sourceLayer||"_geojsonTileLayer",Ae=it[ut];Ae||(Ae=it[ut]=[]),Ae.push(ye)}}};var yt=function(z){var B={},V=[];for(var Z in z){var te=z[Z],ce=B[Z]={};for(var he in te){var ue=te[+he];if(ue&&0!==ue.bitmap.width&&0!==ue.bitmap.height){var X={x:0,y:0,w:ue.bitmap.width+2,h:ue.bitmap.height+2};V.push(X),ce[he]={rect:X,metrics:ue.metrics}}}}var ie=m.potpack(V),ze=new m.AlphaImage({width:ie.w||1,height:ie.h||1});for(var $e in z){var ye=z[$e];for(var Ne in ye){var et=ye[+Ne];if(et&&0!==et.bitmap.width&&0!==et.bitmap.height){var it=B[$e][Ne].rect;m.AlphaImage.copy(et.bitmap,ze,{x:0,y:0},{x:it.x+1,y:it.y+1},et.bitmap)}}}this.image=ze,this.positions=B};m.register("GlyphAtlas",yt);var Or=function(z){this.tileID=new m.OverscaledTileID(z.tileID.overscaledZ,z.tileID.wrap,z.tileID.canonical.z,z.tileID.canonical.x,z.tileID.canonical.y),this.uid=z.uid,this.zoom=z.zoom,this.pixelRatio=z.pixelRatio,this.tileSize=z.tileSize,this.source=z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=z.showCollisionBoxes,this.collectResourceTiming=!!z.collectResourceTiming,this.returnDependencies=!!z.returnDependencies,this.promoteId=z.promoteId};function at(z,B,V){for(var Z=new m.EvaluationParameters(B),te=0,ce=z;te<ce.length;te+=1)ce[te].recalculate(Z,V)}function Ms(z,B){var V=m.getArrayBuffer(z.request,function(Z,te,ce,he){Z?B(Z):te&&B(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(te)),rawData:te,cacheControl:ce,expires:he})});return function(){V.cancel(),B()}}Or.prototype.parse=function(z,B,V,Z,te){var ce=this;this.status="parsing",this.data=z,this.collisionBoxArray=new m.CollisionBoxArray;var he=new m.DictionaryCoder(Object.keys(z.layers).sort()),ue=new m.FeatureIndex(this.tileID,this.promoteId);ue.bucketLayerIDs=[];var X,ie,ze,$e,ye={},Ne={featureIndex:ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:V},et=B.familiesBySource[this.source];for(var it in et){var ut=z.layers[it];if(ut){1===ut.version&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+it+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Ae=he.encode(it),We=[],ke=0;ke<ut.length;ke++){var Pt=ut.feature(ke),kt=ue.getId(Pt,it);We.push({feature:Pt,id:kt,index:ke,sourceLayerIndex:Ae})}for(var ot=0,gn=et[it];ot<gn.length;ot+=1){var Ut=gn[ot],wn=Ut[0];wn.minzoom&&this.zoom<Math.floor(wn.minzoom)||wn.maxzoom&&this.zoom>=wn.maxzoom||"none"!==wn.visibility&&(at(Ut,this.zoom,V),(ye[wn.id]=wn.createBucket({index:ue.bucketLayerIDs.length,layers:Ut,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ae,sourceID:this.source})).populate(We,Ne,this.tileID.canonical),ue.bucketLayerIDs.push(Ut.map(function(ln){return ln.id})))}}}var Mn=m.mapObject(Ne.glyphDependencies,function(ln){return Object.keys(ln).map(Number)});Object.keys(Mn).length?Z.send("getGlyphs",{uid:this.uid,stacks:Mn},function(ln,ht){X||(X=ln,ie=ht,Vn.call(ce))}):ie={};var Zt=Object.keys(Ne.iconDependencies);Zt.length?Z.send("getImages",{icons:Zt,source:this.source,tileID:this.tileID,type:"icons"},function(ln,ht){X||(X=ln,ze=ht,Vn.call(ce))}):ze={};var _n=Object.keys(Ne.patternDependencies);function Vn(){if(X)return te(X);if(ie&&ze&&$e){var ln=new yt(ie),ht=new m.ImageAtlas(ze,$e);for(var Qa in ye){var Nt=ye[Qa];Nt instanceof m.SymbolBucket?(at(Nt.layers,this.zoom,V),m.performSymbolLayout(Nt,ie,ln.positions,ze,ht.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Nt.hasPattern&&(Nt instanceof m.LineBucket||Nt instanceof m.FillBucket||Nt instanceof m.FillExtrusionBucket)&&(at(Nt.layers,this.zoom,V),Nt.addFeatures(Ne,this.tileID.canonical,ht.patternPositions))}this.status="done",te(null,{buckets:m.values(ye).filter(function(Br){return!Br.isEmpty()}),featureIndex:ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ln.image,imageAtlas:ht,glyphMap:this.returnDependencies?ie:null,iconMap:this.returnDependencies?ze:null,glyphPositions:this.returnDependencies?ln.positions:null})}}_n.length?Z.send("getImages",{icons:_n,source:this.source,tileID:this.tileID,type:"patterns"},function(ln,ht){X||(X=ln,$e=ht,Vn.call(ce))}):$e={},Vn.call(this)};var or=function(z,B,V,Z){this.actor=z,this.layerIndex=B,this.availableImages=V,this.loadVectorData=Z||Ms,this.loading={},this.loaded={}};or.prototype.loadTile=function(z,B){var V=this,Z=z.uid;this.loading||(this.loading={});var te=!!(z&&z.request&&z.request.collectResourceTiming)&&new m.RequestPerformance(z.request),ce=this.loading[Z]=new Or(z);ce.abort=this.loadVectorData(z,function(he,ue){if(delete V.loading[Z],he||!ue)return ce.status="done",V.loaded[Z]=ce,B(he);var X=ue.rawData,ie={};ue.expires&&(ie.expires=ue.expires),ue.cacheControl&&(ie.cacheControl=ue.cacheControl);var ze={};if(te){var $e=te.finish();$e&&(ze.resourceTiming=JSON.parse(JSON.stringify($e)))}ce.vectorTile=ue.vectorTile,ce.parse(ue.vectorTile,V.layerIndex,V.availableImages,V.actor,function(ye,Ne){if(ye||!Ne)return B(ye);B(null,m.extend({rawTileData:X.slice(0)},Ne,ie,ze))}),V.loaded=V.loaded||{},V.loaded[Z]=ce})},or.prototype.reloadTile=function(z,B){var V=this,Z=this.loaded,te=z.uid,ce=this;if(Z&&Z[te]){var he=Z[te];he.showCollisionBoxes=z.showCollisionBoxes;var ue=function(X,ie){var ze=he.reloadCallback;ze&&(delete he.reloadCallback,he.parse(he.vectorTile,ce.layerIndex,V.availableImages,ce.actor,ze)),B(X,ie)};"parsing"===he.status?he.reloadCallback=ue:"done"===he.status&&(he.vectorTile?he.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,ue):ue())}},or.prototype.abortTile=function(z,B){var V=this.loading,Z=z.uid;V&&V[Z]&&V[Z].abort&&(V[Z].abort(),delete V[Z]),B()},or.prototype.removeTile=function(z,B){var V=this.loaded,Z=z.uid;V&&V[Z]&&delete V[Z],B()};var di=m.window.ImageBitmap,Yi=function(){this.loaded={}};function Qn(z,B){if(0!==z.length){yi(z[0],B);for(var V=1;V<z.length;V++)yi(z[V],!B)}}function yi(z,B){for(var V=0,Z=0,te=z.length,ce=te-1;Z<te;ce=Z++)V+=(z[Z][0]-z[ce][0])*(z[ce][1]+z[Z][1]);V>=0!=!!B&&z.reverse()}Yi.prototype.loadTile=function(z,B){var V=z.uid,Z=z.encoding,te=z.rawImageData,ce=di&&te instanceof di?this.getImageData(te):te,he=new m.DEMData(V,ce,Z);this.loaded=this.loaded||{},this.loaded[V]=he,B(null,he)},Yi.prototype.getImageData=function(z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(z.width,z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=z.width,this.offscreenCanvas.height=z.height,this.offscreenCanvasContext.drawImage(z,0,0,z.width,z.height);var B=this.offscreenCanvasContext.getImageData(-1,-1,z.width+2,z.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:B.width,height:B.height},B.data)},Yi.prototype.removeTile=function(z){var B=this.loaded,V=z.uid;B&&B[V]&&delete B[V]};var zr=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,Yr=function(z){this._feature=z,this.extent=m.EXTENT,this.type=z.type,this.properties=z.tags,"id"in z&&!isNaN(z.id)&&(this.id=parseInt(z.id,10))};Yr.prototype.loadGeometry=function(){if(1===this._feature.type){for(var z=[],B=0,V=this._feature.geometry;B<V.length;B+=1){var Z=V[B];z.push([new m.Point$1(Z[0],Z[1])])}return z}for(var te=[],ce=0,he=this._feature.geometry;ce<he.length;ce+=1){for(var ue=[],X=0,ie=he[ce];X<ie.length;X+=1){var ze=ie[X];ue.push(new m.Point$1(ze[0],ze[1]))}te.push(ue)}return te},Yr.prototype.toGeoJSON=function(z,B,V){return zr.call(this,z,B,V)};var Kr=function(z){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=z.length,this._features=z};Kr.prototype.feature=function(z){return new Yr(this._features[z])};var Ga=m.vectorTile.VectorTileFeature,Ha=da;function da(z,B){this.options=B||{},this.features=z,this.length=z.length}function xt(z,B){this.id="number"==typeof z.id?z.id:void 0,this.type=z.type,this.rawGeometry=1===z.type?[z.geometry]:z.geometry,this.properties=z.tags,this.extent=B||4096}da.prototype.feature=function(z){return new xt(this.features[z],this.options.extent)},xt.prototype.loadGeometry=function(){var z=this.rawGeometry;this.geometry=[];for(var B=0;B<z.length;B++){for(var V=z[B],Z=[],te=0;te<V.length;te++)Z.push(new m.Point$1(V[te][0],V[te][1]));this.geometry.push(Z)}return this.geometry},xt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var z=this.geometry,B=1/0,V=-1/0,Z=1/0,te=-1/0,ce=0;ce<z.length;ce++)for(var he=z[ce],ue=0;ue<he.length;ue++){var X=he[ue];B=Math.min(B,X.x),V=Math.max(V,X.x),Z=Math.min(Z,X.y),te=Math.max(te,X.y)}return[B,Z,V,te]},xt.prototype.toGeoJSON=Ga.prototype.toGeoJSON;var mo=Wa,Lr=Ha;function Wa(z){var B=new m.pbf;return function(V,Z){for(var te in V.layers)Z.writeMessage(3,Nn,V.layers[te])}(z,B),B.finish()}function Nn(z,B){var V;B.writeVarintField(15,z.version||1),B.writeStringField(1,z.name||""),B.writeVarintField(5,z.extent||4096);var Z={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<z.length;V++)Z.feature=z.feature(V),B.writeMessage(2,Ki,Z);var te=Z.keys;for(V=0;V<te.length;V++)B.writeStringField(3,te[V]);var ce=Z.values;for(V=0;V<ce.length;V++)B.writeMessage(4,zu,ce[V])}function Ki(z,B){var V=z.feature;void 0!==V.id&&B.writeVarintField(1,V.id),B.writeMessage(2,bl,z),B.writeVarintField(3,V.type),B.writeMessage(4,Ps,V)}function bl(z,B){var V=z.feature,Z=z.keys,te=z.values,ce=z.keycache,he=z.valuecache;for(var ue in V.properties){var X=ce[ue];void 0===X&&(Z.push(ue),ce[ue]=X=Z.length-1),B.writeVarint(X);var ie=V.properties[ue],ze=typeof ie;"string"!==ze&&"boolean"!==ze&&"number"!==ze&&(ie=JSON.stringify(ie));var $e=ze+":"+ie,ye=he[$e];void 0===ye&&(te.push(ie),he[$e]=ye=te.length-1),B.writeVarint(ye)}}function mr(z,B){return(B<<3)+(7&z)}function As(z){return z<<1^z>>31}function Ps(z,B){for(var V=z.loadGeometry(),Z=z.type,te=0,ce=0,he=V.length,ue=0;ue<he;ue++){var X=V[ue],ie=1;1===Z&&(ie=X.length),B.writeVarint(mr(1,ie));for(var ze=3===Z?X.length-1:X.length,$e=0;$e<ze;$e++){1===$e&&1!==Z&&B.writeVarint(mr(2,ze-1));var ye=X[$e].x-te,Ne=X[$e].y-ce;B.writeVarint(As(ye)),B.writeVarint(As(Ne)),te+=ye,ce+=Ne}3===Z&&B.writeVarint(mr(7,1))}}function zu(z,B){var V=typeof z;"string"===V?B.writeStringField(1,z):"boolean"===V?B.writeBooleanField(7,z):"number"===V&&(z%1!=0?B.writeDoubleField(3,z):z<0?B.writeSVarintField(6,z):B.writeVarintField(5,z))}function fa(z,B,V,Z){Qr(z,V,Z),Qr(B,2*V,2*Z),Qr(B,2*V+1,2*Z+1)}function Qr(z,B,V){var Z=z[B];z[B]=z[V],z[V]=Z}function Jr(z,B,V,Z){var te=z-V,ce=B-Z;return te*te+ce*ce}mo.fromVectorTileJs=Wa,mo.fromGeojsonVt=function(z,B){B=B||{};var V={};for(var Z in z)V[Z]=new Ha(z[Z].features,B),V[Z].name=Z,V[Z].version=B.version,V[Z].extent=B.extent;return Wa({layers:V})},mo.GeoJSONWrapper=Lr;var ma=function(z){return z[0]},ga=function(z){return z[1]},Lo=function(z,B,V,Z,te){void 0===B&&(B=ma),void 0===V&&(V=ga),void 0===Z&&(Z=64),void 0===te&&(te=Float64Array),this.nodeSize=Z,this.points=z;for(var ce=z.length<65536?Uint16Array:Uint32Array,he=this.ids=new ce(z.length),ue=this.coords=new te(2*z.length),X=0;X<z.length;X++)he[X]=X,ue[2*X]=B(z[X]),ue[2*X+1]=V(z[X]);!function ie(ze,$e,ye,Ne,et,it){if(!(et-Ne<=ye)){var ut=Ne+et>>1;(function Ae(We,ke,Pt,kt,ot,gn){for(;ot>kt;){if(ot-kt>600){var Ut=ot-kt+1,wn=Pt-kt+1,Mn=Math.log(Ut),Zt=.5*Math.exp(2*Mn/3),_n=.5*Math.sqrt(Mn*Zt*(Ut-Zt)/Ut)*(wn-Ut/2<0?-1:1);Ae(We,ke,Pt,Math.max(kt,Math.floor(Pt-wn*Zt/Ut+_n)),Math.min(ot,Math.floor(Pt+(Ut-wn)*Zt/Ut+_n)),gn)}var Vn=ke[2*Pt+gn],ln=kt,ht=ot;for(fa(We,ke,kt,Pt),ke[2*ot+gn]>Vn&&fa(We,ke,kt,ot);ln<ht;){for(fa(We,ke,ln,ht),ln++,ht--;ke[2*ln+gn]<Vn;)ln++;for(;ke[2*ht+gn]>Vn;)ht--}ke[2*kt+gn]===Vn?fa(We,ke,kt,ht):fa(We,ke,++ht,ot),ht<=Pt&&(kt=ht+1),Pt<=ht&&(ot=ht-1)}})(ze,$e,ut,Ne,et,it%2),ie(ze,$e,ye,Ne,ut-1,it+1),ie(ze,$e,ye,ut+1,et,it+1)}}(he,ue,Z,0,he.length-1,0)};Lo.prototype.range=function(z,B,V,Z){return function(te,ce,he,ue,X,ie,ze){for(var $e,ye,Ne=[0,te.length-1,0],et=[];Ne.length;){var it=Ne.pop(),ut=Ne.pop(),Ae=Ne.pop();if(ut-Ae<=ze)for(var We=Ae;We<=ut;We++)ye=ce[2*We+1],($e=ce[2*We])>=he&&$e<=X&&ye>=ue&&ye<=ie&&et.push(te[We]);else{var ke=Math.floor((Ae+ut)/2);ye=ce[2*ke+1],($e=ce[2*ke])>=he&&$e<=X&&ye>=ue&&ye<=ie&&et.push(te[ke]);var Pt=(it+1)%2;(0===it?he<=$e:ue<=ye)&&(Ne.push(Ae),Ne.push(ke-1),Ne.push(Pt)),(0===it?X>=$e:ie>=ye)&&(Ne.push(ke+1),Ne.push(ut),Ne.push(Pt))}}return et}(this.ids,this.coords,z,B,V,Z,this.nodeSize)},Lo.prototype.within=function(z,B,V){return function(Z,te,ce,he,ue,X){for(var ie=[0,Z.length-1,0],ze=[],$e=ue*ue;ie.length;){var ye=ie.pop(),Ne=ie.pop(),et=ie.pop();if(Ne-et<=X)for(var it=et;it<=Ne;it++)Jr(te[2*it],te[2*it+1],ce,he)<=$e&&ze.push(Z[it]);else{var ut=Math.floor((et+Ne)/2),Ae=te[2*ut],We=te[2*ut+1];Jr(Ae,We,ce,he)<=$e&&ze.push(Z[ut]);var ke=(ye+1)%2;(0===ye?ce-ue<=Ae:he-ue<=We)&&(ie.push(et),ie.push(ut-1),ie.push(ke)),(0===ye?ce+ue>=Ae:he+ue>=We)&&(ie.push(ut+1),ie.push(Ne),ie.push(ke))}}return ze}(this.ids,this.coords,z,B,V,this.nodeSize)};var qc={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(z){return z}},Di=function(z){this.options=Ro(Object.create(qc),z),this.trees=new Array(this.options.maxZoom+1)};function go(z,B,V,Z,te){return{x:z,y:B,zoom:1/0,id:V,parentId:-1,numPoints:Z,properties:te}}function sn(z,B){var V=z.geometry.coordinates,Z=V[1];return{x:eo(V[0]),y:qt(Z),zoom:1/0,index:B,parentId:-1}}function _o(z){return{type:"Feature",id:z.id,properties:Za(z),geometry:{type:"Point",coordinates:[(Z=z.x,360*(Z-.5)),(B=z.y,V=(180-360*B)*Math.PI/180,360*Math.atan(Math.exp(V))/Math.PI-90)]}};var B,V,Z}function Za(z){var B=z.numPoints,V=B>=1e4?Math.round(B/1e3)+"k":B>=1e3?Math.round(B/100)/10+"k":B;return Ro(Ro({},z.properties),{cluster:!0,cluster_id:z.id,point_count:B,point_count_abbreviated:V})}function eo(z){return z/360+.5}function qt(z){var B=Math.sin(z*Math.PI/180),V=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return V<0?0:V>1?1:V}function Ro(z,B){for(var V in B)z[V]=B[V];return z}function $i(z){return z.x}function Rr(z){return z.y}function Lu(z,B,V,Z,te,ce){var he=te-V,ue=ce-Z;if(0!==he||0!==ue){var X=((z-V)*he+(B-Z)*ue)/(he*he+ue*ue);X>1?(V=te,Z=ce):X>0&&(V+=he*X,Z+=ue*X)}return(he=z-V)*he+(ue=B-Z)*ue}function Fr(z,B,V,Z){var te={id:void 0===z?null:z,type:B,geometry:V,tags:Z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ce){var he=ce.geometry,ue=ce.type;if("Point"===ue||"MultiPoint"===ue||"LineString"===ue)ks(ce,he);else if("Polygon"===ue||"MultiLineString"===ue)for(var X=0;X<he.length;X++)ks(ce,he[X]);else if("MultiPolygon"===ue)for(X=0;X<he.length;X++)for(var ie=0;ie<he[X].length;ie++)ks(ce,he[X][ie])}(te),te}function ks(z,B){for(var V=0;V<B.length;V+=3)z.minX=Math.min(z.minX,B[V]),z.minY=Math.min(z.minY,B[V+1]),z.maxX=Math.max(z.maxX,B[V]),z.maxY=Math.max(z.maxY,B[V+1])}function gr(z,B,V,Z){if(B.geometry){var te=B.geometry.coordinates,ce=B.geometry.type,he=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),ue=[],X=B.id;if(V.promoteId?X=B.properties[V.promoteId]:V.generateId&&(X=Z||0),"Point"===ce)_a(te,ue);else if("MultiPoint"===ce)for(var ie=0;ie<te.length;ie++)_a(te[ie],ue);else if("LineString"===ce)Xa(te,ue,he,!1);else if("MultiLineString"===ce){if(V.lineMetrics){for(ie=0;ie<te.length;ie++)Xa(te[ie],ue=[],he,!1),z.push(Fr(X,"LineString",ue,B.properties));return}_r(te,ue,he,!1)}else if("Polygon"===ce)_r(te,ue,he,!0);else{if("MultiPolygon"!==ce){if("GeometryCollection"===ce){for(ie=0;ie<B.geometry.geometries.length;ie++)gr(z,{id:X,geometry:B.geometry.geometries[ie],properties:B.properties},V,Z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ie=0;ie<te.length;ie++){var ze=[];_r(te[ie],ze,he,!0),ue.push(ze)}}z.push(Fr(X,ce,ue,B.properties))}}function _a(z,B){B.push(vr(z[0])),B.push(va(z[1])),B.push(0)}function Xa(z,B,V,Z){for(var te,ce,he=0,ue=0;ue<z.length;ue++){var X=vr(z[ue][0]),ie=va(z[ue][1]);B.push(X),B.push(ie),B.push(0),ue>0&&(he+=Z?(te*ie-X*ce)/2:Math.sqrt(Math.pow(X-te,2)+Math.pow(ie-ce,2))),te=X,ce=ie}var ze=B.length-3;B[2]=1,function $e(ye,Ne,et,it){for(var ut,Ae=it,We=et-Ne>>1,ke=et-Ne,Pt=ye[Ne],kt=ye[Ne+1],ot=ye[et],gn=ye[et+1],Ut=Ne+3;Ut<et;Ut+=3){var wn=Lu(ye[Ut],ye[Ut+1],Pt,kt,ot,gn);if(wn>Ae)ut=Ut,Ae=wn;else if(wn===Ae){var Mn=Math.abs(Ut-We);Mn<ke&&(ut=Ut,ke=Mn)}}Ae>it&&(ut-Ne>3&&$e(ye,Ne,ut,it),ye[ut+2]=Ae,et-ut>3&&$e(ye,ut,et,it))}(B,0,ze,V),B[ze+2]=1,B.size=Math.abs(he),B.start=0,B.end=B.size}function _r(z,B,V,Z){for(var te=0;te<z.length;te++){var ce=[];Xa(z[te],ce,V,Z),B.push(ce)}}function vr(z){return z/360+.5}function va(z){var B=Math.sin(z*Math.PI/180),V=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return V<0?0:V>1?1:V}function Nr(z,B,V,Z,te,ce,he,ue){if(Z/=B,ce>=(V/=B)&&he<Z)return z;if(he<V||ce>=Z)return null;for(var X=[],ie=0;ie<z.length;ie++){var ze=z[ie],$e=ze.geometry,ye=ze.type,Ne=0===te?ze.minX:ze.minY,et=0===te?ze.maxX:ze.maxY;if(Ne>=V&&et<Z)X.push(ze);else if(!(et<V||Ne>=Z)){var it=[];if("Point"===ye||"MultiPoint"===ye)Ru($e,it,V,Z,te);else if("LineString"===ye)wl($e,it,V,Z,te,!1,ue.lineMetrics);else if("MultiLineString"===ye)El($e,it,V,Z,te,!1);else if("Polygon"===ye)El($e,it,V,Z,te,!0);else if("MultiPolygon"===ye)for(var ut=0;ut<$e.length;ut++){var Ae=[];El($e[ut],Ae,V,Z,te,!0),Ae.length&&it.push(Ae)}if(it.length){if(ue.lineMetrics&&"LineString"===ye){for(ut=0;ut<it.length;ut++)X.push(Fr(ze.id,ye,it[ut],ze.tags));continue}"LineString"!==ye&&"MultiLineString"!==ye||(1===it.length?(ye="LineString",it=it[0]):ye="MultiLineString"),"Point"!==ye&&"MultiPoint"!==ye||(ye=3===it.length?"Point":"MultiPoint"),X.push(Fr(ze.id,ye,it,ze.tags))}}}return X.length?X:null}function Ru(z,B,V,Z,te){for(var ce=0;ce<z.length;ce+=3){var he=z[ce+te];he>=V&&he<=Z&&(B.push(z[ce]),B.push(z[ce+1]),B.push(z[ce+2]))}}function wl(z,B,V,Z,te,ce,he){for(var ue,X,ie=Cl(z),ze=0===te?Sl:Ya,$e=z.start,ye=0;ye<z.length-3;ye+=3){var Ne=z[ye],et=z[ye+1],it=z[ye+2],ut=z[ye+3],Ae=z[ye+4],We=0===te?Ne:et,ke=0===te?ut:Ae,Pt=!1;he&&(ue=Math.sqrt(Math.pow(Ne-ut,2)+Math.pow(et-Ae,2))),We<V?ke>V&&(X=ze(ie,Ne,et,ut,Ae,V),he&&(ie.start=$e+ue*X)):We>Z?ke<Z&&(X=ze(ie,Ne,et,ut,Ae,Z),he&&(ie.start=$e+ue*X)):Ds(ie,Ne,et,it),ke<V&&We>=V&&(X=ze(ie,Ne,et,ut,Ae,V),Pt=!0),ke>Z&&We<=Z&&(X=ze(ie,Ne,et,ut,Ae,Z),Pt=!0),!ce&&Pt&&(he&&(ie.end=$e+ue*X),B.push(ie),ie=Cl(z)),he&&($e+=ue)}var kt=z.length-3;Ne=z[kt],et=z[kt+1],it=z[kt+2],(We=0===te?Ne:et)>=V&&We<=Z&&Ds(ie,Ne,et,it),kt=ie.length-3,ce&&kt>=3&&(ie[kt]!==ie[0]||ie[kt+1]!==ie[1])&&Ds(ie,ie[0],ie[1],ie[2]),ie.length&&B.push(ie)}function Cl(z){var B=[];return B.size=z.size,B.start=z.start,B.end=z.end,B}function El(z,B,V,Z,te,ce){for(var he=0;he<z.length;he++)wl(z[he],B,V,Z,te,ce,!1)}function Ds(z,B,V,Z){z.push(B),z.push(V),z.push(Z)}function Sl(z,B,V,Z,te,ce){var he=(ce-B)/(Z-B);return z.push(ce),z.push(V+(te-V)*he),z.push(1),he}function Ya(z,B,V,Z,te,ce){var he=(ce-V)/(te-V);return z.push(B+(Z-B)*he),z.push(ce),z.push(1),he}function Os(z,B){for(var V=[],Z=0;Z<z.length;Z++){var te,ce=z[Z],he=ce.type;if("Point"===he||"MultiPoint"===he||"LineString"===he)te=ya(ce.geometry,B);else if("MultiLineString"===he||"Polygon"===he){te=[];for(var ue=0;ue<ce.geometry.length;ue++)te.push(ya(ce.geometry[ue],B))}else if("MultiPolygon"===he)for(te=[],ue=0;ue<ce.geometry.length;ue++){for(var X=[],ie=0;ie<ce.geometry[ue].length;ie++)X.push(ya(ce.geometry[ue][ie],B));te.push(X)}V.push(Fr(ce.id,he,te,ce.tags))}return V}function ya(z,B){var V=[];V.size=z.size,void 0!==z.start&&(V.start=z.start,V.end=z.end);for(var Z=0;Z<z.length;Z+=3)V.push(z[Z]+B,z[Z+1],z[Z+2]);return V}function Tl(z,B){if(z.transformed)return z;var V,Z,te,ce=1<<z.z,he=z.x,ue=z.y;for(V=0;V<z.features.length;V++){var X=z.features[V],ie=X.geometry,ze=X.type;if(X.geometry=[],1===ze)for(Z=0;Z<ie.length;Z+=2)X.geometry.push(zs(ie[Z],ie[Z+1],B,ce,he,ue));else for(Z=0;Z<ie.length;Z++){var $e=[];for(te=0;te<ie[Z].length;te+=2)$e.push(zs(ie[Z][te],ie[Z][te+1],B,ce,he,ue));X.geometry.push($e)}}return z.transformed=!0,z}function zs(z,B,V,Z,te,ce){return[Math.round(V*(z*Z-te)),Math.round(V*(B*Z-ce))]}function Il(z,B,V,Z,te){for(var ce=B===te.maxZoom?0:te.tolerance/((1<<B)*te.extent),he={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:Z,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<z.length;ue++){he.numFeatures++,Ml(he,z[ue],ce,te);var X=z[ue].minX,ie=z[ue].minY,ze=z[ue].maxX,$e=z[ue].maxY;X<he.minX&&(he.minX=X),ie<he.minY&&(he.minY=ie),ze>he.maxX&&(he.maxX=ze),$e>he.maxY&&(he.maxY=$e)}return he}function Ml(z,B,V,Z){var te=B.geometry,ce=B.type,he=[];if("Point"===ce||"MultiPoint"===ce)for(var ue=0;ue<te.length;ue+=3)he.push(te[ue]),he.push(te[ue+1]),z.numPoints++,z.numSimplified++;else if("LineString"===ce)xa(he,te,z,V,!1,!1);else if("MultiLineString"===ce||"Polygon"===ce)for(ue=0;ue<te.length;ue++)xa(he,te[ue],z,V,"Polygon"===ce,0===ue);else if("MultiPolygon"===ce)for(var X=0;X<te.length;X++){var ie=te[X];for(ue=0;ue<ie.length;ue++)xa(he,ie[ue],z,V,!0,0===ue)}if(he.length){var ze=B.tags||null;if("LineString"===ce&&Z.lineMetrics){for(var $e in ze={},B.tags)ze[$e]=B.tags[$e];ze.mapbox_clip_start=te.start/te.size,ze.mapbox_clip_end=te.end/te.size}var ye={geometry:he,type:"Polygon"===ce||"MultiPolygon"===ce?3:"LineString"===ce||"MultiLineString"===ce?2:1,tags:ze};null!==B.id&&(ye.id=B.id),z.features.push(ye)}}function xa(z,B,V,Z,te,ce){var he=Z*Z;if(Z>0&&B.size<(te?he:Z))V.numPoints+=B.length/3;else{for(var ue=[],X=0;X<B.length;X+=3)(0===Z||B[X+2]>he)&&(V.numSimplified++,ue.push(B[X]),ue.push(B[X+1])),V.numPoints++;te&&function(ie,ze){for(var $e=0,ye=0,Ne=ie.length,et=Ne-2;ye<Ne;et=ye,ye+=2)$e+=(ie[ye]-ie[et])*(ie[ye+1]+ie[et+1]);if($e>0===ze)for(ye=0,Ne=ie.length;ye<Ne/2;ye+=2){var it=ie[ye],ut=ie[ye+1];ie[ye]=ie[Ne-2-ye],ie[ye+1]=ie[Ne-1-ye],ie[Ne-2-ye]=it,ie[Ne-1-ye]=ut}}(ue,ce),z.push(ue)}}function ba(z,B){var V=(B=this.options=function(te,ce){for(var he in ce)te[he]=ce[he];return te}(Object.create(this.options),B)).debug;if(V&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var te,ce,he,ue,X,ie,Z=function(te,ce){var he=[];if("FeatureCollection"===te.type)for(var ue=0;ue<te.features.length;ue++)gr(he,te.features[ue],ce,ue);else gr(he,"Feature"===te.type?te:{geometry:te},ce);return he}(z,B);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(te=Z,ce=B,he=ce.buffer/ce.extent,ue=te,X=Nr(te,1,-1-he,he,0,-1,2,ce),ie=Nr(te,1,1-he,2+he,0,-1,2,ce),(X||ie)&&(ue=Nr(te,1,-he,1+he,0,-1,2,ce)||[],X&&(ue=Os(X,1).concat(ue)),ie&&(ue=ue.concat(Os(ie,-1)))),Z=ue).length&&this.splitTile(Z,0,0,0),V&&(Z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Fo(z,B,V){return 32*((1<<z)*V+B)+z}function Ka(z,B){var V=z.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);var Z=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!Z)return B(null,null);var te=new Kr(Z.features),ce=mo(te);0===ce.byteOffset&&ce.byteLength===ce.buffer.byteLength||(ce=new Uint8Array(ce)),B(null,{vectorTile:te,rawData:ce.buffer})}Di.prototype.load=function(z){var B=this.options,V=B.log,Z=B.minZoom,te=B.maxZoom,ce=B.nodeSize;V&&console.time("total time");var he="prepare "+z.length+" points";V&&console.time(he),this.points=z;for(var ue=[],X=0;X<z.length;X++)z[X].geometry&&ue.push(sn(z[X],X));this.trees[te+1]=new Lo(ue,$i,Rr,ce,Float32Array),V&&console.timeEnd(he);for(var ie=te;ie>=Z;ie--){var ze=+Date.now();ue=this._cluster(ue,ie),this.trees[ie]=new Lo(ue,$i,Rr,ce,Float32Array),V&&console.log("z%d: %d clusters in %dms",ie,ue.length,+Date.now()-ze)}return V&&console.timeEnd("total time"),this},Di.prototype.getClusters=function(z,B){var V=((z[0]+180)%360+360)%360-180,Z=Math.max(-90,Math.min(90,z[1])),te=180===z[2]?180:((z[2]+180)%360+360)%360-180,ce=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)V=-180,te=180;else if(V>te){var he=this.getClusters([V,Z,180,ce],B),ue=this.getClusters([-180,Z,te,ce],B);return he.concat(ue)}for(var X=this.trees[this._limitZoom(B)],ie=[],ze=0,$e=X.range(eo(V),qt(ce),eo(te),qt(Z));ze<$e.length;ze+=1){var ye=X.points[$e[ze]];ie.push(ye.numPoints?_o(ye):this.points[ye.index])}return ie},Di.prototype.getChildren=function(z){var B=this._getOriginId(z),V=this._getOriginZoom(z),Z="No cluster with the specified id.",te=this.trees[V];if(!te)throw new Error(Z);var ce=te.points[B];if(!ce)throw new Error(Z);for(var he=this.options.radius/(this.options.extent*Math.pow(2,V-1)),ue=[],X=0,ie=te.within(ce.x,ce.y,he);X<ie.length;X+=1){var ze=te.points[ie[X]];ze.parentId===z&&ue.push(ze.numPoints?_o(ze):this.points[ze.index])}if(0===ue.length)throw new Error(Z);return ue},Di.prototype.getLeaves=function(z,B,V){var Z=[];return this._appendLeaves(Z,z,B=B||10,V=V||0,0),Z},Di.prototype.getTile=function(z,B,V){var Z=this.trees[this._limitZoom(z)],te=Math.pow(2,z),ce=this.options,he=ce.radius/ce.extent,ue=(V-he)/te,X=(V+1+he)/te,ie={features:[]};return this._addTileFeatures(Z.range((B-he)/te,ue,(B+1+he)/te,X),Z.points,B,V,te,ie),0===B&&this._addTileFeatures(Z.range(1-he/te,ue,1,X),Z.points,te,V,te,ie),B===te-1&&this._addTileFeatures(Z.range(0,ue,he/te,X),Z.points,-1,V,te,ie),ie.features.length?ie:null},Di.prototype.getClusterExpansionZoom=function(z){for(var B=this._getOriginZoom(z)-1;B<=this.options.maxZoom;){var V=this.getChildren(z);if(B++,1!==V.length)break;z=V[0].properties.cluster_id}return B},Di.prototype._appendLeaves=function(z,B,V,Z,te){for(var ce=0,he=this.getChildren(B);ce<he.length;ce+=1){var ue=he[ce],X=ue.properties;if(X&&X.cluster?te+X.point_count<=Z?te+=X.point_count:te=this._appendLeaves(z,X.cluster_id,V,Z,te):te<Z?te++:z.push(ue),z.length===V)break}return te},Di.prototype._addTileFeatures=function(z,B,V,Z,te,ce){for(var he=0,ue=z;he<ue.length;he+=1){var X=B[ue[he]],ie=X.numPoints,ze={type:1,geometry:[[Math.round(this.options.extent*(X.x*te-V)),Math.round(this.options.extent*(X.y*te-Z))]],tags:ie?Za(X):this.points[X.index].properties},$e=void 0;ie?$e=X.id:this.options.generateId?$e=X.index:this.points[X.index].id&&($e=this.points[X.index].id),void 0!==$e&&(ze.id=$e),ce.features.push(ze)}},Di.prototype._limitZoom=function(z){return Math.max(this.options.minZoom,Math.min(+z,this.options.maxZoom+1))},Di.prototype._cluster=function(z,B){for(var V=[],Z=this.options,te=Z.reduce,ce=Z.minPoints,he=Z.radius/(Z.extent*Math.pow(2,B)),ue=0;ue<z.length;ue++){var X=z[ue];if(!(X.zoom<=B)){X.zoom=B;for(var ie=this.trees[B+1],ze=ie.within(X.x,X.y,he),$e=X.numPoints||1,ye=$e,Ne=0,et=ze;Ne<et.length;Ne+=1){var it=ie.points[et[Ne]];it.zoom>B&&(ye+=it.numPoints||1)}if(ye>=ce){for(var ut=X.x*$e,Ae=X.y*$e,We=te&&$e>1?this._map(X,!0):null,ke=(ue<<5)+(B+1)+this.points.length,Pt=0,kt=ze;Pt<kt.length;Pt+=1){var ot=ie.points[kt[Pt]];if(!(ot.zoom<=B)){ot.zoom=B;var gn=ot.numPoints||1;ut+=ot.x*gn,Ae+=ot.y*gn,ot.parentId=ke,te&&(We||(We=this._map(X,!0)),te(We,this._map(ot)))}}X.parentId=ke,V.push(go(ut/ye,Ae/ye,ke,ye,We))}else if(V.push(X),ye>1)for(var Ut=0,wn=ze;Ut<wn.length;Ut+=1){var Mn=ie.points[wn[Ut]];Mn.zoom<=B||(Mn.zoom=B,V.push(Mn))}}}return V},Di.prototype._getOriginId=function(z){return z-this.points.length>>5},Di.prototype._getOriginZoom=function(z){return(z-this.points.length)%32},Di.prototype._map=function(z,B){if(z.numPoints)return B?Ro({},z.properties):z.properties;var V=this.points[z.index].properties,Z=this.options.map(V);return B&&Z===V?Ro({},Z):Z},ba.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ba.prototype.splitTile=function(z,B,V,Z,te,ce,he){for(var ue=[z,B,V,Z],X=this.options,ie=X.debug;ue.length;){Z=ue.pop(),V=ue.pop(),B=ue.pop(),z=ue.pop();var ze=1<<B,$e=Fo(B,V,Z),ye=this.tiles[$e];if(!ye&&(ie>1&&console.time("creation"),ye=this.tiles[$e]=Il(z,B,V,Z,X),this.tileCoords.push({z:B,x:V,y:Z}),ie)){ie>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,V,Z,ye.numFeatures,ye.numPoints,ye.numSimplified),console.timeEnd("creation"));var Ne="z"+B;this.stats[Ne]=(this.stats[Ne]||0)+1,this.total++}if(ye.source=z,te){if(B===X.maxZoom||B===te)continue;var et=1<<te-B;if(V!==Math.floor(ce/et)||Z!==Math.floor(he/et))continue}else if(B===X.indexMaxZoom||ye.numPoints<=X.indexMaxPoints)continue;if(ye.source=null,0!==z.length){ie>1&&console.time("clipping");var it,ut,Ae,We,ke,Pt,kt=.5*X.buffer/X.extent,ot=.5-kt,gn=.5+kt,Ut=1+kt;it=ut=Ae=We=null,ke=Nr(z,ze,V-kt,V+gn,0,ye.minX,ye.maxX,X),Pt=Nr(z,ze,V+ot,V+Ut,0,ye.minX,ye.maxX,X),z=null,ke&&(it=Nr(ke,ze,Z-kt,Z+gn,1,ye.minY,ye.maxY,X),ut=Nr(ke,ze,Z+ot,Z+Ut,1,ye.minY,ye.maxY,X),ke=null),Pt&&(Ae=Nr(Pt,ze,Z-kt,Z+gn,1,ye.minY,ye.maxY,X),We=Nr(Pt,ze,Z+ot,Z+Ut,1,ye.minY,ye.maxY,X),Pt=null),ie>1&&console.timeEnd("clipping"),ue.push(it||[],B+1,2*V,2*Z),ue.push(ut||[],B+1,2*V,2*Z+1),ue.push(Ae||[],B+1,2*V+1,2*Z),ue.push(We||[],B+1,2*V+1,2*Z+1)}}},ba.prototype.getTile=function(z,B,V){var Z=this.options,te=Z.extent,ce=Z.debug;if(z<0||z>24)return null;var he=1<<z,ue=Fo(z,B=(B%he+he)%he,V);if(this.tiles[ue])return Tl(this.tiles[ue],te);ce>1&&console.log("drilling down to z%d-%d-%d",z,B,V);for(var X,ie=z,ze=B,$e=V;!X&&ie>0;)ie--,ze=Math.floor(ze/2),$e=Math.floor($e/2),X=this.tiles[Fo(ie,ze,$e)];return X&&X.source?(ce>1&&console.log("found parent tile z%d-%d-%d",ie,ze,$e),ce>1&&console.time("drilling down"),this.splitTile(X.source,ie,ze,$e,z,B,V),ce>1&&console.timeEnd("drilling down"),this.tiles[ue]?Tl(this.tiles[ue],te):null):null};var Ls=function(z){function B(V,Z,te,ce){z.call(this,V,Z,te,Ka),ce&&(this.loadGeoJSON=ce)}return z&&(B.__proto__=z),(B.prototype=Object.create(z&&z.prototype)).constructor=B,B.prototype.loadData=function(V,Z){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Z,this._pendingLoadDataParams=V,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},B.prototype._loadData=function(){var V=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Z=this._pendingCallback,te=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var ce=!!(te&&te.request&&te.request.collectResourceTiming)&&new m.RequestPerformance(te.request);this.loadGeoJSON(te,function(he,ue){if(he||!ue)return Z(he);if("object"!=typeof ue)return Z(new Error("Input data given to '"+te.source+"' is not a valid GeoJSON object."));!function ye(Ne,et){var it,ut=Ne&&Ne.type;if("FeatureCollection"===ut)for(it=0;it<Ne.features.length;it++)ye(Ne.features[it],et);else if("GeometryCollection"===ut)for(it=0;it<Ne.geometries.length;it++)ye(Ne.geometries[it],et);else if("Feature"===ut)ye(Ne.geometry,et);else if("Polygon"===ut)Qn(Ne.coordinates,et);else if("MultiPolygon"===ut)for(it=0;it<Ne.coordinates.length;it++)Qn(Ne.coordinates[it],et);return Ne}(ue,!0);try{if(te.filter){var X=m.createExpression(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===X.result)throw new Error(X.value.map(function(ye){return ye.key+": "+ye.message}).join(", "));var ie=ue.features.filter(function(ye){return X.value.evaluate({zoom:0},ye)});ue={type:"FeatureCollection",features:ie}}V._geoJSONIndex=te.cluster?new Di(function(ye){var Ne=ye.superclusterOptions,et=ye.clusterProperties;if(!et||!Ne)return Ne;for(var it={},ut={},Ae={accumulated:null,zoom:0},We={properties:null},ke=Object.keys(et),Pt=0,kt=ke;Pt<kt.length;Pt+=1){var ot=kt[Pt],gn=et[ot],Ut=gn[0],wn=m.createExpression(gn[1]),Mn=m.createExpression("string"==typeof Ut?[Ut,["accumulated"],["get",ot]]:Ut);it[ot]=wn.value,ut[ot]=Mn.value}return Ne.map=function(Zt){We.properties=Zt;for(var _n={},Vn=0,ln=ke;Vn<ln.length;Vn+=1){var ht=ln[Vn];_n[ht]=it[ht].evaluate(Ae,We)}return _n},Ne.reduce=function(Zt,_n){We.properties=_n;for(var Vn=0,ln=ke;Vn<ln.length;Vn+=1){var ht=ln[Vn];Ae.accumulated=Zt[ht],Zt[ht]=ut[ht].evaluate(Ae,We)}},Ne}(te)).load(ue.features):new ba(ye=ue,te.geojsonVtOptions)}catch(ye){return Z(ye)}var ye;V.loaded={};var ze={};if(ce){var $e=ce.finish();$e&&(ze.resourceTiming={},ze.resourceTiming[te.source]=JSON.parse(JSON.stringify($e)))}Z(null,ze)})}},B.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},B.prototype.reloadTile=function(V,Z){var te=this.loaded;return te&&te[V.uid]?z.prototype.reloadTile.call(this,V,Z):this.loadTile(V,Z)},B.prototype.loadGeoJSON=function(V,Z){if(V.request)m.getJSON(V.request,Z);else{if("string"!=typeof V.data)return Z(new Error("Input data given to '"+V.source+"' is not a valid GeoJSON object."));try{return Z(null,JSON.parse(V.data))}catch(te){return Z(new Error("Input data given to '"+V.source+"' is not a valid GeoJSON object."))}}},B.prototype.removeSource=function(V,Z){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Z()},B.prototype.getClusterExpansionZoom=function(V,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(te){Z(te)}},B.prototype.getClusterChildren=function(V,Z){try{Z(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(te){Z(te)}},B.prototype.getClusterLeaves=function(V,Z){try{Z(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(te){Z(te)}},B}(or),Bn=function(z){var B=this;this.self=z,this.actor=new m.Actor(z,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:or,geojson:Ls},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(V,Z){if(B.workerSourceTypes[V])throw new Error('Worker source with name "'+V+'" already registered.');B.workerSourceTypes[V]=Z},this.self.registerRTLTextPlugin=function(V){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=V.applyArabicShaping,m.plugin.processBidirectionalText=V.processBidirectionalText,m.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}};return Bn.prototype.setReferrer=function(z,B){this.referrer=B},Bn.prototype.setImages=function(z,B,V){for(var Z in this.availableImages[z]=B,this.workerSources[z]){var te=this.workerSources[z][Z];for(var ce in te)te[ce].availableImages=B}V()},Bn.prototype.setLayers=function(z,B,V){this.getLayerIndex(z).replace(B),V()},Bn.prototype.updateLayers=function(z,B,V){this.getLayerIndex(z).update(B.layers,B.removedIds),V()},Bn.prototype.loadTile=function(z,B,V){this.getWorkerSource(z,B.type,B.source).loadTile(B,V)},Bn.prototype.loadDEMTile=function(z,B,V){this.getDEMWorkerSource(z,B.source).loadTile(B,V)},Bn.prototype.reloadTile=function(z,B,V){this.getWorkerSource(z,B.type,B.source).reloadTile(B,V)},Bn.prototype.abortTile=function(z,B,V){this.getWorkerSource(z,B.type,B.source).abortTile(B,V)},Bn.prototype.removeTile=function(z,B,V){this.getWorkerSource(z,B.type,B.source).removeTile(B,V)},Bn.prototype.removeDEMTile=function(z,B){this.getDEMWorkerSource(z,B.source).removeTile(B)},Bn.prototype.removeSource=function(z,B,V){if(this.workerSources[z]&&this.workerSources[z][B.type]&&this.workerSources[z][B.type][B.source]){var Z=this.workerSources[z][B.type][B.source];delete this.workerSources[z][B.type][B.source],void 0!==Z.removeSource?Z.removeSource(B,V):V()}},Bn.prototype.loadWorkerSource=function(z,B,V){try{this.self.importScripts(B.url),V()}catch(Z){V(Z.toString())}},Bn.prototype.syncRTLPluginState=function(z,B,V){try{m.plugin.setState(B);var Z=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&null!=Z){this.self.importScripts(Z);var te=m.plugin.isParsed();V(te?void 0:new Error("RTL Text Plugin failed to import scripts from "+Z),te)}}catch(ce){V(ce.toString())}},Bn.prototype.getAvailableImages=function(z){var B=this.availableImages[z];return B||(B=[]),B},Bn.prototype.getLayerIndex=function(z){var B=this.layerIndexes[z];return B||(B=this.layerIndexes[z]=new jn),B},Bn.prototype.getWorkerSource=function(z,B,V){var Z=this;return this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][B]||(this.workerSources[z][B]={}),this.workerSources[z][B][V]||(this.workerSources[z][B][V]=new this.workerSourceTypes[B]({send:function(te,ce,he){Z.actor.send(te,ce,he,z)}},this.getLayerIndex(z),this.getAvailableImages(z))),this.workerSources[z][B][V]},Bn.prototype.getDEMWorkerSource=function(z,B){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][B]||(this.demWorkerSources[z][B]=new Yi),this.demWorkerSources[z][B]},Bn.prototype.enforceCacheSizeLimit=function(z,B){m.enforceCacheSizeLimit(B)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Bn(self)),Bn}),Dr(0,function(m){var Xi=m.createCommonjsModule(function(s){function u(_){return!l(_)}function l(_){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,S,k=new Blob([""],{type:"text/javascript"}),L=URL.createObjectURL(k);try{S=new Worker(L),b=!0}catch(j){b=!1}return S&&S.terminate(),URL.revokeObjectURL(L),b}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var b=document.createElement("canvas");b.width=b.height=1;var S=b.getContext("2d");if(!S)return!1;var k=S.getImageData(0,0,1,1);return k&&k.width===b.width}()?(void 0===h[x=_&&_.failIfMajorPerformanceCaveat]&&(h[x]=function(b){var L,j,H,S=(L=b,j=document.createElement("canvas"),(H=Object.create(u.webGLContextAttributes)).failIfMajorPerformanceCaveat=L,j.probablySupportsContext?j.probablySupportsContext("webgl",H)||j.probablySupportsContext("experimental-webgl",H):j.supportsContext?j.supportsContext("webgl",H)||j.supportsContext("experimental-webgl",H):j.getContext("webgl",H)||j.getContext("experimental-webgl",H));if(!S)return!1;var k=S.createShader(S.VERTEX_SHADER);return!(!k||S.isContextLost())&&(S.shaderSource(k,"void main() {}"),S.compileShader(k),!0===S.getShaderParameter(k,S.COMPILE_STATUS))}(x)),h[x]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var x}s.exports?s.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=l);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Re={create:function(s,u,l){var h=m.window.document.createElement(s);return void 0!==u&&(h.className=u),l&&l.appendChild(h),h},createNS:function(s,u){return m.window.document.createElementNS(s,u)}},jn=m.window.document&&m.window.document.documentElement.style;function yt(s){if(!jn)return s[0];for(var u=0;u<s.length;u++)if(s[u]in jn)return s[u];return s[0]}var Or,at=yt(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Re.disableDrag=function(){jn&&at&&(Or=jn[at],jn[at]="none")},Re.enableDrag=function(){jn&&at&&(jn[at]=Or)};var Ms=yt(["transform","WebkitTransform"]);Re.setTransform=function(s,u){s.style[Ms]=u};var or=!1;try{var di=Object.defineProperty({},"passive",{get:function(){or=!0}});m.window.addEventListener("test",di,di),m.window.removeEventListener("test",di,di)}catch(s){or=!1}Re.addEventListener=function(s,u,l,h){void 0===h&&(h={}),s.addEventListener(u,l,"passive"in h&&or?h:h.capture)},Re.removeEventListener=function(s,u,l,h){void 0===h&&(h={}),s.removeEventListener(u,l,"passive"in h&&or?h:h.capture)};var Yi=function(s){s.preventDefault(),s.stopPropagation(),m.window.removeEventListener("click",Yi,!0)};function Qn(s){var u=s.userImage;return!!(u&&u.render&&u.render())&&(s.data.replace(new Uint8Array(u.data.buffer)),!0)}Re.suppressClick=function(){m.window.addEventListener("click",Yi,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",Yi,!0)},0)},Re.mousePos=function(s,u){var l=s.getBoundingClientRect();return new m.Point(u.clientX-l.left-s.clientLeft,u.clientY-l.top-s.clientTop)},Re.touchPos=function(s,u){for(var l=s.getBoundingClientRect(),h=[],_=0;_<u.length;_++)h.push(new m.Point(u[_].clientX-l.left-s.clientLeft,u[_].clientY-l.top-s.clientTop));return h},Re.mouseButton=function(s){return void 0!==m.window.InstallTrigger&&2===s.button&&s.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:s.button},Re.remove=function(s){s.parentNode&&s.parentNode.removeChild(s)};var yi=function(s){function u(){s.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(l){if(this.loaded!==l&&(this.loaded=l,l)){for(var h=0,_=this.requestors;h<_.length;h+=1){var x=_[h];this._notify(x.ids,x.callback)}this.requestors=[]}},u.prototype.getImage=function(l){return this.images[l]},u.prototype.addImage=function(l,h){this._validate(l,h)&&(this.images[l]=h)},u.prototype._validate=function(l,h){var _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+l+'" has invalid "stretchX" value'))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+l+'" has invalid "stretchY" value'))),_=!1),this._validateContent(h.content,h)||(this.fire(new m.ErrorEvent(new Error('Image "'+l+'" has invalid "content" value'))),_=!1),_},u.prototype._validateStretch=function(l,h){if(!l)return!0;for(var _=0,x=0,b=l;x<b.length;x+=1){var S=b[x];if(S[0]<_||S[1]<S[0]||h<S[1])return!1;_=S[1]}return!0},u.prototype._validateContent=function(l,h){return!(l&&(4!==l.length||l[0]<0||h.data.width<l[0]||l[1]<0||h.data.height<l[1]||l[2]<0||h.data.width<l[2]||l[3]<0||h.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))},u.prototype.updateImage=function(l,h){h.version=this.images[l].version+1,this.images[l]=h,this.updatedImages[l]=!0},u.prototype.removeImage=function(l){var h=this.images[l];delete this.images[l],delete this.patterns[l],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(l,h){var _=!0;if(!this.isLoaded())for(var x=0,b=l;x<b.length;x+=1)this.images[b[x]]||(_=!1);this.isLoaded()||_?this._notify(l,h):this.requestors.push({ids:l,callback:h})},u.prototype._notify=function(l,h){for(var _={},x=0,b=l;x<b.length;x+=1){var S=b[x];this.images[S]||this.fire(new m.Event("styleimagemissing",{id:S}));var k=this.images[S];k?_[S]={data:k.data.clone(),pixelRatio:k.pixelRatio,sdf:k.sdf,version:k.version,stretchX:k.stretchX,stretchY:k.stretchY,content:k.content,hasRenderCallback:Boolean(k.userImage&&k.userImage.render)}:m.warnOnce('Image "'+S+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,_)},u.prototype.getPixelSize=function(){var l=this.atlasImage;return{width:l.width,height:l.height}},u.prototype.getPattern=function(l){var h=this.patterns[l],_=this.getImage(l);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{var x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},b=new m.ImagePosition(x,_);this.patterns[l]={bin:x,position:b}}return this._updatePatternAtlas(),this.patterns[l].position},u.prototype.bind=function(l){var h=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(l,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var l=[];for(var h in this.patterns)l.push(this.patterns[h].bin);var _=m.potpack(l),x=_.w,b=_.h,S=this.atlasImage;for(var k in S.resize({width:x||1,height:b||1}),this.patterns){var L=this.patterns[k].bin,j=L.x+1,H=L.y+1,q=this.images[k].data,ee=q.width,J=q.height;m.RGBAImage.copy(q,S,{x:0,y:0},{x:j,y:H},{width:ee,height:J}),m.RGBAImage.copy(q,S,{x:0,y:J-1},{x:j,y:H-1},{width:ee,height:1}),m.RGBAImage.copy(q,S,{x:0,y:0},{x:j,y:H+J},{width:ee,height:1}),m.RGBAImage.copy(q,S,{x:ee-1,y:0},{x:j-1,y:H},{width:1,height:J}),m.RGBAImage.copy(q,S,{x:0,y:0},{x:j+ee,y:H},{width:1,height:J})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(l){for(var h=0,_=l;h<_.length;h+=1){var x=_[h];if(!this.callbackDispatchedThisFrame[x]){this.callbackDispatchedThisFrame[x]=!0;var b=this.images[x];Qn(b)&&this.updateImage(x,b)}}},u}(m.Evented),zr=Ga,Yr=Ga,Kr=1e20;function Ga(s,u,l,h,_,x){this.fontSize=s||24,this.buffer=void 0===u?3:u,this.cutoff=h||.25,this.fontFamily=_||"sans-serif",this.fontWeight=x||"normal",this.radius=l||8;var b=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=b,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.d=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Int16Array(b),this.middle=Math.round(b/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ha(s,u,l,h,_,x,b){for(var S=0;S<u;S++){for(var k=0;k<l;k++)h[k]=s[k*u+S];for(da(h,_,x,b,l),k=0;k<l;k++)s[k*u+S]=_[k]}for(k=0;k<l;k++){for(S=0;S<u;S++)h[S]=s[k*u+S];for(da(h,_,x,b,u),S=0;S<u;S++)s[k*u+S]=Math.sqrt(_[S])}}function da(s,u,l,h,_){l[0]=0,h[0]=-Kr,h[1]=+Kr;for(var x=1,b=0;x<_;x++){for(var S=(s[x]+x*x-(s[l[b]]+l[b]*l[b]))/(2*x-2*l[b]);S<=h[b];)b--,S=(s[x]+x*x-(s[l[b]]+l[b]*l[b]))/(2*x-2*l[b]);l[++b]=x,h[b]=S,h[b+1]=+Kr}for(x=0,b=0;x<_;x++){for(;h[b+1]<x;)b++;u[x]=(x-l[b])*(x-l[b])+s[l[b]]}}Ga.prototype.draw=function(s){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(s,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),l=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var _=u.data[4*h+3]/255;this.gridOuter[h]=1===_?0:0===_?Kr:Math.pow(Math.max(0,.5-_),2),this.gridInner[h]=1===_?Kr:0===_?0:Math.pow(Math.max(0,_-.5),2)}for(Ha(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Ha(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)l[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return l},zr.default=Yr;var xt=function(s,u){this.requestManager=s,this.localIdeographFontFamily=u,this.entries={}};xt.prototype.setURL=function(s){this.url=s},xt.prototype.getGlyphs=function(s,u){var l=this,h=[];for(var _ in s)for(var x=0,b=s[_];x<b.length;x+=1)h.push({stack:_,id:b[x]});m.asyncAll(h,function(S,k){var L=S.stack,j=S.id,H=l.entries[L];H||(H=l.entries[L]={glyphs:{},requests:{},ranges:{}});var q=H.glyphs[j];if(void 0===q){if(q=l._tinySDF(H,L,j))return H.glyphs[j]=q,void k(null,{stack:L,id:j,glyph:q});var ee=Math.floor(j/256);if(256*ee>65535)k(new Error("glyphs > 65535 not supported"));else if(H.ranges[ee])k(null,{stack:L,id:j,glyph:q});else{var J=H.requests[ee];J||(J=H.requests[ee]=[],xt.loadGlyphRange(L,ee,l.url,l.requestManager,function(ae,Q){if(Q){for(var re in Q)l._doesCharSupportLocalGlyph(+re)||(H.glyphs[+re]=Q[+re]);H.ranges[ee]=!0}for(var pe=0,fe=J;pe<fe.length;pe+=1)(0,fe[pe])(ae,Q);delete H.requests[ee]})),J.push(function(ae,Q){ae?k(ae):Q&&k(null,{stack:L,id:j,glyph:Q[j]||null})})}}else k(null,{stack:L,id:j,glyph:q})},function(S,k){if(S)u(S);else if(k){for(var L={},j=0,H=k;j<H.length;j+=1){var q=H[j],ee=q.stack,J=q.id,ae=q.glyph;(L[ee]||(L[ee]={}))[J]=ae&&{id:ae.id,bitmap:ae.bitmap.clone(),metrics:ae.metrics}}u(null,L)}})},xt.prototype._doesCharSupportLocalGlyph=function(s){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](s)||m.isChar["Hangul Syllables"](s)||m.isChar.Hiragana(s)||m.isChar.Katakana(s))},xt.prototype._tinySDF=function(s,u,l){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(l)){var _=s.tinySDF;if(!_){var x="400";/bold/i.test(u)?x="900":/medium/i.test(u)?x="500":/light/i.test(u)&&(x="200"),_=s.tinySDF=new xt.TinySDF(24,3,8,.25,h,x)}return{id:l,bitmap:new m.AlphaImage({width:30,height:30},_.draw(String.fromCharCode(l))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},xt.loadGlyphRange=function(s,u,l,h,_){var x=256*u,b=x+255,S=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",s).replace("{range}",x+"-"+b),m.ResourceType.Glyphs);m.getArrayBuffer(S,function(k,L){if(k)_(k);else if(L){for(var j={},H=0,q=m.parseGlyphPBF(L);H<q.length;H+=1){var ee=q[H];j[ee.id]=ee}_(null,j)}})},xt.TinySDF=zr;var mo=function(){this.specification=m.styleSpec.light.position};mo.prototype.possiblyEvaluate=function(s,u){return m.sphericalToCartesian(s.expression.evaluate(u))},mo.prototype.interpolate=function(s,u,l){return{x:m.number(s.x,u.x,l),y:m.number(s.y,u.y,l),z:m.number(s.z,u.z,l)}};var Lr=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new mo,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),Wa=function(s){function u(l){s.call(this),this._transitionable=new m.Transitionable(Lr),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(l,h){if(void 0===h&&(h={}),!this._validate(m.validateLight,l,h))for(var _ in l){var x=l[_];m.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-"-transition".length),x):this._transitionable.setValue(_,x)}},u.prototype.updateTransitions=function(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(l){this.properties=this._transitioning.possiblyEvaluate(l)},u.prototype._validate=function(l,h,_){return(!_||!1!==_.validate)&&m.emitValidationErrors(this,l.call(m.validateStyle,m.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},u}(m.Evented),Nn=function(s,u){this.width=s,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Nn.prototype.getDash=function(s,u){var l=s.join(",")+String(u);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(s,u)),this.dashEntry[l]},Nn.prototype.getDashRanges=function(s,u,l){var h=[],_=s.length%2==1?-s[s.length-1]*l:0,x=s[0]*l,b=!0;h.push({left:_,right:x,isDash:b,zeroLength:0===s[0]});for(var S=s[0],k=1;k<s.length;k++){var L=s[k];h.push({left:_=S*l,right:x=(S+=L)*l,isDash:b=!b,zeroLength:0===L})}return h},Nn.prototype.addRoundDash=function(s,u,l){for(var h=u/2,_=-l;_<=l;_++)for(var x=this.width*(this.nextRow+l+_),b=0,S=s[b],k=0;k<this.width;k++){k/S.right>1&&(S=s[++b]);var L=Math.abs(k-S.left),j=Math.abs(k-S.right),H=Math.min(L,j),q=void 0,ee=_/l*(h+1);if(S.isDash){var J=h-Math.abs(ee);q=Math.sqrt(H*H+J*J)}else q=h-Math.sqrt(H*H+ee*ee);this.data[x+k]=Math.max(0,Math.min(255,q+128))}},Nn.prototype.addRegularDash=function(s){for(var u=s.length-1;u>=0;--u){var l=s[u],h=s[u+1];l.zeroLength?s.splice(u,1):h&&h.isDash===l.isDash&&(h.left=l.left,s.splice(u,1))}var _=s[0],x=s[s.length-1];_.isDash===x.isDash&&(_.left=x.left-this.width,x.right=_.right+this.width);for(var b=this.width*this.nextRow,S=0,k=s[S],L=0;L<this.width;L++){L/k.right>1&&(k=s[++S]);var j=Math.abs(L-k.left),H=Math.abs(L-k.right),q=Math.min(j,H);this.data[b+L]=Math.max(0,Math.min(255,(k.isDash?q:-q)+128))}},Nn.prototype.addDash=function(s,u){var l=u?7:0,h=2*l+1;if(this.nextRow+h>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var _=0,x=0;x<s.length;x++)_+=s[x];if(0!==_){var b=this.width/_,S=this.getDashRanges(s,this.width,b);u?this.addRoundDash(S,b,l):this.addRegularDash(S)}var k={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:_};return this.nextRow+=h,this.dirty=!0,k},Nn.prototype.bind=function(s){var u=s.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var Ki=function s(u,l){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var h=this.workerPool.acquire(this.id),_=0;_<h.length;_++){var x=new s.Actor(h[_],l,this.id);x.name="Worker "+_,this.actors.push(x)}};function bl(s,u,l){var h=function(_,x){if(_)return l(_);if(x){var b=m.pick(m.extend(x,s),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(b.vectorLayers=x.vector_layers,b.vectorLayerIds=b.vectorLayers.map(function(S){return S.id})),b.tiles=u.canonicalizeTileset(b,s.url),l(null,b)}};return s.url?m.getJSON(u.transformRequest(u.normalizeSourceURL(s.url),m.ResourceType.Source),h):m.browser.frame(function(){return h(null,s)})}Ki.prototype.broadcast=function(s,u,l){m.asyncAll(this.actors,function(h,_){h.send(s,u,_)},l=l||function(){})},Ki.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ki.prototype.remove=function(){this.actors.forEach(function(s){s.remove()}),this.actors=[],this.workerPool.release(this.id)},Ki.Actor=m.Actor;var mr=function(s,u,l){this.bounds=m.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=u||0,this.maxzoom=l||24};mr.prototype.validateBounds=function(s){return Array.isArray(s)&&4===s.length?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]},mr.prototype.contains=function(s){var u=Math.pow(2,s.z),l=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*u),_=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*u),x=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*u);return s.x>=l&&s.x<_&&s.y>=h&&s.y<x};var As=function(s){function u(l,h,_,x){if(s.call(this),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(h,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.load=function(){var l=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=bl(this._options,this.map._requestManager,function(h,_){l._tileJSONRequest=null,l._loaded=!0,h?l.fire(new m.ErrorEvent(h)):_&&(m.extend(l,_),_.bounds&&(l.tileBounds=new mr(_.bounds,l.minzoom,l.maxzoom)),m.postTurnstileEvent(_.tiles,l.map._requestManager._customAccessToken),m.postMapLoadEvent(_.tiles,l.map._getMapId(),l.map._requestManager._skuToken,l.map._requestManager._customAccessToken),l.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),l.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)},u.prototype.onAdd=function(l){this.map=l,this.load()},u.prototype.setSourceProperty=function(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(l){var h=this;return this.setSourceProperty(function(){h._options.tiles=l}),this},u.prototype.setUrl=function(l){var h=this;return this.setSourceProperty(function(){h.url=l,h._options.url=l}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return m.extend({},this._options)},u.prototype.loadTile=function(l,h){var _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(_,m.ResourceType.Tile),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function b(S,k){return delete l.request,l.aborted?h(null):S&&404!==S.status?h(S):(k&&k.resourceTiming&&(l.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&l.setExpiryData(k),l.loadVectorData(k,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}x.request.collectResourceTiming=this._collectResourceTiming,l.actor&&"expired"!==l.state?"loading"===l.state?l.reloadCallback=h:l.request=l.actor.send("reloadTile",x,b.bind(this)):(l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",x,b.bind(this)))},u.prototype.abortTile=function(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(m.Evented),Ps=function(s){function u(l,h,_,x){s.call(this),this.id=l,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},h),m.extend(this,m.pick(h,["url","scheme","tileSize"]))}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.load=function(){var l=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=bl(this._options,this.map._requestManager,function(h,_){l._tileJSONRequest=null,l._loaded=!0,h?l.fire(new m.ErrorEvent(h)):_&&(m.extend(l,_),_.bounds&&(l.tileBounds=new mr(_.bounds,l.minzoom,l.maxzoom)),m.postTurnstileEvent(_.tiles),m.postMapLoadEvent(_.tiles,l.map._getMapId(),l.map._requestManager._skuToken),l.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),l.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(l){this.map=l,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return m.extend({},this._options)},u.prototype.hasTile=function(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)},u.prototype.loadTile=function(l,h){var _=this,x=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);l.request=m.getImage(this.map._requestManager.transformRequest(x,m.ResourceType.Tile),function(b,S){if(delete l.request,l.aborted)l.state="unloaded",h(null);else if(b)l.state="errored",h(b);else if(S){_.map._refreshExpiredTiles&&l.setExpiryData(S),delete S.cacheControl,delete S.expires;var k=_.map.painter.context,L=k.gl;l.texture=_.map.painter.getTileTexture(S.width),l.texture?l.texture.update(S,{useMipmap:!0}):(l.texture=new m.Texture(k,S,L.RGBA,{useMipmap:!0}),l.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),k.extTextureFilterAnisotropic&&L.texParameterf(L.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax)),l.state="loaded",m.cacheEntryPossiblyAdded(_.dispatcher),h(null)}})},u.prototype.abortTile=function(l,h){l.request&&(l.request.cancel(),delete l.request),h()},u.prototype.unloadTile=function(l,h){l.texture&&this.map.painter.saveTileTexture(l.texture),h()},u.prototype.hasTransition=function(){return!1},u}(m.Evented),zu=function(s){function u(l,h,_,x){s.call(this,l,h,_,x),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(l,h){var _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function x(b,S){b&&(l.state="errored",h(b)),S&&(l.dem=S,l.needsHillshadePrepare=!0,l.state="loaded",h(null))}l.request=m.getImage(this.map._requestManager.transformRequest(_,m.ResourceType.Tile),function(b,S){if(delete l.request,l.aborted)l.state="unloaded",h(null);else if(b)l.state="errored",h(b);else if(S){this.map._refreshExpiredTiles&&l.setExpiryData(S),delete S.cacheControl,delete S.expires;var k=m.window.ImageBitmap&&S instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?S:m.browser.getImageData(S,1),L={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:k,encoding:this.encoding};l.actor&&"expired"!==l.state||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",L,x.bind(this)))}}.bind(this)),l.neighboringTiles=this._getNeighboringTiles(l.tileID)},u.prototype._getNeighboringTiles=function(l){var h=l.canonical,_=Math.pow(2,h.z),x=(h.x-1+_)%_,b=0===h.x?l.wrap-1:l.wrap,S=(h.x+1+_)%_,k=h.x+1===_?l.wrap+1:l.wrap,L={};return L[new m.OverscaledTileID(l.overscaledZ,b,h.z,x,h.y).key]={backfilled:!1},L[new m.OverscaledTileID(l.overscaledZ,k,h.z,S,h.y).key]={backfilled:!1},h.y>0&&(L[new m.OverscaledTileID(l.overscaledZ,b,h.z,x,h.y-1).key]={backfilled:!1},L[new m.OverscaledTileID(l.overscaledZ,l.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},L[new m.OverscaledTileID(l.overscaledZ,k,h.z,S,h.y-1).key]={backfilled:!1}),h.y+1<_&&(L[new m.OverscaledTileID(l.overscaledZ,b,h.z,x,h.y+1).key]={backfilled:!1},L[new m.OverscaledTileID(l.overscaledZ,l.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},L[new m.OverscaledTileID(l.overscaledZ,k,h.z,S,h.y+1).key]={backfilled:!1}),L},u.prototype.unloadTile=function(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&l.actor.send("removeDEMTile",{uid:l.uid,source:this.id})},u}(Ps),fa=function(s){function u(l,h,_,x){s.call(this),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=_.getActor(),this.setEventedParent(x),this._data=h.data,this._options=m.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],void 0!==h.maxzoom&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var b=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(void 0!==h.buffer?h.buffer:128)*b,tolerance:(void 0!==h.tolerance?h.tolerance:.375)*b,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:void 0!==h.clusterMaxZoom?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:m.EXTENT,radius:(h.clusterRadius||50)*b,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.load=function(){var l=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)l.fire(new m.ErrorEvent(h));else{var _={dataType:"source",sourceDataType:"metadata"};l._collectResourceTiming&&l._resourceTiming&&l._resourceTiming.length>0&&(_.resourceTiming=l._resourceTiming,l._resourceTiming=[]),l.fire(new m.Event("data",_))}})},u.prototype.onAdd=function(l){this.map=l,this.load()},u.prototype.setData=function(l){var h=this;return this._data=l,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(_){if(_)h.fire(new m.ErrorEvent(_));else{var x={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(x.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new m.Event("data",x))}}),this},u.prototype.getClusterExpansionZoom=function(l,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},h),this},u.prototype.getClusterChildren=function(l,h){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},h),this},u.prototype.getClusterLeaves=function(l,h,_,x){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:h,offset:_},x),this},u.prototype._updateWorkerData=function(l){var h=this;this._loaded=!1;var _=m.extend({},this.workerOptions),x=this._data;"string"==typeof x?(_.request=this.map._requestManager.transformRequest(m.browser.resolveURL(x),m.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(x),this.actor.send(this.type+".loadData",_,function(b,S){h._removed||S&&S.abandoned||(h._loaded=!0,S&&S.resourceTiming&&S.resourceTiming[h.id]&&(h._resourceTiming=S.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:_.source},null),l(b))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(l,h){var _=this,x=l.actor?"reloadTile":"loadTile";l.actor=this.actor,l.request=this.actor.send(x,{type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(b,S){return delete l.request,l.unloadVectorData(),l.aborted?h(null):b?h(b):(l.loadVectorData(S,_.map.painter,"reloadTile"===x),h(null))})},u.prototype.abortTile=function(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0},u.prototype.unloadTile=function(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(m.Evented),Qr=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Jr=function(s){function u(l,h,_,x){s.call(this),this.id=l,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=h}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.load=function(l,h){var _=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(x,b){_._loaded=!0,x?_.fire(new m.ErrorEvent(x)):b&&(_.image=b,l&&(_.coordinates=l),h&&h(),_._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(l){var h=this;return this.image&&l.url?(this.options.url=l.url,this.load(l.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(l){this.map=l,this.load()},u.prototype.setCoordinates=function(l){var h=this;this.coordinates=l;var _=l.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(b){for(var S=1/0,k=1/0,L=-1/0,j=-1/0,H=0,q=b;H<q.length;H+=1){var ee=q[H];S=Math.min(S,ee.x),k=Math.min(k,ee.y),L=Math.max(L,ee.x),j=Math.max(j,ee.y)}var J=Math.max(L-S,j-k),ae=Math.max(0,Math.floor(-Math.log(J)/Math.LN2)),Q=Math.pow(2,ae);return new m.CanonicalTileID(ae,Math.floor((S+L)/2*Q),Math.floor((k+j)/2*Q))}(_),this.minzoom=this.maxzoom=this.tileID.z;var x=_.map(function(b){return h.tileID.getTilePoint(b)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(x[0].x,x[0].y,0,0),this._boundsArray.emplaceBack(x[1].x,x[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(x[3].x,x[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(x[2].x,x[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var l=this.map.painter.context,h=l.gl;for(var _ in this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,Qr.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(l,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var x=this.tiles[_];"loaded"!==x.state&&(x.state="loaded",x.texture=this.texture)}}},u.prototype.loadTile=function(l,h){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},h(null)):(l.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(m.Evented),ma=function(s){function u(l,h,_,x){s.call(this,l,h,_,x),this.roundZoom=!0,this.type="video",this.options=h}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.load=function(){var l=this;this._loaded=!1;var h=this.options;this.urls=[];for(var _=0,x=h.urls;_<x.length;_+=1)this.urls.push(this.map._requestManager.transformRequest(x[_],m.ResourceType.Source).url);m.getVideo(this.urls,function(b,S){l._loaded=!0,b?l.fire(new m.ErrorEvent(b)):S&&(l.video=S,l.video.loop=!0,l.video.addEventListener("playing",function(){l.map.triggerRepaint()}),l.map&&l.video.play(),l._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(l){if(this.video){var h=this.video.seekable;l<h.start(0)||l>h.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=l}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var l=this.map.painter.context,h=l.gl;for(var _ in this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,Qr.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(l,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var x=this.tiles[_];"loaded"!==x.state&&(x.state="loaded",x.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(Jr),ga=function(s){function u(l,h,_,x){s.call(this,l,h,_,x),h.coordinates?Array.isArray(h.coordinates)&&4===h.coordinates.length&&!h.coordinates.some(function(b){return!Array.isArray(b)||2!==b.length||b.some(function(S){return"number"!=typeof S})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+l,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+l,null,'missing required property "coordinates"'))),h.animate&&"boolean"!=typeof h.animate&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+l,null,'optional "animate" property must be a boolean value'))),h.canvas?"string"==typeof h.canvas||h.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+l,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+l,null,'missing required property "canvas"'))),this.options=h,this.animate=void 0===h.animate||h.animate}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var h=this.map.painter.context,_=h.gl;for(var x in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Qr.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(h,this.canvas,_.RGBA,{premultiply:!0}),this.tiles){var b=this.tiles[x];"loaded"!==b.state&&(b.state="loaded",b.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var l=0,h=[this.canvas.width,this.canvas.height];l<h.length;l+=1){var _=h[l];if(isNaN(_)||_<=0)return!0}return!1},u}(Jr),Lo={vector:As,raster:Ps,"raster-dem":zu,geojson:fa,video:ma,image:Jr,canvas:ga};function qc(s,u){var l=m.identity([]);return m.translate(l,l,[1,1,0]),m.scale(l,l,[.5*s.width,.5*s.height,1]),m.multiply(l,l,s.calculatePosMatrix(u.toUnwrapped()))}function Di(s,u,l,h,_,x){var b=function(ae,Q,re){if(ae)for(var pe=0,fe=ae;pe<fe.length;pe+=1){var Ce=Q[fe[pe]];if(Ce&&Ce.source===re&&"fill-extrusion"===Ce.type)return!0}else for(var xe in Q){var Ee=Q[xe];if(Ee.source===re&&"fill-extrusion"===Ee.type)return!0}return!1}(_&&_.layers,u,s.id),S=x.maxPitchScaleFactor(),k=s.tilesIn(h,S,b);k.sort(go);for(var L=[],j=0,H=k;j<H.length;j+=1){var q=H[j];L.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(u,l,s._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,_,x,S,qc(s.transform,q.tileID))})}var ee=function(ae){for(var Q={},re={},pe=0,fe=ae;pe<fe.length;pe+=1){var Ce=fe[pe],xe=Ce.queryResults,Ee=Ce.wrappedTileID,Ie=re[Ee]=re[Ee]||{};for(var Ue in xe)for(var Be=xe[Ue],Xe=Ie[Ue]=Ie[Ue]||{},pt=Q[Ue]=Q[Ue]||[],mt=0,dt=Be;mt<dt.length;mt+=1){var Wt=dt[mt];Xe[Wt.featureIndex]||(Xe[Wt.featureIndex]=!0,pt.push(Wt))}}return Q}(L);for(var J in ee)ee[J].forEach(function(ae){var Q=ae.feature,re=s.getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=re});return ee}function go(s,u){var l=s.tileID,h=u.tileID;return l.overscaledZ-h.overscaledZ||l.canonical.y-h.canonical.y||l.wrap-h.wrap||l.canonical.x-h.canonical.x}var sn=function(s,u){this.max=s,this.onRemove=u,this.reset()};sn.prototype.reset=function(){for(var s in this.data)for(var u=0,l=this.data[s];u<l.length;u+=1){var h=l[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},sn.prototype.add=function(s,u,l){var h=this,_=s.wrapped().key;void 0===this.data[_]&&(this.data[_]=[]);var x={value:u,timeout:void 0};if(void 0!==l&&(x.timeout=setTimeout(function(){h.remove(s,x)},l)),this.data[_].push(x),this.order.push(_),this.order.length>this.max){var b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this},sn.prototype.has=function(s){return s.wrapped().key in this.data},sn.prototype.getAndRemove=function(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null},sn.prototype._getAndRemoveByKey=function(s){var u=this.data[s].shift();return u.timeout&&clearTimeout(u.timeout),0===this.data[s].length&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),u.value},sn.prototype.getByKey=function(s){var u=this.data[s];return u?u[0].value:null},sn.prototype.get=function(s){return this.has(s)?this.data[s.wrapped().key][0].value:null},sn.prototype.remove=function(s,u){if(!this.has(s))return this;var l=s.wrapped().key,h=void 0===u?0:this.data[l].indexOf(u),_=this.data[l][h];return this.data[l].splice(h,1),_.timeout&&clearTimeout(_.timeout),0===this.data[l].length&&delete this.data[l],this.onRemove(_.value),this.order.splice(this.order.indexOf(l),1),this},sn.prototype.setMaxSize=function(s){for(this.max=s;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},sn.prototype.filter=function(s){var u=[];for(var l in this.data)for(var h=0,_=this.data[l];h<_.length;h+=1){var x=_[h];s(x.value)||u.push(x)}for(var b=0,S=u;b<S.length;b+=1){var k=S[b];this.remove(k.value.tileID,k)}};var _o=function(s,u,l){this.context=s;var h=s.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(l),this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};_o.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},_o.prototype.updateData=function(s){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)},_o.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Za={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},eo=function(s,u,l,h){this.length=u.length,this.attributes=l,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=s;var _=s.gl;this.buffer=_.createBuffer(),s.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};eo.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},eo.prototype.updateData=function(s){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,s.arrayBuffer)},eo.prototype.enableAttributes=function(s,u){for(var l=0;l<this.attributes.length;l++){var h=u.attributes[this.attributes[l].name];void 0!==h&&s.enableVertexAttribArray(h)}},eo.prototype.setVertexAttribPointers=function(s,u,l){for(var h=0;h<this.attributes.length;h++){var _=this.attributes[h],x=u.attributes[_.name];void 0!==x&&s.vertexAttribPointer(x,_.components,s[Za[_.type]],!1,this.itemSize,_.offset+this.itemSize*(l||0))}},eo.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var qt=function(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};qt.prototype.get=function(){return this.current},qt.prototype.set=function(s){},qt.prototype.getDefault=function(){return this.default},qt.prototype.setDefault=function(){this.set(this.default)};var Ro=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return m.Color.transparent},u.prototype.set=function(l){var h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)},u}(qt),$i=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)},u}(qt),Rr=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)},u}(qt),Lu=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)},u}(qt),Fr=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)},u}(qt),ks=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)},u}(qt),gr=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(l){var h=this.current;(l.func!==h.func||l.ref!==h.ref||l.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)},u}(qt),_a=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){var l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]},u.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)},u}(qt),Xa=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;l?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=l,this.dirty=!1}},u}(qt),_r=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)},u}(qt),vr=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;l?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=l,this.dirty=!1}},u}(qt),va=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)},u}(qt),Nr=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;l?h.enable(h.BLEND):h.disable(h.BLEND),this.current=l,this.dirty=!1}},u}(qt),Ru=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){var l=this.gl;return[l.ONE,l.ZERO]},u.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)},u}(qt),wl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return m.Color.transparent},u.prototype.set=function(l){var h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)},u}(qt),Cl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)},u}(qt),El=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;l?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=l,this.dirty=!1}},u}(qt),Ds=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)},u}(qt),Sl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)},u}(qt),Ya=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)},u}(qt),Os=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)},u}(qt),ya=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){var l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]},u.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)},u}(qt),Tl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,l),this.current=l,this.dirty=!1}},u}(qt),zs=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,l),this.current=l,this.dirty=!1}},u}(qt),Il=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,l),this.current=l,this.dirty=!1}},u}(qt),Ml=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}},u}(qt),xa=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(l){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1},u}(qt),ba=function(s){function u(l){s.call(this,l),this.vao=l.extVertexArrayObject}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)},u}(qt),Fo=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}},u}(qt),Ka=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}},u}(qt),Ls=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}},u}(qt),Bn=function(s){function u(l,h){s.call(this,l),this.context=l,this.parent=h}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(qt),z=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(l){if(l!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}},u}(Bn),B=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(l){if(l!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,l),this.current=l,this.dirty=!1}},u}(Bn),V=function(s,u,l,h){this.context=s,this.width=u,this.height=l;var _=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new z(s,_),h&&(this.depthAttachment=new B(s,_))};V.prototype.destroy=function(){var s=this.context.gl,u=this.colorAttachment.get();if(u&&s.deleteTexture(u),this.depthAttachment){var l=this.depthAttachment.get();l&&s.deleteRenderbuffer(l)}s.deleteFramebuffer(this.framebuffer)};var Z=function(s,u,l){this.func=s,this.mask=u,this.range=l};Z.ReadOnly=!1,Z.ReadWrite=!0,Z.disabled=new Z(519,Z.ReadOnly,[0,1]);var te=function(s,u,l,h,_,x){this.test=s,this.ref=u,this.mask=l,this.fail=h,this.depthFail=_,this.pass=x};te.disabled=new te({func:519,mask:0},0,0,7680,7680,7680);var ce=function(s,u,l){this.blendFunction=s,this.blendColor=u,this.mask=l};ce.disabled=new ce(ce.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),ce.unblended=new ce(ce.Replace,m.Color.transparent,[!0,!0,!0,!0]),ce.alphaBlended=new ce([1,771],m.Color.transparent,[!0,!0,!0,!0]);var he=function(s,u,l){this.enable=s,this.mode=u,this.frontFace=l};he.disabled=new he(!1,1029,2305),he.backCCW=new he(!0,1029,2305);var ue=function(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ro(this),this.clearDepth=new $i(this),this.clearStencil=new Rr(this),this.colorMask=new Lu(this),this.depthMask=new Fr(this),this.stencilMask=new ks(this),this.stencilFunc=new gr(this),this.stencilOp=new _a(this),this.stencilTest=new Xa(this),this.depthRange=new _r(this),this.depthTest=new vr(this),this.depthFunc=new va(this),this.blend=new Nr(this),this.blendFunc=new Ru(this),this.blendColor=new wl(this),this.blendEquation=new Cl(this),this.cullFace=new El(this),this.cullFaceSide=new Ds(this),this.frontFace=new Sl(this),this.program=new Ya(this),this.activeTexture=new Os(this),this.viewport=new ya(this),this.bindFramebuffer=new Tl(this),this.bindRenderbuffer=new zs(this),this.bindTexture=new Il(this),this.bindVertexBuffer=new Ml(this),this.bindElementBuffer=new xa(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ba(this),this.pixelStoreUnpack=new Fo(this),this.pixelStoreUnpackPremultiplyAlpha=new Ka(this),this.pixelStoreUnpackFlipY=new Ls(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)};ue.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ue.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ue.prototype.createIndexBuffer=function(s,u){return new _o(this,s,u)},ue.prototype.createVertexBuffer=function(s,u,l){return new eo(this,s,u,l)},ue.prototype.createRenderbuffer=function(s,u,l){var h=this.gl,_=h.createRenderbuffer();return this.bindRenderbuffer.set(_),h.renderbufferStorage(h.RENDERBUFFER,s,u,l),this.bindRenderbuffer.set(null),_},ue.prototype.createFramebuffer=function(s,u,l){return new V(this,s,u,l)},ue.prototype.clear=function(s){var u=s.color,l=s.depth,h=this.gl,_=0;u&&(_|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(_|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),h.clear(_)},ue.prototype.setCullFace=function(s){!1===s.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))},ue.prototype.setDepthMode=function(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)},ue.prototype.setStencilMode=function(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)},ue.prototype.setColorMode=function(s){m.deepEqual(s.blendFunction,ce.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)},ue.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var X=function(s){function u(l,h,_){var x=this;s.call(this),this.id=l,this.dispatcher=_,this.on("data",function(b){"source"===b.dataType&&"metadata"===b.sourceDataType&&(x._sourceLoaded=!0),x._sourceLoaded&&!x._paused&&"source"===b.dataType&&"content"===b.sourceDataType&&(x.reload(),x.transform&&x.update(x.transform))}),this.on("error",function(){x._sourceErrored=!0}),this._source=function(b,S,k,L){var j=new Lo[S.type](b,S,k,L);if(j.id!==b)throw new Error("Expected Source id to be "+b+" instead of "+j.id);return m.bindAll(["load","abort","unload","serialize","prepare"],j),j}(l,h,_,this),this._tiles={},this._cache=new sn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.onAdd=function(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(l)},u.prototype.onRemove=function(l){this._source&&this._source.onRemove&&this._source.onRemove(l)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var l in this._tiles){var h=this._tiles[l];if("loaded"!==h.state&&"errored"!==h.state)return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(l,h){return this._source.loadTile(l,h)},u.prototype._unloadTile=function(l){if(this._source.unloadTile)return this._source.unloadTile(l,function(){})},u.prototype._abortTile=function(l){if(this._source.abortTile)return this._source.abortTile(l,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(l){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var _=this._tiles[h];_.upload(l),_.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return m.values(this._tiles).map(function(l){return l.tileID}).sort(ie).map(function(l){return l.key})},u.prototype.getRenderableIds=function(l){var h=this,_=[];for(var x in this._tiles)this._isIdRenderable(x,l)&&_.push(this._tiles[x]);return l?_.sort(function(b,S){var k=b.tileID,L=S.tileID,j=new m.Point(k.canonical.x,k.canonical.y)._rotate(h.transform.angle),H=new m.Point(L.canonical.x,L.canonical.y)._rotate(h.transform.angle);return k.overscaledZ-L.overscaledZ||H.y-j.y||H.x-j.x}).map(function(b){return b.tileID.key}):_.map(function(b){return b.tileID}).sort(ie).map(function(b){return b.key})},u.prototype.hasRenderableParent=function(l){var h=this.findLoadedParent(l,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(l,h){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(h||!this._tiles[l].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var l in this._cache.reset(),this._tiles)"errored"!==this._tiles[l].state&&this._reloadTile(l,"reloading")},u.prototype._reloadTile=function(l,h){var _=this._tiles[l];_&&("loading"!==_.state&&(_.state=h),this._loadTile(_,this._tileLoaded.bind(this,_,l,h)))},u.prototype._tileLoaded=function(l,h,_,x){if(x)return l.state="errored",void(404!==x.status?this._source.fire(new m.ErrorEvent(x,{tile:l})):this.update(this.transform));l.timeAdded=m.browser.now(),"expired"===_&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(h,l),"raster-dem"===this.getSource().type&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:l,coord:l.tileID}))},u.prototype._backfillDEM=function(l){for(var h=this.getRenderableIds(),_=0;_<h.length;_++){var x=h[_];if(l.neighboringTiles&&l.neighboringTiles[x]){var b=this.getTileByID(x);S(l,b),S(b,l)}}function S(k,L){k.needsHillshadePrepare=!0;var j=L.tileID.canonical.x-k.tileID.canonical.x,H=L.tileID.canonical.y-k.tileID.canonical.y,q=Math.pow(2,k.tileID.canonical.z),ee=L.tileID.key;0===j&&0===H||Math.abs(H)>1||(Math.abs(j)>1&&(1===Math.abs(j+q)?j+=q:1===Math.abs(j-q)&&(j-=q)),L.dem&&k.dem&&(k.dem.backfillBorder(L.dem,j,H),k.neighboringTiles&&k.neighboringTiles[ee]&&(k.neighboringTiles[ee].backfilled=!0)))}},u.prototype.getTile=function(l){return this.getTileByID(l.key)},u.prototype.getTileByID=function(l){return this._tiles[l]},u.prototype._retainLoadedChildren=function(l,h,_,x){for(var b in this._tiles){var S=this._tiles[b];if(!(x[b]||!S.hasData()||S.tileID.overscaledZ<=h||S.tileID.overscaledZ>_)){for(var k=S.tileID;S&&S.tileID.overscaledZ>h+1;){var L=S.tileID.scaledTo(S.tileID.overscaledZ-1);(S=this._tiles[L.key])&&S.hasData()&&(k=L)}for(var j=k;j.overscaledZ>h;)if(l[(j=j.scaledTo(j.overscaledZ-1)).key]){x[k.key]=k;break}}}},u.prototype.findLoadedParent=function(l,h){if(l.key in this._loadedParentTiles){var _=this._loadedParentTiles[l.key];return _&&_.tileID.overscaledZ>=h?_:null}for(var x=l.overscaledZ-1;x>=h;x--){var b=l.scaledTo(x),S=this._getLoadedTile(b);if(S)return S}},u.prototype._getLoadedTile=function(l){var h=this._tiles[l.key];return h&&h.hasData()?h:this._cache.getByKey(l.wrapped().key)},u.prototype.updateCacheSize=function(l){var h=Math.ceil(l.width/this._source.tileSize)+1,_=Math.ceil(l.height/this._source.tileSize)+1,x=Math.floor(h*_*5),b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(b)},u.prototype.handleWrapJump=function(l){var h=Math.round((l-(void 0===this._prevLng?l:this._prevLng))/360);if(this._prevLng=l,h){var _={};for(var x in this._tiles){var b=this._tiles[x];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+h),_[b.tileID.key]=b}for(var S in this._tiles=_,this._timers)clearTimeout(this._timers[S]),delete this._timers[S];for(var k in this._tiles)this._setTileReloadTimer(k,this._tiles[k])}},u.prototype.update=function(l){var h=this;if(this.transform=l,this._sourceLoaded&&!this._paused){var _;this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?_=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Ie){return new m.OverscaledTileID(Ie.canonical.z,Ie.wrap,Ie.canonical.z,Ie.canonical.x,Ie.canonical.y)}):(_=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(_=_.filter(function(Ie){return h._source.hasTile(Ie)}))):_=[];var x=l.coveringZoomLevel(this._source),b=Math.max(x-u.maxOverzooming,this._source.minzoom),S=Math.max(x+u.maxUnderzooming,this._source.minzoom),k=this._updateRetainedTiles(_,x);if(ze(this._source.type)){for(var L={},j={},H=0,q=Object.keys(k);H<q.length;H+=1){var ee=q[H],J=k[ee],ae=this._tiles[ee];if(ae&&!(ae.fadeEndTime&&ae.fadeEndTime<=m.browser.now())){var Q=this.findLoadedParent(J,b);Q&&(this._addTile(Q.tileID),L[Q.tileID.key]=Q.tileID),j[ee]=J}}for(var re in this._retainLoadedChildren(j,x,S,k),L)k[re]||(this._coveredTiles[re]=!0,k[re]=L[re])}for(var pe in k)this._tiles[pe].clearFadeHold();for(var fe=0,Ce=m.keysDifference(this._tiles,k);fe<Ce.length;fe+=1){var xe=Ce[fe],Ee=this._tiles[xe];Ee.hasSymbolBuckets&&!Ee.holdingForFade()?Ee.setHoldDuration(this.map._fadeDuration):Ee.hasSymbolBuckets&&!Ee.symbolFadeFinished()||this._removeTile(xe)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)},u.prototype._updateRetainedTiles=function(l,h){for(var _={},x={},b=Math.max(h-u.maxOverzooming,this._source.minzoom),S=Math.max(h+u.maxUnderzooming,this._source.minzoom),k={},L=0,j=l;L<j.length;L+=1){var H=j[L],q=this._addTile(H);_[H.key]=H,q.hasData()||h<this._source.maxzoom&&(k[H.key]=H)}this._retainLoadedChildren(k,h,S,_);for(var ee=0,J=l;ee<J.length;ee+=1){var ae=J[ee],Q=this._tiles[ae.key];if(!Q.hasData()){if(h+1>this._source.maxzoom){var re=ae.children(this._source.maxzoom)[0],pe=this.getTile(re);if(pe&&pe.hasData()){_[re.key]=re;continue}}else{var fe=ae.children(this._source.maxzoom);if(_[fe[0].key]&&_[fe[1].key]&&_[fe[2].key]&&_[fe[3].key])continue}for(var Ce=Q.wasRequested(),xe=ae.overscaledZ-1;xe>=b;--xe){var Ee=ae.scaledTo(xe);if(x[Ee.key]||(x[Ee.key]=!0,!(Q=this.getTile(Ee))&&Ce&&(Q=this._addTile(Ee)),Q&&(_[Ee.key]=Ee,Ce=Q.wasRequested(),Q.hasData())))break}}}return _},u.prototype._updateLoadedParentTileCache=function(){for(var l in this._loadedParentTiles={},this._tiles){for(var h=[],_=void 0,x=this._tiles[l].tileID;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){_=this._loadedParentTiles[x.key];break}h.push(x.key);var b=x.scaledTo(x.overscaledZ-1);if(_=this._getLoadedTile(b))break;x=b}for(var S=0,k=h;S<k.length;S+=1)this._loadedParentTiles[k[S]]=_}},u.prototype._addTile=function(l){var h=this._tiles[l.key];if(h)return h;(h=this._cache.getAndRemove(l))&&(this._setTileReloadTimer(l.key,h),h.tileID=l,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,h)));var _=Boolean(h);return _||(h=new m.Tile(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,l.key,h.state))),h?(h.uses++,this._tiles[l.key]=h,_||this._source.fire(new m.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(l,h){var _=this;l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);var x=h.getExpiryTimeout();x&&(this._timers[l]=setTimeout(function(){_._reloadTile(l,"expired"),delete _._timers[l]},x))},u.prototype._removeTile=function(l){var h=this._tiles[l];h&&(h.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),h.uses>0||(h.hasData()&&"reloading"!==h.state?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var l in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(l);this._cache.reset()},u.prototype.tilesIn=function(l,h,_){var x=this,b=[],S=this.transform;if(!S)return b;for(var k=_?S.getCameraQueryGeometry(l):l,L=l.map(function(xe){return S.pointCoordinate(xe)}),j=k.map(function(xe){return S.pointCoordinate(xe)}),H=this.getIds(),q=1/0,ee=1/0,J=-1/0,ae=-1/0,Q=0,re=j;Q<re.length;Q+=1){var pe=re[Q];q=Math.min(q,pe.x),ee=Math.min(ee,pe.y),J=Math.max(J,pe.x),ae=Math.max(ae,pe.y)}for(var fe=function(xe){var Ee=x._tiles[H[xe]];if(!Ee.holdingForFade()){var Ie=Ee.tileID,Ue=Math.pow(2,S.zoom-Ee.tileID.overscaledZ),Be=h*Ee.queryPadding*m.EXTENT/Ee.tileSize/Ue,Xe=[Ie.getTilePoint(new m.MercatorCoordinate(q,ee)),Ie.getTilePoint(new m.MercatorCoordinate(J,ae))];if(Xe[0].x-Be<m.EXTENT&&Xe[0].y-Be<m.EXTENT&&Xe[1].x+Be>=0&&Xe[1].y+Be>=0){var pt=L.map(function(dt){return Ie.getTilePoint(dt)}),mt=j.map(function(dt){return Ie.getTilePoint(dt)});b.push({tile:Ee,tileID:Ie,queryGeometry:pt,cameraQueryGeometry:mt,scale:Ue})}}},Ce=0;Ce<H.length;Ce++)fe(Ce);return b},u.prototype.getVisibleCoordinates=function(l){for(var h=this,_=this.getRenderableIds(l).map(function(k){return h._tiles[k].tileID}),x=0,b=_;x<b.length;x+=1){var S=b[x];S.posMatrix=this.transform.calculatePosMatrix(S.toUnwrapped())}return _},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(ze(this._source.type))for(var l in this._tiles){var h=this._tiles[l];if(void 0!==h.fadeEndTime&&h.fadeEndTime>=m.browser.now())return!0}return!1},u.prototype.setFeatureState=function(l,h,_){this._state.updateState(l=l||"_geojsonTileLayer",h,_)},u.prototype.removeFeatureState=function(l,h,_){this._state.removeFeatureState(l=l||"_geojsonTileLayer",h,_)},u.prototype.getFeatureState=function(l,h){return this._state.getState(l=l||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(l,h,_){var x=this._tiles[l];x&&x.setDependencies(h,_)},u.prototype.reloadTilesForDependencies=function(l,h){for(var _ in this._tiles)this._tiles[_].hasDependency(l,h)&&this._reloadTile(_,"reloading");this._cache.filter(function(x){return!x.hasDependency(l,h)})},u}(m.Evented);function ie(s,u){var l=Math.abs(2*s.wrap)-+(s.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return s.overscaledZ-u.overscaledZ||h-l||u.canonical.y-s.canonical.y||u.canonical.x-s.canonical.x}function ze(s){return"raster"===s||"image"===s||"video"===s}function $e(){return new m.window.Worker(Kl.workerUrl)}X.maxOverzooming=10,X.maxUnderzooming=3;var ye="mapboxgl_preloaded_worker_pool",Ne=function(){this.active={}};Ne.prototype.acquire=function(s){if(!this.workers)for(this.workers=[];this.workers.length<Ne.workerCount;)this.workers.push(new $e);return this.active[s]=!0,this.workers.slice()},Ne.prototype.release=function(s){delete this.active[s],0===this.numActive()&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},Ne.prototype.isPreloaded=function(){return!!this.active[ye]},Ne.prototype.numActive=function(){return Object.keys(this.active).length};var et,it=Math.floor(m.browser.hardwareConcurrency/2);function ut(){return et||(et=new Ne),et}function Ae(s,u){var l={};for(var h in s)"ref"!==h&&(l[h]=s[h]);return m.refProperties.forEach(function(_){_ in u&&(l[_]=u[_])}),l}function We(s){s=s.slice();for(var u=Object.create(null),l=0;l<s.length;l++)u[s[l].id]=s[l];for(var h=0;h<s.length;h++)"ref"in s[h]&&(s[h]=Ae(s[h],u[s[h].ref]));return s}Ne.workerCount=Math.max(Math.min(it,6),1);var ke={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Pt(s,u,l){l.push({command:ke.addSource,args:[s,u[s]]})}function kt(s,u,l){u.push({command:ke.removeSource,args:[s]}),l[s]=!0}function ot(s,u,l,h){kt(s,l,h),Pt(s,u,l)}function gn(s,u,l){var h;for(h in s[l])if(s[l].hasOwnProperty(h)&&"data"!==h&&!m.deepEqual(s[l][h],u[l][h]))return!1;for(h in u[l])if(u[l].hasOwnProperty(h)&&"data"!==h&&!m.deepEqual(s[l][h],u[l][h]))return!1;return!0}function Ut(s,u,l,h,_,x){var b;for(b in u=u||{},s=s||{})s.hasOwnProperty(b)&&(m.deepEqual(s[b],u[b])||l.push({command:x,args:[h,b,u[b],_]}));for(b in u)u.hasOwnProperty(b)&&!s.hasOwnProperty(b)&&(m.deepEqual(s[b],u[b])||l.push({command:x,args:[h,b,u[b],_]}))}function wn(s){return s.id}function Mn(s,u){return s[u.id]=u,s}var Zt=function(s,u){this.reset(s,u)};Zt.prototype.reset=function(s,u){this.points=s||[],this._distances=[0];for(var l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Zt.prototype.lerp=function(s){if(1===this.points.length)return this.points[0];s=m.clamp(s,0,1);for(var u=1,l=this._distances[u],h=s*this.paddedLength+this.padding;l<h&&u<this._distances.length;)l=this._distances[++u];var _=u-1,x=this._distances[_],b=l-x,S=b>0?(h-x)/b:0;return this.points[_].mult(1-S).add(this.points[u].mult(S))};var _n=function(s,u,l){var h=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(s/l),this.yCellCount=Math.ceil(u/l);for(var x=0;x<this.xCellCount*this.yCellCount;x++)h.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=u,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function Vn(s,u,l,h,_){var x=m.create();return u?(m.scale(x,x,[1/_,1/_,1]),l||m.rotateZ(x,x,h.angle)):m.multiply(x,h.labelPlaneMatrix,s),x}function ln(s,u,l,h,_){if(u){var x=m.clone(s);return m.scale(x,x,[_,_,1]),l||m.rotateZ(x,x,-h.angle),x}return h.glCoordMatrix}function ht(s,u){var l=[s.x,s.y,0,1];Qi(l,l,u);var h=l[3];return{point:new m.Point(l[0]/h,l[1]/h),signedDistanceFromCamera:h}}function Qa(s,u){return.5+s/u*.5}function Nt(s,u){var l=s[0]/s[3],h=s[1]/s[3];return l>=-u[0]&&l<=u[0]&&h>=-u[1]&&h<=u[1]}function Br(s,u,l,h,_,x,b,S){var k=h?s.textSizeData:s.iconSizeData,L=m.evaluateSizeForZoom(k,l.transform.zoom),j=[256/l.width*2+1,256/l.height*2+1],H=h?s.text.dynamicLayoutVertexArray:s.icon.dynamicLayoutVertexArray;H.clear();for(var q=s.lineVertexArray,ee=h?s.text.placedSymbolArray:s.icon.placedSymbolArray,J=l.transform.width/l.transform.height,ae=!1,Q=0;Q<ee.length;Q++){var re=ee.get(Q);if(re.hidden||re.writingMode===m.WritingMode.vertical&&!ae)Vr(re.numGlyphs,H);else{ae=!1;var pe=[re.anchorX,re.anchorY,0,1];if(m.transformMat4(pe,pe,u),Nt(pe,j)){var fe=Qa(l.transform.cameraToCenterDistance,pe[3]),Ce=m.evaluateSizeForFeature(k,L,re),xe=b?Ce/fe:Ce*fe,Ee=new m.Point(re.anchorX,re.anchorY),Ie=ht(Ee,_).point,Ue={},Be=xi(re,xe,!1,S,u,_,x,s.glyphOffsetArray,q,H,Ie,Ee,Ue,J);ae=Be.useVertical,(Be.notEnoughRoom||ae||Be.needsFlipping&&xi(re,xe,!0,S,u,_,x,s.glyphOffsetArray,q,H,Ie,Ee,Ue,J).notEnoughRoom)&&Vr(re.numGlyphs,H)}else Vr(re.numGlyphs,H)}}h?s.text.dynamicLayoutVertexBuffer.updateData(H):s.icon.dynamicLayoutVertexBuffer.updateData(H)}function Al(s,u,l,h,_,x,b,S,k,L,j){var H=S.glyphStartIndex+S.numGlyphs,q=S.lineStartIndex,ee=S.lineStartIndex+S.lineLength,J=u.getoffsetX(S.glyphStartIndex),ae=u.getoffsetX(H-1),Q=mi(s*J,l,h,_,x,b,S.segment,q,ee,k,L,j);if(!Q)return null;var re=mi(s*ae,l,h,_,x,b,S.segment,q,ee,k,L,j);return re?{first:Q,last:re}:null}function fi(s,u,l,h){return s===m.WritingMode.horizontal&&Math.abs(l.y-u.y)>Math.abs(l.x-u.x)*h?{useVertical:!0}:(s===m.WritingMode.vertical?u.y<l.y:u.x>l.x)?{needsFlipping:!0}:null}function xi(s,u,l,h,_,x,b,S,k,L,j,H,q,ee){var J,ae=u/24,Q=s.lineOffsetX*ae,re=s.lineOffsetY*ae;if(s.numGlyphs>1){var pe=s.glyphStartIndex+s.numGlyphs,fe=s.lineStartIndex,Ce=s.lineStartIndex+s.lineLength,xe=Al(ae,S,Q,re,l,j,H,s,k,x,q);if(!xe)return{notEnoughRoom:!0};var Ee=ht(xe.first.point,b).point,Ie=ht(xe.last.point,b).point;if(h&&!l){var Ue=fi(s.writingMode,Ee,Ie,ee);if(Ue)return Ue}J=[xe.first];for(var Be=s.glyphStartIndex+1;Be<pe-1;Be++)J.push(mi(ae*S.getoffsetX(Be),Q,re,l,j,H,s.segment,fe,Ce,k,x,q));J.push(xe.last)}else{if(h&&!l){var Xe=ht(H,_).point,pt=s.lineStartIndex+s.segment+1,mt=new m.Point(k.getx(pt),k.gety(pt)),dt=ht(mt,_),Wt=dt.signedDistanceFromCamera>0?dt.point:Fu(H,mt,Xe,1,_),nt=fi(s.writingMode,Xe,Wt,ee);if(nt)return nt}var It=mi(ae*S.getoffsetX(s.glyphStartIndex),Q,re,l,j,H,s.segment,s.lineStartIndex,s.lineStartIndex+s.lineLength,k,x,q);if(!It)return{notEnoughRoom:!0};J=[It]}for(var Dt=0,Mt=J;Dt<Mt.length;Dt+=1){var Et=Mt[Dt];m.addDynamicAttributes(L,Et.point,Et.angle)}return{}}function Fu(s,u,l,h,_){var x=ht(s.add(s.sub(u)._unit()),_).point,b=l.sub(x);return l.add(b._mult(h/b.mag()))}function mi(s,u,l,h,_,x,b,S,k,L,j,H){var q=h?s-u:s+u,ee=q>0?1:-1,J=0;h&&(ee*=-1,J=Math.PI),ee<0&&(J+=Math.PI);for(var ae=ee>0?S+b:S+b+1,Q=_,re=_,pe=0,fe=0,Ce=Math.abs(q),xe=[];pe+fe<=Ce;){if((ae+=ee)<S||ae>=k)return null;if(re=Q,xe.push(Q),void 0===(Q=H[ae])){var Ee=new m.Point(L.getx(ae),L.gety(ae)),Ie=ht(Ee,j);if(Ie.signedDistanceFromCamera>0)Q=H[ae]=Ie.point;else{var Ue=ae-ee;Q=Fu(0===pe?x:new m.Point(L.getx(Ue),L.gety(Ue)),Ee,re,Ce-pe+1,j)}}pe+=fe,fe=re.dist(Q)}var Be=(Ce-pe)/fe,Xe=Q.sub(re),pt=Xe.mult(Be)._add(re);pt._add(Xe._unit()._perp()._mult(l*ee));var mt=J+Math.atan2(Q.y-re.y,Q.x-re.x);return xe.push(pt),{point:pt,angle:mt,path:xe}}_n.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},_n.prototype.insert=function(s,u,l,h,_){this._forEachCell(u,l,h,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(u),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(_)},_n.prototype.insertCircle=function(s,u,l,h){this._forEachCell(u-h,l-h,u+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(u),this.circles.push(l),this.circles.push(h)},_n.prototype._insertBoxCell=function(s,u,l,h,_,x){this.boxCells[_].push(x)},_n.prototype._insertCircleCell=function(s,u,l,h,_,x){this.circleCells[_].push(x)},_n.prototype._query=function(s,u,l,h,_,x){if(l<0||s>this.width||h<0||u>this.height)return!_&&[];var b=[];if(s<=0&&u<=0&&this.width<=l&&this.height<=h){if(_)return!0;for(var S=0;S<this.boxKeys.length;S++)b.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(var k=0;k<this.circleKeys.length;k++){var L=this.circles[3*k],j=this.circles[3*k+1],H=this.circles[3*k+2];b.push({key:this.circleKeys[k],x1:L-H,y1:j-H,x2:L+H,y2:j+H})}return x?b.filter(x):b}return this._forEachCell(s,u,l,h,this._queryCell,b,{hitTest:_,seenUids:{box:{},circle:{}}},x),_?b.length>0:b},_n.prototype._queryCircle=function(s,u,l,h,_){var x=s-l,b=s+l,S=u-l,k=u+l;if(b<0||x>this.width||k<0||S>this.height)return!h&&[];var L=[];return this._forEachCell(x,S,b,k,this._queryCellCircle,L,{hitTest:h,circle:{x:s,y:u,radius:l},seenUids:{box:{},circle:{}}},_),h?L.length>0:L},_n.prototype.query=function(s,u,l,h,_){return this._query(s,u,l,h,!1,_)},_n.prototype.hitTest=function(s,u,l,h,_){return this._query(s,u,l,h,!0,_)},_n.prototype.hitTestCircle=function(s,u,l,h){return this._queryCircle(s,u,l,!0,h)},_n.prototype._queryCell=function(s,u,l,h,_,x,b,S){var k=b.seenUids,L=this.boxCells[_];if(null!==L)for(var j=this.bboxes,H=0,q=L;H<q.length;H+=1){var ee=q[H];if(!k.box[ee]){k.box[ee]=!0;var J=4*ee;if(s<=j[J+2]&&u<=j[J+3]&&l>=j[J+0]&&h>=j[J+1]&&(!S||S(this.boxKeys[ee]))){if(b.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[ee],x1:j[J],y1:j[J+1],x2:j[J+2],y2:j[J+3]})}}}var ae=this.circleCells[_];if(null!==ae)for(var Q=this.circles,re=0,pe=ae;re<pe.length;re+=1){var fe=pe[re];if(!k.circle[fe]){k.circle[fe]=!0;var Ce=3*fe;if(this._circleAndRectCollide(Q[Ce],Q[Ce+1],Q[Ce+2],s,u,l,h)&&(!S||S(this.circleKeys[fe]))){if(b.hitTest)return x.push(!0),!0;var xe=Q[Ce],Ee=Q[Ce+1],Ie=Q[Ce+2];x.push({key:this.circleKeys[fe],x1:xe-Ie,y1:Ee-Ie,x2:xe+Ie,y2:Ee+Ie})}}}},_n.prototype._queryCellCircle=function(s,u,l,h,_,x,b,S){var k=b.circle,L=b.seenUids,j=this.boxCells[_];if(null!==j)for(var H=this.bboxes,q=0,ee=j;q<ee.length;q+=1){var J=ee[q];if(!L.box[J]){L.box[J]=!0;var ae=4*J;if(this._circleAndRectCollide(k.x,k.y,k.radius,H[ae+0],H[ae+1],H[ae+2],H[ae+3])&&(!S||S(this.boxKeys[J])))return x.push(!0),!0}}var Q=this.circleCells[_];if(null!==Q)for(var re=this.circles,pe=0,fe=Q;pe<fe.length;pe+=1){var Ce=fe[pe];if(!L.circle[Ce]){L.circle[Ce]=!0;var xe=3*Ce;if(this._circlesCollide(re[xe],re[xe+1],re[xe+2],k.x,k.y,k.radius)&&(!S||S(this.circleKeys[Ce])))return x.push(!0),!0}}},_n.prototype._forEachCell=function(s,u,l,h,_,x,b,S){for(var k=this._convertToXCellCoord(s),L=this._convertToYCellCoord(u),j=this._convertToXCellCoord(l),H=this._convertToYCellCoord(h),q=k;q<=j;q++)for(var ee=L;ee<=H;ee++)if(_.call(this,s,u,l,h,this.xCellCount*ee+q,x,b,S))return},_n.prototype._convertToXCellCoord=function(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))},_n.prototype._convertToYCellCoord=function(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))},_n.prototype._circlesCollide=function(s,u,l,h,_,x){var b=h-s,S=_-u,k=l+x;return k*k>b*b+S*S},_n.prototype._circleAndRectCollide=function(s,u,l,h,_,x,b){var S=(x-h)/2,k=Math.abs(s-(h+S));if(k>S+l)return!1;var L=(b-_)/2,j=Math.abs(u-(_+L));if(j>L+l)return!1;if(k<=S||j<=L)return!0;var H=k-S,q=j-L;return H*H+q*q<=l*l};var Un=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Vr(s,u){for(var l=0;l<s;l++){var h=u.length;u.resize(h+4),u.float32.set(Un,3*h)}}function Qi(s,u,l){var h=u[0],_=u[1];return s[0]=l[0]*h+l[4]*_+l[12],s[1]=l[1]*h+l[5]*_+l[13],s[3]=l[3]*h+l[7]*_+l[15],s}var An=function(s,u,l){void 0===u&&(u=new _n(s.width+200,s.height+200,25)),void 0===l&&(l=new _n(s.width+200,s.height+200,25)),this.transform=s,this.grid=u,this.ignoredGrid=l,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+100,this.screenBottomBoundary=s.height+100,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200};function Oi(s,u,l){return u*(m.EXTENT/(s.tileSize*Math.pow(2,l-s.tileID.overscaledZ)))}An.prototype.placeCollisionBox=function(s,u,l,h,_){var x=this.projectAndGetPerspectiveRatio(h,s.anchorPointX,s.anchorPointY),b=l*x.perspectiveRatio,S=s.x1*b+x.point.x,k=s.y1*b+x.point.y,L=s.x2*b+x.point.x,j=s.y2*b+x.point.y;return!this.isInsideGrid(S,k,L,j)||!u&&this.grid.hitTest(S,k,L,j,_)?{box:[],offscreen:!1}:{box:[S,k,L,j],offscreen:this.isOffscreen(S,k,L,j)}},An.prototype.placeCollisionCircles=function(s,u,l,h,_,x,b,S,k,L,j,H,q){var ee=[],J=new m.Point(u.anchorX,u.anchorY),ae=ht(J,x),Q=Qa(this.transform.cameraToCenterDistance,ae.signedDistanceFromCamera),re=(L?_/Q:_*Q)/m.ONE_EM,pe=ht(J,b).point,fe=Al(re,h,u.lineOffsetX*re,u.lineOffsetY*re,!1,pe,J,u,l,b,{}),Ce=!1,xe=!1,Ee=!0;if(fe){for(var Ie=.5*H*Q+q,Ue=new m.Point(-100,-100),Be=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),Xe=new Zt,pt=fe.first,mt=fe.last,dt=[],Wt=pt.path.length-1;Wt>=1;Wt--)dt.push(pt.path[Wt]);for(var nt=1;nt<mt.path.length;nt++)dt.push(mt.path[nt]);var It=2.5*Ie;if(S){var Dt=dt.map(function(pr){return ht(pr,S)});dt=Dt.some(function(pr){return pr.signedDistanceFromCamera<=0})?[]:Dt.map(function(pr){return pr.point})}var Mt=[];if(dt.length>0){for(var Et=dt[0].clone(),Ct=dt[0].clone(),wt=1;wt<dt.length;wt++)Et.x=Math.min(Et.x,dt[wt].x),Et.y=Math.min(Et.y,dt[wt].y),Ct.x=Math.max(Ct.x,dt[wt].x),Ct.y=Math.max(Ct.y,dt[wt].y);Mt=Et.x>=Ue.x&&Ct.x<=Be.x&&Et.y>=Ue.y&&Ct.y<=Be.y?[dt]:Ct.x<Ue.x||Et.x>Be.x||Ct.y<Ue.y||Et.y>Be.y?[]:m.clipLine([dt],Ue.x,Ue.y,Be.x,Be.y)}for(var _t=0,un=Mt;_t<un.length;_t+=1){var Gn;Xe.reset(un[_t],.25*Ie),Gn=Xe.length<=.5*Ie?1:Math.ceil(Xe.paddedLength/It)+1;for(var Ri=0;Ri<Gn;Ri++){var li=Ri/Math.max(Gn-1,1),ui=Xe.lerp(li),Hn=ui.x+100,Mi=ui.y+100;ee.push(Hn,Mi,Ie,0);var oo=Hn-Ie,Fi=Mi-Ie,Ni=Hn+Ie,Mr=Mi+Ie;if(Ee=Ee&&this.isOffscreen(oo,Fi,Ni,Mr),xe=xe||this.isInsideGrid(oo,Fi,Ni,Mr),!s&&this.grid.hitTestCircle(Hn,Mi,Ie,j)&&(Ce=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Ce}}}}return{circles:!k&&Ce||!xe?[]:ee,offscreen:Ee,collisionDetected:Ce}},An.prototype.queryRenderedSymbols=function(s){if(0===s.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var u=[],l=1/0,h=1/0,_=-1/0,x=-1/0,b=0,S=s;b<S.length;b+=1){var k=S[b],L=new m.Point(k.x+100,k.y+100);l=Math.min(l,L.x),h=Math.min(h,L.y),_=Math.max(_,L.x),x=Math.max(x,L.y),u.push(L)}for(var j={},H={},q=0,ee=this.grid.query(l,h,_,x).concat(this.ignoredGrid.query(l,h,_,x));q<ee.length;q+=1){var J=ee[q],ae=J.key;if(void 0===j[ae.bucketInstanceId]&&(j[ae.bucketInstanceId]={}),!j[ae.bucketInstanceId][ae.featureIndex]){var Q=[new m.Point(J.x1,J.y1),new m.Point(J.x2,J.y1),new m.Point(J.x2,J.y2),new m.Point(J.x1,J.y2)];m.polygonIntersectsPolygon(u,Q)&&(j[ae.bucketInstanceId][ae.featureIndex]=!0,void 0===H[ae.bucketInstanceId]&&(H[ae.bucketInstanceId]=[]),H[ae.bucketInstanceId].push(ae.featureIndex))}}return H},An.prototype.insertCollisionBox=function(s,u,l,h,_){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:l,featureIndex:h,collisionGroupID:_},s[0],s[1],s[2],s[3])},An.prototype.insertCollisionCircles=function(s,u,l,h,_){for(var x=u?this.ignoredGrid:this.grid,b={bucketInstanceId:l,featureIndex:h,collisionGroupID:_},S=0;S<s.length;S+=4)x.insertCircle(b,s[S],s[S+1],s[S+2])},An.prototype.projectAndGetPerspectiveRatio=function(s,u,l){var h=[u,l,0,1];return Qi(h,h,s),{point:new m.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},An.prototype.isOffscreen=function(s,u,l,h){return l<100||s>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},An.prototype.isInsideGrid=function(s,u,l,h){return l>=0&&s<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},An.prototype.getViewportMatrix=function(){var s=m.identity([]);return m.translate(s,s,[-100,-100,0]),s};var gi=function(s,u,l,h){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?u:-u))):h&&l?1:0,this.placed=l};gi.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var Ji=function(s,u,l,h,_){this.text=new gi(s?s.text:null,u,l,_),this.icon=new gi(s?s.icon:null,u,h,_)};Ji.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var vo=function(s,u,l){this.text=s,this.icon=u,this.skipFade=l},Nu=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},yr=function(s,u,l,h,_){this.bucketInstanceId=s,this.featureIndex=u,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=_},Gc=function(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}};function yo(s,u,l,h,_){var x=m.getAnchorAlignment(s),b=-(x.horizontalAlign-.5)*u,S=-(x.verticalAlign-.5)*l,k=m.evaluateVariableOffset(s,h);return new m.Point(b+k[0]*_,S+k[1]*_)}function _i(s,u,l,h,_,x){var b=s.x1,S=s.x2,k=s.y1,L=s.y2,j=s.anchorPointX,H=s.anchorPointY,q=new m.Point(u,l);return h&&q._rotate(_?x:-x),{x1:b+q.x,y1:k+q.y,x2:S+q.x,y2:L+q.y,anchorPointX:j,anchorPointY:H}}Gc.prototype.get=function(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){var u=++this.maxGroupID;this.collisionGroups[s]={ID:u,predicate:function(l){return l.collisionGroupID===u}}}return this.collisionGroups[s]};var ii=function(s,u,l,h){this.transform=s.clone(),this.collisionIndex=new An(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Gc(l),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function Ja(s,u,l,h,_){s.emplaceBack(u?1:0,l?1:0,h||0,_||0),s.emplaceBack(u?1:0,l?1:0,h||0,_||0),s.emplaceBack(u?1:0,l?1:0,h||0,_||0),s.emplaceBack(u?1:0,l?1:0,h||0,_||0)}ii.prototype.getBucketParts=function(s,u,l,h){var _=l.getBucket(u),x=l.latestFeatureIndex;if(_&&x&&u.id===_.layerIds[0]){var b=l.collisionBoxArray,S=_.layers[0].layout,k=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),L=l.tileSize/m.EXTENT,j=this.transform.calculatePosMatrix(l.tileID.toUnwrapped()),H="map"===S.get("text-pitch-alignment"),q="map"===S.get("text-rotation-alignment"),ee=Oi(l,1,this.transform.zoom),J=Vn(j,H,q,this.transform,ee),ae=null;if(H){var Q=ln(j,H,q,this.transform,ee);ae=m.multiply([],this.transform.labelPlaneMatrix,Q)}this.retainedQueryData[_.bucketInstanceId]=new yr(_.bucketInstanceId,x,_.sourceLayerIndex,_.index,l.tileID);var re={bucket:_,layout:S,posMatrix:j,textLabelPlaneMatrix:J,labelToScreenMatrix:ae,scale:k,textPixelRatio:L,holdingForFade:l.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(h)for(var pe=0,fe=_.sortKeyRanges;pe<fe.length;pe+=1){var Ce=fe[pe];s.push({sortKey:Ce.sortKey,symbolInstanceStart:Ce.symbolInstanceStart,symbolInstanceEnd:Ce.symbolInstanceEnd,parameters:re})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:re})}},ii.prototype.attemptAnchorPlacement=function(s,u,l,h,_,x,b,S,k,L,j,H,q,ee,J){var ae,Q=[H.textOffset0,H.textOffset1],re=yo(s,l,h,Q,_),pe=this.collisionIndex.placeCollisionBox(_i(u,re.x,re.y,x,b,this.transform.angle),j,S,k,L.predicate);if(!J||0!==this.collisionIndex.placeCollisionBox(_i(J,re.x,re.y,x,b,this.transform.angle),j,S,k,L.predicate).box.length)return pe.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(ae=this.prevPlacement.variableOffsets[H.crossTileID].anchor),this.variableOffsets[H.crossTileID]={textOffset:Q,width:l,height:h,anchor:s,textBoxScale:_,prevAnchor:ae},this.markUsedJustification(q,s,H,ee),q.allowVerticalPlacement&&(this.markUsedOrientation(q,ee,H),this.placedOrientations[H.crossTileID]=ee),{shift:re,placedGlyphBoxes:pe}):void 0},ii.prototype.placeLayerBucketPart=function(s,u,l){var h=this,_=s.parameters,x=_.bucket,b=_.layout,S=_.posMatrix,k=_.textLabelPlaneMatrix,L=_.labelToScreenMatrix,j=_.textPixelRatio,H=_.holdingForFade,q=_.collisionBoxArray,ee=_.partiallyEvaluatedTextSize,J=_.collisionGroup,ae=b.get("text-optional"),Q=b.get("icon-optional"),re=b.get("text-allow-overlap"),pe=b.get("icon-allow-overlap"),fe="map"===b.get("text-rotation-alignment"),Ce="map"===b.get("text-pitch-alignment"),xe="none"!==b.get("icon-text-fit"),Ee="viewport-y"===b.get("symbol-z-order"),Ie=re&&(pe||!x.hasIconData()||Q),Ue=pe&&(re||!x.hasTextData()||ae);!x.collisionArrays&&q&&x.deserializeCollisionBoxes(q);var Be=function(nt,It){if(!u[nt.crossTileID])if(H)h.placements[nt.crossTileID]=new vo(!1,!1,!1);else{var Dt,Mt=!1,Et=!1,Ct=!0,wt=null,_t={box:null,offscreen:null},un={box:null,offscreen:null},Gn=null,Ri=null,li=0,ui=0,Hn=0;It.textFeatureIndex?li=It.textFeatureIndex:nt.useRuntimeCollisionCircles&&(li=nt.featureIndex),It.verticalTextFeatureIndex&&(ui=It.verticalTextFeatureIndex);var Mi=It.textBox;if(Mi){var oo=function(Wn){var $n=m.WritingMode.horizontal;if(x.allowVerticalPlacement&&!Wn&&h.prevPlacement){var Hi=h.prevPlacement.placedOrientations[nt.crossTileID];Hi&&(h.placedOrientations[nt.crossTileID]=Hi,h.markUsedOrientation(x,$n=Hi,nt))}return $n},Fi=function(Wn,$n){if(x.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&It.verticalTextBox)for(var Hi=0,Ql=x.writingModes;Hi<Ql.length&&(Ql[Hi]===m.WritingMode.vertical?(_t=$n(),un=_t):_t=Wn(),!(_t&&_t.box&&_t.box.length));Hi+=1);else _t=Wn()};if(b.get("text-variable-anchor")){var Ni=b.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[nt.crossTileID]){var Mr=h.prevPlacement.variableOffsets[nt.crossTileID];Ni.indexOf(Mr.anchor)>0&&(Ni=Ni.filter(function(Wn){return Wn!==Mr.anchor})).unshift(Mr.anchor)}var pr=function(Wn,$n,Hi){for(var Ql=Wn.x2-Wn.x1,ds=Wn.y2-Wn.y1,fs=nt.textBoxScale,rc=xe&&!pe?$n:null,oc={box:[],offscreen:!1},hh=re?2*Ni.length:Ni.length,Ks=0;Ks<hh;++Ks){var Po=h.attemptAnchorPlacement(Ni[Ks%Ni.length],Wn,Ql,ds,fs,fe,Ce,j,S,J,Ks>=Ni.length,nt,x,Hi,rc);if(Po&&(oc=Po.placedGlyphBoxes)&&oc.box&&oc.box.length){Mt=!0,wt=Po.shift;break}}return oc};Fi(function(){return pr(Mi,It.iconBox,m.WritingMode.horizontal)},function(){var Wn=It.verticalTextBox;return x.allowVerticalPlacement&&!(_t&&_t.box&&_t.box.length)&&nt.numVerticalGlyphVertices>0&&Wn?pr(Wn,It.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),_t&&(Mt=_t.box,Ct=_t.offscreen);var Mo=oo(_t&&_t.box);if(!Mt&&h.prevPlacement){var qr=h.prevPlacement.variableOffsets[nt.crossTileID];qr&&(h.variableOffsets[nt.crossTileID]=qr,h.markUsedJustification(x,qr.anchor,nt,Mo))}}else{var hs=function(Wn,$n){var Hi=h.collisionIndex.placeCollisionBox(Wn,re,j,S,J.predicate);return Hi&&Hi.box&&Hi.box.length&&(h.markUsedOrientation(x,$n,nt),h.placedOrientations[nt.crossTileID]=$n),Hi};Fi(function(){return hs(Mi,m.WritingMode.horizontal)},function(){var Wn=It.verticalTextBox;return x.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&Wn?hs(Wn,m.WritingMode.vertical):{box:null,offscreen:null}}),oo(_t&&_t.box&&_t.box.length)}}if(Mt=(Dt=_t)&&Dt.box&&Dt.box.length>0,Ct=Dt&&Dt.offscreen,nt.useRuntimeCollisionCircles){var ps=x.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex),ea=m.evaluateSizeForFeature(x.textSizeData,ee,ps),ka=b.get("text-padding");Gn=h.collisionIndex.placeCollisionCircles(re,ps,x.lineVertexArray,x.glyphOffsetArray,ea,S,k,L,l,Ce,J.predicate,nt.collisionCircleDiameter,ka),Mt=re||Gn.circles.length>0&&!Gn.collisionDetected,Ct=Ct&&Gn.offscreen}if(It.iconFeatureIndex&&(Hn=It.iconFeatureIndex),It.iconBox){var Ao=function(Wn){var $n=xe&&wt?_i(Wn,wt.x,wt.y,fe,Ce,h.transform.angle):Wn;return h.collisionIndex.placeCollisionBox($n,pe,j,S,J.predicate)};Et=un&&un.box&&un.box.length&&It.verticalIconBox?(Ri=Ao(It.verticalIconBox)).box.length>0:(Ri=Ao(It.iconBox)).box.length>0,Ct=Ct&&Ri.offscreen}var Ys=ae||0===nt.numHorizontalGlyphVertices&&0===nt.numVerticalGlyphVertices,oi=Q||0===nt.numIconVertices;if(Ys||oi?oi?Ys||(Et=Et&&Mt):Mt=Et&&Mt:Et=Mt=Et&&Mt,Mt&&Dt&&Dt.box&&h.collisionIndex.insertCollisionBox(Dt.box,b.get("text-ignore-placement"),x.bucketInstanceId,un&&un.box&&ui?ui:li,J.ID),Et&&Ri&&h.collisionIndex.insertCollisionBox(Ri.box,b.get("icon-ignore-placement"),x.bucketInstanceId,Hn,J.ID),Gn&&(Mt&&h.collisionIndex.insertCollisionCircles(Gn.circles,b.get("text-ignore-placement"),x.bucketInstanceId,li,J.ID),l)){var Bi=x.bucketInstanceId,Gr=h.collisionCircleArrays[Bi];void 0===Gr&&(Gr=h.collisionCircleArrays[Bi]=new Nu);for(var Da=0;Da<Gn.circles.length;Da+=4)Gr.circles.push(Gn.circles[Da+0]),Gr.circles.push(Gn.circles[Da+1]),Gr.circles.push(Gn.circles[Da+2]),Gr.circles.push(Gn.collisionDetected?1:0)}h.placements[nt.crossTileID]=new vo(Mt||Ie,Et||Ue,Ct||x.justReloaded),u[nt.crossTileID]=!0}};if(Ee)for(var Xe=x.getSortedSymbolIndexes(this.transform.angle),pt=Xe.length-1;pt>=0;--pt){var mt=Xe[pt];Be(x.symbolInstances.get(mt),x.collisionArrays[mt])}else for(var dt=s.symbolInstanceStart;dt<s.symbolInstanceEnd;dt++)Be(x.symbolInstances.get(dt),x.collisionArrays[dt]);if(l&&x.bucketInstanceId in this.collisionCircleArrays){var Wt=this.collisionCircleArrays[x.bucketInstanceId];m.invert(Wt.invProjMatrix,S),Wt.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1},ii.prototype.markUsedJustification=function(s,u,l,h){var _;_=h===m.WritingMode.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(u)];for(var x=0,b=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];x<b.length;x+=1){var S=b[x];S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=_>=0&&S!==_?0:l.crossTileID)}},ii.prototype.markUsedOrientation=function(s,u,l){for(var h=u===m.WritingMode.horizontal||u===m.WritingMode.horizontalOnly?u:0,_=u===m.WritingMode.vertical?u:0,x=0,b=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];x<b.length;x+=1)s.text.placedSymbolArray.get(b[x]).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=_)},ii.prototype.commit=function(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,l=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(s):1,_=u?u.opacities:{},x=u?u.variableOffsets:{},b=u?u.placedOrientations:{};for(var S in this.placements){var k=this.placements[S],L=_[S];L?(this.opacities[S]=new Ji(L,h,k.text,k.icon),l=l||k.text!==L.text.placed||k.icon!==L.icon.placed):(this.opacities[S]=new Ji(null,h,k.text,k.icon,k.skipFade),l=l||k.text||k.icon)}for(var j in _){var H=_[j];if(!this.opacities[j]){var q=new Ji(H,h,!1,!1);q.isHidden()||(this.opacities[j]=q,l=l||H.text.placed||H.icon.placed)}}for(var ee in x)this.variableOffsets[ee]||!this.opacities[ee]||this.opacities[ee].isHidden()||(this.variableOffsets[ee]=x[ee]);for(var J in b)this.placedOrientations[J]||!this.opacities[J]||this.opacities[J].isHidden()||(this.placedOrientations[J]=b[J]);l?this.lastPlacementChangeTime=s:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:s)},ii.prototype.updateLayerOpacities=function(s,u){for(var l={},h=0,_=u;h<_.length;h+=1){var x=_[h],b=x.getBucket(s);b&&x.latestFeatureIndex&&s.id===b.layerIds[0]&&this.updateBucketOpacities(b,l,x.collisionBoxArray)}},ii.prototype.updateBucketOpacities=function(s,u,l){var h=this;s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();var _=s.layers[0].layout,x=new Ji(null,0,!1,!1,!0),b=_.get("text-allow-overlap"),S=_.get("icon-allow-overlap"),k=_.get("text-variable-anchor"),L="map"===_.get("text-rotation-alignment"),j="map"===_.get("text-pitch-alignment"),H="none"!==_.get("icon-text-fit"),q=new Ji(null,0,b&&(S||!s.hasIconData()||_.get("icon-optional")),S&&(b||!s.hasTextData()||_.get("text-optional")),!0);!s.collisionArrays&&l&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(l);for(var ee=function(re,pe,fe){for(var Ce=0;Ce<pe/4;Ce++)re.opacityVertexArray.emplaceBack(fe)},J=function(re){var pe=s.symbolInstances.get(re),fe=pe.numHorizontalGlyphVertices,Ce=pe.numVerticalGlyphVertices,xe=pe.crossTileID,Ee=h.opacities[xe];u[xe]?Ee=x:Ee||(h.opacities[xe]=Ee=q),u[xe]=!0;var Ie=pe.numIconVertices>0,Ue=h.placedOrientations[pe.crossTileID],Be=Ue===m.WritingMode.vertical,Xe=Ue===m.WritingMode.horizontal||Ue===m.WritingMode.horizontalOnly;if(fe>0||Ce>0){var pt=Vu(Ee.text);ee(s.text,fe,Be?kl:pt),ee(s.text,Ce,Xe?kl:pt);var mt=Ee.text.isHidden();[pe.rightJustifiedTextSymbolIndex,pe.centerJustifiedTextSymbolIndex,pe.leftJustifiedTextSymbolIndex].forEach(function(_t){_t>=0&&(s.text.placedSymbolArray.get(_t).hidden=mt||Be?1:0)}),pe.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(pe.verticalPlacedTextSymbolIndex).hidden=mt||Xe?1:0);var dt=h.variableOffsets[pe.crossTileID];dt&&h.markUsedJustification(s,dt.anchor,pe,Ue);var Wt=h.placedOrientations[pe.crossTileID];Wt&&(h.markUsedJustification(s,"left",pe,Wt),h.markUsedOrientation(s,Wt,pe))}if(Ie){var nt=Vu(Ee.icon),It=!(H&&pe.verticalPlacedIconSymbolIndex&&Be);pe.placedIconSymbolIndex>=0&&(ee(s.icon,pe.numIconVertices,It?nt:kl),s.icon.placedSymbolArray.get(pe.placedIconSymbolIndex).hidden=Ee.icon.isHidden()),pe.verticalPlacedIconSymbolIndex>=0&&(ee(s.icon,pe.numVerticalIconVertices,It?kl:nt),s.icon.placedSymbolArray.get(pe.verticalPlacedIconSymbolIndex).hidden=Ee.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){var Dt=s.collisionArrays[re];if(Dt){var Mt=new m.Point(0,0);if(Dt.textBox||Dt.verticalTextBox){var Et=!0;if(k){var Ct=h.variableOffsets[xe];Ct?(Mt=yo(Ct.anchor,Ct.width,Ct.height,Ct.textOffset,Ct.textBoxScale),L&&Mt._rotate(j?h.transform.angle:-h.transform.angle)):Et=!1}Dt.textBox&&Ja(s.textCollisionBox.collisionVertexArray,Ee.text.placed,!Et||Be,Mt.x,Mt.y),Dt.verticalTextBox&&Ja(s.textCollisionBox.collisionVertexArray,Ee.text.placed,!Et||Xe,Mt.x,Mt.y)}var wt=Boolean(!Xe&&Dt.verticalIconBox);Dt.iconBox&&Ja(s.iconCollisionBox.collisionVertexArray,Ee.icon.placed,wt,H?Mt.x:0,H?Mt.y:0),Dt.verticalIconBox&&Ja(s.iconCollisionBox.collisionVertexArray,Ee.icon.placed,!wt,H?Mt.x:0,H?Mt.y:0)}}},ae=0;ae<s.symbolInstances.length;ae++)J(ae);if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){var Q=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=Q.invProjMatrix,s.placementViewportMatrix=Q.viewportMatrix,s.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}},ii.prototype.symbolFadeChange=function(s){return 0===this.fadeDuration?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},ii.prototype.zoomAdjustment=function(s){return Math.max(0,(this.transform.zoom-s)/1.5)},ii.prototype.hasTransitions=function(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration},ii.prototype.stillRecent=function(s,u){var l=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*l>s},ii.prototype.setStale=function(){this.stale=!0};var Pl=Math.pow(2,25),np=Math.pow(2,24),ip=Math.pow(2,17),Bu=Math.pow(2,16),rp=Math.pow(2,9),Hc=Math.pow(2,8),op=Math.pow(2,1);function Vu(s){if(0===s.opacity&&!s.placed)return 0;if(1===s.opacity&&s.placed)return 4294967295;var u=s.placed?1:0,l=Math.floor(127*s.opacity);return l*Pl+u*np+l*ip+u*Bu+l*rp+u*Hc+l*op+u}var kl=0,Dl=function(s){this._sortAcrossTiles="viewport-y"!==s.layout.get("symbol-z-order")&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Dl.prototype.continuePlacement=function(s,u,l,h,_){for(var x=this._bucketParts;this._currentTileIndex<s.length;)if(u.getBucketParts(x,h,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort(function(b,S){return b.sortKey-S.sortKey}));this._currentPartIndex<x.length;)if(u.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,_())return!0;return!1};var Rs=function(s,u,l,h,_,x,b){this.placement=new ii(s,_,x,b),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=l,this._showCollisionBoxes=h,this._done=!1};Rs.prototype.isDone=function(){return this._done},Rs.prototype.continuePlacement=function(s,u,l){for(var h=this,_=m.browser.now(),x=function(){var k=m.browser.now()-_;return!h._forceFullPlacement&&k>2};this._currentPlacementIndex>=0;){var b=u[s[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===b.type&&(!b.minzoom||b.minzoom<=S)&&(!b.maxzoom||b.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Dl(b)),this._inProgressLayer.continuePlacement(l[b.source],this.placement,this._showCollisionBoxes,b,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Rs.prototype.commit=function(s){return this.placement.commit(s),this.placement};var Wc=512/m.EXTENT/2,Ol=function(s,u,l){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=l;for(var h=0;h<u.length;h++){var _=u.get(h),x=_.key;this.indexedSymbolInstances[x]||(this.indexedSymbolInstances[x]=[]),this.indexedSymbolInstances[x].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,s)})}};Ol.prototype.getScaledCoordinates=function(s,u){var l=Wc/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*m.EXTENT+s.anchorX)*l),y:Math.floor((u.canonical.y*m.EXTENT+s.anchorY)*l)}},Ol.prototype.findMatches=function(s,u,l){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),_=0;_<s.length;_++){var x=s.get(_);if(!x.crossTileID){var b=this.indexedSymbolInstances[x.key];if(b)for(var S=this.getScaledCoordinates(x,u),k=0,L=b;k<L.length;k+=1){var j=L[k];if(Math.abs(j.coord.x-S.x)<=h&&Math.abs(j.coord.y-S.y)<=h&&!l[j.crossTileID]){l[j.crossTileID]=!0,x.crossTileID=j.crossTileID;break}}}}};var Uu=function(){this.maxCrossTileID=0};Uu.prototype.generate=function(){return++this.maxCrossTileID};var ji=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ji.prototype.handleWrapJump=function(s){var u=Math.round((s-this.lng)/360);if(0!==u)for(var l in this.indexes){var h=this.indexes[l],_={};for(var x in h){var b=h[x];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+u),_[b.tileID.key]=b}this.indexes[l]=_}this.lng=s},ji.prototype.addBucket=function(s,u,l){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});var _=this.usedCrossTileIDs[s.overscaledZ];for(var x in this.indexes){var b=this.indexes[x];if(Number(x)>s.overscaledZ)for(var S in b){var k=b[S];k.tileID.isChildOf(s)&&k.findMatches(u.symbolInstances,s,_)}else{var L=b[s.scaledTo(Number(x)).key];L&&L.findMatches(u.symbolInstances,s,_)}}for(var j=0;j<u.symbolInstances.length;j++){var H=u.symbolInstances.get(j);H.crossTileID||(H.crossTileID=l.generate(),_[H.crossTileID]=!0)}return void 0===this.indexes[s.overscaledZ]&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Ol(s,u.symbolInstances,u.bucketInstanceId),!0},ji.prototype.removeBucketCrossTileIDs=function(s,u){for(var l in u.indexedSymbolInstances)for(var h=0,_=u.indexedSymbolInstances[l];h<_.length;h+=1)delete this.usedCrossTileIDs[s][_[h].crossTileID]},ji.prototype.removeStaleBuckets=function(s){var u=!1;for(var l in this.indexes){var h=this.indexes[l];for(var _ in h)s[h[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[_]),delete h[_],u=!0)}return u};var wa=function(){this.layerIndexes={},this.crossTileIDs=new Uu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};wa.prototype.addLayer=function(s,u,l){var h=this.layerIndexes[s.id];void 0===h&&(h=this.layerIndexes[s.id]=new ji);var _=!1,x={};h.handleWrapJump(l);for(var b=0,S=u;b<S.length;b+=1){var k=S[b],L=k.getBucket(s);L&&s.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(k.tileID,L,this.crossTileIDs)&&(_=!0),x[L.bucketInstanceId]=!0)}return h.removeStaleBuckets(x)&&(_=!0),_},wa.prototype.pruneUnusedLayers=function(s){var u={};for(var l in s.forEach(function(h){u[h]=!0}),this.layerIndexes)u[l]||delete this.layerIndexes[l]};var xo=function(s,u){return m.emitValidationErrors(s,u&&u.filter(function(l){return"source.canvas"!==l.identifier}))},zl=m.pick(ke,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),No=m.pick(ke,["setCenter","setZoom","setBearing","setPitch"]),Bo=function(){var s={},u=m.styleSpec.$version;for(var l in m.styleSpec.$root){var h,_=m.styleSpec.$root[l];_.required&&null!=(h="version"===l?u:"array"===_.type?[]:{})&&(s[l]=h)}return s}(),bo=function(s){function u(l,h){var _=this;void 0===h&&(h={}),s.call(this),this.map=l,this.dispatcher=new Ki(ut(),this),this.imageManager=new yi,this.imageManager.setEventedParent(this),this.glyphManager=new xt(l._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Nn(256,512),this.crossTileSymbolIndex=new wa,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var x=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(b){x.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},function(S,k){if(m.triggerPluginCompletionEvent(S),k&&k.every(function(j){return j}))for(var L in x.sourceCaches)x.sourceCaches[L].reload()})}),this.on("data",function(b){if("source"===b.dataType&&"metadata"===b.sourceDataType){var S=_.sourceCaches[b.sourceId];if(S){var k=S.getSource();if(k&&k.vectorLayerIds)for(var L in _._layers){var j=_._layers[L];j.source===k.id&&_._validateLayer(j)}}}})}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.loadURL=function(l,h){var _=this;void 0===h&&(h={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var x="boolean"==typeof h.validate?h.validate:!m.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,h.accessToken);var b=this.map._requestManager.transformRequest(l,m.ResourceType.Style);this._request=m.getJSON(b,function(S,k){_._request=null,S?_.fire(new m.ErrorEvent(S)):k&&_._load(k,x)})},u.prototype.loadJSON=function(l,h){var _=this;void 0===h&&(h={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){_._request=null,_._load(l,!1!==h.validate)})},u.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(Bo,!1)},u.prototype._load=function(l,h){if(!h||!xo(this,m.validateStyle(l))){for(var _ in this._loaded=!0,this.stylesheet=l,l.sources)this.addSource(_,l.sources[_],{validate:!1});l.sprite?this._loadSprite(l.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(l.glyphs);var x=We(this.stylesheet.layers);this._order=x.map(function(L){return L.id}),this._layers={},this._serializedLayers={};for(var b=0,S=x;b<S.length;b+=1){var k=S[b];(k=m.createStyleLayer(k)).setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k,this._serializedLayers[k.id]=k.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Wa(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},u.prototype._loadSprite=function(l){var h=this;this._spriteRequest=function(_,x,b){var S,k,L,j=m.browser.devicePixelRatio>1?"@2x":"",H=m.getJSON(x.transformRequest(x.normalizeSpriteURL(_,j,".json"),m.ResourceType.SpriteJSON),function(J,ae){H=null,L||(L=J,S=ae,ee())}),q=m.getImage(x.transformRequest(x.normalizeSpriteURL(_,j,".png"),m.ResourceType.SpriteImage),function(J,ae){q=null,L||(L=J,k=ae,ee())});function ee(){if(L)b(L);else if(S&&k){var J=m.browser.getImageData(k),ae={};for(var Q in S){var re=S[Q],pe=re.width,fe=re.height,Ce=re.x,xe=re.y,Ee=re.sdf,Ie=re.pixelRatio,Ue=re.stretchX,Be=re.stretchY,Xe=re.content,pt=new m.RGBAImage({width:pe,height:fe});m.RGBAImage.copy(J,pt,{x:Ce,y:xe},{x:0,y:0},{width:pe,height:fe}),ae[Q]={data:pt,pixelRatio:Ie,sdf:Ee,stretchX:Ue,stretchY:Be,content:Xe}}b(null,ae)}}return{cancel:function(){H&&(H.cancel(),H=null),q&&(q.cancel(),q=null)}}}(l,this.map._requestManager,function(_,x){if(h._spriteRequest=null,_)h.fire(new m.ErrorEvent(_));else if(x)for(var b in x)h.imageManager.addImage(b,x[b]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new m.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(l){var h=this.sourceCaches[l.source];if(h){var _=l.sourceLayer;if(_){var x=h.getSource();("geojson"===x.type||x.vectorLayerIds&&-1===x.vectorLayerIds.indexOf(_))&&this.fire(new m.ErrorEvent(new Error('Source layer "'+_+'" does not exist on source "'+x.id+'" as specified by style layer "'+l.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(l){for(var h=[],_=0,x=l;_<x.length;_+=1){var b=this._layers[x[_]];"custom"!==b.type&&h.push(b.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(l){if(this._loaded){var h=this._changed;if(this._changed){var _=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);for(var b in(_.length||x.length)&&this._updateWorkerLayers(_,x),this._updatedSources){var S=this._updatedSources[b];"reload"===S?this._reloadSource(b):"clear"===S&&this._clearSource(b)}for(var k in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[k].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}var L={};for(var j in this.sourceCaches){var H=this.sourceCaches[j];L[j]=H.used,H.used=!1}for(var q=0,ee=this._order;q<ee.length;q+=1){var J=this._layers[ee[q]];J.recalculate(l,this._availableImages),!J.isHidden(l.zoom)&&J.source&&(this.sourceCaches[J.source].used=!0)}for(var ae in L){var Q=this.sourceCaches[ae];L[ae]!==Q.used&&Q.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ae}))}this.light.recalculate(l),this.z=l.zoom,h&&this.fire(new m.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var l=Object.keys(this._changedImages);if(l.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}},u.prototype._updateWorkerLayers=function(l,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(l){var h=this;if(this._checkLoaded(),xo(this,m.validateStyle(l)))return!1;(l=m.clone$1(l)).layers=We(l.layers);var _=function(b,S){if(!b)return[{command:ke.setStyle,args:[S]}];var k=[];try{if(!m.deepEqual(b.version,S.version))return[{command:ke.setStyle,args:[S]}];m.deepEqual(b.center,S.center)||k.push({command:ke.setCenter,args:[S.center]}),m.deepEqual(b.zoom,S.zoom)||k.push({command:ke.setZoom,args:[S.zoom]}),m.deepEqual(b.bearing,S.bearing)||k.push({command:ke.setBearing,args:[S.bearing]}),m.deepEqual(b.pitch,S.pitch)||k.push({command:ke.setPitch,args:[S.pitch]}),m.deepEqual(b.sprite,S.sprite)||k.push({command:ke.setSprite,args:[S.sprite]}),m.deepEqual(b.glyphs,S.glyphs)||k.push({command:ke.setGlyphs,args:[S.glyphs]}),m.deepEqual(b.transition,S.transition)||k.push({command:ke.setTransition,args:[S.transition]}),m.deepEqual(b.light,S.light)||k.push({command:ke.setLight,args:[S.light]});var L={},j=[];!function(q,ee,J,ae){var Q;for(Q in ee=ee||{},q=q||{})q.hasOwnProperty(Q)&&(ee.hasOwnProperty(Q)||kt(Q,J,ae));for(Q in ee)ee.hasOwnProperty(Q)&&(q.hasOwnProperty(Q)?m.deepEqual(q[Q],ee[Q])||("geojson"===q[Q].type&&"geojson"===ee[Q].type&&gn(q,ee,Q)?J.push({command:ke.setGeoJSONSourceData,args:[Q,ee[Q].data]}):ot(Q,ee,J,ae)):Pt(Q,ee,J))}(b.sources,S.sources,j,L);var H=[];b.layers&&b.layers.forEach(function(q){L[q.source]?k.push({command:ke.removeLayer,args:[q.id]}):H.push(q)}),k=k.concat(j),function(q,ee,J){ee=ee||[];var ae,Q,re,pe,fe,Ce,xe,Ee=(q=q||[]).map(wn),Ie=ee.map(wn),Ue=q.reduce(Mn,{}),Be=ee.reduce(Mn,{}),Xe=Ee.slice(),pt=Object.create(null);for(ae=0,Q=0;ae<Ee.length;ae++)Be.hasOwnProperty(re=Ee[ae])?Q++:(J.push({command:ke.removeLayer,args:[re]}),Xe.splice(Xe.indexOf(re,Q),1));for(ae=0,Q=0;ae<Ie.length;ae++)Xe[Xe.length-1-ae]!==(re=Ie[Ie.length-1-ae])&&(Ue.hasOwnProperty(re)?(J.push({command:ke.removeLayer,args:[re]}),Xe.splice(Xe.lastIndexOf(re,Xe.length-Q),1)):Q++,J.push({command:ke.addLayer,args:[Be[re],Ce=Xe[Xe.length-ae]]}),Xe.splice(Xe.length-ae,0,re),pt[re]=!0);for(ae=0;ae<Ie.length;ae++)if(pe=Ue[re=Ie[ae]],fe=Be[re],!pt[re]&&!m.deepEqual(pe,fe))if(m.deepEqual(pe.source,fe.source)&&m.deepEqual(pe["source-layer"],fe["source-layer"])&&m.deepEqual(pe.type,fe.type)){for(xe in Ut(pe.layout,fe.layout,J,re,null,ke.setLayoutProperty),Ut(pe.paint,fe.paint,J,re,null,ke.setPaintProperty),m.deepEqual(pe.filter,fe.filter)||J.push({command:ke.setFilter,args:[re,fe.filter]}),m.deepEqual(pe.minzoom,fe.minzoom)&&m.deepEqual(pe.maxzoom,fe.maxzoom)||J.push({command:ke.setLayerZoomRange,args:[re,fe.minzoom,fe.maxzoom]}),pe)pe.hasOwnProperty(xe)&&"layout"!==xe&&"paint"!==xe&&"filter"!==xe&&"metadata"!==xe&&"minzoom"!==xe&&"maxzoom"!==xe&&(0===xe.indexOf("paint.")?Ut(pe[xe],fe[xe],J,re,xe.slice(6),ke.setPaintProperty):m.deepEqual(pe[xe],fe[xe])||J.push({command:ke.setLayerProperty,args:[re,xe,fe[xe]]}));for(xe in fe)fe.hasOwnProperty(xe)&&!pe.hasOwnProperty(xe)&&"layout"!==xe&&"paint"!==xe&&"filter"!==xe&&"metadata"!==xe&&"minzoom"!==xe&&"maxzoom"!==xe&&(0===xe.indexOf("paint.")?Ut(pe[xe],fe[xe],J,re,xe.slice(6),ke.setPaintProperty):m.deepEqual(pe[xe],fe[xe])||J.push({command:ke.setLayerProperty,args:[re,xe,fe[xe]]}))}else J.push({command:ke.removeLayer,args:[re]}),Ce=Xe[Xe.lastIndexOf(re)+1],J.push({command:ke.addLayer,args:[fe,Ce]})}(H,S.layers,k)}catch(q){console.warn("Unable to compute style diff:",q),k=[{command:ke.setStyle,args:[S]}]}return k}(this.serialize(),l).filter(function(b){return!(b.command in No)});if(0===_.length)return!1;var x=_.filter(function(b){return!(b.command in zl)});if(x.length>0)throw new Error("Unimplemented: "+x.map(function(b){return b.command}).join(", ")+".");return _.forEach(function(b){"setTransition"!==b.command&&h[b.command].apply(h,b.args)}),this.stylesheet=l,!0},u.prototype.addImage=function(l,h){if(this.getImage(l))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(l,h),this._afterImageUpdated(l)},u.prototype.updateImage=function(l,h){this.imageManager.updateImage(l,h)},u.prototype.getImage=function(l){return this.imageManager.getImage(l)},u.prototype.removeImage=function(l){if(!this.getImage(l))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(l),this._afterImageUpdated(l)},u.prototype._afterImageUpdated=function(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(l,h,_){var x=this;if(void 0===_&&(_={}),this._checkLoaded(),void 0!==this.sourceCaches[l])throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(m.validateStyle.source,"sources."+l,h,null,_))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var b=this.sourceCaches[l]=new X(l,h,this.dispatcher);b.style=this,b.setEventedParent(this,function(){return{isSourceLoaded:x.loaded(),source:b.serialize(),sourceId:l}}),b.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(l){if(this._checkLoaded(),void 0===this.sourceCaches[l])throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===l)return this.fire(new m.ErrorEvent(new Error('Source "'+l+'" cannot be removed while layer "'+h+'" is using it.')));var _=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],_.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),_.setEventedParent(null),_.clearTiles(),_.onRemove&&_.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(l,h){this._checkLoaded(),this.sourceCaches[l].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()},u.prototype.addLayer=function(l,h,_){void 0===_&&(_={}),this._checkLoaded();var x=l.id;if(this.getLayer(x))this.fire(new m.ErrorEvent(new Error('Layer with id "'+x+'" already exists on this map')));else{var b;if("custom"===l.type){if(xo(this,m.validateCustomStyleLayer(l)))return;b=m.createStyleLayer(l)}else{if("object"==typeof l.source&&(this.addSource(x,l.source),l=m.clone$1(l),l=m.extend(l,{source:x})),this._validate(m.validateStyle.layer,"layers."+x,l,{arrayIndex:-1},_))return;b=m.createStyleLayer(l),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[b.id]=b.serialize()}var S=h?this._order.indexOf(h):this._order.length;if(h&&-1===S)this.fire(new m.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(S,0,x),this._layerOrderChanged=!0,this._layers[x]=b,this._removedLayers[x]&&b.source&&"custom"!==b.type){var k=this._removedLayers[x];delete this._removedLayers[x],k.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}},u.prototype.moveLayer=function(l,h){if(this._checkLoaded(),this._changed=!0,this._layers[l]){if(l!==h){var _=this._order.indexOf(l);this._order.splice(_,1);var x=h?this._order.indexOf(h):this._order.length;h&&-1===x?this.fire(new m.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(x,0,l),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(l){this._checkLoaded();var h=this._layers[l];if(h){h.setEventedParent(null);var _=this._order.indexOf(l);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=h,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],h.onRemove&&h.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(l){return this._layers[l]},u.prototype.hasLayer=function(l){return l in this._layers},u.prototype.setLayerZoomRange=function(l,h,_){this._checkLoaded();var x=this.getLayer(l);x?x.minzoom===h&&x.maxzoom===_||(null!=h&&(x.minzoom=h),null!=_&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new m.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(l,h,_){void 0===_&&(_={}),this._checkLoaded();var x=this.getLayer(l);if(x){if(!m.deepEqual(x.filter,h))return null==h?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(m.validateStyle.filter,"layers."+x.id+".filter",h,null,_)||(x.filter=m.clone$1(h),this._updateLayer(x)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(l){return m.clone$1(this.getLayer(l).filter)},u.prototype.setLayoutProperty=function(l,h,_,x){void 0===x&&(x={}),this._checkLoaded();var b=this.getLayer(l);b?m.deepEqual(b.getLayoutProperty(h),_)||(b.setLayoutProperty(h,_,x),this._updateLayer(b)):this.fire(new m.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(l,h){var _=this.getLayer(l);if(_)return _.getLayoutProperty(h);this.fire(new m.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(l,h,_,x){void 0===x&&(x={}),this._checkLoaded();var b=this.getLayer(l);b?m.deepEqual(b.getPaintProperty(h),_)||(b.setPaintProperty(h,_,x)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(l,h){return this.getLayer(l).getPaintProperty(h)},u.prototype.setFeatureState=function(l,h){this._checkLoaded();var _=l.source,x=l.sourceLayer,b=this.sourceCaches[_];if(void 0!==b){var S=b.getSource().type;"geojson"===S&&x?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==S||x?(void 0===l.id&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),b.setFeatureState(x,l.id,h)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(l,h){this._checkLoaded();var _=l.source,x=this.sourceCaches[_];if(void 0!==x){var b=x.getSource().type,S="vector"===b?l.sourceLayer:void 0;"vector"!==b||S?h&&"string"!=typeof l.id&&"number"!=typeof l.id?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):x.removeFeatureState(S,l.id,h):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+_+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(l){this._checkLoaded();var h=l.source,_=l.sourceLayer,x=this.sourceCaches[h];if(void 0!==x){if("vector"!==x.getSource().type||_)return void 0===l.id&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),x.getFeatureState(_,l.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(l){return l.serialize()}),layers:this._serializeLayers(this._order)},function(l){return void 0!==l})},u.prototype._updateLayer=function(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&"raster"!==this.sourceCaches[l.source].getSource().type&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(l){for(var h=this,_=function(Ue){return"fill-extrusion"===h._layers[Ue].type},x={},b=[],S=this._order.length-1;S>=0;S--){var k=this._order[S];if(_(k)){x[k]=S;for(var L=0,j=l;L<j.length;L+=1){var H=j[L][k];if(H)for(var q=0,ee=H;q<ee.length;q+=1)b.push(ee[q])}}}b.sort(function(Ue,Be){return Be.intersectionZ-Ue.intersectionZ});for(var J=[],ae=this._order.length-1;ae>=0;ae--){var Q=this._order[ae];if(_(Q))for(var re=b.length-1;re>=0;re--){var pe=b[re].feature;if(x[pe.layer.id]<ae)break;J.push(pe),b.pop()}else for(var fe=0,Ce=l;fe<Ce.length;fe+=1){var xe=Ce[fe][Q];if(xe)for(var Ee=0,Ie=xe;Ee<Ie.length;Ee+=1)J.push(Ie[Ee].feature)}}return J},u.prototype.queryRenderedFeatures=function(l,h,_){h&&h.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var x={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var b=0,S=h.layers;b<S.length;b+=1){var k=S[b],L=this._layers[k];if(!L)return this.fire(new m.ErrorEvent(new Error("The layer '"+k+"' does not exist in the map's style and cannot be queried for features."))),[];x[L.source]=!0}}var j=[];for(var H in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!x[H]||j.push(Di(this.sourceCaches[H],this._layers,this._serializedLayers,l,h,_));return this.placement&&j.push(function(q,ee,J,ae,Q,re,pe){for(var fe={},Ce=re.queryRenderedSymbols(ae),xe=[],Ee=0,Ie=Object.keys(Ce).map(Number);Ee<Ie.length;Ee+=1)xe.push(pe[Ie[Ee]]);xe.sort(go);for(var Ue=function(){var dt=Xe[Be],Wt=dt.featureIndex.lookupSymbolFeatures(Ce[dt.bucketInstanceId],ee,dt.bucketIndex,dt.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,q);for(var nt in Wt){var It=fe[nt]=fe[nt]||[],Dt=Wt[nt];Dt.sort(function(Ct,wt){var _t=dt.featureSortOrder;if(_t){var un=_t.indexOf(Ct.featureIndex);return _t.indexOf(wt.featureIndex)-un}return wt.featureIndex-Ct.featureIndex});for(var Mt=0,Et=Dt;Mt<Et.length;Mt+=1)It.push(Et[Mt])}},Be=0,Xe=xe;Be<Xe.length;Be+=1)Ue();var pt=function(dt){fe[dt].forEach(function(Wt){var nt=Wt.feature,It=J[q[dt].source].getFeatureState(nt.layer["source-layer"],nt.id);nt.source=nt.layer.source,nt.layer["source-layer"]&&(nt.sourceLayer=nt.layer["source-layer"]),nt.state=It})};for(var mt in fe)pt(mt);return fe}(this._layers,this._serializedLayers,this.sourceCaches,l,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(j)},u.prototype.querySourceFeatures=function(l,h){h&&h.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var _=this.sourceCaches[l];return _?function(x,b){for(var S=x.getRenderableIds().map(function(ee){return x.getTileByID(ee)}),k=[],L={},j=0;j<S.length;j++){var H=S[j],q=H.tileID.canonical.key;L[q]||(L[q]=!0,H.querySourceFeatures(k,b))}return k}(_,h):[]},u.prototype.addSourceType=function(l,h,_){return u.getSourceType(l)?_(new Error('A source type called "'+l+'" already exists.')):(u.setSourceType(l,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:h.workerSourceURL},_):_(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(l,h){void 0===h&&(h={}),this._checkLoaded();var _=this.light.getLight(),x=!1;for(var b in l)if(!m.deepEqual(l[b],_[b])){x=!0;break}if(x){var S={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,h),this.light.updateTransitions(S)}},u.prototype._validate=function(l,h,_,x,b){return void 0===b&&(b={}),(!b||!1!==b.validate)&&xo(this,l.call(m.validateStyle,m.extend({key:h,style:this.serialize(),value:_,styleSpec:m.styleSpec},x)))},u.prototype._remove=function(){for(var l in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[l].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(l){this.sourceCaches[l].clearTiles()},u.prototype._reloadSource=function(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()},u.prototype._updateSources=function(l){for(var h in this.sourceCaches)this.sourceCaches[h].update(l)},u.prototype._generateCollisionBoxes=function(){for(var l in this.sourceCaches)this._reloadSource(l)},u.prototype._updatePlacement=function(l,h,_,x,b){void 0===b&&(b=!1);for(var S=!1,k=!1,L={},j=0,H=this._order;j<H.length;j+=1){var q=this._layers[H[j]];if("symbol"===q.type){if(!L[q.source]){var ee=this.sourceCaches[q.source];L[q.source]=ee.getRenderableIds(!0).map(function(pe){return ee.getTileByID(pe)}).sort(function(pe,fe){return fe.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(fe.tileID)?-1:1)})}var J=this.crossTileSymbolIndex.addLayer(q,L[q.source],l.center.lng);S=S||J}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||0===_)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),l.zoom))&&(this.pauseablePlacement=new Rs(l,this._order,b,h,_,x,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),k=!0),S&&this.pauseablePlacement.placement.setStale()),k||S)for(var ae=0,Q=this._order;ae<Q.length;ae+=1){var re=this._layers[Q[ae]];"symbol"===re.type&&this.placement.updateLayerOpacities(re,L[re.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()},u.prototype.getImages=function(l,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();var x=this.sourceCaches[h.source];x&&x.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(l,h,_){this.glyphManager.getGlyphs(h.stacks,_)},u.prototype.getResource=function(l,h,_){return m.makeRequest(h,_)},u}(m.Evented);bo.getSourceType=function(s){return Lo[s]},bo.setSourceType=function(s,u){Lo[s]=u},bo.registerForPluginStateChange=m.registerForPluginStateChange;var Ur=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),Jn=Cn("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),Ll=Cn("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Zc=Cn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),ap=Cn("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),sp=Cn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),$u=Cn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),ju=Cn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),qu=Cn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Gu=Cn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Xc=Cn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Yc=Cn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),lp=Cn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Fs=Cn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Ns=Cn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),Kc=Cn("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),bi=Cn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),Hu=Cn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),wo=Cn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Vo=Cn("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),Ca=Cn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),Uo=Cn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),$o=Cn("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),jo=Cn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ea=Cn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),qo=Cn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),Qc=Cn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function Cn(s,u){var l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),_=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=x?x.concat(_):_,S={};return{fragmentSource:s=s.replace(l,function(k,L,j,H,q){return S[q]=!0,"define"===L?"\n#ifndef HAS_UNIFORM_u_"+q+"\nvarying "+j+" "+H+" "+q+";\n#else\nuniform "+j+" "+H+" u_"+q+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+q+"\n    "+j+" "+H+" "+q+" = u_"+q+";\n#endif\n"}),vertexSource:u=u.replace(l,function(k,L,j,H,q){var ee="float"===H?"vec2":"vec4",J=q.match(/color/)?"color":ee;return S[q]?"define"===L?"\n#ifndef HAS_UNIFORM_u_"+q+"\nuniform lowp float u_"+q+"_t;\nattribute "+j+" "+ee+" a_"+q+";\nvarying "+j+" "+H+" "+q+";\n#else\nuniform "+j+" "+H+" u_"+q+";\n#endif\n":"vec4"===J?"\n#ifndef HAS_UNIFORM_u_"+q+"\n    "+q+" = a_"+q+";\n#else\n    "+j+" "+H+" "+q+" = u_"+q+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+q+"\n    "+q+" = unpack_mix_"+J+"(a_"+q+", u_"+q+"_t);\n#else\n    "+j+" "+H+" "+q+" = u_"+q+";\n#endif\n":"define"===L?"\n#ifndef HAS_UNIFORM_u_"+q+"\nuniform lowp float u_"+q+"_t;\nattribute "+j+" "+ee+" a_"+q+";\n#else\nuniform "+j+" "+H+" u_"+q+";\n#endif\n":"vec4"===J?"\n#ifndef HAS_UNIFORM_u_"+q+"\n    "+j+" "+H+" "+q+" = a_"+q+";\n#else\n    "+j+" "+H+" "+q+" = u_"+q+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+q+"\n    "+j+" "+H+" "+q+" = unpack_mix_"+J+"(a_"+q+", u_"+q+"_t);\n#else\n    "+j+" "+H+" "+q+" = u_"+q+";\n#endif\n"}),staticAttributes:h,staticUniforms:b}}var es=Object.freeze({__proto__:null,prelude:Jn,background:Ll,backgroundPattern:Zc,circle:ap,clippingMask:sp,heatmap:$u,heatmapTexture:ju,collisionBox:qu,collisionCircle:Gu,debug:Xc,fill:Yc,fillOutline:lp,fillOutlinePattern:Fs,fillPattern:Ns,fillExtrusion:Kc,fillExtrusionPattern:bi,hillshadePrepare:Hu,hillshade:wo,line:Vo,lineGradient:Ca,linePattern:Uo,lineSDF:$o,raster:jo,symbolIcon:Ea,symbolSDF:qo,symbolTextAndIcon:Qc}),Rl=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Jc(s){for(var u=[],l=0;l<s.length;l++)if(null!==s[l]){var h=s[l].split(" ");u.push(h.pop())}return u}Rl.prototype.bind=function(s,u,l,h,_,x,b,S){this.context=s;for(var k=this.boundPaintVertexBuffers.length!==h.length,L=0;!k&&L<h.length;L++)this.boundPaintVertexBuffers[L]!==h[L]&&(k=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===l&&!k&&this.boundIndexBuffer===_&&this.boundVertexOffset===x&&this.boundDynamicVertexBuffer===b&&this.boundDynamicVertexBuffer2===S?(s.bindVertexArrayOES.set(this.vao),b&&b.bind(),_&&_.dynamicDraw&&_.bind(),S&&S.bind()):this.freshBind(u,l,h,_,x,b,S)},Rl.prototype.freshBind=function(s,u,l,h,_,x,b){var S,k=s.numAttributes,L=this.context,j=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=s,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=b;else{S=L.currentNumAttributes||0;for(var H=k;H<S;H++)j.disableVertexAttribArray(H)}u.enableAttributes(j,s);for(var q=0,ee=l;q<ee.length;q+=1)ee[q].enableAttributes(j,s);x&&x.enableAttributes(j,s),b&&b.enableAttributes(j,s),u.bind(),u.setVertexAttribPointers(j,s,_);for(var J=0,ae=l;J<ae.length;J+=1){var Q=ae[J];Q.bind(),Q.setVertexAttribPointers(j,s,_)}x&&(x.bind(),x.setVertexAttribPointers(j,s,_)),h&&h.bind(),b&&(b.bind(),b.setVertexAttribPointers(j,s,_)),L.currentNumAttributes=k},Rl.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var eh=function(s,u,l,h,_,x){var b=s.gl;this.program=b.createProgram();for(var S=Jc(l.staticAttributes),k=h?h.getBinderAttributes():[],L=S.concat(k),j=l.staticUniforms?Jc(l.staticUniforms):[],H=h?h.getBinderUniforms():[],q=[],ee=0,J=j.concat(H);ee<J.length;ee+=1){var ae=J[ee];q.indexOf(ae)<0&&q.push(ae)}var Q=h?h.defines():[];x&&Q.push("#define OVERDRAW_INSPECTOR;");var re=Q.concat(Jn.fragmentSource,l.fragmentSource).join("\n"),pe=Q.concat(Jn.vertexSource,l.vertexSource).join("\n"),fe=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())this.failedToCreate=!0;else{b.shaderSource(fe,re),b.compileShader(fe),b.attachShader(this.program,fe);var Ce=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())this.failedToCreate=!0;else{b.shaderSource(Ce,pe),b.compileShader(Ce),b.attachShader(this.program,Ce),this.attributes={};var xe={};this.numAttributes=L.length;for(var Ee=0;Ee<this.numAttributes;Ee++)L[Ee]&&(b.bindAttribLocation(this.program,Ee,L[Ee]),this.attributes[L[Ee]]=Ee);b.linkProgram(this.program),b.deleteShader(Ce),b.deleteShader(fe);for(var Ie=0;Ie<q.length;Ie++){var Ue=q[Ie];if(Ue&&!xe[Ue]){var Be=b.getUniformLocation(this.program,Ue);Be&&(xe[Ue]=Be)}}this.fixedUniforms=_(s,xe),this.binderUniforms=h?h.getUniforms(s,xe):[]}}};function th(s,u,l){var h=1/Oi(l,1,u.transform.tileZoom),_=Math.pow(2,l.tileID.overscaledZ),x=l.tileSize*Math.pow(2,u.transform.tileZoom)/_,b=x*(l.tileID.canonical.x+l.tileID.wrap*_),S=x*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[h,s.fromScale,s.toScale],u_fade:s.t,u_pixel_coord_upper:[b>>16,S>>16],u_pixel_coord_lower:[65535&b,65535&S]}}eh.prototype.draw=function(s,u,l,h,_,x,b,S,k,L,j,H,q,ee,J,ae){var Q,re=s.gl;if(!this.failedToCreate){for(var pe in s.program.set(this.program),s.setDepthMode(l),s.setStencilMode(h),s.setColorMode(_),s.setCullFace(x),this.fixedUniforms)this.fixedUniforms[pe].set(b[pe]);ee&&ee.setUniforms(s,this.binderUniforms,H,{zoom:q});for(var fe=(Q={},Q[re.LINES]=2,Q[re.TRIANGLES]=3,Q[re.LINE_STRIP]=1,Q)[u],Ce=0,xe=j.get();Ce<xe.length;Ce+=1){var Ee=xe[Ce],Ie=Ee.vaos||(Ee.vaos={});(Ie[S]||(Ie[S]=new Rl)).bind(s,this,k,ee?ee.getPaintVertexBuffers():[],L,Ee.vertexOffset,J,ae),re.drawElements(u,Ee.primitiveLength*fe,re.UNSIGNED_SHORT,Ee.primitiveOffset*fe*2)}}};var nh=function(s,u,l,h){var _=u.style.light,x=_.properties.get("position"),b=[x.x,x.y,x.z],S=m.create$1();"viewport"===_.properties.get("anchor")&&m.fromRotation(S,-u.transform.angle),m.transformMat3(b,b,S);var k=_.properties.get("color");return{u_matrix:s,u_lightpos:b,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+l,u_opacity:h}},up=function(s,u,l,h,_,x,b){return m.extend(nh(s,u,l,h),th(x,u,b),{u_height_factor:-Math.pow(2,_.overscaledZ)/b.tileSize/8})},Go=function(s){return{u_matrix:s}},Ho=function(s,u,l,h){return m.extend(Go(s),th(l,u,h))},ts=function(s,u){return{u_matrix:s,u_world:u}},ih=function(s,u,l,h,_){return m.extend(Ho(s,u,l,h),{u_world:_})},rh=function(s,u,l,h){var _,x,b=s.transform;if("map"===h.paint.get("circle-pitch-alignment")){var S=Oi(l,1,b.zoom);_=!0,x=[S,S]}else _=!1,x=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+("map"===h.paint.get("circle-pitch-scale")),u_matrix:s.translatePosMatrix(u.posMatrix,l,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:x}},Fl=function(s,u,l){var h=Oi(l,1,u.zoom),_=Math.pow(2,u.zoom-l.tileID.overscaledZ),x=l.tileID.overscaleFactor();return{u_matrix:s,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*_),u.pixelsToGLUnits[1]/(h*_)],u_overscale_factor:x}},Sa=function(s,u,l){return{u_matrix:s,u_inv_matrix:u,u_camera_to_center_distance:l.cameraToCenterDistance,u_viewport_size:[l.width,l.height]}},Bs=function(s,u,l){return void 0===l&&(l=1),{u_matrix:s,u_color:u,u_overlay:0,u_overlay_scale:l}},Co=function(s){return{u_matrix:s}},Ii=function(s,u,l,h){return{u_matrix:s,u_extrude_scale:Oi(u,1,l),u_intensity:h}},Wo=function(s,u,l){var h=s.transform;return{u_matrix:Vs(s,u,l),u_ratio:1/Oi(u,1,h.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Wu=function(s,u,l,h){return m.extend(Wo(s,u,l),{u_image:0,u_image_height:h})},En=function(s,u,l,h){var _=s.transform,x=cp(u,_);return{u_matrix:Vs(s,u,l),u_texsize:u.imageAtlasTexture.size,u_ratio:1/Oi(u,1,_.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[x,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Zu=function(s,u,l,h,_){var x=s.lineAtlas,b=cp(u,s.transform),S="round"===l.layout.get("line-cap"),k=x.getDash(h.from,S),L=x.getDash(h.to,S),j=k.width*_.fromScale,H=L.width*_.toScale;return m.extend(Wo(s,u,l),{u_patternscale_a:[b/j,-k.height/2],u_patternscale_b:[b/H,-L.height/2],u_sdfgamma:x.width/(256*Math.min(j,H)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:L.y,u_mix:_.t})};function cp(s,u){return 1/Oi(s,1,u.tileZoom)}function Vs(s,u,l){return s.translatePosMatrix(u.tileID.posMatrix,u,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}var Qp=function(s,u,l,h,_){return{u_matrix:s,u_tl_parent:u,u_scale_parent:l,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(b=_.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(x=_.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Jp(_.paint.get("raster-hue-rotate"))};var x,b};function Jp(s){s*=Math.PI/180;var u=Math.sin(s),l=Math.cos(s);return[(2*l+1)/3,(-Math.sqrt(3)*u-l+1)/3,(Math.sqrt(3)*u-l+1)/3]}var Nl,hp=function(s,u,l,h,_,x,b,S,k,L){var j=_.transform;return{u_is_size_zoom_constant:+("constant"===s||"source"===s),u_is_size_feature_constant:+("constant"===s||"camera"===s),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:j.width/j.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:b,u_coord_matrix:S,u_is_text:+k,u_pitch_with_map:+h,u_texsize:L,u_texture:0}},Us=function(s,u,l,h,_,x,b,S,k,L,j){var H=_.transform;return m.extend(hp(s,u,l,h,_,x,b,S,k,L),{u_gamma_scale:h?Math.cos(H._pitch)*H.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+j})},Xu=function(s,u,l,h,_,x,b,S,k,L){return m.extend(Us(s,u,l,h,_,x,b,S,!0,k,!0),{u_texsize_icon:L,u_texture_icon:1})},Yu=function(s,u,l){return{u_matrix:s,u_opacity:u,u_color:l}},Bl=function(s,u,l,h,_,x){return m.extend((S=x,L=_,j=(k=l).imageManager.getPattern((b=h).from.toString()),H=k.imageManager.getPattern(b.to.toString()),ee=(q=k.imageManager.getPixelSize()).width,J=q.height,ae=Math.pow(2,L.tileID.overscaledZ),re=(Q=L.tileSize*Math.pow(2,k.transform.tileZoom)/ae)*(L.tileID.canonical.x+L.tileID.wrap*ae),pe=Q*L.tileID.canonical.y,{u_image:0,u_pattern_tl_a:j.tl,u_pattern_br_a:j.br,u_pattern_tl_b:H.tl,u_pattern_br_b:H.br,u_texsize:[ee,J],u_mix:S.t,u_pattern_size_a:j.displaySize,u_pattern_size_b:H.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/Oi(L,1,k.transform.tileZoom),u_pixel_coord_upper:[re>>16,pe>>16],u_pixel_coord_lower:[65535&re,65535&pe]}),{u_matrix:s,u_opacity:u});var b,S,k,L,j,H,q,ee,J,ae,Q,re,pe},$s={fillExtrusion:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_lightpos:new m.Uniform3f(s,u.u_lightpos),u_lightintensity:new m.Uniform1f(s,u.u_lightintensity),u_lightcolor:new m.Uniform3f(s,u.u_lightcolor),u_vertical_gradient:new m.Uniform1f(s,u.u_vertical_gradient),u_opacity:new m.Uniform1f(s,u.u_opacity)}},fillExtrusionPattern:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_lightpos:new m.Uniform3f(s,u.u_lightpos),u_lightintensity:new m.Uniform1f(s,u.u_lightintensity),u_lightcolor:new m.Uniform3f(s,u.u_lightcolor),u_vertical_gradient:new m.Uniform1f(s,u.u_vertical_gradient),u_height_factor:new m.Uniform1f(s,u.u_height_factor),u_image:new m.Uniform1i(s,u.u_image),u_texsize:new m.Uniform2f(s,u.u_texsize),u_pixel_coord_upper:new m.Uniform2f(s,u.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(s,u.u_pixel_coord_lower),u_scale:new m.Uniform3f(s,u.u_scale),u_fade:new m.Uniform1f(s,u.u_fade),u_opacity:new m.Uniform1f(s,u.u_opacity)}},fill:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix)}},fillPattern:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_image:new m.Uniform1i(s,u.u_image),u_texsize:new m.Uniform2f(s,u.u_texsize),u_pixel_coord_upper:new m.Uniform2f(s,u.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(s,u.u_pixel_coord_lower),u_scale:new m.Uniform3f(s,u.u_scale),u_fade:new m.Uniform1f(s,u.u_fade)}},fillOutline:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_world:new m.Uniform2f(s,u.u_world)}},fillOutlinePattern:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_world:new m.Uniform2f(s,u.u_world),u_image:new m.Uniform1i(s,u.u_image),u_texsize:new m.Uniform2f(s,u.u_texsize),u_pixel_coord_upper:new m.Uniform2f(s,u.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(s,u.u_pixel_coord_lower),u_scale:new m.Uniform3f(s,u.u_scale),u_fade:new m.Uniform1f(s,u.u_fade)}},circle:function(s,u){return{u_camera_to_center_distance:new m.Uniform1f(s,u.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(s,u.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(s,u.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(s,u.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(s,u.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(s,u.u_matrix)}},collisionBox:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_camera_to_center_distance:new m.Uniform1f(s,u.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(s,u.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(s,u.u_extrude_scale),u_overscale_factor:new m.Uniform1f(s,u.u_overscale_factor)}},collisionCircle:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_inv_matrix:new m.UniformMatrix4f(s,u.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(s,u.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(s,u.u_viewport_size)}},debug:function(s,u){return{u_color:new m.UniformColor(s,u.u_color),u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_overlay:new m.Uniform1i(s,u.u_overlay),u_overlay_scale:new m.Uniform1f(s,u.u_overlay_scale)}},clippingMask:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix)}},heatmap:function(s,u){return{u_extrude_scale:new m.Uniform1f(s,u.u_extrude_scale),u_intensity:new m.Uniform1f(s,u.u_intensity),u_matrix:new m.UniformMatrix4f(s,u.u_matrix)}},heatmapTexture:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_world:new m.Uniform2f(s,u.u_world),u_image:new m.Uniform1i(s,u.u_image),u_color_ramp:new m.Uniform1i(s,u.u_color_ramp),u_opacity:new m.Uniform1f(s,u.u_opacity)}},hillshade:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_image:new m.Uniform1i(s,u.u_image),u_latrange:new m.Uniform2f(s,u.u_latrange),u_light:new m.Uniform2f(s,u.u_light),u_shadow:new m.UniformColor(s,u.u_shadow),u_highlight:new m.UniformColor(s,u.u_highlight),u_accent:new m.UniformColor(s,u.u_accent)}},hillshadePrepare:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_image:new m.Uniform1i(s,u.u_image),u_dimension:new m.Uniform2f(s,u.u_dimension),u_zoom:new m.Uniform1f(s,u.u_zoom),u_unpack:new m.Uniform4f(s,u.u_unpack)}},line:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_ratio:new m.Uniform1f(s,u.u_ratio),u_device_pixel_ratio:new m.Uniform1f(s,u.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(s,u.u_units_to_pixels)}},lineGradient:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_ratio:new m.Uniform1f(s,u.u_ratio),u_device_pixel_ratio:new m.Uniform1f(s,u.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(s,u.u_units_to_pixels),u_image:new m.Uniform1i(s,u.u_image),u_image_height:new m.Uniform1f(s,u.u_image_height)}},linePattern:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_texsize:new m.Uniform2f(s,u.u_texsize),u_ratio:new m.Uniform1f(s,u.u_ratio),u_device_pixel_ratio:new m.Uniform1f(s,u.u_device_pixel_ratio),u_image:new m.Uniform1i(s,u.u_image),u_units_to_pixels:new m.Uniform2f(s,u.u_units_to_pixels),u_scale:new m.Uniform3f(s,u.u_scale),u_fade:new m.Uniform1f(s,u.u_fade)}},lineSDF:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_ratio:new m.Uniform1f(s,u.u_ratio),u_device_pixel_ratio:new m.Uniform1f(s,u.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(s,u.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(s,u.u_patternscale_a),u_patternscale_b:new m.Uniform2f(s,u.u_patternscale_b),u_sdfgamma:new m.Uniform1f(s,u.u_sdfgamma),u_image:new m.Uniform1i(s,u.u_image),u_tex_y_a:new m.Uniform1f(s,u.u_tex_y_a),u_tex_y_b:new m.Uniform1f(s,u.u_tex_y_b),u_mix:new m.Uniform1f(s,u.u_mix)}},raster:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_tl_parent:new m.Uniform2f(s,u.u_tl_parent),u_scale_parent:new m.Uniform1f(s,u.u_scale_parent),u_buffer_scale:new m.Uniform1f(s,u.u_buffer_scale),u_fade_t:new m.Uniform1f(s,u.u_fade_t),u_opacity:new m.Uniform1f(s,u.u_opacity),u_image0:new m.Uniform1i(s,u.u_image0),u_image1:new m.Uniform1i(s,u.u_image1),u_brightness_low:new m.Uniform1f(s,u.u_brightness_low),u_brightness_high:new m.Uniform1f(s,u.u_brightness_high),u_saturation_factor:new m.Uniform1f(s,u.u_saturation_factor),u_contrast_factor:new m.Uniform1f(s,u.u_contrast_factor),u_spin_weights:new m.Uniform3f(s,u.u_spin_weights)}},symbolIcon:function(s,u){return{u_is_size_zoom_constant:new m.Uniform1i(s,u.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(s,u.u_is_size_feature_constant),u_size_t:new m.Uniform1f(s,u.u_size_t),u_size:new m.Uniform1f(s,u.u_size),u_camera_to_center_distance:new m.Uniform1f(s,u.u_camera_to_center_distance),u_pitch:new m.Uniform1f(s,u.u_pitch),u_rotate_symbol:new m.Uniform1i(s,u.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(s,u.u_aspect_ratio),u_fade_change:new m.Uniform1f(s,u.u_fade_change),u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(s,u.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(s,u.u_coord_matrix),u_is_text:new m.Uniform1i(s,u.u_is_text),u_pitch_with_map:new m.Uniform1i(s,u.u_pitch_with_map),u_texsize:new m.Uniform2f(s,u.u_texsize),u_texture:new m.Uniform1i(s,u.u_texture)}},symbolSDF:function(s,u){return{u_is_size_zoom_constant:new m.Uniform1i(s,u.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(s,u.u_is_size_feature_constant),u_size_t:new m.Uniform1f(s,u.u_size_t),u_size:new m.Uniform1f(s,u.u_size),u_camera_to_center_distance:new m.Uniform1f(s,u.u_camera_to_center_distance),u_pitch:new m.Uniform1f(s,u.u_pitch),u_rotate_symbol:new m.Uniform1i(s,u.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(s,u.u_aspect_ratio),u_fade_change:new m.Uniform1f(s,u.u_fade_change),u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(s,u.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(s,u.u_coord_matrix),u_is_text:new m.Uniform1i(s,u.u_is_text),u_pitch_with_map:new m.Uniform1i(s,u.u_pitch_with_map),u_texsize:new m.Uniform2f(s,u.u_texsize),u_texture:new m.Uniform1i(s,u.u_texture),u_gamma_scale:new m.Uniform1f(s,u.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(s,u.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(s,u.u_is_halo)}},symbolTextAndIcon:function(s,u){return{u_is_size_zoom_constant:new m.Uniform1i(s,u.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(s,u.u_is_size_feature_constant),u_size_t:new m.Uniform1f(s,u.u_size_t),u_size:new m.Uniform1f(s,u.u_size),u_camera_to_center_distance:new m.Uniform1f(s,u.u_camera_to_center_distance),u_pitch:new m.Uniform1f(s,u.u_pitch),u_rotate_symbol:new m.Uniform1i(s,u.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(s,u.u_aspect_ratio),u_fade_change:new m.Uniform1f(s,u.u_fade_change),u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(s,u.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(s,u.u_coord_matrix),u_is_text:new m.Uniform1i(s,u.u_is_text),u_pitch_with_map:new m.Uniform1i(s,u.u_pitch_with_map),u_texsize:new m.Uniform2f(s,u.u_texsize),u_texsize_icon:new m.Uniform2f(s,u.u_texsize_icon),u_texture:new m.Uniform1i(s,u.u_texture),u_texture_icon:new m.Uniform1i(s,u.u_texture_icon),u_gamma_scale:new m.Uniform1f(s,u.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(s,u.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(s,u.u_is_halo)}},background:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_opacity:new m.Uniform1f(s,u.u_opacity),u_color:new m.UniformColor(s,u.u_color)}},backgroundPattern:function(s,u){return{u_matrix:new m.UniformMatrix4f(s,u.u_matrix),u_opacity:new m.Uniform1f(s,u.u_opacity),u_image:new m.Uniform1i(s,u.u_image),u_pattern_tl_a:new m.Uniform2f(s,u.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(s,u.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(s,u.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(s,u.u_pattern_br_b),u_texsize:new m.Uniform2f(s,u.u_texsize),u_mix:new m.Uniform1f(s,u.u_mix),u_pattern_size_a:new m.Uniform2f(s,u.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(s,u.u_pattern_size_b),u_scale_a:new m.Uniform1f(s,u.u_scale_a),u_scale_b:new m.Uniform1f(s,u.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(s,u.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(s,u.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(s,u.u_tile_units_to_pixels)}}};function oh(s,u,l,h,_,x,b){for(var S=s.context,k=S.gl,L=s.useProgram("collisionBox"),j=[],H=0,q=0,ee=0;ee<h.length;ee++){var J=h[ee],ae=u.getTile(J),Q=ae.getBucket(l);if(Q){var re=J.posMatrix;0===_[0]&&0===_[1]||(re=s.translatePosMatrix(J.posMatrix,ae,_,x));var pe=b?Q.textCollisionBox:Q.iconCollisionBox,fe=Q.collisionCircleArray;if(fe.length>0){var Ce=m.create(),xe=re;m.mul(Ce,Q.placementInvProjMatrix,s.transform.glCoordMatrix),m.mul(Ce,Ce,Q.placementViewportMatrix),j.push({circleArray:fe,circleOffset:q,transform:xe,invTransform:Ce}),q=H+=fe.length/4}pe&&L.draw(S,k.LINES,Z.disabled,te.disabled,s.colorModeForRenderPass(),he.disabled,Fl(re,s.transform,ae),l.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,null,s.transform.zoom,null,null,pe.collisionVertexBuffer)}}if(b&&j.length){var Ee=s.useProgram("collisionCircle"),Ie=new m.StructArrayLayout2f1f2i16;Ie.resize(4*H),Ie._trim();for(var Ue=0,Be=0,Xe=j;Be<Xe.length;Be+=1)for(var pt=Xe[Be],mt=0;mt<pt.circleArray.length/4;mt++){var dt=4*mt,Wt=pt.circleArray[dt+0],nt=pt.circleArray[dt+1],It=pt.circleArray[dt+2],Dt=pt.circleArray[dt+3];Ie.emplace(Ue++,Wt,nt,It,Dt,0),Ie.emplace(Ue++,Wt,nt,It,Dt,1),Ie.emplace(Ue++,Wt,nt,It,Dt,2),Ie.emplace(Ue++,Wt,nt,It,Dt,3)}(!Nl||Nl.length<2*H)&&(Nl=function(Gn){var Ri=2*Gn,li=new m.StructArrayLayout3ui6;li.resize(Ri),li._trim();for(var ui=0;ui<Ri;ui++){var Hn=6*ui;li.uint16[Hn+0]=4*ui+0,li.uint16[Hn+1]=4*ui+1,li.uint16[Hn+2]=4*ui+2,li.uint16[Hn+3]=4*ui+2,li.uint16[Hn+4]=4*ui+3,li.uint16[Hn+5]=4*ui+0}return li}(H));for(var Mt=S.createIndexBuffer(Nl,!0),Et=S.createVertexBuffer(Ie,m.collisionCircleLayout.members,!0),Ct=0,wt=j;Ct<wt.length;Ct+=1){var _t=wt[Ct],un=Sa(_t.transform,_t.invTransform,s.transform);Ee.draw(S,k.TRIANGLES,Z.disabled,te.disabled,s.colorModeForRenderPass(),he.disabled,un,l.id,Et,Mt,m.SegmentVector.simpleSegment(0,2*_t.circleOffset,_t.circleArray.length,_t.circleArray.length/2),null,s.transform.zoom,null,null,null)}Et.destroy(),Mt.destroy()}}var Vl=m.identity(new Float32Array(16));function to(s,u,l,h,_,x){var b=m.getAnchorAlignment(s),S=-(b.horizontalAlign-.5)*u,k=-(b.verticalAlign-.5)*l,L=m.evaluateVariableOffset(s,h);return new m.Point((S/_+L[0])*x,(k/_+L[1])*x)}function pp(s,u,l,h,_,x,b,S,k,L,j){var H=s.text.placedSymbolArray,q=s.text.dynamicLayoutVertexArray,ee=s.icon.dynamicLayoutVertexArray,J={};q.clear();for(var ae=0;ae<H.length;ae++){var Q=H.get(ae),re=Q.hidden||!Q.crossTileID||s.allowVerticalPlacement&&!Q.placedOrientation?null:h[Q.crossTileID];if(re){var pe=new m.Point(Q.anchorX,Q.anchorY),fe=ht(pe,l?S:b),Ce=Qa(x.cameraToCenterDistance,fe.signedDistanceFromCamera),xe=_.evaluateSizeForFeature(s.textSizeData,L,Q)*Ce/m.ONE_EM;l&&(xe*=s.tilePixelRatio/k);for(var Ee=to(re.anchor,re.width,re.height,re.textOffset,re.textBoxScale,xe),Ie=l?ht(pe.add(Ee),b).point:fe.point.add(u?Ee.rotate(-x.angle):Ee),Ue=s.allowVerticalPlacement&&Q.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,Be=0;Be<Q.numGlyphs;Be++)m.addDynamicAttributes(q,Ie,Ue);j&&Q.associatedIconIndex>=0&&(J[Q.associatedIconIndex]={shiftedAnchor:Ie,angle:Ue})}else Vr(Q.numGlyphs,q)}if(j){ee.clear();for(var Xe=s.icon.placedSymbolArray,pt=0;pt<Xe.length;pt++){var mt=Xe.get(pt);if(mt.hidden)Vr(mt.numGlyphs,ee);else{var dt=J[pt];if(dt)for(var Wt=0;Wt<mt.numGlyphs;Wt++)m.addDynamicAttributes(ee,dt.shiftedAnchor,dt.angle);else Vr(mt.numGlyphs,ee)}}s.icon.dynamicLayoutVertexBuffer.updateData(ee)}s.text.dynamicLayoutVertexBuffer.updateData(q)}function dp(s,u,l){return l.iconsInText&&u?"symbolTextAndIcon":s?"symbolSDF":"symbolIcon"}function ah(s,u,l,h,_,x,b,S,k,L,j,H){for(var q=s.context,ee=q.gl,J=s.transform,ae="map"===S,Q="map"===k,re=ae&&"point"!==l.layout.get("symbol-placement"),pe=ae&&!Q&&!re,fe=!l.layout.get("symbol-sort-key").isConstant(),Ce=!1,xe=s.depthModeForSublayer(0,Z.ReadOnly),Ee=l.layout.get("text-variable-anchor"),Ie=[],Ue=0,Be=h;Ue<Be.length;Ue+=1){var Xe=Be[Ue],pt=u.getTile(Xe),mt=pt.getBucket(l);if(mt){var dt=_?mt.text:mt.icon;if(dt&&dt.segments.get().length){var Wt=dt.programConfigurations.get(l.id),nt=_||mt.sdfIcons,It=_?mt.textSizeData:mt.iconSizeData,Dt=Q||0!==J.pitch,Mt=s.useProgram(dp(nt,_,mt),Wt),Et=m.evaluateSizeForZoom(It,J.zoom),Ct=void 0,wt=[0,0],_t=void 0,un=void 0,Gn=null,Ri=void 0;if(_)_t=pt.glyphAtlasTexture,un=ee.LINEAR,Ct=pt.glyphAtlasTexture.size,mt.iconsInText&&(wt=pt.imageAtlasTexture.size,Gn=pt.imageAtlasTexture,Ri=Dt||s.options.rotating||s.options.zooming||"composite"===It.kind||"camera"===It.kind?ee.LINEAR:ee.NEAREST);else{var li=1!==l.layout.get("icon-size").constantOr(0)||mt.iconsNeedLinear;_t=pt.imageAtlasTexture,un=nt||s.options.rotating||s.options.zooming||li||Dt?ee.LINEAR:ee.NEAREST,Ct=pt.imageAtlasTexture.size}var ui=Oi(pt,1,s.transform.zoom),Hn=Vn(Xe.posMatrix,Q,ae,s.transform,ui),Mi=ln(Xe.posMatrix,Q,ae,s.transform,ui),oo=Ee&&mt.hasTextData(),Fi="none"!==l.layout.get("icon-text-fit")&&oo&&mt.hasIconData();re&&Br(mt,Xe.posMatrix,s,_,Hn,Mi,Q,L);var Ni=s.translatePosMatrix(Xe.posMatrix,pt,x,b),Mr=re||_&&Ee||Fi?Vl:Hn,pr=s.translatePosMatrix(Mi,pt,x,b,!0),Mo=nt&&0!==l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1),qr={program:Mt,buffers:dt,uniformValues:nt?mt.iconsInText?Xu(It.kind,Et,pe,Q,s,Ni,Mr,pr,Ct,wt):Us(It.kind,Et,pe,Q,s,Ni,Mr,pr,_,Ct,!0):hp(It.kind,Et,pe,Q,s,Ni,Mr,pr,_,Ct),atlasTexture:_t,atlasTextureIcon:Gn,atlasInterpolation:un,atlasInterpolationIcon:Ri,isSDF:nt,hasHalo:Mo};if(fe&&mt.canOverlap){Ce=!0;for(var hs=0,ps=dt.segments.get();hs<ps.length;hs+=1){var ea=ps[hs];Ie.push({segments:new m.SegmentVector([ea]),sortKey:ea.sortKey,state:qr})}}else Ie.push({segments:dt.segments,sortKey:0,state:qr})}}}Ce&&Ie.sort(function(Gr,Da){return Gr.sortKey-Da.sortKey});for(var ka=0,Ao=Ie;ka<Ao.length;ka+=1){var Ys=Ao[ka],oi=Ys.state;if(q.activeTexture.set(ee.TEXTURE0),oi.atlasTexture.bind(oi.atlasInterpolation,ee.CLAMP_TO_EDGE),oi.atlasTextureIcon&&(q.activeTexture.set(ee.TEXTURE1),oi.atlasTextureIcon&&oi.atlasTextureIcon.bind(oi.atlasInterpolationIcon,ee.CLAMP_TO_EDGE)),oi.isSDF){var Bi=oi.uniformValues;oi.hasHalo&&(Bi.u_is_halo=1,ns(oi.buffers,Ys.segments,l,s,oi.program,xe,j,H,Bi)),Bi.u_is_halo=0}ns(oi.buffers,Ys.segments,l,s,oi.program,xe,j,H,oi.uniformValues)}}function ns(s,u,l,h,_,x,b,S,k){var L=h.context;_.draw(L,L.gl.TRIANGLES,x,b,S,he.disabled,k,l.id,s.layoutVertexBuffer,s.indexBuffer,u,l.paint,h.transform.zoom,s.programConfigurations.get(l.id),s.dynamicLayoutVertexBuffer,s.opacityVertexBuffer)}function Ul(s,u,l,h,_,x,b){var S,k,L,j,H,q=s.context.gl,ee=l.paint.get("fill-pattern"),J=ee&&ee.constantOr(1),ae=l.getCrossfadeParameters();b?(k=J&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",S=q.LINES):(k=J?"fillPattern":"fill",S=q.TRIANGLES);for(var Q=0,re=h;Q<re.length;Q+=1){var pe=re[Q],fe=u.getTile(pe);if(!J||fe.patternsLoaded()){var Ce=fe.getBucket(l);if(Ce){var xe=Ce.programConfigurations.get(l.id),Ee=s.useProgram(k,xe);J&&(s.context.activeTexture.set(q.TEXTURE0),fe.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),xe.updatePaintBuffers(ae));var Ie=ee.constantOr(null);if(Ie&&fe.imageAtlas){var Ue=fe.imageAtlas,Be=Ue.patternPositions[Ie.to.toString()],Xe=Ue.patternPositions[Ie.from.toString()];Be&&Xe&&xe.setConstantPatternPositions(Be,Xe)}var pt=s.translatePosMatrix(pe.posMatrix,fe,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(b){j=Ce.indexBuffer2,H=Ce.segments2;var mt=[q.drawingBufferWidth,q.drawingBufferHeight];L="fillOutlinePattern"===k&&J?ih(pt,s,ae,fe,mt):ts(pt,mt)}else j=Ce.indexBuffer,H=Ce.segments,L=J?Ho(pt,s,ae,fe):Go(pt);Ee.draw(s.context,S,_,s.stencilModeForClipping(pe),x,he.disabled,L,l.id,Ce.layoutVertexBuffer,j,H,l.paint,s.transform.zoom,xe)}}}}function $l(s,u,l,h,_,x,b){for(var S=s.context,k=S.gl,L=l.paint.get("fill-extrusion-pattern"),j=L.constantOr(1),H=l.getCrossfadeParameters(),q=l.paint.get("fill-extrusion-opacity"),ee=0,J=h;ee<J.length;ee+=1){var ae=J[ee],Q=u.getTile(ae),re=Q.getBucket(l);if(re){var pe=re.programConfigurations.get(l.id),fe=s.useProgram(j?"fillExtrusionPattern":"fillExtrusion",pe);j&&(s.context.activeTexture.set(k.TEXTURE0),Q.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),pe.updatePaintBuffers(H));var Ce=L.constantOr(null);if(Ce&&Q.imageAtlas){var xe=Q.imageAtlas,Ee=xe.patternPositions[Ce.to.toString()],Ie=xe.patternPositions[Ce.from.toString()];Ee&&Ie&&pe.setConstantPatternPositions(Ee,Ie)}var Ue=s.translatePosMatrix(ae.posMatrix,Q,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Be=l.paint.get("fill-extrusion-vertical-gradient"),Xe=j?up(Ue,s,Be,q,ae,H,Q):nh(Ue,s,Be,q);fe.draw(S,S.gl.TRIANGLES,_,x,b,he.backCCW,Xe,l.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,l.paint,s.transform.zoom,pe)}}}function fp(s,u,l,h,_,x){var b=s.context,S=b.gl,k=u.fbo;if(k){var L=s.useProgram("hillshade");b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,k.colorAttachment.get());var j=function(H,q,ee){var J=ee.paint.get("hillshade-shadow-color"),ae=ee.paint.get("hillshade-highlight-color"),Q=ee.paint.get("hillshade-accent-color"),re=ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ee.paint.get("hillshade-illumination-anchor")&&(re-=H.transform.angle);var pe,fe,Ce,xe=!H.options.moving;return{u_matrix:H.transform.calculatePosMatrix(q.tileID.toUnwrapped(),xe),u_image:0,u_latrange:(pe=q.tileID,fe=Math.pow(2,pe.canonical.z),Ce=pe.canonical.y,[new m.MercatorCoordinate(0,Ce/fe).toLngLat().lat,new m.MercatorCoordinate(0,(Ce+1)/fe).toLngLat().lat]),u_light:[ee.paint.get("hillshade-exaggeration"),re],u_shadow:J,u_highlight:ae,u_accent:Q}}(s,u,l);L.draw(b,S.TRIANGLES,h,_,x,he.disabled,j,l.id,s.rasterBoundsBuffer,s.quadTriangleIndexBuffer,s.rasterBoundsSegments)}}function $r(s,u,l,h,_,x){var ae,Q,re,pe,b=s.context,S=b.gl,k=u.dem;if(k&&k.data){var L=k.dim,j=k.stride,H=k.getPixels();if(b.activeTexture.set(S.TEXTURE1),b.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||s.getTileTexture(j),u.demTexture){var q=u.demTexture;q.update(H,{premultiply:!1}),q.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else u.demTexture=new m.Texture(b,H,S.RGBA,{premultiply:!1}),u.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);b.activeTexture.set(S.TEXTURE0);var ee=u.fbo;if(!ee){var J=new m.Texture(b,{width:L,height:L,data:null},S.RGBA);J.bind(S.LINEAR,S.CLAMP_TO_EDGE),(ee=u.fbo=b.createFramebuffer(L,L,!0)).colorAttachment.set(J.texture)}b.bindFramebuffer.set(ee.framebuffer),b.viewport.set([0,0,L,L]),s.useProgram("hillshadePrepare").draw(b,S.TRIANGLES,h,_,x,he.disabled,(ae=u.tileID,re=(Q=k).stride,pe=m.create(),m.ortho(pe,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(pe,pe,[0,-m.EXTENT,0]),{u_matrix:pe,u_image:1,u_dimension:[re,re],u_zoom:ae.overscaledZ,u_unpack:Q.getUnpackVector()}),l.id,s.rasterBoundsBuffer,s.quadTriangleIndexBuffer,s.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function mp(s,u,l,h,_){var x=h.paint.get("raster-fade-duration");if(x>0){var b=m.browser.now(),S=(b-s.timeAdded)/x,k=u?(b-u.timeAdded)/x:-1,L=l.getSource(),j=_.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),H=!u||Math.abs(u.tileID.overscaledZ-j)>Math.abs(s.tileID.overscaledZ-j),q=H&&s.refreshedUponExpiration?1:m.clamp(H?S:1-k,0,1);return s.refreshedUponExpiration&&S>=1&&(s.refreshedUponExpiration=!1),u?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}var jl=new m.Color(1,0,0,1),Ku=new m.Color(0,1,0,1),sh=new m.Color(0,0,1,1),xr=new m.Color(1,0,1,1),is=new m.Color(0,1,1,1);function Ze(s,u,l,h){rs(s,0,u+l/2,s.transform.width,l,h)}function Zo(s,u,l,h){rs(s,u-l/2,0,l,s.transform.height,h)}function rs(s,u,l,h,_,x){var b=s.context,S=b.gl;S.enable(S.SCISSOR_TEST),S.scissor(u*m.browser.devicePixelRatio,l*m.browser.devicePixelRatio,h*m.browser.devicePixelRatio,_*m.browser.devicePixelRatio),b.clear({color:x}),S.disable(S.SCISSOR_TEST)}function lh(s,u,l){var h=s.context,_=h.gl,x=l.posMatrix,b=s.useProgram("debug"),S=Z.disabled,k=te.disabled,L=s.colorModeForRenderPass();h.activeTexture.set(_.TEXTURE0),s.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),b.draw(h,_.LINE_STRIP,S,k,L,he.disabled,Bs(x,m.Color.red),"$debug",s.debugBuffer,s.tileBorderIndexBuffer,s.debugSegments);var j=u.getTileByID(l.key).latestRawTileData,H=Math.floor((j&&j.byteLength||0)/1024),q=u.getTile(l).tileSize,ee=512/Math.min(q,512)*(l.overscaledZ/s.transform.zoom)*.5,J=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(J+=" => "+l.overscaledZ),function(ae,Q){ae.initDebugOverlayCanvas();var re=ae.debugOverlayCanvas,pe=ae.context.gl,fe=ae.debugOverlayCanvas.getContext("2d");fe.clearRect(0,0,re.width,re.height),fe.shadowColor="white",fe.shadowBlur=2,fe.lineWidth=1.5,fe.strokeStyle="white",fe.textBaseline="top",fe.font="bold 36px Open Sans, sans-serif",fe.fillText(Q,5,5),fe.strokeText(Q,5,5),ae.debugOverlayTexture.update(re),ae.debugOverlayTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE)}(s,J+" "+H+"kb"),b.draw(h,_.TRIANGLES,S,k,ce.alphaBlended,he.disabled,Bs(x,m.Color.transparent,ee),"$debug",s.debugBuffer,s.quadTriangleIndexBuffer,s.debugSegments)}var js={symbol:function(s,u,l,h,_){if("translucent"===s.renderPass){var x=te.disabled,b=s.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(S,k,L,j,H,q,ee){for(var J=k.transform,ae="map"===H,Q="map"===q,re=0,pe=S;re<pe.length;re+=1){var fe=pe[re],Ce=j.getTile(fe),xe=Ce.getBucket(L);if(xe&&xe.text&&xe.text.segments.get().length){var Ee=m.evaluateSizeForZoom(xe.textSizeData,J.zoom),Ie=Oi(Ce,1,k.transform.zoom),Ue=Vn(fe.posMatrix,Q,ae,k.transform,Ie),Be="none"!==L.layout.get("icon-text-fit")&&xe.hasIconData();if(Ee){var Xe=Math.pow(2,J.zoom-Ce.tileID.overscaledZ);pp(xe,ae,Q,ee,m.symbolSize,J,Ue,fe.posMatrix,Xe,Ee,Be)}}}}(h,s,l,u,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),0!==l.paint.get("icon-opacity").constantOr(1)&&ah(s,u,l,h,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),x,b),0!==l.paint.get("text-opacity").constantOr(1)&&ah(s,u,l,h,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),x,b),u.map.showCollisionBoxes&&(oh(s,u,l,h,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),oh(s,u,l,h,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))}},circle:function(s,u,l,h){if("translucent"===s.renderPass){var _=l.paint.get("circle-opacity"),x=l.paint.get("circle-stroke-width"),b=l.paint.get("circle-stroke-opacity"),S=!l.layout.get("circle-sort-key").isConstant();if(0!==_.constantOr(1)||0!==x.constantOr(1)&&0!==b.constantOr(1)){for(var k=s.context,L=k.gl,j=s.depthModeForSublayer(0,Z.ReadOnly),H=te.disabled,q=s.colorModeForRenderPass(),ee=[],J=0;J<h.length;J++){var ae=h[J],Q=u.getTile(ae),re=Q.getBucket(l);if(re){var pe=re.programConfigurations.get(l.id),fe={programConfiguration:pe,program:s.useProgram("circle",pe),layoutVertexBuffer:re.layoutVertexBuffer,indexBuffer:re.indexBuffer,uniformValues:rh(s,ae,Q,l)};if(S)for(var Ce=0,xe=re.segments.get();Ce<xe.length;Ce+=1){var Ee=xe[Ce];ee.push({segments:new m.SegmentVector([Ee]),sortKey:Ee.sortKey,state:fe})}else ee.push({segments:re.segments,sortKey:0,state:fe})}}S&&ee.sort(function(pt,mt){return pt.sortKey-mt.sortKey});for(var Ie=0,Ue=ee;Ie<Ue.length;Ie+=1){var Be=Ue[Ie],Xe=Be.state;Xe.program.draw(k,L.TRIANGLES,j,H,q,he.disabled,Xe.uniformValues,l.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Be.segments,l.paint,s.transform.zoom,Xe.programConfiguration)}}}},heatmap:function(s,u,l,h){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===s.renderPass){var _=s.context,x=_.gl,b=te.disabled,S=new ce([x.ONE,x.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(ee,J,ae){var Q=ee.gl;ee.activeTexture.set(Q.TEXTURE1),ee.viewport.set([0,0,J.width/4,J.height/4]);var fe,Ce,xe,Ee,Ie,re=ae.heatmapFbo;if(re)Q.bindTexture(Q.TEXTURE_2D,re.colorAttachment.get()),ee.bindFramebuffer.set(re.framebuffer);else{var pe=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,pe),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),xe=pe,Ee=re=ae.heatmapFbo=ee.createFramebuffer(J.width/4,J.height/4,!1),(Ie=(fe=ee).gl).texImage2D(Ie.TEXTURE_2D,0,Ie.RGBA,(Ce=J).width/4,Ce.height/4,0,Ie.RGBA,fe.extRenderToTextureHalfFloat?fe.extTextureHalfFloat.HALF_FLOAT_OES:Ie.UNSIGNED_BYTE,null),Ee.colorAttachment.set(xe)}})(_,s,l),_.clear({color:m.Color.transparent});for(var k=0;k<h.length;k++){var L=h[k];if(!u.hasRenderableParent(L)){var j=u.getTile(L),H=j.getBucket(l);if(H){var q=H.programConfigurations.get(l.id);s.useProgram("heatmap",q).draw(_,x.TRIANGLES,Z.disabled,b,S,he.disabled,Ii(L.posMatrix,j,s.transform.zoom,l.paint.get("heatmap-intensity")),l.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,l.paint,s.transform.zoom,q)}}}_.viewport.set([0,0,s.width,s.height])}else"translucent"===s.renderPass&&(s.context.setColorMode(s.colorModeForRenderPass()),function(ee,J){var ae=ee.context,Q=ae.gl,re=J.heatmapFbo;if(re){ae.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,re.colorAttachment.get()),ae.activeTexture.set(Q.TEXTURE1);var pe=J.colorRampTexture;pe||(pe=J.colorRampTexture=new m.Texture(ae,J.colorRamp,Q.RGBA)),pe.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),ee.useProgram("heatmapTexture").draw(ae,Q.TRIANGLES,Z.disabled,te.disabled,ee.colorModeForRenderPass(),he.disabled,function(fe,Ce,xe,Ee){var Ie=m.create();m.ortho(Ie,0,fe.width,fe.height,0,0,1);var Ue=fe.context.gl;return{u_matrix:Ie,u_world:[Ue.drawingBufferWidth,Ue.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ce.paint.get("heatmap-opacity")}}(ee,J),J.id,ee.viewportBuffer,ee.quadTriangleIndexBuffer,ee.viewportSegments,J.paint,ee.transform.zoom)}}(s,l))},line:function(s,u,l,h){if("translucent"===s.renderPass){var _=l.paint.get("line-opacity"),x=l.paint.get("line-width");if(0!==_.constantOr(1)&&0!==x.constantOr(1))for(var b=s.depthModeForSublayer(0,Z.ReadOnly),S=s.colorModeForRenderPass(),k=l.paint.get("line-dasharray"),L=l.paint.get("line-pattern"),j=L.constantOr(1),H=l.paint.get("line-gradient"),q=l.getCrossfadeParameters(),ee=j?"linePattern":k?"lineSDF":H?"lineGradient":"line",J=s.context,ae=J.gl,Q=!0,re=0,pe=h;re<pe.length;re+=1){var fe=pe[re],Ce=u.getTile(fe);if(!j||Ce.patternsLoaded()){var xe=Ce.getBucket(l);if(xe){var Ee=xe.programConfigurations.get(l.id),Ie=s.context.program.get(),Ue=s.useProgram(ee,Ee),Be=Q||Ue.program!==Ie,Xe=L.constantOr(null);if(Xe&&Ce.imageAtlas){var pt=Ce.imageAtlas,mt=pt.patternPositions[Xe.to.toString()],dt=pt.patternPositions[Xe.from.toString()];mt&&dt&&Ee.setConstantPatternPositions(mt,dt)}var Wt=j?En(s,Ce,l,q):k?Zu(s,Ce,l,k,q):H?Wu(s,Ce,l,xe.lineClipsArray.length):Wo(s,Ce,l);if(j)J.activeTexture.set(ae.TEXTURE0),Ce.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Ee.updatePaintBuffers(q);else if(k&&(Be||s.lineAtlas.dirty))J.activeTexture.set(ae.TEXTURE0),s.lineAtlas.bind(J);else if(H){var nt=xe.gradients[l.id],It=nt.texture;if(l.gradientVersion!==nt.version){var Dt=256;if(l.stepInterpolant){var Mt=u.getSource().maxzoom,Et=fe.canonical.z===Mt?Math.ceil(1<<s.transform.maxZoom-fe.canonical.z):1;Dt=m.clamp(m.nextPowerOfTwo(xe.maxLineLength/m.EXTENT*1024*Et),256,J.maxTextureSize)}nt.gradient=m.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Dt,image:nt.gradient||void 0,clips:xe.lineClipsArray}),nt.texture?nt.texture.update(nt.gradient):nt.texture=new m.Texture(J,nt.gradient,ae.RGBA),nt.version=l.gradientVersion,It=nt.texture}J.activeTexture.set(ae.TEXTURE0),It.bind(l.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}Ue.draw(J,ae.TRIANGLES,b,s.stencilModeForClipping(fe),S,he.disabled,Wt,l.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,l.paint,s.transform.zoom,Ee,xe.layoutVertexBuffer2),Q=!1}}}}},fill:function(s,u,l,h){var _=l.paint.get("fill-color"),x=l.paint.get("fill-opacity");if(0!==x.constantOr(1)){var b=s.colorModeForRenderPass(),S=l.paint.get("fill-pattern"),k=s.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===_.constantOr(m.Color.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";if(s.renderPass===k){var L=s.depthModeForSublayer(1,"opaque"===s.renderPass?Z.ReadWrite:Z.ReadOnly);Ul(s,u,l,h,L,b,!1)}if("translucent"===s.renderPass&&l.paint.get("fill-antialias")){var j=s.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,Z.ReadOnly);Ul(s,u,l,h,j,b,!0)}}},"fill-extrusion":function(s,u,l,h){var _=l.paint.get("fill-extrusion-opacity");if(0!==_&&"translucent"===s.renderPass){var x=new Z(s.context.gl.LEQUAL,Z.ReadWrite,s.depthRangeFor3D);if(1!==_||l.paint.get("fill-extrusion-pattern").constantOr(1))$l(s,u,l,h,x,te.disabled,ce.disabled),$l(s,u,l,h,x,s.stencilModeFor3D(),s.colorModeForRenderPass());else{var b=s.colorModeForRenderPass();$l(s,u,l,h,x,te.disabled,b)}}},hillshade:function(s,u,l,h){if("offscreen"===s.renderPass||"translucent"===s.renderPass){for(var _=s.context,x=s.depthModeForSublayer(0,Z.ReadOnly),b=s.colorModeForRenderPass(),S="translucent"===s.renderPass?s.stencilConfigForOverlap(h):[{},h],k=S[0],L=0,j=S[1];L<j.length;L+=1){var H=j[L],q=u.getTile(H);q.needsHillshadePrepare&&"offscreen"===s.renderPass?$r(s,q,l,x,te.disabled,b):"translucent"===s.renderPass&&fp(s,q,l,x,k[H.overscaledZ],b)}_.viewport.set([0,0,s.width,s.height])}},raster:function(s,u,l,h){if("translucent"===s.renderPass&&0!==l.paint.get("raster-opacity")&&h.length)for(var _=s.context,x=_.gl,b=u.getSource(),S=s.useProgram("raster"),k=s.colorModeForRenderPass(),L=b instanceof Jr?[{},h]:s.stencilConfigForOverlap(h),j=L[0],H=L[1],q=H[H.length-1].overscaledZ,ee=!s.options.moving,J=0,ae=H;J<ae.length;J+=1){var Q=ae[J],re=s.depthModeForSublayer(Q.overscaledZ-q,1===l.paint.get("raster-opacity")?Z.ReadWrite:Z.ReadOnly,x.LESS),pe=u.getTile(Q),fe=s.transform.calculatePosMatrix(Q.toUnwrapped(),ee);pe.registerFadeDuration(l.paint.get("raster-fade-duration"));var Ce=u.findLoadedParent(Q,0),xe=mp(pe,Ce,u,l,s.transform),Ee=void 0,Ie=void 0,Ue="nearest"===l.paint.get("raster-resampling")?x.NEAREST:x.LINEAR;_.activeTexture.set(x.TEXTURE0),pe.texture.bind(Ue,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(x.TEXTURE1),Ce?(Ce.texture.bind(Ue,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),Ee=Math.pow(2,Ce.tileID.overscaledZ-pe.tileID.overscaledZ),Ie=[pe.tileID.canonical.x*Ee%1,pe.tileID.canonical.y*Ee%1]):pe.texture.bind(Ue,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST);var Be=Qp(fe,Ie||[0,0],Ee||1,xe,l);b instanceof Jr?S.draw(_,x.TRIANGLES,re,te.disabled,k,he.disabled,Be,l.id,b.boundsBuffer,s.quadTriangleIndexBuffer,b.boundsSegments):S.draw(_,x.TRIANGLES,re,j[Q.overscaledZ],k,he.disabled,Be,l.id,s.rasterBoundsBuffer,s.quadTriangleIndexBuffer,s.rasterBoundsSegments)}},background:function(s,u,l){var h=l.paint.get("background-color"),_=l.paint.get("background-opacity");if(0!==_){var x=s.context,b=x.gl,S=s.transform,k=S.tileSize,L=l.paint.get("background-pattern");if(!s.isPatternMissing(L)){var j=!L&&1===h.a&&1===_&&s.opaquePassEnabledForLayer()?"opaque":"translucent";if(s.renderPass===j){var H=te.disabled,q=s.depthModeForSublayer(0,"opaque"===j?Z.ReadWrite:Z.ReadOnly),ee=s.colorModeForRenderPass(),J=s.useProgram(L?"backgroundPattern":"background"),ae=S.coveringTiles({tileSize:k});L&&(x.activeTexture.set(b.TEXTURE0),s.imageManager.bind(s.context));for(var Q=l.getCrossfadeParameters(),re=0,pe=ae;re<pe.length;re+=1){var fe=pe[re],Ce=s.transform.calculatePosMatrix(fe.toUnwrapped()),xe=L?Bl(Ce,_,s,L,{tileID:fe,tileSize:k},Q):Yu(Ce,_,h);J.draw(x,b.TRIANGLES,q,H,ee,he.disabled,xe,l.id,s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments)}}}}},debug:function(s,u,l){for(var h=0;h<l.length;h++)lh(s,u,l[h])},custom:function(s,u,l){var h=s.context,_=l.implementation;if("offscreen"===s.renderPass){var x=_.prerender;x&&(s.setCustomLayerDefaults(),h.setColorMode(s.colorModeForRenderPass()),x.call(_,h.gl,s.transform.customLayerMatrix()),h.setDirty(),s.setBaseState())}else if("translucent"===s.renderPass){s.setCustomLayerDefaults(),h.setColorMode(s.colorModeForRenderPass()),h.setStencilMode(te.disabled);var b="3d"===_.renderingMode?new Z(s.context.gl.LEQUAL,Z.ReadWrite,s.depthRangeFor3D):s.depthModeForSublayer(0,Z.ReadOnly);h.setDepthMode(b),_.render(h.gl,s.transform.customLayerMatrix()),h.setDirty(),s.setBaseState(),h.bindFramebuffer.set(null)}}},an=function(s,u){this.context=new ue(s),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=X.maxUnderzooming+X.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new wa,this.gpuTimers={}};an.prototype.resize=function(s,u){if(this.width=s*m.browser.devicePixelRatio,this.height=u*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var l=0,h=this.style._order;l<h.length;l+=1)this.style._layers[h[l]].resize()},an.prototype.setup=function(){var s=this.context,u=new m.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(m.EXTENT,0),u.emplaceBack(0,m.EXTENT),u.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(u,Ur.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var l=new m.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(m.EXTENT,0),l.emplaceBack(0,m.EXTENT),l.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=s.createVertexBuffer(l,Ur.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var h=new m.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(m.EXTENT,0,m.EXTENT,0),h.emplaceBack(0,m.EXTENT,0,m.EXTENT),h.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=s.createVertexBuffer(h,Qr.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var _=new m.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(_,Ur.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var x=new m.StructArrayLayout1ui2;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(x);var b=new m.StructArrayLayout3ui6;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(b),this.emptyTexture=new m.Texture(s,{width:1,height:1,data:new Uint8Array([0,0,0,0])},s.gl.RGBA);var S=this.context.gl;this.stencilClearMode=new te({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)},an.prototype.clearStencil=function(){var s=this.context,u=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var l=m.create();m.ortho(l,0,this.width,this.height,0,0,1),m.scale(l,l,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,u.TRIANGLES,Z.disabled,this.stencilClearMode,ce.disabled,he.disabled,Co(l),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},an.prototype._renderTileClippingMasks=function(s,u){if(this.currentStencilSource!==s.source&&s.isTileClipped()&&u&&u.length){this.currentStencilSource=s.source;var l=this.context,h=l.gl;this.nextStencilID+u.length>256&&this.clearStencil(),l.setColorMode(ce.disabled),l.setDepthMode(Z.disabled);var _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var x=0,b=u;x<b.length;x+=1){var S=b[x],k=this._tileClippingMaskIDs[S.key]=this.nextStencilID++;_.draw(l,h.TRIANGLES,Z.disabled,new te({func:h.ALWAYS,mask:0},k,255,h.KEEP,h.KEEP,h.REPLACE),ce.disabled,he.disabled,Co(S.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},an.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var s=this.nextStencilID++,u=this.context.gl;return new te({func:u.NOTEQUAL,mask:255},s,255,u.KEEP,u.KEEP,u.REPLACE)},an.prototype.stencilModeForClipping=function(s){var u=this.context.gl;return new te({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,u.KEEP,u.KEEP,u.REPLACE)},an.prototype.stencilConfigForOverlap=function(s){var u,l=this.context.gl,h=s.sort(function(k,L){return L.overscaledZ-k.overscaledZ}),_=h[h.length-1].overscaledZ,x=h[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();for(var b={},S=0;S<x;S++)b[S+_]=new te({func:l.GEQUAL,mask:255},S+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=x,[b,h]}return[(u={},u[_]=te.disabled,u),h]},an.prototype.colorModeForRenderPass=function(){var s=this.context.gl;return this._showOverdrawInspector?new ce([s.CONSTANT_COLOR,s.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?ce.unblended:ce.alphaBlended},an.prototype.depthModeForSublayer=function(s,u,l){if(!this.opaquePassEnabledForLayer())return Z.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Z(l||this.context.gl.LEQUAL,u,[h,h])},an.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},an.prototype.render=function(s,u){var l=this;this.style=s,this.options=u,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var h=this.style._order,_=this.style.sourceCaches;for(var x in _){var b=_[x];b.used&&b.prepare(this.context)}var S,k,L={},j={},H={};for(var q in _){var ee=_[q];L[q]=ee.getVisibleCoordinates(),j[q]=L[q].slice().reverse(),H[q]=ee.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var J=0;J<h.length;J++)if(this.style._layers[h[J]].is3D()){this.opaquePassCutoff=J;break}this.renderPass="offscreen";for(var ae=0,Q=h;ae<Q.length;ae+=1){var re=this.style._layers[Q[ae]];if(re.hasOffscreenPass()&&!re.isHidden(this.transform.zoom)){var pe=j[re.source];("custom"===re.type||pe.length)&&this.renderLayer(this,_[re.source],re,pe)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var fe=this.style._layers[h[this.currentLayer]],Ce=_[fe.source],xe=L[fe.source];this._renderTileClippingMasks(fe,xe),this.renderLayer(this,Ce,fe,xe)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var Ee=this.style._layers[h[this.currentLayer]],Ie=_[Ee.source],Ue=("symbol"===Ee.type?H:j)[Ee.source];this._renderTileClippingMasks(Ee,L[Ee.source]),this.renderLayer(this,Ie,Ee,Ue)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(Be){Be.source&&!Be.isHidden(l.transform.zoom)&&(Be.source!==(k&&k.id)&&(k=l.style.sourceCaches[Be.source]),(!S||S.getSource().maxzoom<k.getSource().maxzoom)&&(S=k))}),S&&js.debug(this,S,S.getVisibleCoordinates())),this.options.showPadding&&function(Be){var Xe=Be.transform.padding;Ze(Be,Be.transform.height-(Xe.top||0),3,jl),Ze(Be,Xe.bottom||0,3,Ku),Zo(Be,Xe.left||0,3,sh),Zo(Be,Be.transform.width-(Xe.right||0),3,xr);var mt,dt,Wt,nt,pt=Be.transform.centerPoint;rs(mt=Be,(dt=pt.x)-1,(Wt=Be.transform.height-pt.y)-10,2,20,nt=is),rs(mt,dt-10,Wt-1,20,2,nt)}(this),this.context.setDefault()},an.prototype.renderLayer=function(s,u,l,h){l.isHidden(this.transform.zoom)||("background"===l.type||"custom"===l.type||h.length)&&(this.id=l.id,this.gpuTimingStart(l),js[l.type](s,u,l,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},an.prototype.gpuTimingStart=function(s){if(this.options.gpuTiming){var u=this.context.extTimerQuery,l=this.gpuTimers[s.id];l||(l=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),l.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,l.query)}},an.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}},an.prototype.collectGpuTimers=function(){var s=this.gpuTimers;return this.gpuTimers={},s},an.prototype.queryGpuTimers=function(s){var u={};for(var l in s){var h=s[l],_=this.context.extTimerQuery,x=_.getQueryObjectEXT(h.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(h.query),u[l]=x}return u},an.prototype.translatePosMatrix=function(s,u,l,h,_){if(!l[0]&&!l[1])return s;var x=_?"map"===h?this.transform.angle:0:"viewport"===h?-this.transform.angle:0;if(x){var b=Math.sin(x),S=Math.cos(x);l=[l[0]*S-l[1]*b,l[0]*b+l[1]*S]}var k=[_?l[0]:Oi(u,l[0],this.transform.zoom),_?l[1]:Oi(u,l[1],this.transform.zoom),0],L=new Float32Array(16);return m.translate(L,s,k),L},an.prototype.saveTileTexture=function(s){var u=this._tileTextures[s.size[0]];u?u.push(s):this._tileTextures[s.size[0]]=[s]},an.prototype.getTileTexture=function(s){var u=this._tileTextures[s];return u&&u.length>0?u.pop():null},an.prototype.isPatternMissing=function(s){if(!s)return!1;if(!s.from||!s.to)return!0;var u=this.imageManager.getPattern(s.from.toString()),l=this.imageManager.getPattern(s.to.toString());return!u||!l},an.prototype.useProgram=function(s,u){this.cache=this.cache||{};var l=""+s+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[l]||(this.cache[l]=new eh(this.context,s,es[s],u,$s[s],this._showOverdrawInspector)),this.cache[l]},an.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},an.prototype.setBaseState=function(){var s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)},an.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},an.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Ta=function(s,u){this.points=s,this.planes=u};Ta.fromInvProjectionMatrix=function(s,u,l){var h=Math.pow(2,l),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(b){return m.transformMat4([],b,s)}).map(function(b){return m.scale$1([],b,1/b[3]/u*h)}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(b){var S=m.sub([],_[b[0]],_[b[1]]),k=m.sub([],_[b[2]],_[b[1]]),L=m.normalize([],m.cross([],S,k)),j=-m.dot(L,_[b[1]]);return L.concat(j)});return new Ta(_,x)};var Xo=function(s,u){this.min=s,this.max=u,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};Xo.prototype.quadrant=function(s){for(var u=[s%2==0,s<2],l=m.clone$2(this.min),h=m.clone$2(this.max),_=0;_<u.length;_++)l[_]=u[_]?this.min[_]:this.center[_],h[_]=u[_]?this.center[_]:this.max[_];return h[2]=this.max[2],new Xo(l,h)},Xo.prototype.distanceX=function(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]},Xo.prototype.distanceY=function(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]},Xo.prototype.intersects=function(s){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],l=!0,h=0;h<s.planes.length;h++){for(var _=s.planes[h],x=0,b=0;b<u.length;b++)x+=m.dot$1(_,u[b])>=0;if(0===x)return 0;x!==u.length&&(l=!1)}if(l)return 2;for(var S=0;S<3;S++){for(var k=Number.MAX_VALUE,L=-Number.MAX_VALUE,j=0;j<s.points.length;j++){var H=s.points[j][S]-this.min[S];k=Math.min(k,H),L=Math.max(L,H)}if(L<0||k>this.max[S]-this.min[S])return 0}return 1};var Yo=function(s,u,l,h){if(void 0===s&&(s=0),void 0===u&&(u=0),void 0===l&&(l=0),void 0===h&&(h=0),isNaN(s)||s<0||isNaN(u)||u<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=u,this.left=l,this.right=h};Yo.prototype.interpolate=function(s,u,l){return null!=u.top&&null!=s.top&&(this.top=m.number(s.top,u.top,l)),null!=u.bottom&&null!=s.bottom&&(this.bottom=m.number(s.bottom,u.bottom,l)),null!=u.left&&null!=s.left&&(this.left=m.number(s.left,u.left,l)),null!=u.right&&null!=s.right&&(this.right=m.number(s.right,u.right,l)),this},Yo.prototype.getCenter=function(s,u){var l=m.clamp((this.left+s-this.right)/2,0,s),h=m.clamp((this.top+u-this.bottom)/2,0,u);return new m.Point(l,h)},Yo.prototype.equals=function(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right},Yo.prototype.clone=function(){return new Yo(this.top,this.bottom,this.left,this.right)},Yo.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var rn=function(s,u,l,h,_){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===_||_,this._minZoom=s||0,this._maxZoom=u||22,this._minPitch=null==l?0:l,this._maxPitch=null==h?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Yo,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ht={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};rn.prototype.clone=function(){var s=new rn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.tileSize=this.tileSize,s.latRange=this.latRange,s.width=this.width,s.height=this.height,s._center=this._center,s.zoom=this.zoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._calcMatrices(),s},Ht.minZoom.get=function(){return this._minZoom},Ht.minZoom.set=function(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))},Ht.maxZoom.get=function(){return this._maxZoom},Ht.maxZoom.set=function(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))},Ht.minPitch.get=function(){return this._minPitch},Ht.minPitch.set=function(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))},Ht.maxPitch.get=function(){return this._maxPitch},Ht.maxPitch.set=function(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))},Ht.renderWorldCopies.get=function(){return this._renderWorldCopies},Ht.renderWorldCopies.set=function(s){void 0===s?s=!0:null===s&&(s=!1),this._renderWorldCopies=s},Ht.worldSize.get=function(){return this.tileSize*this.scale},Ht.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ht.size.get=function(){return new m.Point(this.width,this.height)},Ht.bearing.get=function(){return-this.angle/Math.PI*180},Ht.bearing.set=function(s){var u=-m.wrap(s,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ht.pitch.get=function(){return this._pitch/Math.PI*180},Ht.pitch.set=function(s){var u=m.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Ht.fov.get=function(){return this._fov/Math.PI*180},Ht.fov.set=function(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())},Ht.zoom.get=function(){return this._zoom},Ht.zoom.set=function(s){var u=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Ht.center.get=function(){return this._center},Ht.center.set=function(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())},Ht.padding.get=function(){return this._edgeInsets.toJSON()},Ht.padding.set=function(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())},Ht.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},rn.prototype.isPaddingEqual=function(s){return this._edgeInsets.equals(s)},rn.prototype.interpolatePadding=function(s,u,l){this._unmodified=!1,this._edgeInsets.interpolate(s,u,l),this._constrain(),this._calcMatrices()},rn.prototype.coveringZoomLevel=function(s){var u=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,u)},rn.prototype.getVisibleUnwrappedCoordinates=function(s){var u=[new m.UnwrappedTileID(0,s)];if(this._renderWorldCopies)for(var l=this.pointCoordinate(new m.Point(0,0)),h=this.pointCoordinate(new m.Point(this.width,0)),_=this.pointCoordinate(new m.Point(this.width,this.height)),x=this.pointCoordinate(new m.Point(0,this.height)),b=Math.floor(Math.min(l.x,h.x,_.x,x.x)),S=Math.floor(Math.max(l.x,h.x,_.x,x.x)),k=b-1;k<=S+1;k++)0!==k&&u.push(new m.UnwrappedTileID(k,s));return u},rn.prototype.coveringTiles=function(s){var u=this.coveringZoomLevel(s),l=u;if(void 0!==s.minzoom&&u<s.minzoom)return[];void 0!==s.maxzoom&&u>s.maxzoom&&(u=s.maxzoom);var h=m.MercatorCoordinate.fromLngLat(this.center),_=Math.pow(2,u),x=[_*h.x,_*h.y,0],b=Ta.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),S=s.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(S=u);var k=function(Be){return{aabb:new Xo([Be*_,0,0],[(Be+1)*_,_,0]),zoom:0,x:0,y:0,wrap:Be,fullyVisible:!1}},L=[],j=[],H=u,q=s.reparseOverscaled?l:u;if(this._renderWorldCopies)for(var ee=1;ee<=3;ee++)L.push(k(-ee)),L.push(k(ee));for(L.push(k(0));L.length>0;){var J=L.pop(),ae=J.x,Q=J.y,re=J.fullyVisible;if(!re){var pe=J.aabb.intersects(b);if(0===pe)continue;re=2===pe}var fe=J.aabb.distanceX(x),Ce=J.aabb.distanceY(x),xe=Math.max(Math.abs(fe),Math.abs(Ce));if(J.zoom===H||xe>3+(1<<H-J.zoom)-2&&J.zoom>=S)j.push({tileID:new m.OverscaledTileID(J.zoom===H?q:J.zoom,J.wrap,J.zoom,ae,Q),distanceSq:m.sqrLen([x[0]-.5-ae,x[1]-.5-Q])});else for(var Ee=0;Ee<4;Ee++){var Ie=(ae<<1)+Ee%2,Ue=(Q<<1)+(Ee>>1);L.push({aabb:J.aabb.quadrant(Ee),zoom:J.zoom+1,x:Ie,y:Ue,wrap:J.wrap,fullyVisible:re})}}return j.sort(function(Be,Xe){return Be.distanceSq-Xe.distanceSq}).map(function(Be){return Be.tileID})},rn.prototype.resize=function(s,u){this.width=s,this.height=u,this.pixelsToGLUnits=[2/s,-2/u],this._constrain(),this._calcMatrices()},Ht.unmodified.get=function(){return this._unmodified},rn.prototype.zoomScale=function(s){return Math.pow(2,s)},rn.prototype.scaleZoom=function(s){return Math.log(s)/Math.LN2},rn.prototype.project=function(s){var u=m.clamp(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(s.lng)*this.worldSize,m.mercatorYfromLat(u)*this.worldSize)},rn.prototype.unproject=function(s){return new m.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()},Ht.point.get=function(){return this.project(this.center)},rn.prototype.setLocationAtPoint=function(s,u){var l=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(s),x=new m.MercatorCoordinate(_.x-(l.x-h.x),_.y-(l.y-h.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())},rn.prototype.locationPoint=function(s){return this.coordinatePoint(this.locationCoordinate(s))},rn.prototype.pointLocation=function(s){return this.coordinateLocation(this.pointCoordinate(s))},rn.prototype.locationCoordinate=function(s){return m.MercatorCoordinate.fromLngLat(s)},rn.prototype.coordinateLocation=function(s){return s.toLngLat()},rn.prototype.pointCoordinate=function(s){var u=[s.x,s.y,0,1],l=[s.x,s.y,1,1];m.transformMat4(u,u,this.pixelMatrixInverse),m.transformMat4(l,l,this.pixelMatrixInverse);var h=u[3],_=l[3],x=u[1]/h,b=l[1]/_,S=u[2]/h,k=l[2]/_,L=S===k?0:(0-S)/(k-S);return new m.MercatorCoordinate(m.number(u[0]/h,l[0]/_,L)/this.worldSize,m.number(x,b,L)/this.worldSize)},rn.prototype.coordinatePoint=function(s){var u=[s.x*this.worldSize,s.y*this.worldSize,0,1];return m.transformMat4(u,u,this.pixelMatrix),new m.Point(u[0]/u[3],u[1]/u[3])},rn.prototype.getBounds=function(){return(new m.LngLatBounds).extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},rn.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},rn.prototype.setMaxBounds=function(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},rn.prototype.calculatePosMatrix=function(s,u){void 0===u&&(u=!1);var l=s.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[l])return h[l];var _=s.canonical,x=this.worldSize/this.zoomScale(_.z),b=_.x+Math.pow(2,_.z)*s.wrap,S=m.identity(new Float64Array(16));return m.translate(S,S,[b*x,_.y*x,0]),m.scale(S,S,[x/m.EXTENT,x/m.EXTENT,1]),m.multiply(S,u?this.alignedProjMatrix:this.projMatrix,S),h[l]=new Float32Array(S),h[l]},rn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},rn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var s,u,l,h,_=-90,x=90,b=-180,S=180,k=this.size,L=this._unmodified;if(this.latRange){var j=this.latRange;_=m.mercatorYfromLat(j[1])*this.worldSize,s=(x=m.mercatorYfromLat(j[0])*this.worldSize)-_<k.y?k.y/(x-_):0}if(this.lngRange){var H=this.lngRange;b=m.mercatorXfromLng(H[0])*this.worldSize,u=(S=m.mercatorXfromLng(H[1])*this.worldSize)-b<k.x?k.x/(S-b):0}var q=this.point,ee=Math.max(u||0,s||0);if(ee)return this.center=this.unproject(new m.Point(u?(S+b)/2:q.x,s?(x+_)/2:q.y)),this.zoom+=this.scaleZoom(ee),this._unmodified=L,void(this._constraining=!1);if(this.latRange){var J=q.y,ae=k.y/2;J-ae<_&&(h=_+ae),J+ae>x&&(h=x-ae)}if(this.lngRange){var Q=q.x,re=k.x/2;Q-re<b&&(l=b+re),Q+re>S&&(l=S-re)}void 0===l&&void 0===h||(this.center=this.unproject(new m.Point(void 0!==l?l:q.x,void 0!==h?h:q.y))),this._unmodified=L,this._constraining=!1}},rn.prototype._calcMatrices=function(){if(this.height){var s=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,l=this._fov*(.5+s.y/this.height),h=Math.sin(l)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-u-l,.01,Math.PI-.01)),_=this.point,x=_.x,b=_.y,S=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),k=this.height/50,L=new Float64Array(16);m.perspective(L,this._fov,this.width/this.height,k,S),L[8]=2*-s.x/this.width,L[9]=2*s.y/this.height,m.scale(L,L,[1,-1,1]),m.translate(L,L,[0,0,-this.cameraToCenterDistance]),m.rotateX(L,L,this._pitch),m.rotateZ(L,L,this.angle),m.translate(L,L,[-x,-b,0]),this.mercatorMatrix=m.scale([],L,[this.worldSize,this.worldSize,this.worldSize]),m.scale(L,L,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=L,this.invProjMatrix=m.invert([],this.projMatrix);var j=this.width%2/2,H=this.height%2/2,q=Math.cos(this.angle),ee=Math.sin(this.angle),J=x-Math.round(x)+q*j+ee*H,ae=b-Math.round(b)+q*H+ee*j,Q=new Float64Array(L);if(m.translate(Q,Q,[J>.5?J-1:J,ae>.5?ae-1:ae,0]),this.alignedProjMatrix=Q,L=m.create(),m.scale(L,L,[this.width/2,-this.height/2,1]),m.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=m.create(),m.scale(L,L,[1,-1,1]),m.translate(L,L,[-1,-1,0]),m.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(L=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=L,this._posMatrixCache={},this._alignedPosMatrixCache={}}},rn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var s=this.pointCoordinate(new m.Point(0,0)),u=[s.x*this.worldSize,s.y*this.worldSize,0,1];return m.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},rn.prototype.getCameraPoint=function(){var s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,s))},rn.prototype.getCameraQueryGeometry=function(s){var u=this.getCameraPoint();if(1===s.length)return[s[0],u];for(var l=u.x,h=u.y,_=u.x,x=u.y,b=0,S=s;b<S.length;b+=1){var k=S[b];l=Math.min(l,k.x),h=Math.min(h,k.y),_=Math.max(_,k.x),x=Math.max(x,k.y)}return[new m.Point(l,h),new m.Point(_,h),new m.Point(_,x),new m.Point(l,x),new m.Point(l,h)]},Object.defineProperties(rn.prototype,Ht);var Eo=function(s){var u,l,h,_;this._hashName=s&&encodeURIComponent(s),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),l=!1,h=null,_=function(){h=null,l&&(u(),h=setTimeout(_,300),l=!1)},function(){return l=!0,h||_(),h})};Eo.prototype.addTo=function(s){return this._map=s,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Eo.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Eo.prototype.getHashString=function(s){var u=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,h),x=Math.round(u.lng*_)/_,b=Math.round(u.lat*_)/_,S=this._map.getBearing(),k=this._map.getPitch(),L="";if(L+=s?"/"+x+"/"+b+"/"+l:l+"/"+b+"/"+x,(S||k)&&(L+="/"+Math.round(10*S)/10),k&&(L+="/"+Math.round(k)),this._hashName){var j=this._hashName,H=!1,q=m.window.location.hash.slice(1).split("&").map(function(ee){var J=ee.split("=")[0];return J===j?(H=!0,J+"="+L):ee}).filter(function(ee){return ee});return H||q.push(j+"="+L),"#"+q.join("&")}return"#"+L},Eo.prototype._getCurrentHash=function(){var s,u=this,l=m.window.location.hash.replace("#","");return this._hashName?(l.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(s=h)}),(s&&s[1]||"").split("/")):l.split("/")},Eo.prototype._onHashChange=function(){var s=this._getCurrentHash();if(s.length>=3&&!s.some(function(l){return isNaN(l)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0}return!1},Eo.prototype._updateHashUnthrottled=function(){var s=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,s)}catch(u){}};var So={linearity:.3,easing:m.bezier(0,0,.3,1)},qs=m.extend({deceleration:2500,maxSpeed:1400},So),Ia=m.extend({deceleration:20,maxSpeed:1400},So),Gs=m.extend({deceleration:1e3,maxSpeed:360},So),ed=m.extend({deceleration:1e3,maxSpeed:90},So),ql=function(s){this._map=s,this.clear()};function Gl(s,u){(!s.duration||s.duration<u.duration)&&(s.duration=u.duration,s.easing=u.easing)}function Hl(s,u,l){var h=l.maxSpeed,_=l.linearity,x=l.deceleration,b=m.clamp(s*_/(u/1e3),-h,h),S=Math.abs(b)/(x*_);return{easing:l.easing,duration:1e3*S,amount:b*(S/2)}}ql.prototype.clear=function(){this._inertiaBuffer=[]},ql.prototype.record=function(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:s})},ql.prototype._drainInertiaBuffer=function(){for(var s=this._inertiaBuffer,u=m.browser.now();s.length>0&&u-s[0].time>160;)s.shift()},ql.prototype._onMoveEnd=function(s){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},l=0,h=this._inertiaBuffer;l<h.length;l+=1){var _=h[l].settings;u.zoom+=_.zoomDelta||0,u.bearing+=_.bearingDelta||0,u.pitch+=_.pitchDelta||0,_.panDelta&&u.pan._add(_.panDelta),_.around&&(u.around=_.around),_.pinchAround&&(u.pinchAround=_.pinchAround)}var x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(u.pan.mag()){var S=Hl(u.pan.mag(),x,m.extend({},qs,s||{}));b.offset=u.pan.mult(S.amount/u.pan.mag()),b.center=this._map.transform.center,Gl(b,S)}if(u.zoom){var k=Hl(u.zoom,x,Ia);b.zoom=this._map.transform.zoom+k.amount,Gl(b,k)}if(u.bearing){var L=Hl(u.bearing,x,Gs);b.bearing=this._map.transform.bearing+m.clamp(L.amount,-179,179),Gl(b,L)}if(u.pitch){var j=Hl(u.pitch,x,ed);b.pitch=this._map.transform.pitch+j.amount,Gl(b,j)}if(b.zoom||b.bearing){var H=void 0===u.pinchAround?u.around:u.pinchAround;b.around=H?this._map.unproject(H):this._map.getCenter()}return this.clear(),m.extend(b,{noMoveStart:!0})}};var zi=function(s){function u(h,_,x,b){void 0===b&&(b={});var S=Re.mousePos(_.getCanvasContainer(),x),k=_.unproject(S);s.call(this,h,m.extend({point:S,lngLat:k,originalEvent:x},b)),this._defaultPrevented=!1,this.target=_}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var l={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},l.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,l),u}(m.Event),br=function(s){function u(h,_,x){var b="touchend"===h?x.changedTouches:x.touches,S=Re.touchPos(_.getCanvasContainer(),b),k=S.map(function(H){return _.unproject(H)}),L=S.reduce(function(H,q,ee,J){return H.add(q.div(J.length))},new m.Point(0,0)),j=_.unproject(L);s.call(this,h,{points:S,point:L,lngLats:k,lngLat:j,originalEvent:x}),this._defaultPrevented=!1}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var l={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},l.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,l),u}(m.Event),no=function(s){function u(h,_,x){s.call(this,h,{originalEvent:x}),this._defaultPrevented=!1}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var l={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},l.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,l),u}(m.Event),wi=function(s,u){this._map=s,this._clickTolerance=u.clickTolerance};wi.prototype.reset=function(){delete this._mousedownPos},wi.prototype.wheel=function(s){return this._firePreventable(new no(s.type,this._map,s))},wi.prototype.mousedown=function(s,u){return this._mousedownPos=u,this._firePreventable(new zi(s.type,this._map,s))},wi.prototype.mouseup=function(s){this._map.fire(new zi(s.type,this._map,s))},wi.prototype.click=function(s,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new zi(s.type,this._map,s))},wi.prototype.dblclick=function(s){return this._firePreventable(new zi(s.type,this._map,s))},wi.prototype.mouseover=function(s){this._map.fire(new zi(s.type,this._map,s))},wi.prototype.mouseout=function(s){this._map.fire(new zi(s.type,this._map,s))},wi.prototype.touchstart=function(s){return this._firePreventable(new br(s.type,this._map,s))},wi.prototype.touchmove=function(s){this._map.fire(new br(s.type,this._map,s))},wi.prototype.touchend=function(s){this._map.fire(new br(s.type,this._map,s))},wi.prototype.touchcancel=function(s){this._map.fire(new br(s.type,this._map,s))},wi.prototype._firePreventable=function(s){if(this._map.fire(s),s.defaultPrevented)return{}},wi.prototype.isEnabled=function(){return!0},wi.prototype.isActive=function(){return!1},wi.prototype.enable=function(){},wi.prototype.disable=function(){};var er=function(s){this._map=s};er.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},er.prototype.mousemove=function(s){this._map.fire(new zi(s.type,this._map,s))},er.prototype.mousedown=function(){this._delayContextMenu=!0},er.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},er.prototype.contextmenu=function(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new zi(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()},er.prototype.isEnabled=function(){return!0},er.prototype.isActive=function(){return!1},er.prototype.enable=function(){},er.prototype.disable=function(){};var Je=function(s,u){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=u.clickTolerance||1};function Wl(s,u){for(var l={},h=0;h<s.length;h++)l[s[h].identifier]=u[h];return l}Je.prototype.isEnabled=function(){return!!this._enabled},Je.prototype.isActive=function(){return!!this._active},Je.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Je.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Je.prototype.mousedown=function(s,u){this.isEnabled()&&s.shiftKey&&0===s.button&&(Re.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},Je.prototype.mousemoveWindow=function(s,u){if(this._active){var l=u;if(!(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=l,this._box||(this._box=Re.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));var _=Math.min(h.x,l.x),x=Math.max(h.x,l.x),b=Math.min(h.y,l.y),S=Math.max(h.y,l.y);Re.setTransform(this._box,"translate("+_+"px,"+b+"px)"),this._box.style.width=x-_+"px",this._box.style.height=S-b+"px"}}},Je.prototype.mouseupWindow=function(s,u){var l=this;if(this._active&&0===s.button){var h=this._startPos,_=u;if(this.reset(),Re.suppressClick(),h.x!==_.x||h.y!==_.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:function(x){return x.fitScreenCoordinates(h,_,l._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",s)}},Je.prototype.keydown=function(s){this._active&&27===s.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",s))},Je.prototype.reset=function(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(Re.remove(this._box),this._box=null),Re.enableDrag(),delete this._startPos,delete this._lastPos},Je.prototype._fireEvent=function(s,u){return this._map.fire(new m.Event(s,{originalEvent:u}))};var Hs=function(s){this.reset(),this.numTouches=s.numTouches};Hs.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Hs.prototype.touchstart=function(s,u,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=s.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){for(var _=new m.Point(0,0),x=0,b=h;x<b.length;x+=1)_._add(b[x]);return _.div(h.length)}(u),this.touches=Wl(l,u)))},Hs.prototype.touchmove=function(s,u,l){if(!this.aborted&&this.centroid){var h=Wl(l,u);for(var _ in this.touches){var x=h[_];(!x||x.dist(this.touches[_])>30)&&(this.aborted=!0)}}},Hs.prototype.touchend=function(s,u,l){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),0===l.length){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var Ko=function(s){this.singleTap=new Hs(s),this.numTaps=s.numTaps,this.reset()};Ko.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ko.prototype.touchstart=function(s,u,l){this.singleTap.touchstart(s,u,l)},Ko.prototype.touchmove=function(s,u,l){this.singleTap.touchmove(s,u,l)},Ko.prototype.touchend=function(s,u,l){var h=this.singleTap.touchend(s,u,l);if(h){var _=s.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(h)<30;if(_&&x||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var Li=function(){this._zoomIn=new Ko({numTouches:1,numTaps:2}),this._zoomOut=new Ko({numTouches:2,numTaps:1}),this.reset()};Li.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Li.prototype.touchstart=function(s,u,l){this._zoomIn.touchstart(s,u,l),this._zoomOut.touchstart(s,u,l)},Li.prototype.touchmove=function(s,u,l){this._zoomIn.touchmove(s,u,l),this._zoomOut.touchmove(s,u,l)},Li.prototype.touchend=function(s,u,l){var h=this,_=this._zoomIn.touchend(s,u,l),x=this._zoomOut.touchend(s,u,l);return _?(this._active=!0,s.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(b){return b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(_)},{originalEvent:s})}}):x?(this._active=!0,s.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(b){return b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(x)},{originalEvent:s})}}):void 0},Li.prototype.touchcancel=function(){this.reset()},Li.prototype.enable=function(){this._enabled=!0},Li.prototype.disable=function(){this._enabled=!1,this.reset()},Li.prototype.isEnabled=function(){return this._enabled},Li.prototype.isActive=function(){return this._active};var os={0:1,2:2},qi=function(s){this.reset(),this._clickTolerance=s.clickTolerance||1};qi.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},qi.prototype._correctButton=function(s,u){return!1},qi.prototype._move=function(s,u){return{}},qi.prototype.mousedown=function(s,u){if(!this._lastPoint){var l=Re.mouseButton(s);this._correctButton(s,l)&&(this._lastPoint=u,this._eventButton=l)}},qi.prototype.mousemoveWindow=function(s,u){var h,x,l=this._lastPoint;if(l)if(s.preventDefault(),x=os[this._eventButton],void 0===(h=s).buttons||(h.buttons&x)!==x)this.reset();else if(this._moved||!(u.dist(l)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(l,u)},qi.prototype.mouseupWindow=function(s){this._lastPoint&&Re.mouseButton(s)===this._eventButton&&(this._moved&&Re.suppressClick(),this.reset())},qi.prototype.enable=function(){this._enabled=!0},qi.prototype.disable=function(){this._enabled=!1,this.reset()},qi.prototype.isEnabled=function(){return this._enabled},qi.prototype.isActive=function(){return this._active};var tt=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.mousedown=function(l,h){s.prototype.mousedown.call(this,l,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(l,h){return 0===h&&!l.ctrlKey},u.prototype._move=function(l,h){return{around:h,panDelta:h.sub(l)}},u}(qi),Qo=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._correctButton=function(l,h){return 0===h&&l.ctrlKey||2===h},u.prototype._move=function(l,h){var _=.8*(h.x-l.x);if(_)return this._active=!0,{bearingDelta:_}},u.prototype.contextmenu=function(l){l.preventDefault()},u}(qi),ri=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._correctButton=function(l,h){return 0===h&&l.ctrlKey||2===h},u.prototype._move=function(l,h){var _=-.5*(h.y-l.y);if(_)return this._active=!0,{pitchDelta:_}},u.prototype.contextmenu=function(l){l.preventDefault()},u}(qi),Gi=function(s){this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset()};Gi.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},Gi.prototype.touchstart=function(s,u,l){return this._calculateTransform(s,u,l)},Gi.prototype.touchmove=function(s,u,l){if(this._active&&!(l.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,u,l)},Gi.prototype.touchend=function(s,u,l){this._calculateTransform(s,u,l),this._active&&l.length<this._minTouches&&this.reset()},Gi.prototype.touchcancel=function(){this.reset()},Gi.prototype._calculateTransform=function(s,u,l){l.length>0&&(this._active=!0);var h=Wl(l,u),_=new m.Point(0,0),x=new m.Point(0,0),b=0;for(var S in h){var k=h[S],L=this._touches[S];L&&(_._add(k),x._add(k.sub(L)),b++,h[S]=k)}if(this._touches=h,!(b<this._minTouches)&&x.mag()){var j=x.div(b);if(this._sum._add(j),!(this._sum.mag()<this._clickTolerance))return{around:_.div(b),panDelta:j}}},Gi.prototype.enable=function(){this._enabled=!0},Gi.prototype.disable=function(){this._enabled=!1,this.reset()},Gi.prototype.isEnabled=function(){return this._enabled},Gi.prototype.isActive=function(){return this._active};var tr=function(){this.reset()};function Qu(s,u,l){for(var h=0;h<s.length;h++)if(s[h].identifier===l)return u[h]}function uh(s,u){return Math.log(s/u)/Math.LN2}tr.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},tr.prototype._start=function(s){},tr.prototype._move=function(s,u,l){return{}},tr.prototype.touchstart=function(s,u,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([u[0],u[1]]))},tr.prototype.touchmove=function(s,u,l){if(this._firstTwoTouches){s.preventDefault();var h=this._firstTwoTouches,_=h[1],x=Qu(l,u,h[0]),b=Qu(l,u,_);if(x&&b){var S=this._aroundCenter?null:x.add(b).div(2);return this._move([x,b],S,s)}}},tr.prototype.touchend=function(s,u,l){if(this._firstTwoTouches){var h=this._firstTwoTouches,_=h[1],x=Qu(l,u,h[0]),b=Qu(l,u,_);x&&b||(this._active&&Re.suppressClick(),this.reset())}},tr.prototype.touchcancel=function(){this.reset()},tr.prototype.enable=function(s){this._enabled=!0,this._aroundCenter=!!s&&"center"===s.around},tr.prototype.disable=function(){this._enabled=!1,this.reset()},tr.prototype.isEnabled=function(){return this._enabled},tr.prototype.isActive=function(){return this._active};var Ju=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.reset=function(){s.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(l){this._startDistance=this._distance=l[0].dist(l[1])},u.prototype._move=function(l,h){var _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(uh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:uh(this._distance,_),pinchAround:h}},u}(tr);function qn(s,u){return 180*s.angleWith(u)/Math.PI}var ar=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.reset=function(){s.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])},u.prototype._move=function(l,h){var _=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:qn(this._vector,_),pinchAround:h}},u.prototype._isBelowThreshold=function(l){this._minDiameter=Math.min(this._minDiameter,l.mag());var h=25/(Math.PI*this._minDiameter)*360,_=qn(l,this._startVector);return Math.abs(_)<h},u}(tr);function Ws(s){return Math.abs(s.y)>Math.abs(s.x)}var as=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.reset=function(){s.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(l){this._lastPoints=l,Ws(l[0].sub(l[1]))&&(this._valid=!1)},u.prototype._move=function(l,h,_){var x=l[0].sub(this._lastPoints[0]),b=l[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(x,b,_.timeStamp),this._valid)return this._lastPoints=l,this._active=!0,{pitchDelta:(x.y+b.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(l,h,_){if(void 0!==this._valid)return this._valid;var x=l.mag()>=2,b=h.mag()>=2;if(x||b){if(!x||!b)return void 0===this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;var S=l.y>0==h.y>0;return Ws(l)&&Ws(h)&&S}},u}(tr),Zs={panStep:100,bearingStep:15,pitchStep:10},wr=function(){var s=Zs;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1};function ch(s){return s*(2-s)}wr.prototype.reset=function(){this._active=!1},wr.prototype.keydown=function(s){var u=this;if(!(s.altKey||s.ctrlKey||s.metaKey)){var l=0,h=0,_=0,x=0,b=0;switch(s.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:s.shiftKey?h=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?h=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?_=1:(s.preventDefault(),b=-1);break;case 40:s.shiftKey?_=-1:(s.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(h=0,_=0),{cameraAnimation:function(S){var k=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:ch,zoom:l?Math.round(k)+l*(s.shiftKey?2:1):k,bearing:S.getBearing()+h*u._bearingStep,pitch:S.getPitch()+_*u._pitchStep,offset:[-x*u._panStep,-b*u._panStep],center:S.getCenter()},{originalEvent:s})}}}},wr.prototype.enable=function(){this._enabled=!0},wr.prototype.disable=function(){this._enabled=!1,this.reset()},wr.prototype.isEnabled=function(){return this._enabled},wr.prototype.isActive=function(){return this._active},wr.prototype.disableRotation=function(){this._rotationDisabled=!0},wr.prototype.enableRotation=function(){this._rotationDisabled=!1};var Dn=function(s,u){this._map=s,this._el=s.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};Dn.prototype.setZoomRate=function(s){this._defaultZoomRate=s},Dn.prototype.setWheelZoomRate=function(s){this._wheelZoomRate=s},Dn.prototype.isEnabled=function(){return!!this._enabled},Dn.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},Dn.prototype.isZooming=function(){return!!this._zooming},Dn.prototype.enable=function(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=s&&"center"===s.around)},Dn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Dn.prototype.wheel=function(s){if(this.isEnabled()){var u=s.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY,l=m.browser.now(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,0!==u&&u%4.000244140625==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),s.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=s,this._delta-=u,this._active||this._start(s)),s.preventDefault()}},Dn.prototype._onTimeout=function(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)},Dn.prototype._start=function(s){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=Re.mousePos(this._el,s);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Dn.prototype.renderFrame=function(){var s=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(0!==this._delta){var l="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*l)));this._delta<0&&0!==h&&(h=1/h);var _="number"==typeof this._targetZoom?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(_*h))),"wheel"===this._type&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var x,b="number"==typeof this._targetZoom?this._targetZoom:u.zoom,S=this._startZoom,k=this._easing,L=!1;if("wheel"===this._type&&S&&k){var j=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),H=k(j);x=m.number(S,b,H),j<1?this._frameId||(this._frameId=!0):L=!0}else x=b,L=!0;return this._active=!0,L&&(this._active=!1,this._finishTimeout=setTimeout(function(){s._zooming=!1,s._handler._triggerRenderFrame(),delete s._targetZoom,delete s._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!L,zoomDelta:x-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Dn.prototype._smoothOutEasing=function(s){var u=m.ease;if(this._prevEase){var l=this._prevEase,h=(m.browser.now()-l.start)/l.duration,_=l.easing(h+.01)-l.easing(h),x=.27/Math.sqrt(_*_+1e-4)*.01,b=Math.sqrt(.0729-x*x);u=m.bezier(x,b,.25,1)}return this._prevEase={start:m.browser.now(),duration:s,easing:u},u},Dn.prototype.reset=function(){this._active=!1};var on=function(s,u){this._clickZoom=s,this._tapZoom=u};on.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},on.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},on.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},on.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Cr=function(){this.reset()};Cr.prototype.reset=function(){this._active=!1},Cr.prototype.dblclick=function(s,u){return s.preventDefault(),{cameraAnimation:function(l){l.easeTo({duration:300,zoom:l.getZoom()+(s.shiftKey?-1:1),around:l.unproject(u)},{originalEvent:s})}}},Cr.prototype.enable=function(){this._enabled=!0},Cr.prototype.disable=function(){this._enabled=!1,this.reset()},Cr.prototype.isEnabled=function(){return this._enabled},Cr.prototype.isActive=function(){return this._active};var sr=function(){this._tap=new Ko({numTouches:1,numTaps:1}),this.reset()};sr.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},sr.prototype.touchstart=function(s,u,l){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?l.length>0&&(this._swipePoint=u[0],this._swipeTouch=l[0].identifier):this._tap.touchstart(s,u,l))},sr.prototype.touchmove=function(s,u,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;var h=u[0],_=h.y-this._swipePoint.y;return this._swipePoint=h,s.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(s,u,l)},sr.prototype.touchend=function(s,u,l){this._tapTime?this._swipePoint&&0===l.length&&this.reset():this._tap.touchend(s,u,l)&&(this._tapTime=s.timeStamp)},sr.prototype.touchcancel=function(){this.reset()},sr.prototype.enable=function(){this._enabled=!0},sr.prototype.disable=function(){this._enabled=!1,this.reset()},sr.prototype.isEnabled=function(){return this._enabled},sr.prototype.isActive=function(){return this._active};var lr=function(s,u,l){this._el=s,this._mousePan=u,this._touchPan=l};lr.prototype.enable=function(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")},lr.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")},lr.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},lr.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ss=function(s,u,l){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=u,this._mousePitch=l};ss.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ss.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ss.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ss.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var io=function(s,u,l,h){this._el=s,this._touchZoom=u,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};io.prototype.enable=function(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")},io.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")},io.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},io.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},io.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},io.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ro=function(s){return s.zoom||s.drag||s.pitch||s.rotate},Er=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(m.Event);function jr(s){return s.panDelta&&s.panDelta.mag()||s.zoomDelta||s.bearingDelta||s.pitchDelta}var Ke=function(s,u){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ql(s),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),m.bindAll(["handleEvent","handleWindowEvent"],this);var l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[m.window,"blur",void 0]];for(var h=0,_=this._listeners;h<_.length;h+=1){var x=_[h],b=x[0];Re.addEventListener(b,x[1],b===m.window.document?this.handleWindowEvent:this.handleEvent,x[2])}};Ke.prototype.destroy=function(){for(var s=0,u=this._listeners;s<u.length;s+=1){var l=u[s],h=l[0];Re.removeEventListener(h,l[1],h===m.window.document?this.handleWindowEvent:this.handleEvent,l[2])}},Ke.prototype._addDefaultHandlers=function(s){var u=this._map,l=u.getCanvasContainer();this._add("mapEvent",new wi(u,s));var h=u.boxZoom=new Je(u,s);this._add("boxZoom",h);var _=new Li,x=new Cr;u.doubleClickZoom=new on(x,_),this._add("tapZoom",_),this._add("clickZoom",x);var b=new sr;this._add("tapDragZoom",b);var S=u.touchPitch=new as;this._add("touchPitch",S);var k=new Qo(s),L=new ri(s);u.dragRotate=new ss(s,k,L),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);var j=new tt(s),H=new Gi(s);u.dragPan=new lr(l,j,H),this._add("mousePan",j),this._add("touchPan",H,["touchZoom","touchRotate"]);var q=new ar,ee=new Ju;u.touchZoomRotate=new io(l,ee,q,b),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]);var J=u.scrollZoom=new Dn(u,this);this._add("scrollZoom",J,["mousePan"]);var ae=u.keyboard=new wr;this._add("keyboard",ae),this._add("blockableMapEvent",new er(u));for(var Q=0,re=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Q<re.length;Q+=1){var pe=re[Q];s.interactive&&s[pe]&&u[pe].enable(s[pe])}},Ke.prototype._add=function(s,u,l){this._handlers.push({handlerName:s,handler:u,allowed:l}),this._handlersById[s]=u},Ke.prototype.stop=function(s){if(!this._updatingCamera){for(var u=0,l=this._handlers;u<l.length;u+=1)l[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}},Ke.prototype.isActive=function(){for(var s=0,u=this._handlers;s<u.length;s+=1)if(u[s].handler.isActive())return!0;return!1},Ke.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Ke.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Ke.prototype.isMoving=function(){return Boolean(ro(this._eventsInProgress))||this.isZooming()},Ke.prototype._blockedByActive=function(s,u,l){for(var h in s)if(h!==l&&(!u||u.indexOf(h)<0))return!0;return!1},Ke.prototype.handleWindowEvent=function(s){this.handleEvent(s,s.type+"Window")},Ke.prototype._getMapTouches=function(s){for(var u=[],l=0,h=s;l<h.length;l+=1){var _=h[l];this._el.contains(_.target)&&u.push(_)}return u},Ke.prototype.handleEvent=function(s,u){if("blur"!==s.type){this._updatingCamera=!0;for(var l="renderFrame"===s.type?void 0:s,h={needsRenderFrame:!1},_={},x={},b=s.touches?this._getMapTouches(s.touches):void 0,S=b?Re.touchPos(this._el,b):Re.mousePos(this._el,s),k=0,L=this._handlers;k<L.length;k+=1){var j=L[k],H=j.handlerName,q=j.handler,ee=j.allowed;if(q.isEnabled()){var J=void 0;this._blockedByActive(x,ee,H)?q.reset():q[u||s.type]&&(J=q[u||s.type](s,S,b),this.mergeHandlerResult(h,_,J,H,l),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||q.isActive())&&(x[H]=q)}}var ae={};for(var Q in this._previousActiveHandlers)x[Q]||(ae[Q]=l);this._previousActiveHandlers=x,(Object.keys(ae).length||jr(h))&&(this._changes.push([h,_,ae]),this._triggerRenderFrame()),(Object.keys(x).length||jr(h))&&this._map._stop(!0),this._updatingCamera=!1;var re=h.cameraAnimation;re&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],re(this._map))}else this.stop(!0)},Ke.prototype.mergeHandlerResult=function(s,u,l,h,_){if(l){m.extend(s,l);var x={handlerName:h,originalEvent:l.originalEvent||_};void 0!==l.zoomDelta&&(u.zoom=x),void 0!==l.panDelta&&(u.drag=x),void 0!==l.pitchDelta&&(u.pitch=x),void 0!==l.bearingDelta&&(u.rotate=x)}},Ke.prototype._applyChanges=function(){for(var s={},u={},l={},h=0,_=this._changes;h<_.length;h+=1){var x=_[h],b=x[0],S=x[1],k=x[2];b.panDelta&&(s.panDelta=(s.panDelta||new m.Point(0,0))._add(b.panDelta)),b.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+b.pitchDelta),void 0!==b.around&&(s.around=b.around),void 0!==b.pinchAround&&(s.pinchAround=b.pinchAround),b.noInertia&&(s.noInertia=b.noInertia),m.extend(u,S),m.extend(l,k)}this._updateMapTransform(s,u,l),this._changes=[]},Ke.prototype._updateMapTransform=function(s,u,l){var h=this._map,_=h.transform;if(!jr(s))return this._fireEvents(u,l,!0);var x=s.panDelta,b=s.zoomDelta,S=s.bearingDelta,k=s.pitchDelta,L=s.around,j=s.pinchAround;void 0!==j&&(L=j),h._stop(!0),L=L||h.transform.centerPoint;var H=_.pointLocation(x?L.sub(x):L);S&&(_.bearing+=S),k&&(_.pitch+=k),b&&(_.zoom+=b),_.setLocationAtPoint(H,L),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(u,l,!0)},Ke.prototype._fireEvents=function(s,u,l){var h=this,_=ro(this._eventsInProgress),x=ro(s),b={};for(var S in s)this._eventsInProgress[S]||(b[S+"start"]=s[S].originalEvent),this._eventsInProgress[S]=s[S];for(var k in!_&&x&&this._fireEvent("movestart",x.originalEvent),b)this._fireEvent(k,b[k]);for(var L in x&&this._fireEvent("move",x.originalEvent),s)this._fireEvent(L,s[L].originalEvent);var j,H={};for(var q in this._eventsInProgress){var ee=this._eventsInProgress[q],J=ee.handlerName,ae=ee.originalEvent;this._handlersById[J].isActive()||(delete this._eventsInProgress[q],H[q+"end"]=j=u[J]||ae)}for(var Q in H)this._fireEvent(Q,H[Q]);var re=ro(this._eventsInProgress);if(l&&(_||x)&&!re){this._updatingCamera=!0;var pe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),fe=function(Ce){return 0!==Ce&&-h._bearingSnap<Ce&&Ce<h._bearingSnap};pe?(fe(pe.bearing||this._map.getBearing())&&(pe.bearing=0),this._map.easeTo(pe,{originalEvent:j})):(this._map.fire(new m.Event("moveend",{originalEvent:j})),fe(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Ke.prototype._fireEvent=function(s,u){this._map.fire(new m.Event(s,u?{originalEvent:u}:{}))},Ke.prototype._requestFrame=function(){var s=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete s._frameId,s.handleEvent(new Er("renderFrame",{timeStamp:u})),s._applyChanges()})},Ke.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var bt=function(s){function u(l,h){s.call(this),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=h.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(l,h){return this.jumpTo({center:l},h)},u.prototype.panBy=function(l,h,_){return l=m.Point.convert(l).mult(-1),this.panTo(this.transform.center,m.extend({offset:l},h),_)},u.prototype.panTo=function(l,h,_){return this.easeTo(m.extend({center:l},h),_)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(l,h){return this.jumpTo({zoom:l},h),this},u.prototype.zoomTo=function(l,h,_){return this.easeTo(m.extend({zoom:l},h),_)},u.prototype.zoomIn=function(l,h){return this.zoomTo(this.getZoom()+1,l,h),this},u.prototype.zoomOut=function(l,h){return this.zoomTo(this.getZoom()-1,l,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(l,h){return this.jumpTo({bearing:l},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(l,h){return this.jumpTo({padding:l},h),this},u.prototype.rotateTo=function(l,h,_){return this.easeTo(m.extend({bearing:l},h),_)},u.prototype.resetNorth=function(l,h){return this.rotateTo(0,m.extend({duration:1e3},l),h),this},u.prototype.resetNorthPitch=function(l,h){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},l),h),this},u.prototype.snapToNorth=function(l,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(l,h){return this.jumpTo({pitch:l},h),this},u.prototype.cameraForBounds=function(l,h){l=m.LngLatBounds.convert(l);var _=h&&h.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),_,h)},u.prototype._cameraForBoxAndBearing=function(l,h,_,x){var b={top:0,bottom:0,right:0,left:0};if("number"==typeof(x=m.extend({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},x)).padding){var S=x.padding;x.padding={top:S,bottom:S,right:S,left:S}}x.padding=m.extend(b,x.padding);var k=this.transform,L=k.padding,j=k.project(m.LngLat.convert(l)),H=k.project(m.LngLat.convert(h)),q=j.rotate(-_*Math.PI/180),ee=H.rotate(-_*Math.PI/180),J=new m.Point(Math.max(q.x,ee.x),Math.max(q.y,ee.y)),ae=new m.Point(Math.min(q.x,ee.x),Math.min(q.y,ee.y)),Q=J.sub(ae),re=(k.width-(L.left+L.right+x.padding.left+x.padding.right))/Q.x,pe=(k.height-(L.top+L.bottom+x.padding.top+x.padding.bottom))/Q.y;if(!(pe<0||re<0)){var fe=Math.min(k.scaleZoom(k.scale*Math.min(re,pe)),x.maxZoom),Ce="number"==typeof x.offset.x?new m.Point(x.offset.x,x.offset.y):m.Point.convert(x.offset),xe=new m.Point((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(_*Math.PI/180),Ee=Ce.add(xe).mult(k.scale/k.zoomScale(fe));return{center:k.unproject(j.add(H).div(2).sub(Ee)),zoom:fe,bearing:_}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(l,h,_){return this._fitInternal(this.cameraForBounds(l,h),h,_)},u.prototype.fitScreenCoordinates=function(l,h,_,x,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(l)),this.transform.pointLocation(m.Point.convert(h)),_,x),x,b)},u.prototype._fitInternal=function(l,h,_){return l?(delete(h=m.extend(l,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this},u.prototype.jumpTo=function(l,h){this.stop();var _=this.transform,x=!1,b=!1,S=!1;return"zoom"in l&&_.zoom!==+l.zoom&&(x=!0,_.zoom=+l.zoom),void 0!==l.center&&(_.center=m.LngLat.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(b=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(S=!0,_.pitch=+l.pitch),null==l.padding||_.isPaddingEqual(l.padding)||(_.padding=l.padding),this.fire(new m.Event("movestart",h)).fire(new m.Event("move",h)),x&&this.fire(new m.Event("zoomstart",h)).fire(new m.Event("zoom",h)).fire(new m.Event("zoomend",h)),b&&this.fire(new m.Event("rotatestart",h)).fire(new m.Event("rotate",h)).fire(new m.Event("rotateend",h)),S&&this.fire(new m.Event("pitchstart",h)).fire(new m.Event("pitch",h)).fire(new m.Event("pitchend",h)),this.fire(new m.Event("moveend",h))},u.prototype.easeTo=function(l,h){var _=this;this._stop(!1,l.easeId),(!1===(l=m.extend({offset:[0,0],duration:500,easing:m.ease},l)).animate||!l.essential&&m.browser.prefersReducedMotion)&&(l.duration=0);var x=this.transform,b=this.getZoom(),S=this.getBearing(),k=this.getPitch(),L=this.getPadding(),j="zoom"in l?+l.zoom:b,H="bearing"in l?this._normalizeBearing(l.bearing,S):S,q="pitch"in l?+l.pitch:k,ee="padding"in l?l.padding:x.padding,J=m.Point.convert(l.offset),ae=x.centerPoint.add(J),Q=x.pointLocation(ae),re=m.LngLat.convert(l.center||Q);this._normalizeCenter(re);var pe,fe,Ce=x.project(Q),xe=x.project(re).sub(Ce),Ee=x.zoomScale(j-b);l.around&&(pe=m.LngLat.convert(l.around),fe=x.locationPoint(pe));var Ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||j!==b,this._rotating=this._rotating||S!==H,this._pitching=this._pitching||q!==k,this._padding=!x.isPaddingEqual(ee),this._easeId=l.easeId,this._prepareEase(h,l.noMoveStart,Ie),this._ease(function(Ue){if(_._zooming&&(x.zoom=m.number(b,j,Ue)),_._rotating&&(x.bearing=m.number(S,H,Ue)),_._pitching&&(x.pitch=m.number(k,q,Ue)),_._padding&&(x.interpolatePadding(L,ee,Ue),ae=x.centerPoint.add(J)),pe)x.setLocationAtPoint(pe,fe);else{var Be=x.zoomScale(x.zoom-b),Xe=j>b?Math.min(2,Ee):Math.max(.5,Ee),pt=Math.pow(Xe,1-Ue),mt=x.unproject(Ce.add(xe.mult(Ue*pt)).mult(Be));x.setLocationAtPoint(x.renderWorldCopies?mt.wrap():mt,ae)}_._fireMoveEvents(h)},function(Ue){_._afterEase(h,Ue)},l),this},u.prototype._prepareEase=function(l,h,_){void 0===_&&(_={}),this._moving=!0,h||_.moving||this.fire(new m.Event("movestart",l)),this._zooming&&!_.zooming&&this.fire(new m.Event("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new m.Event("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new m.Event("pitchstart",l))},u.prototype._fireMoveEvents=function(l){this.fire(new m.Event("move",l)),this._zooming&&this.fire(new m.Event("zoom",l)),this._rotating&&this.fire(new m.Event("rotate",l)),this._pitching&&this.fire(new m.Event("pitch",l))},u.prototype._afterEase=function(l,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var _=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new m.Event("zoomend",l)),x&&this.fire(new m.Event("rotateend",l)),b&&this.fire(new m.Event("pitchend",l)),this.fire(new m.Event("moveend",l))}},u.prototype.flyTo=function(l,h){var _=this;if(!l.essential&&m.browser.prefersReducedMotion){var x=m.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(x,h)}this.stop(),l=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},l);var b=this.transform,S=this.getZoom(),k=this.getBearing(),L=this.getPitch(),j=this.getPadding(),H="zoom"in l?m.clamp(+l.zoom,b.minZoom,b.maxZoom):S,q="bearing"in l?this._normalizeBearing(l.bearing,k):k,ee="pitch"in l?+l.pitch:L,J="padding"in l?l.padding:b.padding,ae=b.zoomScale(H-S),Q=m.Point.convert(l.offset),re=b.centerPoint.add(Q),pe=b.pointLocation(re),fe=m.LngLat.convert(l.center||pe);this._normalizeCenter(fe);var Ce=b.project(pe),xe=b.project(fe).sub(Ce),Ee=l.curve,Ie=Math.max(b.width,b.height),Ue=Ie/ae,Be=xe.mag();if("minZoom"in l){var Xe=m.clamp(Math.min(l.minZoom,S,H),b.minZoom,b.maxZoom),pt=Ie/b.zoomScale(Xe-S);Ee=Math.sqrt(pt/Be*2)}var mt=Ee*Ee;function dt(wt){var _t=(Ue*Ue-Ie*Ie+(wt?-1:1)*mt*mt*Be*Be)/(2*(wt?Ue:Ie)*mt*Be);return Math.log(Math.sqrt(_t*_t+1)-_t)}function Wt(wt){return(Math.exp(wt)-Math.exp(-wt))/2}function nt(wt){return(Math.exp(wt)+Math.exp(-wt))/2}var It=dt(0),Dt=function(wt){return nt(It)/nt(It+Ee*wt)},Mt=function(wt){return Ie*((nt(It)*(Wt(_t=It+Ee*wt)/nt(_t))-Wt(It))/mt)/Be;var _t},Et=(dt(1)-It)/Ee;if(Math.abs(Be)<1e-6||!isFinite(Et)){if(Math.abs(Ie-Ue)<1e-6)return this.easeTo(l,h);var Ct=Ue<Ie?-1:1;Et=Math.abs(Math.log(Ue/Ie))/Ee,Mt=function(){return 0},Dt=function(wt){return Math.exp(Ct*Ee*wt)}}return l.duration="duration"in l?+l.duration:1e3*Et/("screenSpeed"in l?+l.screenSpeed/Ee:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=k!==q,this._pitching=ee!==L,this._padding=!b.isPaddingEqual(J),this._prepareEase(h,!1),this._ease(function(wt){var _t=wt*Et,un=1/Dt(_t);b.zoom=1===wt?H:S+b.scaleZoom(un),_._rotating&&(b.bearing=m.number(k,q,wt)),_._pitching&&(b.pitch=m.number(L,ee,wt)),_._padding&&(b.interpolatePadding(j,J,wt),re=b.centerPoint.add(Q));var Gn=1===wt?fe:b.unproject(Ce.add(xe.mult(Mt(_t))).mult(un));b.setLocationAtPoint(b.renderWorldCopies?Gn.wrap():Gn,re),_._fireMoveEvents(h)},function(){return _._afterEase(h)},l),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(l,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,h)}if(!l){var x=this.handlers;x&&x.stop(!1)}return this},u.prototype._ease=function(l,h,_){!1===_.animate||0===_.duration?(l(1),h()):(this._easeStart=m.browser.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var l=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(l,h){l=m.wrap(l,-180,180);var _=Math.abs(l-h);return Math.abs(l-360-h)<_&&(l-=360),Math.abs(l+360-h)<_&&(l+=360),l},u.prototype._normalizeCenter=function(l){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var _=l.lng-h.center.lng;l.lng+=_>180?-360:_<-180?360:0}},u}(m.Evented),ur=function(s){void 0===s&&(s={}),this.options=s,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ur.prototype.getDefaultPosition=function(){return"bottom-right"},ur.prototype.onAdd=function(s){var u=this.options&&this.options.compact;return this._map=s,this._container=Re.create("div","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Re.create("button","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.type="button",this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Re.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("maplibregl-compact","mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ur.prototype.onRemove=function(){Re.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ur.prototype._setElementTitle=function(s,u){var l=this._map._getUIString("AttributionControl."+u);s.title=l,s.setAttribute("aria-label",l)},ur.prototype._toggleAttribution=function(){this._container.classList.contains("maplibregl-compact-show")||this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ur.prototype._updateEditLink=function(){var s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(s){var l=u.reduce(function(h,_,x){return _.value&&(h+=_.key+"="+_.value+(x<u.length-1?"&":"")),h},"?");s.href=m.config.FEEDBACK_URL+"/"+l+(this._map._hash?this._map._hash.getHashString(!0):""),s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}},ur.prototype._updateData=function(s){!s||"metadata"!==s.sourceDataType&&"visibility"!==s.sourceDataType&&"style"!==s.dataType||(this._updateAttributions(),this._updateEditLink())},ur.prototype._updateAttributions=function(){if(this._map.style){var s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(function(S){return"string"!=typeof S?"":S})):"string"==typeof this.options.customAttribution&&s.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var l=this._map.style.sourceCaches;for(var h in l){var _=l[h];if(_.used){var x=_.getSource();x.attribution&&s.indexOf(x.attribution)<0&&s.push(x.attribution)}}s.sort(function(S,k){return S.length-k.length});var b=(s=s.filter(function(S,k){for(var L=k+1;L<s.length;L++)if(s[L].indexOf(S)>=0)return!1;return!0})).join(" | ");b!==this._attribHTML&&(this._attribHTML=b,s.length?(this._innerContainer.innerHTML=b,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._editLink=null)}},ur.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("maplibregl-compact","mapboxgl-compact"):this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show")};var Sr=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};Sr.prototype.onAdd=function(s){this._map=s,this._container=Re.create("div","maplibregl-ctrl mapboxgl-ctrl");var u=Re.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Sr.prototype.onRemove=function(){Re.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Sr.prototype.getDefaultPosition=function(){return"bottom-left"},Sr.prototype._updateLogo=function(s){s&&"metadata"!==s.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},Sr.prototype._logoRequired=function(){if(this._map.style){var s=this._map.style.sourceCaches;for(var u in s)if(s[u].getSource().mapbox_logo)return!0;return!1}},Sr.prototype._updateCompact=function(){var s=this._container.children;if(s.length){var u=s[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("maplibregl-compact","mapboxgl-compact"):u.classList.remove("maplibregl-compact","mapboxgl-compact")}};var Tr=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Tr.prototype.add=function(s){var u=++this._id;return this._queue.push({callback:s,id:u,cancelled:!1}),u},Tr.prototype.remove=function(s){for(var u=this._currentlyRunning,l=0,h=u?this._queue.concat(u):this._queue;l<h.length;l+=1){var _=h[l];if(_.id===s)return void(_.cancelled=!0)}},Tr.prototype.run=function(s){void 0===s&&(s=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var l=0,h=u;l<h.length;l+=1){var _=h[l];if(!_.cancelled&&(_.callback(s),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Tr.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var nr={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ir=m.window.HTMLImageElement,gp=m.window.HTMLElement,To=m.window.ImageBitmap,Sn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Ci=function(s){function u(h){var _=this;if(null!=(h=m.extend({},Sn,h)).minZoom&&null!=h.maxZoom&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=h.minPitch&&null!=h.maxPitch&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=h.minPitch&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=h.maxPitch&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var x=new rn(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(s.call(this,x,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Tr,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},nr,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new m.RequestManager(h.transformRequest,h.accessToken),"string"==typeof h.container){if(this._container=m.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof gp))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return _._update(!1)}),this.on("moveend",function(){return _._update(!1)}),this.on("zoom",function(){return _._update(!0)}),void 0!==m.window&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Ke(this,h),this._hash=h.hash&&new Eo("string"==typeof h.hash&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,m.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new ur({customAttribution:h.customAttribution})),this.addControl(new Sr,h.logoPosition),this.on("style.load",function(){_.transform.unmodified&&_.jumpTo(_.style.stylesheet)}),this.on("data",function(b){_._update("style"===b.dataType),_.fire(new m.Event(b.dataType+"data",b))}),this.on("dataloading",function(b){_.fire(new m.Event(b.dataType+"dataloading",b))})}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var l={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,_){if(void 0===_&&(_=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var x=h.onAdd(this);this._controls.push(h);var b=this._controlPositions[_];return-1!==_.indexOf("bottom")?b.insertBefore(x,b.firstChild):b.appendChild(x),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var _=this._controls.indexOf(h);return _>-1&&this._controls.splice(_,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var _=this._containerDimensions(),x=_[0],b=_[1];this._resizeCanvas(x,b),this.transform.resize(x,b),this.painter.resize(x,b);var S=!this._moving;return S&&(this.stop(),this.fire(new m.Event("movestart",h)).fire(new m.Event("move",h))),this.fire(new m.Event("resize",h)),S&&this.fire(new m.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(m.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=null==h?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=null==h?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=null==h?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=null==h?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(m.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(m.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,_,x){var b,S=this;if("mouseenter"===h||"mouseover"===h){var k=!1;return{layer:_,listener:x,delegates:{mousemove:function(j){var H=S.getLayer(_)?S.queryRenderedFeatures(j.point,{layers:[_]}):[];H.length?k||(k=!0,x.call(S,new zi(h,S,j.originalEvent,{features:H}))):k=!1},mouseout:function(){k=!1}}}}if("mouseleave"===h||"mouseout"===h){var L=!1;return{layer:_,listener:x,delegates:{mousemove:function(j){(S.getLayer(_)?S.queryRenderedFeatures(j.point,{layers:[_]}):[]).length?L=!0:L&&(L=!1,x.call(S,new zi(h,S,j.originalEvent)))},mouseout:function(j){L&&(L=!1,x.call(S,new zi(h,S,j.originalEvent)))}}}}return{layer:_,listener:x,delegates:(b={},b[h]=function(j){var H=S.getLayer(_)?S.queryRenderedFeatures(j.point,{layers:[_]}):[];H.length&&(j.features=H,x.call(S,j),delete j.features)},b)}},u.prototype.on=function(h,_,x){if(void 0===x)return s.prototype.on.call(this,h,_);var b=this._createDelegatedListener(h,_,x);for(var S in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(b),b.delegates)this.on(S,b.delegates[S]);return this},u.prototype.once=function(h,_,x){if(void 0===x)return s.prototype.once.call(this,h,_);var b=this._createDelegatedListener(h,_,x);for(var S in b.delegates)this.once(S,b.delegates[S]);return this},u.prototype.off=function(h,_,x){var b=this;return void 0===x?s.prototype.off.call(this,h,_):(this._delegatedListeners&&this._delegatedListeners[h]&&function(S){for(var k=S[h],L=0;L<k.length;L++){var j=k[L];if(j.layer===_&&j.listener===x){for(var H in j.delegates)b.off(H,j.delegates[H]);return k.splice(L,1),b}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,_){if(!this.style)return[];var x;if(void 0!==_||void 0===h||h instanceof m.Point||Array.isArray(h)||(_=h,h=void 0),_=_||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||"number"==typeof h[0])x=[m.Point.convert(h)];else{var b=m.Point.convert(h[0]),S=m.Point.convert(h[1]);x=[b,new m.Point(S.x,b.y),S,new m.Point(b.x,S.y),b]}return this.style.queryRenderedFeatures(x,_,this.transform)},u.prototype.querySourceFeatures=function(h,_){return this.style.querySourceFeatures(h,_)},u.prototype.setStyle=function(h,_){return!1!==(_=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},_)).diff&&_.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,_),this):(this._localIdeographFontFamily=_.localIdeographFontFamily,this._updateStyle(h,_))},u.prototype.setTransformRequest=function(h){return this._requestManager.setTransformRequest(h),this},u.prototype._getUIString=function(h){var _=this._locale[h];if(null==_)throw new Error("Missing UI string '"+h+"'");return _},u.prototype._updateStyle=function(h,_){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new bo(this,_||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof h?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new bo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,_){var x=this;if("string"==typeof h){var b=this._requestManager.normalizeStyleURL(h),S=this._requestManager.transformRequest(b,m.ResourceType.Style);m.getJSON(S,function(k,L){k?x.fire(new m.ErrorEvent(k)):L&&x._updateDiff(L,_)})}else"object"==typeof h&&this._updateDiff(h,_)},u.prototype._updateDiff=function(h,_){try{this.style.setState(h)&&this._update(!0)}catch(x){m.warnOnce("Unable to perform style diff: "+(x.message||x.error||x)+".  Rebuilding the style from scratch."),this._updateStyle(h,_)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,_){return this._lazyInitEmptyStyle(),this.style.addSource(h,_),this._update(!0)},u.prototype.isSourceLoaded=function(h){var _=this.style&&this.style.sourceCaches[h];if(void 0!==_)return _.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var _ in h){var x=h[_]._tiles;for(var b in x){var S=x[b];if("loaded"!==S.state&&"errored"!==S.state)return!1}}return!0},u.prototype.addSourceType=function(h,_,x){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,_,x)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,_,x){void 0===x&&(x={});var b=x.pixelRatio;void 0===b&&(b=1);var S=x.sdf;void 0===S&&(S=!1);var k=x.stretchX,L=x.stretchY,j=x.content;if(this._lazyInitEmptyStyle(),_ instanceof Ir||To&&_ instanceof To){var H=m.browser.getImageData(_);this.style.addImage(h,{data:new m.RGBAImage({width:H.width,height:H.height},H.data),pixelRatio:b,stretchX:k,stretchY:L,content:j,sdf:S,version:0})}else{if(void 0===_.width||void 0===_.height)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var q=_;this.style.addImage(h,{data:new m.RGBAImage({width:_.width,height:_.height},new Uint8Array(_.data)),pixelRatio:b,stretchX:k,stretchY:L,content:j,sdf:S,version:0,userImage:q}),q.onAdd&&q.onAdd(this,h)}},u.prototype.updateImage=function(h,_){var x=this.style.getImage(h);if(!x)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var b=_ instanceof Ir||To&&_ instanceof To?m.browser.getImageData(_):_,S=b.width,k=b.height,L=b.data;return void 0===S||void 0===k?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):S!==x.data.width||k!==x.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(x.data.replace(L,!(_ instanceof Ir||To&&_ instanceof To)),void this.style.updateImage(h,x))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,_){m.getImage(this._requestManager.transformRequest(h,m.ResourceType.Image),_)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,_){return this._lazyInitEmptyStyle(),this.style.addLayer(h,_),this._update(!0)},u.prototype.moveLayer=function(h,_){return this.style.moveLayer(h,_),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,_,x){return this.style.setLayerZoomRange(h,_,x),this._update(!0)},u.prototype.setFilter=function(h,_,x){return void 0===x&&(x={}),this.style.setFilter(h,_,x),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,_,x,b){return void 0===b&&(b={}),this.style.setPaintProperty(h,_,x,b),this._update(!0)},u.prototype.getPaintProperty=function(h,_){return this.style.getPaintProperty(h,_)},u.prototype.setLayoutProperty=function(h,_,x,b){return void 0===b&&(b={}),this.style.setLayoutProperty(h,_,x,b),this._update(!0)},u.prototype.getLayoutProperty=function(h,_){return this.style.getLayoutProperty(h,_)},u.prototype.setLight=function(h,_){return void 0===_&&(_={}),this._lazyInitEmptyStyle(),this.style.setLight(h,_),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,_){return this.style.setFeatureState(h,_),this._update()},u.prototype.removeFeatureState=function(h,_){return this.style.removeFeatureState(h,_),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,_=0;return this._container&&(h=this._container.clientWidth||400,_=this._container.clientHeight||300),[h,_]},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("maplibregl-map","mapboxgl-map");var _=this._canvasContainer=Re.create("div","maplibregl-canvas-container mapboxgl-canvas-container",h);this._interactive&&_.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=Re.create("canvas","maplibregl-canvas mapboxgl-canvas",_),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var x=this._containerDimensions();this._resizeCanvas(x[0],x[1]);var b=this._controlContainer=Re.create("div","maplibregl-control-container mapboxgl-control-container",h),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(k){S[k]=Re.create("div","maplibregl-ctrl-"+k+" mapboxgl-ctrl-"+k,b)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,_){var x=m.browser.devicePixelRatio||1;this._canvas.width=x*h,this._canvas.height=x*_,this._canvas.style.width=h+"px",this._canvas.style.height=_+"px"},u.prototype._setupPainter=function(){var h=m.extend({},Xi.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),_=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);_?(this.painter=new an(_,this.transform),m.webpSupported.testSupport(_)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var _,x=this,b=0,S=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(_=S.createQueryEXT(),S.beginQueryEXT(S.TIME_ELAPSED_EXT,_),b=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var k=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var L=this.transform.zoom,j=m.browser.now();this.style.zoomHistory.update(L,j);var H=new m.EvaluationParameters(L,{now:j,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),q=H.crossFadingFactor();1===q&&q===this._crossFadingFactor||(k=!0,this._crossFadingFactor=q),this.style.update(H)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||k)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var ee=m.browser.now()-b;S.endQueryEXT(S.TIME_ELAPSED_EXT,_),setTimeout(function(){var Q=S.getQueryObjectEXT(_,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(_),x.fire(new m.Event("gpu-timing-frame",{cpuTime:ee,gpuTime:Q}))},50)}if(this.listens("gpu-timing-layer")){var J=this.painter.collectGpuTimers();setTimeout(function(){var Q=x.painter.queryGpuTimers(J);x.fire(new m.Event("gpu-timing-layer",{layerTimes:Q}))},50)}var ae=this._sourcesDirty||this._styleDirty||this._placementDirty;return ae||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||ae||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,_=this._controls;h<_.length;h+=1)_[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==m.window&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var x=this.painter.context.gl.getExtension("WEBGL_lose_context");x&&x.loseContext(),ec(this._canvasContainer),ec(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(_){h._frame=null,h._render(_)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},l.showTileBoundaries.get=function(){return!!this._showTileBoundaries},l.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},l.showPadding.get=function(){return!!this._showPadding},l.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},l.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},l.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},l.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},l.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},l.repaint.get=function(){return!!this._repaint},l.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},l.vertices.get=function(){return!!this._vertices},l.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,_){m.setCacheLimits(h,_)},l.version.get=function(){return m.version},Object.defineProperties(u.prototype,l),u}(bt);function ec(s){s.parentNode&&s.parentNode.removeChild(s)}var Ma={showCompass:!0,showZoom:!0,visualizePitch:!1},cr=function(s){var u=this;this.options=m.extend({},Ma,s),this._container=Re.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(l){return l.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",function(l){return u._map.zoomIn({},{originalEvent:l})}),Re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",function(l){return u._map.zoomOut({},{originalEvent:l})}),Re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",function(l){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:l}):u._map.resetNorth({},{originalEvent:l})}),this._compassIcon=Re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};cr.prototype._updateZoomButtons=function(){var s=this._map.getZoom(),u=s===this._map.getMaxZoom(),l=s===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},cr.prototype._rotateCompassArrow=function(){var s=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=s},cr.prototype.onAdd=function(s){return this._map=s,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new si(this._map,this._compass,this.options.visualizePitch)),this._container},cr.prototype.onRemove=function(){Re.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},cr.prototype._createButton=function(s,u){var l=Re.create("button",s,this._container);return l.type="button",l.addEventListener("click",u),l},cr.prototype._setButtonTitle=function(s,u){var l=this._map._getUIString("NavigationControl."+u);s.title=l,s.setAttribute("aria-label",l)};var si=function(s,u,l){void 0===l&&(l=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new Qo({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,l&&(this.mousePitch=new ri({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Re.addEventListener(u,"mousedown",this.mousedown),Re.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),Re.addEventListener(u,"touchmove",this.touchmove),Re.addEventListener(u,"touchend",this.touchend),Re.addEventListener(u,"touchcancel",this.reset)};function Zl(s,u,l){if(s=new m.LngLat(s.lng,s.lat),u){var h=new m.LngLat(s.lng-360,s.lat),_=new m.LngLat(s.lng+360,s.lat),x=l.locationPoint(s).distSqr(u);l.locationPoint(h).distSqr(u)<x?s=h:l.locationPoint(_).distSqr(u)<x&&(s=_)}for(;Math.abs(s.lng-l.center.lng)>180;){var b=l.locationPoint(s);if(b.x>=0&&b.y>=0&&b.x<=l.width&&b.y<=l.height)break;s.lng>l.center.lng?s.lng-=360:s.lng+=360}return s}si.prototype.down=function(s,u){this.mouseRotate.mousedown(s,u),this.mousePitch&&this.mousePitch.mousedown(s,u),Re.disableDrag()},si.prototype.move=function(s,u){var l=this.map,h=this.mouseRotate.mousemoveWindow(s,u);if(h&&h.bearingDelta&&l.setBearing(l.getBearing()+h.bearingDelta),this.mousePitch){var _=this.mousePitch.mousemoveWindow(s,u);_&&_.pitchDelta&&l.setPitch(l.getPitch()+_.pitchDelta)}},si.prototype.off=function(){var s=this.element;Re.removeEventListener(s,"mousedown",this.mousedown),Re.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),Re.removeEventListener(s,"touchmove",this.touchmove),Re.removeEventListener(s,"touchend",this.touchend),Re.removeEventListener(s,"touchcancel",this.reset),this.offTemp()},si.prototype.offTemp=function(){Re.enableDrag(),Re.removeEventListener(m.window,"mousemove",this.mousemove),Re.removeEventListener(m.window,"mouseup",this.mouseup)},si.prototype.mousedown=function(s){this.down(m.extend({},s,{ctrlKey:!0,preventDefault:function(){return s.preventDefault()}}),Re.mousePos(this.element,s)),Re.addEventListener(m.window,"mousemove",this.mousemove),Re.addEventListener(m.window,"mouseup",this.mouseup)},si.prototype.mousemove=function(s){this.move(s,Re.mousePos(this.element,s))},si.prototype.mouseup=function(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()},si.prototype.touchstart=function(s){1!==s.targetTouches.length?this.reset():(this._startPos=this._lastPos=Re.touchPos(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return s.preventDefault()}},this._startPos))},si.prototype.touchmove=function(s){1!==s.targetTouches.length?this.reset():(this._lastPos=Re.touchPos(this.element,s.targetTouches)[0],this.move({preventDefault:function(){return s.preventDefault()}},this._lastPos))},si.prototype.touchend=function(s){0===s.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},si.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Aa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Io(s,u,l){var h=s.classList;for(var _ in Aa)h.remove("maplibregl-"+l+"-anchor-"+_,"mapboxgl-"+l+"-anchor-"+_);h.add("maplibregl-"+l+"-anchor-"+u,"mapboxgl-"+l+"-anchor-"+u)}var ls,Pa=function(s){function u(l,h){if(s.call(this),(l instanceof m.window.HTMLElement||h)&&(l=m.extend({element:l},h)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&"auto"!==l.pitchAlignment?l.pitchAlignment:this._rotationAlignment,l&&l.element)this._element=l.element,this._offset=m.Point.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=Re.create("div"),this._element.setAttribute("aria-label","Map marker");var _=Re.createNS("http://www.w3.org/2000/svg","svg");_.setAttributeNS(null,"display","block"),_.setAttributeNS(null,"height","41px"),_.setAttributeNS(null,"width","27px"),_.setAttributeNS(null,"viewBox","0 0 27 41");var x=Re.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");var b=Re.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");var S=Re.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");for(var k=0,L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];k<L.length;k+=1){var j=L[k],H=Re.createNS("http://www.w3.org/2000/svg","ellipse");H.setAttributeNS(null,"opacity","0.04"),H.setAttributeNS(null,"cx","10.5"),H.setAttributeNS(null,"cy","5.80029008"),H.setAttributeNS(null,"rx",j.rx),H.setAttributeNS(null,"ry",j.ry),S.appendChild(H)}var q=Re.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"fill",this._color);var ee=Re.createNS("http://www.w3.org/2000/svg","path");ee.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),q.appendChild(ee);var J=Re.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"fill","#000000");var ae=Re.createNS("http://www.w3.org/2000/svg","path");ae.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),J.appendChild(ae);var Q=Re.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Q.setAttributeNS(null,"fill","#FFFFFF");var re=Re.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"transform","translate(8.0, 8.0)");var pe=Re.createNS("http://www.w3.org/2000/svg","circle");pe.setAttributeNS(null,"fill","#000000"),pe.setAttributeNS(null,"opacity","0.25"),pe.setAttributeNS(null,"cx","5.5"),pe.setAttributeNS(null,"cy","5.5"),pe.setAttributeNS(null,"r","5.4999962");var fe=Re.createNS("http://www.w3.org/2000/svg","circle");fe.setAttributeNS(null,"fill","#FFFFFF"),fe.setAttributeNS(null,"cx","5.5"),fe.setAttributeNS(null,"cy","5.5"),fe.setAttributeNS(null,"r","5.4999962"),re.appendChild(pe),re.appendChild(fe),b.appendChild(S),b.appendChild(q),b.appendChild(J),b.appendChild(Q),b.appendChild(re),_.appendChild(b),_.setAttributeNS(null,"height",41*this._scale+"px"),_.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(_),this._offset=m.Point.convert(l&&l.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ce){Ce.preventDefault()}),this._element.addEventListener("mousedown",function(Ce){Ce.preventDefault()}),Io(this._element,this._anchor,"marker"),this._popup=null}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.addTo=function(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Re.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(l){return this._lngLat=m.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=l,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(l){var h=l.code,_=l.charCode||l.keyCode;"Space"!==h&&"Enter"!==h&&32!==_&&13!==_||this.togglePopup()},u.prototype._onMapClick=function(l){var h=l.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var l=this._popup;return l?(l.isOpen()?l.remove():l.addTo(this._map),this):this},u.prototype._update=function(l){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Zl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?h="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var _="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?_="rotateX(0deg)":"map"===this._pitchAlignment&&(_="rotateX("+this._map.getPitch()+"deg)"),l&&"moveend"!==l.type||(this._pos=this._pos.round()),Re.setTransform(this._element,Aa[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+_+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(l){return this._offset=m.Point.convert(l),this._update(),this},u.prototype._onMove=function(l){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new m.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(l){this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._offset),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(l){return this._rotation=l||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(l){return this._rotationAlignment=l||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(l){return this._pitchAlignment=l&&"auto"!==l?l:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(m.Evented),pn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},us=0,Jo=!1,tc=function(s){function u(l){s.call(this),this.options=m.extend({},pn,l),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.onAdd=function(l){var h;return this._map=l,this._container=Re.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,void 0!==ls?h(ls):void 0!==m.window.navigator.permissions?m.window.navigator.permissions.query({name:"geolocation"}).then(function(_){h(ls="denied"!==_.state)}):h(ls=!!m.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Re.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,us=0,Jo=!1},u.prototype._isOutOfMapMaxBounds=function(l){var h=this._map.getMaxBounds(),_=l.coords;return h&&(_.longitude<h.getWest()||_.longitude>h.getEast()||_.latitude<h.getSouth()||_.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(l),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",l)),this._finish()}},u.prototype._updateCamera=function(l){var h=new m.LngLat(l.coords.longitude,l.coords.latitude),_=l.coords.accuracy,x=this._map.getBearing(),b=m.extend({bearing:x},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(_),b,{geolocateSource:!0})},u.prototype._updateMarker=function(l){if(l){var h=new m.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var l=this._map._container.clientHeight/2,h=this._map.unproject([0,l]),_=this._map.unproject([1,l]),x=h.distanceTo(_),b=Math.ceil(2*this._accuracy/x);this._circleElement.style.width=b+"px",this._circleElement.style.height=b+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(l){if(this._map){if(this.options.trackUserLocation)if(1===l.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===l.code&&Jo)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",l)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(l){var h=this;if(this._container.addEventListener("contextmenu",function(b){return b.preventDefault()}),this._geolocateButton=Re.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),Re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===l){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var _=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=_,this._geolocateButton.setAttribute("aria-label",_)}else{var x=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Re.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Pa(this._dotElement),this._circleElement=Re.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(b){b.geolocateSource||"ACTIVE_LOCK"!==h._watchState||b.originalEvent&&"resize"===b.originalEvent.type||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),h.fire(new m.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":us--,Jo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var l;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++us>1?(l={maximumAge:6e5,timeout:0},Jo=!0):(l=this.options.positionOptions,Jo=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,l)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(m.Evented),nc={maxWidth:100,unit:"metric"},ir=function(s){this.options=m.extend({},nc,s),m.bindAll(["_onMove","setUnit"],this)};function ic(s,u,l){var h=l&&l.maxWidth||100,_=s._container.clientHeight/2,x=s.unproject([0,_]),b=s.unproject([h,_]),S=x.distanceTo(b);if(l&&"imperial"===l.unit){var k=3.2808*S;k>5280?cs(u,h,k/5280,s._getUIString("ScaleControl.Miles")):cs(u,h,k,s._getUIString("ScaleControl.Feet"))}else l&&"nautical"===l.unit?cs(u,h,S/1852,s._getUIString("ScaleControl.NauticalMiles")):S>=1e3?cs(u,h,S/1e3,s._getUIString("ScaleControl.Kilometers")):cs(u,h,S,s._getUIString("ScaleControl.Meters"))}function cs(s,u,l,h){var _,x,b,k,L,S=(_=l,(x=Math.pow(10,(""+Math.floor(_)).length-1))*(b=(b=_/x)>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:(k=b,L=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10)),Math.round(k*L)/L)));s.style.width=u*(S/l)+"px",s.innerHTML=S+"&nbsp;"+h}ir.prototype.getDefaultPosition=function(){return"bottom-left"},ir.prototype._onMove=function(){ic(this._map,this._container,this.options)},ir.prototype.onAdd=function(s){return this._map=s,this._container=Re.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",s.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},ir.prototype.onRemove=function(){Re.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},ir.prototype.setUnit=function(s){this.options.unit=s,ic(this._map,this._container,this.options)};var hr=function(s){this._fullscreen=!1,s&&s.container&&(s.container instanceof m.window.HTMLElement?this._container=s.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};hr.prototype.onAdd=function(s){return this._map=s,this._container||(this._container=this._map.getContainer()),this._controlContainer=Re.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},hr.prototype.onRemove=function(){Re.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},hr.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},hr.prototype._setupUI=function(){var s=this._fullscreenButton=Re.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);Re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",s).setAttribute("aria-hidden",!0),s.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},hr.prototype._updateTitle=function(){var s=this._getTitle();this._fullscreenButton.setAttribute("aria-label",s),this._fullscreenButton.title=s},hr.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},hr.prototype._isFullscreen=function(){return this._fullscreen},hr.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},hr.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Xl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Yl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Xs=function(s){function u(l){s.call(this),this.options=m.extend(Object.create(Xl),l),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.addTo=function(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&Re.remove(this._content),this._container&&(Re.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(l){return this._lngLat=m.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(l){return this.setDOMContent(m.window.document.createTextNode(l))},u.prototype.setHTML=function(l){var h,_=m.window.document.createDocumentFragment(),x=m.window.document.createElement("body");for(x.innerHTML=l;h=x.firstChild;)_.appendChild(h);return this.setDOMContent(_)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(l){return this.options.maxWidth=l,this._update(),this},u.prototype.setDOMContent=function(l){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Re.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(l),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(l){this._container&&this._container.classList.add(l)},u.prototype.removeClassName=function(l){this._container&&this._container.classList.remove(l)},u.prototype.setOffset=function(l){return this.options.offset=l,this._update(),this},u.prototype.toggleClassName=function(l){if(this._container)return this._container.classList.toggle(l)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Re.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(l){this._update(l.point)},u.prototype._onMouseMove=function(l){this._update(l.point)},u.prototype._onDrag=function(l){this._update(l.point)},u.prototype._update=function(l){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Re.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=Re.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(H){return h._container.classList.add(H)}),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||l)){var _=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat),x=this.options.anchor,b=function H(q){if(q){if("number"==typeof q){var ee=Math.round(Math.sqrt(.5*Math.pow(q,2)));return{center:new m.Point(0,0),top:new m.Point(0,q),"top-left":new m.Point(ee,ee),"top-right":new m.Point(-ee,ee),bottom:new m.Point(0,-q),"bottom-left":new m.Point(ee,-ee),"bottom-right":new m.Point(-ee,-ee),left:new m.Point(q,0),right:new m.Point(-q,0)}}if(q instanceof m.Point||Array.isArray(q)){var J=m.Point.convert(q);return{center:J,top:J,"top-left":J,"top-right":J,bottom:J,"bottom-left":J,"bottom-right":J,left:J,right:J}}return{center:m.Point.convert(q.center||[0,0]),top:m.Point.convert(q.top||[0,0]),"top-left":m.Point.convert(q["top-left"]||[0,0]),"top-right":m.Point.convert(q["top-right"]||[0,0]),bottom:m.Point.convert(q.bottom||[0,0]),"bottom-left":m.Point.convert(q["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(q["bottom-right"]||[0,0]),left:m.Point.convert(q.left||[0,0]),right:m.Point.convert(q.right||[0,0])}}return H(new m.Point(0,0))}(this.options.offset);if(!x){var S,k=this._container.offsetWidth,L=this._container.offsetHeight;S=_.y+b.bottom.y<L?["top"]:_.y>this._map.transform.height-L?["bottom"]:[],_.x<k/2?S.push("left"):_.x>this._map.transform.width-k/2&&S.push("right"),x=0===S.length?"bottom":S.join("-")}var j=_.add(b[x]).round();Re.setTransform(this._container,Aa[x]+" translate("+j.x+"px,"+j.y+"px)"),Io(this._container,x,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var l=this._container.querySelector(Yl);l&&l.focus()}},u.prototype._onClose=function(){this.remove()},u}(m.Evented),Kl={version:m.version,supported:Xi,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:Ci,NavigationControl:cr,GeolocateControl:tc,AttributionControl:ur,ScaleControl:ir,FullscreenControl:hr,Popup:Xs,Marker:Pa,Style:bo,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){ut().acquire(ye)},clearPrewarmedResources:function(){var s=et;s&&(s.isPreloaded()&&1===s.numActive()?(s.release(ye),et=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(s){m.config.ACCESS_TOKEN=s},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(s){m.config.API_URL=s},get workerCount(){return Ne.workerCount},set workerCount(s){Ne.workerCount=s},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(s){m.config.MAX_PARALLEL_IMAGE_REQUESTS=s},clearStorage:function(s){m.clearTileCache(s)},workerUrl:"",addProtocol:function(s,u){m.config.REGISTERED_PROTOCOLS[s]=u},removeProtocol:function(s){delete m.config.REGISTERED_PROTOCOLS[s]}};return Kl}),Ti}()},1644:(zo,Si,Vt)=>{"use strict";Vt.r(Si),Vt.d(Si,{HomePageModule:()=>cy});var Ti=Vt(6019),Dr=Vt(3375),m=Vt(9133),Xi=Vt(3989),Re=Vt(4762),jn=Vt(5320),yt=Vt(3132),Or=Vt.n(yt);function at(n){return null!==n&&"object"==typeof n&&"constructor"in n&&n.constructor===Object}function Ms(n={},i={}){Object.keys(i).forEach(t=>{void 0===n[t]?n[t]=i[t]:at(i[t])&&at(n[t])&&Object.keys(i[t]).length>0&&Ms(n[t],i[t])})}const or={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector:()=>null,querySelectorAll:()=>[],getElementById:()=>null,createEvent:()=>({initEvent(){}}),createElement:()=>({children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName:()=>[]}),createElementNS:()=>({}),importNode:()=>null,location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function di(){const n="undefined"!=typeof document?document:{};return Ms(n,or),n}const Yi={document:or,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle:()=>({getPropertyValue:()=>""}),Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia:()=>({}),requestAnimationFrame:n=>"undefined"==typeof setTimeout?(n(),null):setTimeout(n,0),cancelAnimationFrame(n){"undefined"!=typeof setTimeout&&clearTimeout(n)}};function Qn(){const n="undefined"!=typeof window?window:{};return Ms(n,Yi),n}class zr extends Array{constructor(i){"number"==typeof i?super(i):(super(...i||[]),function(n){const i=n.__proto__;Object.defineProperty(n,"__proto__",{get:()=>i,set(t){i.__proto__=t}})}(this))}}function Yr(n=[]){const i=[];return n.forEach(t=>{Array.isArray(t)?i.push(...Yr(t)):i.push(t)}),i}function Kr(n,i){return Array.prototype.filter.call(n,i)}function xt(n,i){const t=Qn(),o=di();let p=[];if(!i&&n instanceof zr)return n;if(!n)return new zr(p);if("string"==typeof n){const f=n.trim();if(f.indexOf("<")>=0&&f.indexOf(">")>=0){let y="div";0===f.indexOf("<li")&&(y="ul"),0===f.indexOf("<tr")&&(y="tbody"),(0===f.indexOf("<td")||0===f.indexOf("<th"))&&(y="tr"),0===f.indexOf("<tbody")&&(y="table"),0===f.indexOf("<option")&&(y="select");const C=o.createElement(y);C.innerHTML=f;for(let E=0;E<C.childNodes.length;E+=1)p.push(C.childNodes[E])}else p=function(n,i){if("string"!=typeof n)return[n];const t=[],o=i.querySelectorAll(n);for(let p=0;p<o.length;p+=1)t.push(o[p]);return t}(n.trim(),i||o)}else if(n.nodeType||n===t||n===o)p.push(n);else if(Array.isArray(n)){if(n instanceof zr)return n;p=n}return new zr(function(n){const i=[];for(let t=0;t<n.length;t+=1)-1===i.indexOf(n[t])&&i.push(n[t]);return i}(p))}xt.fn=zr.prototype;const ce="resize scroll".split(" ");function he(n){return function(...t){if(void 0===t[0]){for(let o=0;o<this.length;o+=1)ce.indexOf(n)<0&&(n in this[o]?this[o][n]():xt(this[o]).trigger(n));return this}return this.on(n,...t)}}he("click"),he("blur"),he("focus"),he("focusin"),he("focusout"),he("keyup"),he("keydown"),he("keypress"),he("submit"),he("change"),he("mousedown"),he("mousemove"),he("mouseup"),he("mouseenter"),he("mouseleave"),he("mouseout"),he("mouseover"),he("touchstart"),he("touchend"),he("touchmove"),he("resize"),he("scroll");const ln={addClass:function(...n){const i=Yr(n.map(t=>t.split(" ")));return this.forEach(t=>{t.classList.add(...i)}),this},removeClass:function(...n){const i=Yr(n.map(t=>t.split(" ")));return this.forEach(t=>{t.classList.remove(...i)}),this},hasClass:function(...n){const i=Yr(n.map(t=>t.split(" ")));return Kr(this,t=>i.filter(o=>t.classList.contains(o)).length>0).length>0},toggleClass:function(...n){const i=Yr(n.map(t=>t.split(" ")));this.forEach(t=>{i.forEach(o=>{t.classList.toggle(o)})})},attr:function(n,i){if(1===arguments.length&&"string"==typeof n)return this[0]?this[0].getAttribute(n):void 0;for(let t=0;t<this.length;t+=1)if(2===arguments.length)this[t].setAttribute(n,i);else for(const o in n)this[t][o]=n[o],this[t].setAttribute(o,n[o]);return this},removeAttr:function(n){for(let i=0;i<this.length;i+=1)this[i].removeAttribute(n);return this},transform:function(n){for(let i=0;i<this.length;i+=1)this[i].style.transform=n;return this},transition:function(n){for(let i=0;i<this.length;i+=1)this[i].style.transitionDuration="string"!=typeof n?`${n}ms`:n;return this},on:function(...n){let[i,t,o,p]=n;function f(M){const A=M.target;if(!A)return;const I=M.target.dom7EventData||[];if(I.indexOf(M)<0&&I.unshift(M),xt(A).is(t))o.apply(A,I);else{const R=xt(A).parents();for(let G=0;G<R.length;G+=1)xt(R[G]).is(t)&&o.apply(R[G],I)}}function y(M){const A=M&&M.target&&M.target.dom7EventData||[];A.indexOf(M)<0&&A.unshift(M),o.apply(this,A)}"function"==typeof n[1]&&([i,o,p]=n,t=void 0),p||(p=!1);const C=i.split(" ");let E;for(let M=0;M<this.length;M+=1){const A=this[M];if(t)for(E=0;E<C.length;E+=1){const I=C[E];A.dom7LiveListeners||(A.dom7LiveListeners={}),A.dom7LiveListeners[I]||(A.dom7LiveListeners[I]=[]),A.dom7LiveListeners[I].push({listener:o,proxyListener:f}),A.addEventListener(I,f,p)}else for(E=0;E<C.length;E+=1){const I=C[E];A.dom7Listeners||(A.dom7Listeners={}),A.dom7Listeners[I]||(A.dom7Listeners[I]=[]),A.dom7Listeners[I].push({listener:o,proxyListener:y}),A.addEventListener(I,y,p)}}return this},off:function(...n){let[i,t,o,p]=n;"function"==typeof n[1]&&([i,o,p]=n,t=void 0),p||(p=!1);const f=i.split(" ");for(let y=0;y<f.length;y+=1){const C=f[y];for(let E=0;E<this.length;E+=1){const M=this[E];let A;if(!t&&M.dom7Listeners?A=M.dom7Listeners[C]:t&&M.dom7LiveListeners&&(A=M.dom7LiveListeners[C]),A&&A.length)for(let I=A.length-1;I>=0;I-=1){const R=A[I];o&&R.listener===o||o&&R.listener&&R.listener.dom7proxy&&R.listener.dom7proxy===o?(M.removeEventListener(C,R.proxyListener,p),A.splice(I,1)):o||(M.removeEventListener(C,R.proxyListener,p),A.splice(I,1))}}}return this},trigger:function(...n){const i=Qn(),t=n[0].split(" "),o=n[1];for(let p=0;p<t.length;p+=1){const f=t[p];for(let y=0;y<this.length;y+=1){const C=this[y];if(i.CustomEvent){const E=new i.CustomEvent(f,{detail:o,bubbles:!0,cancelable:!0});C.dom7EventData=n.filter((M,A)=>A>0),C.dispatchEvent(E),C.dom7EventData=[],delete C.dom7EventData}}}return this},transitionEnd:function(n){const i=this;return n&&i.on("transitionend",function t(o){o.target===this&&(n.call(this,o),i.off("transitionend",t))}),this},outerWidth:function(n){if(this.length>0){if(n){const i=this.styles();return this[0].offsetWidth+parseFloat(i.getPropertyValue("margin-right"))+parseFloat(i.getPropertyValue("margin-left"))}return this[0].offsetWidth}return null},outerHeight:function(n){if(this.length>0){if(n){const i=this.styles();return this[0].offsetHeight+parseFloat(i.getPropertyValue("margin-top"))+parseFloat(i.getPropertyValue("margin-bottom"))}return this[0].offsetHeight}return null},styles:function(){const n=Qn();return this[0]?n.getComputedStyle(this[0],null):{}},offset:function(){if(this.length>0){const n=Qn(),i=di(),t=this[0],o=t.getBoundingClientRect(),p=i.body;return{top:o.top+(t===n?n.scrollY:t.scrollTop)-(t.clientTop||p.clientTop||0),left:o.left+(t===n?n.scrollX:t.scrollLeft)-(t.clientLeft||p.clientLeft||0)}}return null},css:function(n,i){const t=Qn();let o;if(1===arguments.length){if("string"!=typeof n){for(o=0;o<this.length;o+=1)for(const p in n)this[o].style[p]=n[p];return this}if(this[0])return t.getComputedStyle(this[0],null).getPropertyValue(n)}if(2===arguments.length&&"string"==typeof n){for(o=0;o<this.length;o+=1)this[o].style[n]=i;return this}return this},each:function(n){return n?(this.forEach((i,t)=>{n.apply(i,[i,t])}),this):this},html:function(n){if(void 0===n)return this[0]?this[0].innerHTML:null;for(let i=0;i<this.length;i+=1)this[i].innerHTML=n;return this},text:function(n){if(void 0===n)return this[0]?this[0].textContent.trim():null;for(let i=0;i<this.length;i+=1)this[i].textContent=n;return this},is:function(n){const i=Qn(),t=di(),o=this[0];let p,f;if(!o||void 0===n)return!1;if("string"==typeof n){if(o.matches)return o.matches(n);if(o.webkitMatchesSelector)return o.webkitMatchesSelector(n);if(o.msMatchesSelector)return o.msMatchesSelector(n);for(p=xt(n),f=0;f<p.length;f+=1)if(p[f]===o)return!0;return!1}if(n===t)return o===t;if(n===i)return o===i;if(n.nodeType||n instanceof zr){for(p=n.nodeType?[n]:n,f=0;f<p.length;f+=1)if(p[f]===o)return!0;return!1}return!1},index:function(){let i,n=this[0];if(n){for(i=0;null!==(n=n.previousSibling);)1===n.nodeType&&(i+=1);return i}},eq:function(n){if(void 0===n)return this;const i=this.length;if(n>i-1)return xt([]);if(n<0){const t=i+n;return xt(t<0?[]:[this[t]])}return xt([this[n]])},append:function(...n){let i;const t=di();for(let o=0;o<n.length;o+=1){i=n[o];for(let p=0;p<this.length;p+=1)if("string"==typeof i){const f=t.createElement("div");for(f.innerHTML=i;f.firstChild;)this[p].appendChild(f.firstChild)}else if(i instanceof zr)for(let f=0;f<i.length;f+=1)this[p].appendChild(i[f]);else this[p].appendChild(i)}return this},prepend:function(n){const i=di();let t,o;for(t=0;t<this.length;t+=1)if("string"==typeof n){const p=i.createElement("div");for(p.innerHTML=n,o=p.childNodes.length-1;o>=0;o-=1)this[t].insertBefore(p.childNodes[o],this[t].childNodes[0])}else if(n instanceof zr)for(o=0;o<n.length;o+=1)this[t].insertBefore(n[o],this[t].childNodes[0]);else this[t].insertBefore(n,this[t].childNodes[0]);return this},next:function(n){return this.length>0?n?this[0].nextElementSibling&&xt(this[0].nextElementSibling).is(n)?xt([this[0].nextElementSibling]):xt([]):xt(this[0].nextElementSibling?[this[0].nextElementSibling]:[]):xt([])},nextAll:function(n){const i=[];let t=this[0];if(!t)return xt([]);for(;t.nextElementSibling;){const o=t.nextElementSibling;n?xt(o).is(n)&&i.push(o):i.push(o),t=o}return xt(i)},prev:function(n){if(this.length>0){const i=this[0];return n?i.previousElementSibling&&xt(i.previousElementSibling).is(n)?xt([i.previousElementSibling]):xt([]):xt(i.previousElementSibling?[i.previousElementSibling]:[])}return xt([])},prevAll:function(n){const i=[];let t=this[0];if(!t)return xt([]);for(;t.previousElementSibling;){const o=t.previousElementSibling;n?xt(o).is(n)&&i.push(o):i.push(o),t=o}return xt(i)},parent:function(n){const i=[];for(let t=0;t<this.length;t+=1)null!==this[t].parentNode&&(n?xt(this[t].parentNode).is(n)&&i.push(this[t].parentNode):i.push(this[t].parentNode));return xt(i)},parents:function(n){const i=[];for(let t=0;t<this.length;t+=1){let o=this[t].parentNode;for(;o;)n?xt(o).is(n)&&i.push(o):i.push(o),o=o.parentNode}return xt(i)},closest:function(n){let i=this;return void 0===n?xt([]):(i.is(n)||(i=i.parents(n).eq(0)),i)},find:function(n){const i=[];for(let t=0;t<this.length;t+=1){const o=this[t].querySelectorAll(n);for(let p=0;p<o.length;p+=1)i.push(o[p])}return xt(i)},children:function(n){const i=[];for(let t=0;t<this.length;t+=1){const o=this[t].children;for(let p=0;p<o.length;p+=1)(!n||xt(o[p]).is(n))&&i.push(o[p])}return xt(i)},filter:function(n){return xt(Kr(this,n))},remove:function(){for(let n=0;n<this.length;n+=1)this[n].parentNode&&this[n].parentNode.removeChild(this[n]);return this}};Object.keys(ln).forEach(n=>{Object.defineProperty(xt.fn,n,{value:ln[n],writable:!0})});const ht=xt;function Nt(n,i=0){return setTimeout(n,i)}function Br(){return Date.now()}function xi(n){return"object"==typeof n&&null!==n&&n.constructor&&"Object"===Object.prototype.toString.call(n).slice(8,-1)}function Fu(n){return"undefined"!=typeof window&&void 0!==window.HTMLElement?n instanceof HTMLElement:n&&(1===n.nodeType||11===n.nodeType)}function mi(...n){const i=Object(n[0]),t=["__proto__","constructor","prototype"];for(let o=1;o<n.length;o+=1){const p=n[o];if(null!=p&&!Fu(p)){const f=Object.keys(Object(p)).filter(y=>t.indexOf(y)<0);for(let y=0,C=f.length;y<C;y+=1){const E=f[y],M=Object.getOwnPropertyDescriptor(p,E);void 0!==M&&M.enumerable&&(xi(i[E])&&xi(p[E])?p[E].__swiper__?i[E]=p[E]:mi(i[E],p[E]):!xi(i[E])&&xi(p[E])?(i[E]={},p[E].__swiper__?i[E]=p[E]:mi(i[E],p[E])):i[E]=p[E])}}}return i}function Un(n,i,t){n.style.setProperty(i,t)}function Vr({swiper:n,targetPosition:i,side:t}){const o=Qn(),p=-n.translate;let y,f=null;const C=n.params.speed;n.wrapperEl.style.scrollSnapType="none",o.cancelAnimationFrame(n.cssModeFrameID);const E=i>p?"next":"prev",M=(I,R)=>"next"===E&&I>=R||"prev"===E&&I<=R,A=()=>{y=(new Date).getTime(),null===f&&(f=y);const I=Math.max(Math.min((y-f)/C,1),0),R=.5-Math.cos(I*Math.PI)/2;let G=p+R*(i-p);if(M(G,i)&&(G=i),n.wrapperEl.scrollTo({[t]:G}),M(G,i))return n.wrapperEl.style.overflow="hidden",n.wrapperEl.style.scrollSnapType="",setTimeout(()=>{n.wrapperEl.style.overflow="",n.wrapperEl.scrollTo({[t]:G})}),void o.cancelAnimationFrame(n.cssModeFrameID);n.cssModeFrameID=o.requestAnimationFrame(A)};A()}let Qi,gi,Nu;function Oi(){return Qi||(Qi=function(){const n=Qn(),i=di();return{smoothScroll:i.documentElement&&"scrollBehavior"in i.documentElement.style,touch:!!("ontouchstart"in n||n.DocumentTouch&&i instanceof n.DocumentTouch),passiveListener:function(){let o=!1;try{const p=Object.defineProperty({},"passive",{get(){o=!0}});n.addEventListener("testPassiveListener",null,p)}catch(p){}return o}(),gestures:"ongesturestart"in n}}()),Qi}const ii={on(n,i,t){const o=this;if("function"!=typeof i)return o;const p=t?"unshift":"push";return n.split(" ").forEach(f=>{o.eventsListeners[f]||(o.eventsListeners[f]=[]),o.eventsListeners[f][p](i)}),o},once(n,i,t){const o=this;if("function"!=typeof i)return o;function p(...f){o.off(n,p),p.__emitterProxy&&delete p.__emitterProxy,i.apply(o,f)}return p.__emitterProxy=i,o.on(n,p,t)},onAny(n,i){const t=this;if("function"!=typeof n)return t;const o=i?"unshift":"push";return t.eventsAnyListeners.indexOf(n)<0&&t.eventsAnyListeners[o](n),t},offAny(n){const i=this;if(!i.eventsAnyListeners)return i;const t=i.eventsAnyListeners.indexOf(n);return t>=0&&i.eventsAnyListeners.splice(t,1),i},off(n,i){const t=this;return t.eventsListeners&&n.split(" ").forEach(o=>{void 0===i?t.eventsListeners[o]=[]:t.eventsListeners[o]&&t.eventsListeners[o].forEach((p,f)=>{(p===i||p.__emitterProxy&&p.__emitterProxy===i)&&t.eventsListeners[o].splice(f,1)})}),t},emit(...n){const i=this;if(!i.eventsListeners)return i;let t,o,p;return"string"==typeof n[0]||Array.isArray(n[0])?(t=n[0],o=n.slice(1,n.length),p=i):(t=n[0].events,o=n[0].data,p=n[0].context||i),o.unshift(p),(Array.isArray(t)?t:t.split(" ")).forEach(y=>{i.eventsAnyListeners&&i.eventsAnyListeners.length&&i.eventsAnyListeners.forEach(C=>{C.apply(p,[y,...o])}),i.eventsListeners&&i.eventsListeners[y]&&i.eventsListeners[y].forEach(C=>{C.apply(p,o)})}),i}},kl={updateSize:function(){const n=this;let i,t;const o=n.$el;i=null!=n.params.width?n.params.width:o[0].clientWidth,t=null!=n.params.height?n.params.height:o[0].clientHeight,!(0===i&&n.isHorizontal()||0===t&&n.isVertical())&&(i=i-parseInt(o.css("padding-left")||0,10)-parseInt(o.css("padding-right")||0,10),t=t-parseInt(o.css("padding-top")||0,10)-parseInt(o.css("padding-bottom")||0,10),Number.isNaN(i)&&(i=0),Number.isNaN(t)&&(t=0),Object.assign(n,{width:i,height:t,size:n.isHorizontal()?i:t}))},updateSlides:function(){const n=this;function i(Fe){return n.isHorizontal()?Fe:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[Fe]}function t(Fe,De){return parseFloat(Fe.getPropertyValue(i(De))||0)}const o=n.params,{$wrapperEl:p,size:f,rtlTranslate:y,wrongRTL:C}=n,E=n.virtual&&o.virtual.enabled,M=E?n.virtual.slides.length:n.slides.length,A=p.children(`.${n.params.slideClass}`),I=E?n.virtual.slides.length:A.length;let R=[];const G=[],W=[];let se=o.slidesOffsetBefore;"function"==typeof se&&(se=o.slidesOffsetBefore.call(n));let ne=o.slidesOffsetAfter;"function"==typeof ne&&(ne=o.slidesOffsetAfter.call(n));const ge=n.snapGrid.length,we=n.slidesGrid.length;let _e=o.spaceBetween,Pe=-se,Ve=0,Ge=0;if(void 0===f)return;"string"==typeof _e&&_e.indexOf("%")>=0&&(_e=parseFloat(_e.replace("%",""))/100*f),n.virtualSize=-_e,A.css(y?{marginLeft:"",marginBottom:"",marginTop:""}:{marginRight:"",marginBottom:"",marginTop:""}),o.centeredSlides&&o.cssMode&&(Un(n.wrapperEl,"--swiper-centered-offset-before",""),Un(n.wrapperEl,"--swiper-centered-offset-after",""));const Ye=o.grid&&o.grid.rows>1&&n.grid;let Te;Ye&&n.grid.initSlides(I);const Se="auto"===o.slidesPerView&&o.breakpoints&&Object.keys(o.breakpoints).filter(Fe=>void 0!==o.breakpoints[Fe].slidesPerView).length>0;for(let Fe=0;Fe<I;Fe+=1){Te=0;const De=A.eq(Fe);if(Ye&&n.grid.updateSlide(Fe,De,I,i),"none"!==De.css("display")){if("auto"===o.slidesPerView){Se&&(A[Fe].style[i("width")]="");const rt=getComputedStyle(De[0]),ct=De[0].style.transform,Jt=De[0].style.webkitTransform;if(ct&&(De[0].style.transform="none"),Jt&&(De[0].style.webkitTransform="none"),o.roundLengths)Te=n.isHorizontal()?De.outerWidth(!0):De.outerHeight(!0);else{const zt=t(rt,"width"),Oe=t(rt,"padding-left"),vt=t(rt,"padding-right"),Tt=t(rt,"margin-left"),tn=t(rt,"margin-right"),Fn=rt.getPropertyValue("box-sizing");if(Fn&&"border-box"===Fn)Te=zt+Tt+tn;else{const{clientWidth:Uc,offsetWidth:$c}=De[0];Te=zt+Oe+vt+Tt+tn+($c-Uc)}}ct&&(De[0].style.transform=ct),Jt&&(De[0].style.webkitTransform=Jt),o.roundLengths&&(Te=Math.floor(Te))}else Te=(f-(o.slidesPerView-1)*_e)/o.slidesPerView,o.roundLengths&&(Te=Math.floor(Te)),A[Fe]&&(A[Fe].style[i("width")]=`${Te}px`);A[Fe]&&(A[Fe].swiperSlideSize=Te),W.push(Te),o.centeredSlides?(Pe=Pe+Te/2+Ve/2+_e,0===Ve&&0!==Fe&&(Pe=Pe-f/2-_e),0===Fe&&(Pe=Pe-f/2-_e),Math.abs(Pe)<.001&&(Pe=0),o.roundLengths&&(Pe=Math.floor(Pe)),Ge%o.slidesPerGroup==0&&R.push(Pe),G.push(Pe)):(o.roundLengths&&(Pe=Math.floor(Pe)),(Ge-Math.min(n.params.slidesPerGroupSkip,Ge))%n.params.slidesPerGroup==0&&R.push(Pe),G.push(Pe),Pe=Pe+Te+_e),n.virtualSize+=Te+_e,Ve=Te,Ge+=1}}if(n.virtualSize=Math.max(n.virtualSize,f)+ne,y&&C&&("slide"===o.effect||"coverflow"===o.effect)&&p.css({width:`${n.virtualSize+o.spaceBetween}px`}),o.setWrapperSize&&p.css({[i("width")]:`${n.virtualSize+o.spaceBetween}px`}),Ye&&n.grid.updateWrapperSize(Te,R,i),!o.centeredSlides){const Fe=[];for(let De=0;De<R.length;De+=1){let rt=R[De];o.roundLengths&&(rt=Math.floor(rt)),R[De]<=n.virtualSize-f&&Fe.push(rt)}R=Fe,Math.floor(n.virtualSize-f)-Math.floor(R[R.length-1])>1&&R.push(n.virtualSize-f)}if(0===R.length&&(R=[0]),0!==o.spaceBetween){const Fe=n.isHorizontal()&&y?"marginLeft":i("marginRight");A.filter((De,rt)=>!o.cssMode||rt!==A.length-1).css({[Fe]:`${_e}px`})}if(o.centeredSlides&&o.centeredSlidesBounds){let Fe=0;W.forEach(rt=>{Fe+=rt+(o.spaceBetween?o.spaceBetween:0)}),Fe-=o.spaceBetween;const De=Fe-f;R=R.map(rt=>rt<0?-se:rt>De?De+ne:rt)}if(o.centerInsufficientSlides){let Fe=0;if(W.forEach(De=>{Fe+=De+(o.spaceBetween?o.spaceBetween:0)}),Fe-=o.spaceBetween,Fe<f){const De=(f-Fe)/2;R.forEach((rt,ct)=>{R[ct]=rt-De}),G.forEach((rt,ct)=>{G[ct]=rt+De})}}if(Object.assign(n,{slides:A,snapGrid:R,slidesGrid:G,slidesSizesGrid:W}),o.centeredSlides&&o.cssMode&&!o.centeredSlidesBounds){Un(n.wrapperEl,"--swiper-centered-offset-before",-R[0]+"px"),Un(n.wrapperEl,"--swiper-centered-offset-after",n.size/2-W[W.length-1]/2+"px");const Fe=-n.snapGrid[0],De=-n.slidesGrid[0];n.snapGrid=n.snapGrid.map(rt=>rt+Fe),n.slidesGrid=n.slidesGrid.map(rt=>rt+De)}I!==M&&n.emit("slidesLengthChange"),R.length!==ge&&(n.params.watchOverflow&&n.checkOverflow(),n.emit("snapGridLengthChange")),G.length!==we&&n.emit("slidesGridLengthChange"),o.watchSlidesProgress&&n.updateSlidesOffset()},updateAutoHeight:function(n){const i=this,t=[],o=i.virtual&&i.params.virtual.enabled;let f,p=0;"number"==typeof n?i.setTransition(n):!0===n&&i.setTransition(i.params.speed);const y=C=>o?i.slides.filter(E=>parseInt(E.getAttribute("data-swiper-slide-index"),10)===C)[0]:i.slides.eq(C)[0];if("auto"!==i.params.slidesPerView&&i.params.slidesPerView>1)if(i.params.centeredSlides)i.visibleSlides.each(C=>{t.push(C)});else for(f=0;f<Math.ceil(i.params.slidesPerView);f+=1){const C=i.activeIndex+f;if(C>i.slides.length&&!o)break;t.push(y(C))}else t.push(y(i.activeIndex));for(f=0;f<t.length;f+=1)if(void 0!==t[f]){const C=t[f].offsetHeight;p=C>p?C:p}(p||0===p)&&i.$wrapperEl.css("height",`${p}px`)},updateSlidesOffset:function(){const n=this,i=n.slides;for(let t=0;t<i.length;t+=1)i[t].swiperSlideOffset=n.isHorizontal()?i[t].offsetLeft:i[t].offsetTop},updateSlidesProgress:function(n=this&&this.translate||0){const i=this,t=i.params,{slides:o,rtlTranslate:p,snapGrid:f}=i;if(0===o.length)return;void 0===o[0].swiperSlideOffset&&i.updateSlidesOffset();let y=-n;p&&(y=n),o.removeClass(t.slideVisibleClass),i.visibleSlidesIndexes=[],i.visibleSlides=[];for(let C=0;C<o.length;C+=1){const E=o[C];let M=E.swiperSlideOffset;t.cssMode&&t.centeredSlides&&(M-=o[0].swiperSlideOffset);const A=(y+(t.centeredSlides?i.minTranslate():0)-M)/(E.swiperSlideSize+t.spaceBetween),I=(y-f[0]+(t.centeredSlides?i.minTranslate():0)-M)/(E.swiperSlideSize+t.spaceBetween),R=-(y-M),G=R+i.slidesSizesGrid[C];(R>=0&&R<i.size-1||G>1&&G<=i.size||R<=0&&G>=i.size)&&(i.visibleSlides.push(E),i.visibleSlidesIndexes.push(C),o.eq(C).addClass(t.slideVisibleClass)),E.progress=p?-A:A,E.originalProgress=p?-I:I}i.visibleSlides=ht(i.visibleSlides)},updateProgress:function(n){const i=this;if(void 0===n){const M=i.rtlTranslate?-1:1;n=i&&i.translate&&i.translate*M||0}const t=i.params,o=i.maxTranslate()-i.minTranslate();let{progress:p,isBeginning:f,isEnd:y}=i;const C=f,E=y;0===o?(p=0,f=!0,y=!0):(p=(n-i.minTranslate())/o,f=p<=0,y=p>=1),Object.assign(i,{progress:p,isBeginning:f,isEnd:y}),(t.watchSlidesProgress||t.centeredSlides&&t.autoHeight)&&i.updateSlidesProgress(n),f&&!C&&i.emit("reachBeginning toEdge"),y&&!E&&i.emit("reachEnd toEdge"),(C&&!f||E&&!y)&&i.emit("fromEdge"),i.emit("progress",p)},updateSlidesClasses:function(){const n=this,{slides:i,params:t,$wrapperEl:o,activeIndex:p,realIndex:f}=n,y=n.virtual&&t.virtual.enabled;let C;i.removeClass(`${t.slideActiveClass} ${t.slideNextClass} ${t.slidePrevClass} ${t.slideDuplicateActiveClass} ${t.slideDuplicateNextClass} ${t.slideDuplicatePrevClass}`),C=y?n.$wrapperEl.find(`.${t.slideClass}[data-swiper-slide-index="${p}"]`):i.eq(p),C.addClass(t.slideActiveClass),t.loop&&(C.hasClass(t.slideDuplicateClass)?o.children(`.${t.slideClass}:not(.${t.slideDuplicateClass})[data-swiper-slide-index="${f}"]`).addClass(t.slideDuplicateActiveClass):o.children(`.${t.slideClass}.${t.slideDuplicateClass}[data-swiper-slide-index="${f}"]`).addClass(t.slideDuplicateActiveClass));let E=C.nextAll(`.${t.slideClass}`).eq(0).addClass(t.slideNextClass);t.loop&&0===E.length&&(E=i.eq(0),E.addClass(t.slideNextClass));let M=C.prevAll(`.${t.slideClass}`).eq(0).addClass(t.slidePrevClass);t.loop&&0===M.length&&(M=i.eq(-1),M.addClass(t.slidePrevClass)),t.loop&&(E.hasClass(t.slideDuplicateClass)?o.children(`.${t.slideClass}:not(.${t.slideDuplicateClass})[data-swiper-slide-index="${E.attr("data-swiper-slide-index")}"]`).addClass(t.slideDuplicateNextClass):o.children(`.${t.slideClass}.${t.slideDuplicateClass}[data-swiper-slide-index="${E.attr("data-swiper-slide-index")}"]`).addClass(t.slideDuplicateNextClass),M.hasClass(t.slideDuplicateClass)?o.children(`.${t.slideClass}:not(.${t.slideDuplicateClass})[data-swiper-slide-index="${M.attr("data-swiper-slide-index")}"]`).addClass(t.slideDuplicatePrevClass):o.children(`.${t.slideClass}.${t.slideDuplicateClass}[data-swiper-slide-index="${M.attr("data-swiper-slide-index")}"]`).addClass(t.slideDuplicatePrevClass)),n.emitSlidesClasses()},updateActiveIndex:function(n){const i=this,t=i.rtlTranslate?i.translate:-i.translate,{slidesGrid:o,snapGrid:p,params:f,activeIndex:y,realIndex:C,snapIndex:E}=i;let A,M=n;if(void 0===M){for(let R=0;R<o.length;R+=1)void 0!==o[R+1]?t>=o[R]&&t<o[R+1]-(o[R+1]-o[R])/2?M=R:t>=o[R]&&t<o[R+1]&&(M=R+1):t>=o[R]&&(M=R);f.normalizeSlideIndex&&(M<0||void 0===M)&&(M=0)}if(p.indexOf(t)>=0)A=p.indexOf(t);else{const R=Math.min(f.slidesPerGroupSkip,M);A=R+Math.floor((M-R)/f.slidesPerGroup)}if(A>=p.length&&(A=p.length-1),M===y)return void(A!==E&&(i.snapIndex=A,i.emit("snapIndexChange")));const I=parseInt(i.slides.eq(M).attr("data-swiper-slide-index")||M,10);Object.assign(i,{snapIndex:A,realIndex:I,previousIndex:y,activeIndex:M}),i.emit("activeIndexChange"),i.emit("snapIndexChange"),C!==I&&i.emit("realIndexChange"),(i.initialized||i.params.runCallbacksOnInit)&&i.emit("slideChange")},updateClickedSlide:function(n){const i=this,t=i.params,o=ht(n).closest(`.${t.slideClass}`)[0];let f,p=!1;if(o)for(let y=0;y<i.slides.length;y+=1)if(i.slides[y]===o){p=!0,f=y;break}if(!o||!p)return i.clickedSlide=void 0,void(i.clickedIndex=void 0);i.clickedSlide=o,i.clickedIndex=i.virtual&&i.params.virtual.enabled?parseInt(ht(o).attr("data-swiper-slide-index"),10):f,t.slideToClickedSlide&&void 0!==i.clickedIndex&&i.clickedIndex!==i.activeIndex&&i.slideToClickedSlide()}},ji={getTranslate:function(n=(this.isHorizontal()?"x":"y")){const{params:t,rtlTranslate:o,translate:p,$wrapperEl:f}=this;if(t.virtualTranslate)return o?-p:p;if(t.cssMode)return p;let y=function(n,i="x"){const t=Qn();let o,p,f;const y=function(n){const i=Qn();let t;return i.getComputedStyle&&(t=i.getComputedStyle(n,null)),!t&&n.currentStyle&&(t=n.currentStyle),t||(t=n.style),t}(n);return t.WebKitCSSMatrix?(p=y.transform||y.webkitTransform,p.split(",").length>6&&(p=p.split(", ").map(C=>C.replace(",",".")).join(", ")),f=new t.WebKitCSSMatrix("none"===p?"":p)):(f=y.MozTransform||y.OTransform||y.MsTransform||y.msTransform||y.transform||y.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),o=f.toString().split(",")),"x"===i&&(p=t.WebKitCSSMatrix?f.m41:16===o.length?parseFloat(o[12]):parseFloat(o[4])),"y"===i&&(p=t.WebKitCSSMatrix?f.m42:16===o.length?parseFloat(o[13]):parseFloat(o[5])),p||0}(f[0],n);return o&&(y=-y),y||0},setTranslate:function(n,i){const t=this,{rtlTranslate:o,params:p,$wrapperEl:f,wrapperEl:y,progress:C}=t;let I,E=0,M=0;t.isHorizontal()?E=o?-n:n:M=n,p.roundLengths&&(E=Math.floor(E),M=Math.floor(M)),p.cssMode?y[t.isHorizontal()?"scrollLeft":"scrollTop"]=t.isHorizontal()?-E:-M:p.virtualTranslate||f.transform(`translate3d(${E}px, ${M}px, 0px)`),t.previousTranslate=t.translate,t.translate=t.isHorizontal()?E:M;const R=t.maxTranslate()-t.minTranslate();I=0===R?0:(n-t.minTranslate())/R,I!==C&&t.updateProgress(n),t.emit("setTranslate",t.translate,i)},minTranslate:function(){return-this.snapGrid[0]},maxTranslate:function(){return-this.snapGrid[this.snapGrid.length-1]},translateTo:function(n=0,i=this.params.speed,t=!0,o=!0,p){const f=this,{params:y,wrapperEl:C}=f;if(f.animating&&y.preventInteractionOnTransition)return!1;const E=f.minTranslate(),M=f.maxTranslate();let A;if(A=o&&n>E?E:o&&n<M?M:n,f.updateProgress(A),y.cssMode){const I=f.isHorizontal();if(0===i)C[I?"scrollLeft":"scrollTop"]=-A;else{if(!f.support.smoothScroll)return Vr({swiper:f,targetPosition:-A,side:I?"left":"top"}),!0;C.scrollTo({[I?"left":"top"]:-A,behavior:"smooth"})}return!0}return 0===i?(f.setTransition(0),f.setTranslate(A),t&&(f.emit("beforeTransitionStart",i,p),f.emit("transitionEnd"))):(f.setTransition(i),f.setTranslate(A),t&&(f.emit("beforeTransitionStart",i,p),f.emit("transitionStart")),f.animating||(f.animating=!0,f.onTranslateToWrapperTransitionEnd||(f.onTranslateToWrapperTransitionEnd=function(R){!f||f.destroyed||R.target===this&&(f.$wrapperEl[0].removeEventListener("transitionend",f.onTranslateToWrapperTransitionEnd),f.$wrapperEl[0].removeEventListener("webkitTransitionEnd",f.onTranslateToWrapperTransitionEnd),f.onTranslateToWrapperTransitionEnd=null,delete f.onTranslateToWrapperTransitionEnd,t&&f.emit("transitionEnd"))}),f.$wrapperEl[0].addEventListener("transitionend",f.onTranslateToWrapperTransitionEnd),f.$wrapperEl[0].addEventListener("webkitTransitionEnd",f.onTranslateToWrapperTransitionEnd))),!0}};function xo({swiper:n,runCallbacks:i,direction:t,step:o}){const{activeIndex:p,previousIndex:f}=n;let y=t;if(y||(y=p>f?"next":p<f?"prev":"reset"),n.emit(`transition${o}`),i&&p!==f){if("reset"===y)return void n.emit(`slideResetTransition${o}`);n.emit(`slideChangeTransition${o}`),n.emit("next"===y?`slideNextTransition${o}`:`slidePrevTransition${o}`)}}const Bo={setTransition:function(n,i){const t=this;t.params.cssMode||t.$wrapperEl.transition(n),t.emit("setTransition",n,i)},transitionStart:function(n=!0,i){const t=this,{params:o}=t;o.cssMode||(o.autoHeight&&t.updateAutoHeight(),xo({swiper:t,runCallbacks:n,direction:i,step:"Start"}))},transitionEnd:function(n=!0,i){const t=this,{params:o}=t;t.animating=!1,!o.cssMode&&(t.setTransition(0),xo({swiper:t,runCallbacks:n,direction:i,step:"End"}))}},$u={slideTo:function(n=0,i=this.params.speed,t=!0,o,p){if("number"!=typeof n&&"string"!=typeof n)throw new Error(`The 'index' argument cannot have type other than 'number' or 'string'. [${typeof n}] given.`);if("string"==typeof n){const _e=parseInt(n,10);if(!isFinite(_e))throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${n}] given.`);n=_e}const f=this;let y=n;y<0&&(y=0);const{params:C,snapGrid:E,slidesGrid:M,previousIndex:A,activeIndex:I,rtlTranslate:R,wrapperEl:G,enabled:W}=f;if(f.animating&&C.preventInteractionOnTransition||!W&&!o&&!p)return!1;const se=Math.min(f.params.slidesPerGroupSkip,y);let ne=se+Math.floor((y-se)/f.params.slidesPerGroup);ne>=E.length&&(ne=E.length-1),(I||C.initialSlide||0)===(A||0)&&t&&f.emit("beforeSlideChangeStart");const ge=-E[ne];if(f.updateProgress(ge),C.normalizeSlideIndex)for(let _e=0;_e<M.length;_e+=1){const Pe=-Math.floor(100*ge),Ve=Math.floor(100*M[_e]),Ge=Math.floor(100*M[_e+1]);void 0!==M[_e+1]?Pe>=Ve&&Pe<Ge-(Ge-Ve)/2?y=_e:Pe>=Ve&&Pe<Ge&&(y=_e+1):Pe>=Ve&&(y=_e)}if(f.initialized&&y!==I&&(!f.allowSlideNext&&ge<f.translate&&ge<f.minTranslate()||!f.allowSlidePrev&&ge>f.translate&&ge>f.maxTranslate()&&(I||0)!==y))return!1;let we;if(we=y>I?"next":y<I?"prev":"reset",R&&-ge===f.translate||!R&&ge===f.translate)return f.updateActiveIndex(y),C.autoHeight&&f.updateAutoHeight(),f.updateSlidesClasses(),"slide"!==C.effect&&f.setTranslate(ge),"reset"!==we&&(f.transitionStart(t,we),f.transitionEnd(t,we)),!1;if(C.cssMode){const _e=f.isHorizontal(),Pe=R?ge:-ge;if(0===i){const Ve=f.virtual&&f.params.virtual.enabled;Ve&&(f.wrapperEl.style.scrollSnapType="none",f._immediateVirtual=!0),G[_e?"scrollLeft":"scrollTop"]=Pe,Ve&&requestAnimationFrame(()=>{f.wrapperEl.style.scrollSnapType="",f._swiperImmediateVirtual=!1})}else{if(!f.support.smoothScroll)return Vr({swiper:f,targetPosition:Pe,side:_e?"left":"top"}),!0;G.scrollTo({[_e?"left":"top"]:Pe,behavior:"smooth"})}return!0}return f.setTransition(i),f.setTranslate(ge),f.updateActiveIndex(y),f.updateSlidesClasses(),f.emit("beforeTransitionStart",i,o),f.transitionStart(t,we),0===i?f.transitionEnd(t,we):f.animating||(f.animating=!0,f.onSlideToWrapperTransitionEnd||(f.onSlideToWrapperTransitionEnd=function(Pe){!f||f.destroyed||Pe.target===this&&(f.$wrapperEl[0].removeEventListener("transitionend",f.onSlideToWrapperTransitionEnd),f.$wrapperEl[0].removeEventListener("webkitTransitionEnd",f.onSlideToWrapperTransitionEnd),f.onSlideToWrapperTransitionEnd=null,delete f.onSlideToWrapperTransitionEnd,f.transitionEnd(t,we))}),f.$wrapperEl[0].addEventListener("transitionend",f.onSlideToWrapperTransitionEnd),f.$wrapperEl[0].addEventListener("webkitTransitionEnd",f.onSlideToWrapperTransitionEnd)),!0},slideToLoop:function(n=0,i=this.params.speed,t=!0,o){const p=this;let f=n;return p.params.loop&&(f+=p.loopedSlides),p.slideTo(f,i,t,o)},slideNext:function(n=this.params.speed,i=!0,t){const o=this,{animating:p,enabled:f,params:y}=o;if(!f)return o;let C=y.slidesPerGroup;"auto"===y.slidesPerView&&1===y.slidesPerGroup&&y.slidesPerGroupAuto&&(C=Math.max(o.slidesPerViewDynamic("current",!0),1));const E=o.activeIndex<y.slidesPerGroupSkip?1:C;if(y.loop){if(p&&y.loopPreventsSlide)return!1;o.loopFix(),o._clientLeft=o.$wrapperEl[0].clientLeft}return o.slideTo(y.rewind&&o.isEnd?0:o.activeIndex+E,n,i,t)},slidePrev:function(n=this.params.speed,i=!0,t){const o=this,{params:p,animating:f,snapGrid:y,slidesGrid:C,rtlTranslate:E,enabled:M}=o;if(!M)return o;if(p.loop){if(f&&p.loopPreventsSlide)return!1;o.loopFix(),o._clientLeft=o.$wrapperEl[0].clientLeft}function I(ne){return ne<0?-Math.floor(Math.abs(ne)):Math.floor(ne)}const R=I(E?o.translate:-o.translate),G=y.map(ne=>I(ne));let W=y[G.indexOf(R)-1];if(void 0===W&&p.cssMode){let ne;y.forEach((ge,we)=>{R>=ge&&(ne=we)}),void 0!==ne&&(W=y[ne>0?ne-1:ne])}let se=0;return void 0!==W&&(se=C.indexOf(W),se<0&&(se=o.activeIndex-1),"auto"===p.slidesPerView&&1===p.slidesPerGroup&&p.slidesPerGroupAuto&&(se=se-o.slidesPerViewDynamic("previous",!0)+1,se=Math.max(se,0))),o.slideTo(p.rewind&&o.isBeginning?o.slides.length-1:se,n,i,t)},slideReset:function(n=this.params.speed,i=!0,t){return this.slideTo(this.activeIndex,n,i,t)},slideToClosest:function(n=this.params.speed,i=!0,t,o=.5){const p=this;let f=p.activeIndex;const y=Math.min(p.params.slidesPerGroupSkip,f),C=y+Math.floor((f-y)/p.params.slidesPerGroup),E=p.rtlTranslate?p.translate:-p.translate;if(E>=p.snapGrid[C]){const M=p.snapGrid[C];E-M>(p.snapGrid[C+1]-M)*o&&(f+=p.params.slidesPerGroup)}else{const M=p.snapGrid[C-1];E-M<=(p.snapGrid[C]-M)*o&&(f-=p.params.slidesPerGroup)}return f=Math.max(f,0),f=Math.min(f,p.slidesGrid.length-1),p.slideTo(f,n,i,t)},slideToClickedSlide:function(){const n=this,{params:i,$wrapperEl:t}=n,o="auto"===i.slidesPerView?n.slidesPerViewDynamic():i.slidesPerView;let f,p=n.clickedIndex;if(i.loop){if(n.animating)return;f=parseInt(ht(n.clickedSlide).attr("data-swiper-slide-index"),10),i.centeredSlides?p<n.loopedSlides-o/2||p>n.slides.length-n.loopedSlides+o/2?(n.loopFix(),p=t.children(`.${i.slideClass}[data-swiper-slide-index="${f}"]:not(.${i.slideDuplicateClass})`).eq(0).index(),Nt(()=>{n.slideTo(p)})):n.slideTo(p):p>n.slides.length-o?(n.loopFix(),p=t.children(`.${i.slideClass}[data-swiper-slide-index="${f}"]:not(.${i.slideDuplicateClass})`).eq(0).index(),Nt(()=>{n.slideTo(p)})):n.slideTo(p)}else n.slideTo(p)}},Xc={loopCreate:function(){const n=this,i=di(),{params:t,$wrapperEl:o}=n,p=o.children().length>0?ht(o.children()[0].parentNode):o;p.children(`.${t.slideClass}.${t.slideDuplicateClass}`).remove();let f=p.children(`.${t.slideClass}`);if(t.loopFillGroupWithBlank){const E=t.slidesPerGroup-f.length%t.slidesPerGroup;if(E!==t.slidesPerGroup){for(let M=0;M<E;M+=1){const A=ht(i.createElement("div")).addClass(`${t.slideClass} ${t.slideBlankClass}`);p.append(A)}f=p.children(`.${t.slideClass}`)}}"auto"===t.slidesPerView&&!t.loopedSlides&&(t.loopedSlides=f.length),n.loopedSlides=Math.ceil(parseFloat(t.loopedSlides||t.slidesPerView,10)),n.loopedSlides+=t.loopAdditionalSlides,n.loopedSlides>f.length&&(n.loopedSlides=f.length);const y=[],C=[];f.each((E,M)=>{const A=ht(E);M<n.loopedSlides&&C.push(E),M<f.length&&M>=f.length-n.loopedSlides&&y.push(E),A.attr("data-swiper-slide-index",M)});for(let E=0;E<C.length;E+=1)p.append(ht(C[E].cloneNode(!0)).addClass(t.slideDuplicateClass));for(let E=y.length-1;E>=0;E-=1)p.prepend(ht(y[E].cloneNode(!0)).addClass(t.slideDuplicateClass))},loopFix:function(){const n=this;n.emit("beforeLoopFix");const{activeIndex:i,slides:t,loopedSlides:o,allowSlidePrev:p,allowSlideNext:f,snapGrid:y,rtlTranslate:C}=n;let E;n.allowSlidePrev=!0,n.allowSlideNext=!0;const A=-y[i]-n.getTranslate();i<o?(E=t.length-3*o+i,E+=o,n.slideTo(E,0,!1,!0)&&0!==A&&n.setTranslate((C?-n.translate:n.translate)-A)):i>=t.length-o&&(E=-t.length+i+o,E+=o,n.slideTo(E,0,!1,!0)&&0!==A&&n.setTranslate((C?-n.translate:n.translate)-A)),n.allowSlidePrev=p,n.allowSlideNext=f,n.emit("loopFix")},loopDestroy:function(){const{$wrapperEl:i,params:t,slides:o}=this;i.children(`.${t.slideClass}.${t.slideDuplicateClass},.${t.slideClass}.${t.slideBlankClass}`).remove(),o.removeAttr("data-swiper-slide-index")}};function Kc(n){const i=this,t=di(),o=Qn(),p=i.touchEventsData,{params:f,touches:y,enabled:C}=i;if(!C||i.animating&&f.preventInteractionOnTransition)return;!i.animating&&f.cssMode&&f.loop&&i.loopFix();let E=n;E.originalEvent&&(E=E.originalEvent);let M=ht(E.target);if("wrapper"===f.touchEventsTarget&&!M.closest(i.wrapperEl).length||(p.isTouchEvent="touchstart"===E.type,!p.isTouchEvent&&"which"in E&&3===E.which)||!p.isTouchEvent&&"button"in E&&E.button>0||p.isTouched&&p.isMoved)return;f.noSwipingClass&&""!==f.noSwipingClass&&E.target&&E.target.shadowRoot&&n.path&&n.path[0]&&(M=ht(n.path[0]));const I=f.noSwipingSelector?f.noSwipingSelector:`.${f.noSwipingClass}`;if(f.noSwiping&&(E.target&&E.target.shadowRoot?function(n,i=this){return function t(o){return o&&o!==di()&&o!==Qn()?(o.assignedSlot&&(o=o.assignedSlot),o.closest(n)||t(o.getRootNode().host)):null}(i)}(I,E.target):M.closest(I)[0]))return void(i.allowClick=!0);if(f.swipeHandler&&!M.closest(f.swipeHandler)[0])return;y.currentX="touchstart"===E.type?E.targetTouches[0].pageX:E.pageX,y.currentY="touchstart"===E.type?E.targetTouches[0].pageY:E.pageY;const G=y.currentX,W=y.currentY,se=f.edgeSwipeDetection||f.iOSEdgeSwipeDetection,ne=f.edgeSwipeThreshold||f.iOSEdgeSwipeThreshold;if(se&&(G<=ne||G>=o.innerWidth-ne)){if("prevent"!==se)return;n.preventDefault()}if(Object.assign(p,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),y.startX=G,y.startY=W,p.touchStartTime=Br(),i.allowClick=!0,i.updateSize(),i.swipeDirection=void 0,f.threshold>0&&(p.allowThresholdMove=!1),"touchstart"!==E.type){let ge=!0;M.is(p.focusableElements)&&(ge=!1),t.activeElement&&ht(t.activeElement).is(p.focusableElements)&&t.activeElement!==M[0]&&t.activeElement.blur();const we=ge&&i.allowTouchMove&&f.touchStartPreventDefault;(f.touchStartForcePreventDefault||we)&&!M[0].isContentEditable&&E.preventDefault()}i.emit("touchStart",E)}function bi(n){const i=di(),t=this,o=t.touchEventsData,{params:p,touches:f,rtlTranslate:y,enabled:C}=t;if(!C)return;let E=n;if(E.originalEvent&&(E=E.originalEvent),!o.isTouched)return void(o.startMoving&&o.isScrolling&&t.emit("touchMoveOpposite",E));if(o.isTouchEvent&&"touchmove"!==E.type)return;const M="touchmove"===E.type&&E.targetTouches&&(E.targetTouches[0]||E.changedTouches[0]),A="touchmove"===E.type?M.pageX:E.pageX,I="touchmove"===E.type?M.pageY:E.pageY;if(E.preventedByNestedSwiper)return f.startX=A,void(f.startY=I);if(!t.allowTouchMove)return t.allowClick=!1,void(o.isTouched&&(Object.assign(f,{startX:A,startY:I,currentX:A,currentY:I}),o.touchStartTime=Br()));if(o.isTouchEvent&&p.touchReleaseOnEdges&&!p.loop)if(t.isVertical()){if(I<f.startY&&t.translate<=t.maxTranslate()||I>f.startY&&t.translate>=t.minTranslate())return o.isTouched=!1,void(o.isMoved=!1)}else if(A<f.startX&&t.translate<=t.maxTranslate()||A>f.startX&&t.translate>=t.minTranslate())return;if(o.isTouchEvent&&i.activeElement&&E.target===i.activeElement&&ht(E.target).is(o.focusableElements))return o.isMoved=!0,void(t.allowClick=!1);if(o.allowTouchCallbacks&&t.emit("touchMove",E),E.targetTouches&&E.targetTouches.length>1)return;f.currentX=A,f.currentY=I;const R=f.currentX-f.startX,G=f.currentY-f.startY;if(t.params.threshold&&Math.sqrt(fo(R,2)+fo(G,2))<t.params.threshold)return;if(void 0===o.isScrolling){let ge;t.isHorizontal()&&f.currentY===f.startY||t.isVertical()&&f.currentX===f.startX?o.isScrolling=!1:R*R+G*G>=25&&(ge=180*Math.atan2(Math.abs(G),Math.abs(R))/Math.PI,o.isScrolling=t.isHorizontal()?ge>p.touchAngle:90-ge>p.touchAngle)}if(o.isScrolling&&t.emit("touchMoveOpposite",E),void 0===o.startMoving&&(f.currentX!==f.startX||f.currentY!==f.startY)&&(o.startMoving=!0),o.isScrolling)return void(o.isTouched=!1);if(!o.startMoving)return;t.allowClick=!1,!p.cssMode&&E.cancelable&&E.preventDefault(),p.touchMoveStopPropagation&&!p.nested&&E.stopPropagation(),o.isMoved||(p.loop&&!p.cssMode&&t.loopFix(),o.startTranslate=t.getTranslate(),t.setTransition(0),t.animating&&t.$wrapperEl.trigger("webkitTransitionEnd transitionend"),o.allowMomentumBounce=!1,p.grabCursor&&(!0===t.allowSlideNext||!0===t.allowSlidePrev)&&t.setGrabCursor(!0),t.emit("sliderFirstMove",E)),t.emit("sliderMove",E),o.isMoved=!0;let W=t.isHorizontal()?R:G;f.diff=W,W*=p.touchRatio,y&&(W=-W),t.swipeDirection=W>0?"prev":"next",o.currentTranslate=W+o.startTranslate;let se=!0,ne=p.resistanceRatio;if(p.touchReleaseOnEdges&&(ne=0),W>0&&o.currentTranslate>t.minTranslate()?(se=!1,p.resistance&&(o.currentTranslate=t.minTranslate()-1+fo(-t.minTranslate()+o.startTranslate+W,ne))):W<0&&o.currentTranslate<t.maxTranslate()&&(se=!1,p.resistance&&(o.currentTranslate=t.maxTranslate()+1-fo(t.maxTranslate()-o.startTranslate-W,ne))),se&&(E.preventedByNestedSwiper=!0),!t.allowSlideNext&&"next"===t.swipeDirection&&o.currentTranslate<o.startTranslate&&(o.currentTranslate=o.startTranslate),!t.allowSlidePrev&&"prev"===t.swipeDirection&&o.currentTranslate>o.startTranslate&&(o.currentTranslate=o.startTranslate),!t.allowSlidePrev&&!t.allowSlideNext&&(o.currentTranslate=o.startTranslate),p.threshold>0){if(!(Math.abs(W)>p.threshold||o.allowThresholdMove))return void(o.currentTranslate=o.startTranslate);if(!o.allowThresholdMove)return o.allowThresholdMove=!0,f.startX=f.currentX,f.startY=f.currentY,o.currentTranslate=o.startTranslate,void(f.diff=t.isHorizontal()?f.currentX-f.startX:f.currentY-f.startY)}!p.followFinger||p.cssMode||((p.freeMode&&p.freeMode.enabled&&t.freeMode||p.watchSlidesProgress)&&(t.updateActiveIndex(),t.updateSlidesClasses()),t.params.freeMode&&p.freeMode.enabled&&t.freeMode&&t.freeMode.onTouchMove(),t.updateProgress(o.currentTranslate),t.setTranslate(o.currentTranslate))}function Hu(n){const i=this,t=i.touchEventsData,{params:o,touches:p,rtlTranslate:f,slidesGrid:y,enabled:C}=i;if(!C)return;let E=n;if(E.originalEvent&&(E=E.originalEvent),t.allowTouchCallbacks&&i.emit("touchEnd",E),t.allowTouchCallbacks=!1,!t.isTouched)return t.isMoved&&o.grabCursor&&i.setGrabCursor(!1),t.isMoved=!1,void(t.startMoving=!1);o.grabCursor&&t.isMoved&&t.isTouched&&(!0===i.allowSlideNext||!0===i.allowSlidePrev)&&i.setGrabCursor(!1);const M=Br(),A=M-t.touchStartTime;if(i.allowClick){const ne=E.path||E.composedPath&&E.composedPath();i.updateClickedSlide(ne&&ne[0]||E.target),i.emit("tap click",E),A<300&&M-t.lastClickTime<300&&i.emit("doubleTap doubleClick",E)}if(t.lastClickTime=Br(),Nt(()=>{i.destroyed||(i.allowClick=!0)}),!t.isTouched||!t.isMoved||!i.swipeDirection||0===p.diff||t.currentTranslate===t.startTranslate)return t.isTouched=!1,t.isMoved=!1,void(t.startMoving=!1);let I;if(t.isTouched=!1,t.isMoved=!1,t.startMoving=!1,I=o.followFinger?f?i.translate:-i.translate:-t.currentTranslate,o.cssMode)return;if(i.params.freeMode&&o.freeMode.enabled)return void i.freeMode.onTouchEnd({currentPos:I});let R=0,G=i.slidesSizesGrid[0];for(let ne=0;ne<y.length;ne+=ne<o.slidesPerGroupSkip?1:o.slidesPerGroup){const ge=ne<o.slidesPerGroupSkip-1?1:o.slidesPerGroup;void 0!==y[ne+ge]?I>=y[ne]&&I<y[ne+ge]&&(R=ne,G=y[ne+ge]-y[ne]):I>=y[ne]&&(R=ne,G=y[y.length-1]-y[y.length-2])}const W=(I-y[R])/G,se=R<o.slidesPerGroupSkip-1?1:o.slidesPerGroup;if(A>o.longSwipesMs){if(!o.longSwipes)return void i.slideTo(i.activeIndex);"next"===i.swipeDirection&&i.slideTo(W>=o.longSwipesRatio?R+se:R),"prev"===i.swipeDirection&&i.slideTo(W>1-o.longSwipesRatio?R+se:R)}else{if(!o.shortSwipes)return void i.slideTo(i.activeIndex);!i.navigation||E.target!==i.navigation.nextEl&&E.target!==i.navigation.prevEl?("next"===i.swipeDirection&&i.slideTo(R+se),"prev"===i.swipeDirection&&i.slideTo(R)):i.slideTo(E.target===i.navigation.nextEl?R+se:R)}}function wo(){const n=this,{params:i,el:t}=n;if(t&&0===t.offsetWidth)return;i.breakpoints&&n.setBreakpoint();const{allowSlideNext:o,allowSlidePrev:p,snapGrid:f}=n;n.allowSlideNext=!0,n.allowSlidePrev=!0,n.updateSize(),n.updateSlides(),n.updateSlidesClasses(),n.slideTo(("auto"===i.slidesPerView||i.slidesPerView>1)&&n.isEnd&&!n.isBeginning&&!n.params.centeredSlides?n.slides.length-1:n.activeIndex,0,!1,!0),n.autoplay&&n.autoplay.running&&n.autoplay.paused&&n.autoplay.run(),n.allowSlidePrev=p,n.allowSlideNext=o,n.params.watchOverflow&&f!==n.snapGrid&&n.checkOverflow()}function Vo(n){const i=this;!i.enabled||i.allowClick||(i.params.preventClicks&&n.preventDefault(),i.params.preventClicksPropagation&&i.animating&&(n.stopPropagation(),n.stopImmediatePropagation()))}function Ca(){const n=this,{wrapperEl:i,rtlTranslate:t,enabled:o}=n;if(!o)return;let p;n.previousTranslate=n.translate,n.translate=n.isHorizontal()?-i.scrollLeft:-i.scrollTop,-0===n.translate&&(n.translate=0),n.updateActiveIndex(),n.updateSlidesClasses();const f=n.maxTranslate()-n.minTranslate();p=0===f?0:(n.translate-n.minTranslate())/f,p!==n.progress&&n.updateProgress(t?-n.translate:n.translate),n.emit("setTranslate",n.translate,!1)}let Uo=!1;function $o(){}const jo=(n,i)=>{const t=di(),{params:o,touchEvents:p,el:f,wrapperEl:y,device:C,support:E}=n,M=!!o.nested,A="on"===i?"addEventListener":"removeEventListener",I=i;if(E.touch){const R=!("touchstart"!==p.start||!E.passiveListener||!o.passiveListeners)&&{passive:!0,capture:!1};f[A](p.start,n.onTouchStart,R),f[A](p.move,n.onTouchMove,E.passiveListener?{passive:!1,capture:M}:M),f[A](p.end,n.onTouchEnd,R),p.cancel&&f[A](p.cancel,n.onTouchEnd,R)}else f[A](p.start,n.onTouchStart,!1),t[A](p.move,n.onTouchMove,M),t[A](p.end,n.onTouchEnd,!1);(o.preventClicks||o.preventClicksPropagation)&&f[A]("click",n.onClick,!0),o.cssMode&&y[A]("scroll",n.onScroll),n[I](o.updateOnWindowResize?C.ios||C.android?"resize orientationchange observerUpdate":"resize observerUpdate":"observerUpdate",wo,!0)},Qc={attachEvents:function(){const n=this,i=di(),{params:t,support:o}=n;n.onTouchStart=Kc.bind(n),n.onTouchMove=bi.bind(n),n.onTouchEnd=Hu.bind(n),t.cssMode&&(n.onScroll=Ca.bind(n)),n.onClick=Vo.bind(n),o.touch&&!Uo&&(i.addEventListener("touchstart",$o),Uo=!0),jo(n,"on")},detachEvents:function(){jo(this,"off")}},Cn=(n,i)=>n.grid&&i.grid&&i.grid.rows>1,Jc={setBreakpoint:function(){const n=this,{activeIndex:i,initialized:t,loopedSlides:o=0,params:p,$el:f}=n,y=p.breakpoints;if(!y||y&&0===Object.keys(y).length)return;const C=n.getBreakpoint(y,n.params.breakpointsBase,n.el);if(!C||n.currentBreakpoint===C)return;const M=(C in y?y[C]:void 0)||n.originalParams,A=Cn(n,p),I=Cn(n,M),R=p.enabled;A&&!I?(f.removeClass(`${p.containerModifierClass}grid ${p.containerModifierClass}grid-column`),n.emitContainerClasses()):!A&&I&&(f.addClass(`${p.containerModifierClass}grid`),(M.grid.fill&&"column"===M.grid.fill||!M.grid.fill&&"column"===p.grid.fill)&&f.addClass(`${p.containerModifierClass}grid-column`),n.emitContainerClasses());const G=M.direction&&M.direction!==p.direction,W=p.loop&&(M.slidesPerView!==p.slidesPerView||G);G&&t&&n.changeDirection(),mi(n.params,M);const se=n.params.enabled;Object.assign(n,{allowTouchMove:n.params.allowTouchMove,allowSlideNext:n.params.allowSlideNext,allowSlidePrev:n.params.allowSlidePrev}),R&&!se?n.disable():!R&&se&&n.enable(),n.currentBreakpoint=C,n.emit("_beforeBreakpoint",M),W&&t&&(n.loopDestroy(),n.loopCreate(),n.updateSlides(),n.slideTo(i-o+n.loopedSlides,0,!1)),n.emit("breakpoint",M)},getBreakpoint:function(n,i="window",t){if(!n||"container"===i&&!t)return;let o=!1;const p=Qn(),f="window"===i?p.innerHeight:t.clientHeight,y=Object.keys(n).map(C=>{if("string"==typeof C&&0===C.indexOf("@")){const E=parseFloat(C.substr(1));return{value:f*E,point:C}}return{value:C,point:C}});y.sort((C,E)=>parseInt(C.value,10)-parseInt(E.value,10));for(let C=0;C<y.length;C+=1){const{point:E,value:M}=y[C];"window"===i?p.matchMedia(`(min-width: ${M}px)`).matches&&(o=E):M<=t.clientWidth&&(o=E)}return o||"max"}},up={addClasses:function(){const n=this,{classNames:i,params:t,rtl:o,$el:p,device:f,support:y}=n,C=function(n,i){const t=[];return n.forEach(o=>{"object"==typeof o?Object.keys(o).forEach(p=>{o[p]&&t.push(i+p)}):"string"==typeof o&&t.push(i+o)}),t}(["initialized",t.direction,{"pointer-events":!y.touch},{"free-mode":n.params.freeMode&&t.freeMode.enabled},{autoheight:t.autoHeight},{rtl:o},{grid:t.grid&&t.grid.rows>1},{"grid-column":t.grid&&t.grid.rows>1&&"column"===t.grid.fill},{android:f.android},{ios:f.ios},{"css-mode":t.cssMode},{centered:t.cssMode&&t.centeredSlides}],t.containerModifierClass);i.push(...C),p.addClass([...i].join(" ")),n.emitContainerClasses()},removeClasses:function(){const{$el:i,classNames:t}=this;i.removeClass(t.join(" ")),this.emitContainerClasses()}},ts={loadImage:function(n,i,t,o,p,f){const y=Qn();let C;function E(){f&&f()}ht(n).parent("picture")[0]||n.complete&&p||!i?E():(C=new y.Image,C.onload=E,C.onerror=E,o&&(C.sizes=o),t&&(C.srcset=t),i&&(C.src=i))},preloadImages:function(){const n=this;function i(){null==n||!n||n.destroyed||(void 0!==n.imagesLoaded&&(n.imagesLoaded+=1),n.imagesLoaded===n.imagesToLoad.length&&(n.params.updateOnImagesReady&&n.update(),n.emit("imagesReady")))}n.imagesToLoad=n.$el.find("img");for(let t=0;t<n.imagesToLoad.length;t+=1){const o=n.imagesToLoad[t];n.loadImage(o,o.currentSrc||o.getAttribute("src"),o.srcset||o.getAttribute("srcset"),o.sizes||o.getAttribute("sizes"),!0,i)}}},Fl={init:!0,direction:"horizontal",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:0,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,loopFillGroupWithBlank:!1,loopPreventsSlide:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-invisible-blank",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",runCallbacksOnInit:!0,_emitClasses:!1};function Sa(n,i){return function(o={}){const p=Object.keys(o)[0],f=o[p];"object"==typeof f&&null!==f?(["navigation","pagination","scrollbar"].indexOf(p)>=0&&!0===n[p]&&(n[p]={auto:!0}),p in n&&"enabled"in f?(!0===n[p]&&(n[p]={enabled:!0}),"object"==typeof n[p]&&!("enabled"in n[p])&&(n[p].enabled=!0),n[p]||(n[p]={enabled:!1}),mi(i,o)):mi(i,o)):mi(i,o)}}const Bs={eventsEmitter:ii,update:kl,translate:ji,transition:Bo,slide:$u,loop:Xc,grabCursor:{setGrabCursor:function(n){const i=this;if(i.support.touch||!i.params.simulateTouch||i.params.watchOverflow&&i.isLocked||i.params.cssMode)return;const t="container"===i.params.touchEventsTarget?i.el:i.wrapperEl;t.style.cursor="move",t.style.cursor=n?"-webkit-grabbing":"-webkit-grab",t.style.cursor=n?"-moz-grabbin":"-moz-grab",t.style.cursor=n?"grabbing":"grab"},unsetGrabCursor:function(){const n=this;n.support.touch||n.params.watchOverflow&&n.isLocked||n.params.cssMode||(n["container"===n.params.touchEventsTarget?"el":"wrapperEl"].style.cursor="")}},events:Qc,breakpoints:Jc,checkOverflow:{checkOverflow:function(){const n=this,{isLocked:i,params:t}=n,{slidesOffsetBefore:o}=t;if(o){const p=n.slides.length-1;n.isLocked=n.size>n.slidesGrid[p]+n.slidesSizesGrid[p]+2*o}else n.isLocked=1===n.snapGrid.length;!0===t.allowSlideNext&&(n.allowSlideNext=!n.isLocked),!0===t.allowSlidePrev&&(n.allowSlidePrev=!n.isLocked),i&&i!==n.isLocked&&(n.isEnd=!1),i!==n.isLocked&&n.emit(n.isLocked?"lock":"unlock")}},classes:up,images:ts},Co={};class Ii{constructor(...i){let t,o;if(1===i.length&&i[0].constructor&&"Object"===Object.prototype.toString.call(i[0]).slice(8,-1)?o=i[0]:[t,o]=i,o||(o={}),o=mi({},o),t&&!o.el&&(o.el=t),o.el&&ht(o.el).length>1){const C=[];return ht(o.el).each(E=>{const M=mi({},o,{el:E});C.push(new Ii(M))}),C}const p=this;p.__swiper__=!0,p.support=Oi(),p.device=function(n={}){return gi||(gi=function({userAgent:n}={}){const i=Oi(),t=Qn(),o=t.navigator.platform,p=n||t.navigator.userAgent,f={ios:!1,android:!1},y=t.screen.width,C=t.screen.height,E=p.match(/(Android);?[\s\/]+([\d.]+)?/);let M=p.match(/(iPad).*OS\s([\d_]+)/);const A=p.match(/(iPod)(.*OS\s([\d_]+))?/),I=!M&&p.match(/(iPhone\sOS|iOS)\s([\d_]+)/),R="Win32"===o;let G="MacIntel"===o;return!M&&G&&i.touch&&["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"].indexOf(`${y}x${C}`)>=0&&(M=p.match(/(Version)\/([\d.]+)/),M||(M=[0,1,"13_0_0"]),G=!1),E&&!R&&(f.os="android",f.android=!0),(M||I||A)&&(f.os="ios",f.ios=!0),f}(n)),gi}({userAgent:o.userAgent}),p.browser=(Nu||(Nu=function(){const n=Qn();return{isSafari:function(){const t=n.navigator.userAgent.toLowerCase();return t.indexOf("safari")>=0&&t.indexOf("chrome")<0&&t.indexOf("android")<0}(),isWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(n.navigator.userAgent)}}()),Nu),p.eventsListeners={},p.eventsAnyListeners=[],p.modules=[...p.__modules__],o.modules&&Array.isArray(o.modules)&&p.modules.push(...o.modules);const f={};p.modules.forEach(C=>{C({swiper:p,extendParams:Sa(o,f),on:p.on.bind(p),once:p.once.bind(p),off:p.off.bind(p),emit:p.emit.bind(p)})});const y=mi({},Fl,f);return p.params=mi({},y,Co,o),p.originalParams=mi({},p.params),p.passedParams=mi({},o),p.params&&p.params.on&&Object.keys(p.params.on).forEach(C=>{p.on(C,p.params.on[C])}),p.params&&p.params.onAny&&p.onAny(p.params.onAny),p.$=ht,Object.assign(p,{enabled:p.params.enabled,el:t,classNames:[],slides:ht(),slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal:()=>"horizontal"===p.params.direction,isVertical:()=>"vertical"===p.params.direction,activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,allowSlideNext:p.params.allowSlideNext,allowSlidePrev:p.params.allowSlidePrev,touchEvents:function(){const E=["touchstart","touchmove","touchend","touchcancel"],M=["pointerdown","pointermove","pointerup"];return p.touchEventsTouch={start:E[0],move:E[1],end:E[2],cancel:E[3]},p.touchEventsDesktop={start:M[0],move:M[1],end:M[2]},p.support.touch||!p.params.simulateTouch?p.touchEventsTouch:p.touchEventsDesktop}(),touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:p.params.focusableElements,lastClickTime:Br(),clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,isTouchEvent:void 0,startMoving:void 0},allowClick:!0,allowTouchMove:p.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),p.emit("_swiper"),p.params.init&&p.init(),p}enable(){const i=this;i.enabled||(i.enabled=!0,i.params.grabCursor&&i.setGrabCursor(),i.emit("enable"))}disable(){const i=this;!i.enabled||(i.enabled=!1,i.params.grabCursor&&i.unsetGrabCursor(),i.emit("disable"))}setProgress(i,t){const o=this;i=Math.min(Math.max(i,0),1);const p=o.minTranslate(),y=(o.maxTranslate()-p)*i+p;o.translateTo(y,void 0===t?0:t),o.updateActiveIndex(),o.updateSlidesClasses()}emitContainerClasses(){const i=this;if(!i.params._emitClasses||!i.el)return;const t=i.el.className.split(" ").filter(o=>0===o.indexOf("swiper")||0===o.indexOf(i.params.containerModifierClass));i.emit("_containerClasses",t.join(" "))}getSlideClasses(i){const t=this;return i.className.split(" ").filter(o=>0===o.indexOf("swiper-slide")||0===o.indexOf(t.params.slideClass)).join(" ")}emitSlidesClasses(){const i=this;if(!i.params._emitClasses||!i.el)return;const t=[];i.slides.each(o=>{const p=i.getSlideClasses(o);t.push({slideEl:o,classNames:p}),i.emit("_slideClass",o,p)}),i.emit("_slideClasses",t)}slidesPerViewDynamic(i="current",t=!1){const{params:p,slides:f,slidesGrid:y,slidesSizesGrid:C,size:E,activeIndex:M}=this;let A=1;if(p.centeredSlides){let R,I=f[M].swiperSlideSize;for(let G=M+1;G<f.length;G+=1)f[G]&&!R&&(I+=f[G].swiperSlideSize,A+=1,I>E&&(R=!0));for(let G=M-1;G>=0;G-=1)f[G]&&!R&&(I+=f[G].swiperSlideSize,A+=1,I>E&&(R=!0))}else if("current"===i)for(let I=M+1;I<f.length;I+=1)(t?y[I]+C[I]-y[M]<E:y[I]-y[M]<E)&&(A+=1);else for(let I=M-1;I>=0;I-=1)y[M]-y[I]<E&&(A+=1);return A}update(){const i=this;if(!i||i.destroyed)return;const{snapGrid:t,params:o}=i;function p(){const C=Math.min(Math.max(i.rtlTranslate?-1*i.translate:i.translate,i.maxTranslate()),i.minTranslate());i.setTranslate(C),i.updateActiveIndex(),i.updateSlidesClasses()}let f;o.breakpoints&&i.setBreakpoint(),i.updateSize(),i.updateSlides(),i.updateProgress(),i.updateSlidesClasses(),i.params.freeMode&&i.params.freeMode.enabled?(p(),i.params.autoHeight&&i.updateAutoHeight()):(f=i.slideTo(("auto"===i.params.slidesPerView||i.params.slidesPerView>1)&&i.isEnd&&!i.params.centeredSlides?i.slides.length-1:i.activeIndex,0,!1,!0),f||p()),o.watchOverflow&&t!==i.snapGrid&&i.checkOverflow(),i.emit("update")}changeDirection(i,t=!0){const o=this,p=o.params.direction;return i||(i="horizontal"===p?"vertical":"horizontal"),i===p||"horizontal"!==i&&"vertical"!==i||(o.$el.removeClass(`${o.params.containerModifierClass}${p}`).addClass(`${o.params.containerModifierClass}${i}`),o.emitContainerClasses(),o.params.direction=i,o.slides.each(f=>{"vertical"===i?f.style.width="":f.style.height=""}),o.emit("changeDirection"),t&&o.update()),o}mount(i){const t=this;if(t.mounted)return!0;const o=ht(i||t.params.el);if(!(i=o[0]))return!1;i.swiper=t;const p=()=>`.${(t.params.wrapperClass||"").trim().split(" ").join(".")}`;let y=(()=>{if(i&&i.shadowRoot&&i.shadowRoot.querySelector){const C=ht(i.shadowRoot.querySelector(p()));return C.children=E=>o.children(E),C}return o.children(p())})();if(0===y.length&&t.params.createElements){const E=di().createElement("div");y=ht(E),E.className=t.params.wrapperClass,o.append(E),o.children(`.${t.params.slideClass}`).each(M=>{y.append(M)})}return Object.assign(t,{$el:o,el:i,$wrapperEl:y,wrapperEl:y[0],mounted:!0,rtl:"rtl"===i.dir.toLowerCase()||"rtl"===o.css("direction"),rtlTranslate:"horizontal"===t.params.direction&&("rtl"===i.dir.toLowerCase()||"rtl"===o.css("direction")),wrongRTL:"-webkit-box"===y.css("display")}),!0}init(i){const t=this;return t.initialized||!1===t.mount(i)||(t.emit("beforeInit"),t.params.breakpoints&&t.setBreakpoint(),t.addClasses(),t.params.loop&&t.loopCreate(),t.updateSize(),t.updateSlides(),t.params.watchOverflow&&t.checkOverflow(),t.params.grabCursor&&t.enabled&&t.setGrabCursor(),t.params.preloadImages&&t.preloadImages(),t.slideTo(t.params.loop?t.params.initialSlide+t.loopedSlides:t.params.initialSlide,0,t.params.runCallbacksOnInit,!1,!0),t.attachEvents(),t.initialized=!0,t.emit("init"),t.emit("afterInit")),t}destroy(i=!0,t=!0){const o=this,{params:p,$el:f,$wrapperEl:y,slides:C}=o;return void 0===o.params||o.destroyed||(o.emit("beforeDestroy"),o.initialized=!1,o.detachEvents(),p.loop&&o.loopDestroy(),t&&(o.removeClasses(),f.removeAttr("style"),y.removeAttr("style"),C&&C.length&&C.removeClass([p.slideVisibleClass,p.slideActiveClass,p.slideNextClass,p.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-slide-index")),o.emit("destroy"),Object.keys(o.eventsListeners).forEach(E=>{o.off(E)}),!1!==i&&(o.$el[0].swiper=null,function(n){const i=n;Object.keys(i).forEach(t=>{try{i[t]=null}catch(o){}try{delete i[t]}catch(o){}})}(o)),o.destroyed=!0),null}static extendDefaults(i){mi(Co,i)}static get extendedDefaults(){return Co}static get defaults(){return Fl}static installModule(i){Ii.prototype.__modules__||(Ii.prototype.__modules__=[]);const t=Ii.prototype.__modules__;"function"==typeof i&&t.indexOf(i)<0&&t.push(i)}static use(i){return Array.isArray(i)?(i.forEach(t=>Ii.installModule(t)),Ii):(Ii.installModule(i),Ii)}}Object.keys(Bs).forEach(n=>{Object.keys(Bs[n]).forEach(i=>{Ii.prototype[i]=Bs[n][i]})}),Ii.use([function({swiper:n,on:i,emit:t}){const o=Qn();let p=null;const f=()=>{!n||n.destroyed||!n.initialized||(t("beforeResize"),t("resize"))},E=()=>{!n||n.destroyed||!n.initialized||t("orientationchange")};i("init",()=>{n.params.resizeObserver&&void 0!==o.ResizeObserver?!n||n.destroyed||!n.initialized||(p=new ResizeObserver(M=>{const{width:A,height:I}=n;let R=A,G=I;M.forEach(({contentBoxSize:W,contentRect:se,target:ne})=>{ne&&ne!==n.el||(R=se?se.width:(W[0]||W).inlineSize,G=se?se.height:(W[0]||W).blockSize)}),(R!==A||G!==I)&&f()}),p.observe(n.el)):(o.addEventListener("resize",f),o.addEventListener("orientationchange",E))}),i("destroy",()=>{p&&p.unobserve&&n.el&&(p.unobserve(n.el),p=null),o.removeEventListener("resize",f),o.removeEventListener("orientationchange",E)})},function({swiper:n,extendParams:i,on:t,emit:o}){const p=[],f=Qn(),y=(M,A={})=>{const R=new(f.MutationObserver||f.WebkitMutationObserver)(G=>{if(1===G.length)return void o("observerUpdate",G[0]);const W=function(){o("observerUpdate",G[0])};f.requestAnimationFrame?f.requestAnimationFrame(W):f.setTimeout(W,0)});R.observe(M,{attributes:void 0===A.attributes||A.attributes,childList:void 0===A.childList||A.childList,characterData:void 0===A.characterData||A.characterData}),p.push(R)};i({observer:!1,observeParents:!1,observeSlideChildren:!1}),t("init",()=>{if(n.params.observer){if(n.params.observeParents){const M=n.$el.parents();for(let A=0;A<M.length;A+=1)y(M[A])}y(n.$el[0],{childList:n.params.observeSlideChildren}),y(n.$wrapperEl[0],{attributes:!1})}}),t("destroy",()=>{p.forEach(M=>{M.disconnect()}),p.splice(0,p.length)})}]);const Wo=Ii;var fp=Vt(168);const $r=JSON.parse('{"W":{"1":"#e31a1c","2":"#fdbf6f","3":"#33a02c","4":"#aaaaaa"}}');var mp=Vt(5306),jl=Vt(4438);const Ku=JSON.parse('[{"name":"CAORLE","lat":45.6030238,"long":12.8859589},{"name":"JESOLO","lat":45.5334198,"long":12.6438498},{"name":"MUSILE DI PIAVE","lat":45.6244348,"long":12.563901},{"name":"SAN MICHELE AL TAGLIAMENTO","lat":45.7054178,"long":13.0019979},{"name":"SAN DONA\' DI PIAVE","lat":45.633333,"long":12.566667},{"name":"ERACLEA","lat":45.5808511,"long":12.6801548},{"name":"CONCORDIA SAGITTARIA","lat":45.7572285,"long":12.842294},{"name":"PORTOGRUARO","lat":45.7805759,"long":12.8373992},{"name":"ANNONE VENETO","lat":45.7957523,"long":12.6833548},{"name":"FOSSALTA DI PIAVE","lat":45.6467509,"long":12.513665},{"name":"NOVENTA DI PIAVE","lat":45.6604188,"long":12.5301585},{"name":"SAN STINO DI LIVENZA","lat":45.7297158,"long":12.6813746},{"name":"MEOLO","lat":45.6180406,"long":12.4538437},{"name":"TORRE DI MOSTO","lat":45.6877244,"long":12.7041963},{"name":"CINTO CAOMAGGIORE","lat":45.8248435,"long":12.7860829},{"name":"PRAMAGGIORE","lat":45.7998068,"long":12.7234046},{"name":"CEGGIA","lat":45.6890925,"long":12.639028}]');var sh=Vt(9570),xr=Vt(8239);const Ze=function(n,i){if(!n)throw Zo(i)},Zo=function(n){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+n)},rs=function(n){const i=[];let t=0;for(let o=0;o<n.length;o++){let p=n.charCodeAt(o);p<128?i[t++]=p:p<2048?(i[t++]=p>>6|192,i[t++]=63&p|128):55296==(64512&p)&&o+1<n.length&&56320==(64512&n.charCodeAt(o+1))?(p=65536+((1023&p)<<10)+(1023&n.charCodeAt(++o)),i[t++]=p>>18|240,i[t++]=p>>12&63|128,i[t++]=p>>6&63|128,i[t++]=63&p|128):(i[t++]=p>>12|224,i[t++]=p>>6&63|128,i[t++]=63&p|128)}return i},js={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,i){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=i?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let p=0;p<n.length;p+=3){const f=n[p],y=p+1<n.length,C=y?n[p+1]:0,E=p+2<n.length,M=E?n[p+2]:0;let R=(15&C)<<2|M>>6,G=63&M;E||(G=64,y||(R=64)),o.push(t[f>>2],t[(3&f)<<4|C>>4],t[R],t[G])}return o.join("")},encodeString(n,i){return this.HAS_NATIVE_SUPPORT&&!i?btoa(n):this.encodeByteArray(rs(n),i)},decodeString(n,i){return this.HAS_NATIVE_SUPPORT&&!i?atob(n):function(n){const i=[];let t=0,o=0;for(;t<n.length;){const p=n[t++];if(p<128)i[o++]=String.fromCharCode(p);else if(p>191&&p<224){const f=n[t++];i[o++]=String.fromCharCode((31&p)<<6|63&f)}else if(p>239&&p<365){const E=((7&p)<<18|(63&n[t++])<<12|(63&n[t++])<<6|63&n[t++])-65536;i[o++]=String.fromCharCode(55296+(E>>10)),i[o++]=String.fromCharCode(56320+(1023&E))}else{const f=n[t++],y=n[t++];i[o++]=String.fromCharCode((15&p)<<12|(63&f)<<6|63&y)}}return i.join("")}(this.decodeStringToByteArray(n,i))},decodeStringToByteArray(n,i){this.init_();const t=i?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let p=0;p<n.length;){const f=t[n.charAt(p++)],C=p<n.length?t[n.charAt(p)]:0;++p;const M=p<n.length?t[n.charAt(p)]:64;++p;const I=p<n.length?t[n.charAt(p)]:64;if(++p,null==f||null==C||null==M||null==I)throw Error();o.push(f<<2|C>>4),64!==M&&(o.push(C<<4&240|M>>2),64!==I&&o.push(M<<6&192|I))}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},an=function(n){const i=rs(n);return js.encodeByteArray(i,!0)},Ta=function(n){return an(n).replace(/\./g,"")},Xo=function(n){try{return js.decodeString(n,!0)}catch(i){console.error("base64Decode failed: ",i)}return null};function Yo(n){return rn(void 0,n)}function rn(n,i){if(!(i instanceof Object))return i;switch(i.constructor){case Date:return new Date(i.getTime());case Object:void 0===n&&(n={});break;case Array:n=[];break;default:return i}for(const t in i)!i.hasOwnProperty(t)||!Ht(t)||(n[t]=rn(n[t],i[t]));return n}function Ht(n){return"__proto__"!==n}class Eo{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((i,t)=>{this.resolve=i,this.reject=t})}wrapCallback(i){return(t,o)=>{t?this.reject(t):this.resolve(o),"function"==typeof i&&(this.promise.catch(()=>{}),1===i.length?i(t):i(t,o))}}}function Ia(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}class Li extends Error{constructor(i,t,o){super(t),this.code=i,this.customData=o,this.name="FirebaseError",Object.setPrototypeOf(this,Li.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,os.prototype.create)}}class os{constructor(i,t,o){this.service=i,this.serviceName=t,this.errors=o}create(i,...t){const o=t[0]||{},p=`${this.service}/${i}`,f=this.errors[i],y=f?function(n,i){return n.replace(tt,(t,o)=>{const p=i[o];return null!=p?String(p):`<${o}?>`})}(f,o):"Error";return new Li(p,`${this.serviceName}: ${y} (${p}).`,o)}}const tt=/\{\$([^}]+)}/g;function Qo(n){return JSON.parse(n)}function ri(n){return JSON.stringify(n)}const Gi=function(n){let i={},t={},o={},p="";try{const f=n.split(".");i=Qo(Xo(f[0])||""),t=Qo(Xo(f[1])||""),p=f[2],o=t.d||{},delete t.d}catch(f){}return{header:i,claims:t,data:o,signature:p}};function qn(n,i){return Object.prototype.hasOwnProperty.call(n,i)}function ar(n,i){if(Object.prototype.hasOwnProperty.call(n,i))return n[i]}function Ws(n){for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i))return!1;return!0}function as(n,i,t){const o={};for(const p in n)Object.prototype.hasOwnProperty.call(n,p)&&(o[p]=i.call(t,n[p],p,n));return o}function Zs(n,i){if(n===i)return!0;const t=Object.keys(n),o=Object.keys(i);for(const p of t){if(!o.includes(p))return!1;const f=n[p],y=i[p];if(wr(f)&&wr(y)){if(!Zs(f,y))return!1}else if(f!==y)return!1}for(const p of o)if(!t.includes(p))return!1;return!0}function wr(n){return null!==n&&"object"==typeof n}class Cr{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let i=1;i<this.blockSize;++i)this.pad_[i]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(i,t){t||(t=0);const o=this.W_;if("string"==typeof i)for(let I=0;I<16;I++)o[I]=i.charCodeAt(t)<<24|i.charCodeAt(t+1)<<16|i.charCodeAt(t+2)<<8|i.charCodeAt(t+3),t+=4;else for(let I=0;I<16;I++)o[I]=i[t]<<24|i[t+1]<<16|i[t+2]<<8|i[t+3],t+=4;for(let I=16;I<80;I++){const R=o[I-3]^o[I-8]^o[I-14]^o[I-16];o[I]=4294967295&(R<<1|R>>>31)}let M,A,p=this.chain_[0],f=this.chain_[1],y=this.chain_[2],C=this.chain_[3],E=this.chain_[4];for(let I=0;I<80;I++){I<40?I<20?(M=C^f&(y^C),A=1518500249):(M=f^y^C,A=1859775393):I<60?(M=f&y|C&(f|y),A=2400959708):(M=f^y^C,A=3395469782);const R=(p<<5|p>>>27)+M+E+A+o[I]&4294967295;E=C,C=y,y=4294967295&(f<<30|f>>>2),f=p,p=R}this.chain_[0]=this.chain_[0]+p&4294967295,this.chain_[1]=this.chain_[1]+f&4294967295,this.chain_[2]=this.chain_[2]+y&4294967295,this.chain_[3]=this.chain_[3]+C&4294967295,this.chain_[4]=this.chain_[4]+E&4294967295}update(i,t){if(null==i)return;void 0===t&&(t=i.length);const o=t-this.blockSize;let p=0;const f=this.buf_;let y=this.inbuf_;for(;p<t;){if(0===y)for(;p<=o;)this.compress_(i,p),p+=this.blockSize;if("string"==typeof i){for(;p<t;)if(f[y]=i.charCodeAt(p),++y,++p,y===this.blockSize){this.compress_(f),y=0;break}}else for(;p<t;)if(f[y]=i[p],++y,++p,y===this.blockSize){this.compress_(f),y=0;break}}this.inbuf_=y,this.total_+=t}digest(){const i=[];let t=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(let p=this.blockSize-1;p>=56;p--)this.buf_[p]=255&t,t/=256;this.compress_(this.buf_);let o=0;for(let p=0;p<5;p++)for(let f=24;f>=0;f-=8)i[o]=this.chain_[p]>>f&255,++o;return i}}function jr(n,i){return`${n} failed: ${i} argument `}const Tr=function(n){let i=0;for(let t=0;t<n.length;t++){const o=n.charCodeAt(t);o<128?i++:o<2048?i+=2:o>=55296&&o<=56319?(i+=4,t++):i+=3}return i};function Ma(n){return n&&n._delegate?n._delegate:n}class cr{constructor(i,t,o){this.name=i,this.instanceFactory=t,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(i){return this.instantiationMode=i,this}setMultipleInstances(i){return this.multipleInstances=i,this}setServiceProps(i){return this.serviceProps=i,this}setInstanceCreatedCallback(i){return this.onInstanceCreated=i,this}}const si="[DEFAULT]";class Zl{constructor(i,t){this.name=i,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(i){const t=this.normalizeInstanceIdentifier(i);if(!this.instancesDeferred.has(t)){const o=new Eo;if(this.instancesDeferred.set(t,o),this.isInitialized(t)||this.shouldAutoInitialize())try{const p=this.getOrInitializeService({instanceIdentifier:t});p&&o.resolve(p)}catch(p){}}return this.instancesDeferred.get(t).promise}getImmediate(i){var t;const o=this.normalizeInstanceIdentifier(null==i?void 0:i.identifier),p=null!==(t=null==i?void 0:i.optional)&&void 0!==t&&t;if(!this.isInitialized(o)&&!this.shouldAutoInitialize()){if(p)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:o})}catch(f){if(p)return null;throw f}}getComponent(){return this.component}setComponent(i){if(i.name!==this.name)throw Error(`Mismatching Component ${i.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=i,this.shouldAutoInitialize()){if("EAGER"===i.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:si})}catch(t){}for(const[t,o]of this.instancesDeferred.entries()){const p=this.normalizeInstanceIdentifier(t);try{const f=this.getOrInitializeService({instanceIdentifier:p});o.resolve(f)}catch(f){}}}}clearInstance(i=si){this.instancesDeferred.delete(i),this.instancesOptions.delete(i),this.instances.delete(i)}delete(){var i=this;return(0,xr.Z)(function*(){const t=Array.from(i.instances.values());yield Promise.all([...t.filter(o=>"INTERNAL"in o).map(o=>o.INTERNAL.delete()),...t.filter(o=>"_delete"in o).map(o=>o._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(i=si){return this.instances.has(i)}getOptions(i=si){return this.instancesOptions.get(i)||{}}initialize(i={}){const{options:t={}}=i,o=this.normalizeInstanceIdentifier(i.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const p=this.getOrInitializeService({instanceIdentifier:o,options:t});for(const[f,y]of this.instancesDeferred.entries())o===this.normalizeInstanceIdentifier(f)&&y.resolve(p);return p}onInit(i,t){var o;const p=this.normalizeInstanceIdentifier(t),f=null!==(o=this.onInitCallbacks.get(p))&&void 0!==o?o:new Set;f.add(i),this.onInitCallbacks.set(p,f);const y=this.instances.get(p);return y&&i(y,p),()=>{f.delete(i)}}invokeOnInitCallbacks(i,t){const o=this.onInitCallbacks.get(t);if(o)for(const p of o)try{p(i,t)}catch(f){}}getOrInitializeService({instanceIdentifier:i,options:t={}}){let o=this.instances.get(i);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:(n=i,n===si?void 0:n),options:t}),this.instances.set(i,o),this.instancesOptions.set(i,t),this.invokeOnInitCallbacks(o,i),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,i,o)}catch(p){}var n;return o||null}normalizeInstanceIdentifier(i=si){return this.component?this.component.multipleInstances?i:si:i}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ls{constructor(i){this.name=i,this.providers=new Map}addComponent(i){const t=this.getProvider(i.name);if(t.isComponentSet())throw new Error(`Component ${i.name} has already been registered with ${this.name}`);t.setComponent(i)}addOrOverwriteComponent(i){this.getProvider(i.name).isComponentSet()&&this.providers.delete(i.name),this.addComponent(i)}getProvider(i){if(this.providers.has(i))return this.providers.get(i);const t=new Zl(i,this);return this.providers.set(i,t),t}getProviders(){return Array.from(this.providers.values())}}const Pa=[];var pn=(()=>{return(n=pn||(pn={}))[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",pn;var n})();const us={debug:pn.DEBUG,verbose:pn.VERBOSE,info:pn.INFO,warn:pn.WARN,error:pn.ERROR,silent:pn.SILENT},Jo=pn.INFO,tc={[pn.DEBUG]:"log",[pn.VERBOSE]:"log",[pn.INFO]:"info",[pn.WARN]:"warn",[pn.ERROR]:"error"},nc=(n,i,...t)=>{if(i<n.logLevel)return;const o=(new Date).toISOString(),p=tc[i];if(!p)throw new Error(`Attempted to log a message with an invalid logType (value: ${i})`);console[p](`[${o}]  ${n.name}:`,...t)};class ir{constructor(i){this.name=i,this._logLevel=Jo,this._logHandler=nc,this._userLogHandler=null,Pa.push(this)}get logLevel(){return this._logLevel}set logLevel(i){if(!(i in pn))throw new TypeError(`Invalid value "${i}" assigned to \`logLevel\``);this._logLevel=i}setLogLevel(i){this._logLevel="string"==typeof i?us[i]:i}get logHandler(){return this._logHandler}set logHandler(i){if("function"!=typeof i)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=i}get userLogHandler(){return this._userLogHandler}set userLogHandler(i){this._userLogHandler=i}debug(...i){this._userLogHandler&&this._userLogHandler(this,pn.DEBUG,...i),this._logHandler(this,pn.DEBUG,...i)}log(...i){this._userLogHandler&&this._userLogHandler(this,pn.VERBOSE,...i),this._logHandler(this,pn.VERBOSE,...i)}info(...i){this._userLogHandler&&this._userLogHandler(this,pn.INFO,...i),this._logHandler(this,pn.INFO,...i)}warn(...i){this._userLogHandler&&this._userLogHandler(this,pn.WARN,...i),this._logHandler(this,pn.WARN,...i)}error(...i){this._userLogHandler&&this._userLogHandler(this,pn.ERROR,...i),this._logHandler(this,pn.ERROR,...i)}}let Xl,Yl;const s=new WeakMap,u=new WeakMap,l=new WeakMap,h=new WeakMap,_=new WeakMap;let S={get(n,i,t){if(n instanceof IDBTransaction){if("done"===i)return u.get(n);if("objectStoreNames"===i)return n.objectStoreNames||l.get(n);if("store"===i)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return H(n[i])},set:(n,i,t)=>(n[i]=t,!0),has:(n,i)=>n instanceof IDBTransaction&&("done"===i||"store"===i)||i in n};function j(n){return"function"==typeof n?function(n){return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Yl||(Yl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(n)?function(...i){return n.apply(q(this),i),H(s.get(this))}:function(...i){return H(n.apply(q(this),i))}:function(i,...t){const o=n.call(q(this),i,...t);return l.set(o,i.sort?i.sort():[i]),H(o)}}(n):(n instanceof IDBTransaction&&function(n){if(u.has(n))return;const i=new Promise((t,o)=>{const p=()=>{n.removeEventListener("complete",f),n.removeEventListener("error",y),n.removeEventListener("abort",y)},f=()=>{t(),p()},y=()=>{o(n.error||new DOMException("AbortError","AbortError")),p()};n.addEventListener("complete",f),n.addEventListener("error",y),n.addEventListener("abort",y)});u.set(n,i)}(n),((n,i)=>i.some(t=>n instanceof t))(n,Xl||(Xl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(n,S):n)}function H(n){if(n instanceof IDBRequest)return function(n){const i=new Promise((t,o)=>{const p=()=>{n.removeEventListener("success",f),n.removeEventListener("error",y)},f=()=>{t(H(n.result)),p()},y=()=>{o(n.error),p()};n.addEventListener("success",f),n.addEventListener("error",y)});return i.then(t=>{t instanceof IDBCursor&&s.set(t,n)}).catch(()=>{}),_.set(i,n),i}(n);if(h.has(n))return h.get(n);const i=j(n);return i!==n&&(h.set(n,i),_.set(i,n)),i}const q=n=>_.get(n),ae=["get","getKey","getAll","getAllKeys","count"],Q=["put","add","delete","clear"],re=new Map;function pe(n,i){if(!(n instanceof IDBDatabase)||i in n||"string"!=typeof i)return;if(re.get(i))return re.get(i);const t=i.replace(/FromIndex$/,""),o=i!==t,p=Q.includes(t);if(!(t in(o?IDBIndex:IDBObjectStore).prototype)||!p&&!ae.includes(t))return;const f=function(){var y=(0,xr.Z)(function*(C,...E){const M=this.transaction(C,p?"readwrite":"readonly");let A=M.store;return o&&(A=A.index(E.shift())),(yield Promise.all([A[t](...E),p&&M.done]))[0]});return function(E){return y.apply(this,arguments)}}();return re.set(i,f),f}var n;S=fg(dg({},n=S),{get:(i,t,o)=>pe(i,t)||n.get(i,t,o),has:(i,t)=>!!pe(i,t)||n.has(i,t)});class fe{constructor(i){this.container=i}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function(n){const i=n.getComponent();return"VERSION"===(null==i?void 0:i.type)}(t)){const o=t.getImmediate();return`${o.library}/${o.version}`}return null}).filter(t=>t).join(" ")}}const xe="@firebase/app",Ie=new ir("@firebase/app"),Mr="[DEFAULT]",pr={[xe]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Mo=new Map,qr=new Map;function hs(n,i){try{n.container.addComponent(i)}catch(t){Ie.debug(`Component ${i.name} failed to register with FirebaseApp ${n.name}`,t)}}function ea(n){const i=n.name;if(qr.has(i))return Ie.debug(`There were multiple attempts to register component ${i}.`),!1;qr.set(i,n);for(const t of Mo.values())hs(t,n);return!0}const Bi=new os("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."});class Gr{constructor(i,t,o){this._isDeleted=!1,this._options=Object.assign({},i),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new cr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(i){this.checkDestroyed(),this._automaticDataCollectionEnabled=i}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(i){this._isDeleted=i}checkDestroyed(){if(this.isDeleted)throw Bi.create("app-deleted",{appName:this._name})}}function fs(n,i,t){var o;let p=null!==(o=pr[n])&&void 0!==o?o:n;t&&(p+=`-${t}`);const f=p.match(/\s|\//),y=i.match(/\s|\//);if(f||y){const C=[`Unable to register library "${p}" with version "${i}":`];return f&&C.push(`library name "${p}" contains illegal characters (whitespace or "/")`),f&&y&&C.push("and"),y&&C.push(`version name "${i}" contains illegal characters (whitespace or "/")`),void Ie.warn(C.join(" "))}ea(new cr(`${p}-version`,()=>({library:p,version:i}),"VERSION"))}const Po="firebase-heartbeat-store";let ph=null;function dh(){return ph||(ph=function(n,i,{blocked:t,upgrade:o,blocking:p,terminated:f}={}){const y=indexedDB.open(n,i),C=H(y);return o&&y.addEventListener("upgradeneeded",E=>{o(H(y.result),E.oldVersion,E.newVersion,H(y.transaction))}),t&&y.addEventListener("blocked",()=>t()),C.then(E=>{f&&E.addEventListener("close",()=>f()),p&&E.addEventListener("versionchange",()=>p())}).catch(()=>{}),C}("firebase-heartbeat-database",1,{upgrade:(n,i)=>{0===i&&n.createObjectStore(Po)}}).catch(n=>{throw Bi.create("storage-open",{originalErrorMessage:n.message})})),ph}function Vi(){return Vi=(0,xr.Z)(function*(n){var i;try{return(yield dh()).transaction(Po).objectStore(Po).get(nd(n))}catch(t){throw Bi.create("storage-get",{originalErrorMessage:null===(i=t)||void 0===i?void 0:i.message})}}),Vi.apply(this,arguments)}function td(n,i){return fh.apply(this,arguments)}function fh(){return fh=(0,xr.Z)(function*(n,i){var t;try{const p=(yield dh()).transaction(Po,"readwrite");return yield p.objectStore(Po).put(i,nd(n)),p.done}catch(o){throw Bi.create("storage-set",{originalErrorMessage:null===(t=o)||void 0===t?void 0:t.message})}}),fh.apply(this,arguments)}function nd(n){return`${n.name}!${n.options.appId}`}class _f{constructor(i){this.container=i,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new gh(t),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}triggerHeartbeat(){var i=this;return(0,xr.Z)(function*(){const o=i.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),p=mh();if(null===i._heartbeatsCache&&(i._heartbeatsCache=yield i._heartbeatsCachePromise),i._heartbeatsCache.lastSentHeartbeatDate!==p&&!i._heartbeatsCache.heartbeats.some(f=>f.date===p))return i._heartbeatsCache.heartbeats.push({date:p,agent:o}),i._heartbeatsCache.heartbeats=i._heartbeatsCache.heartbeats.filter(f=>{const y=new Date(f.date).valueOf();return Date.now()-y<=2592e6}),i._storage.overwrite(i._heartbeatsCache)})()}getHeartbeatsHeader(){var i=this;return(0,xr.Z)(function*(){if(null===i._heartbeatsCache&&(yield i._heartbeatsCachePromise),null===i._heartbeatsCache||0===i._heartbeatsCache.heartbeats.length)return"";const t=mh(),{heartbeatsToSend:o,unsentEntries:p}=function(n,i=1024){const t=[];let o=n.slice();for(const p of n){const f=t.find(y=>y.agent===p.agent);if(f){if(f.dates.push(p.date),_p(t)>i){f.dates.pop();break}}else if(t.push({agent:p.agent,dates:[p.date]}),_p(t)>i){t.pop();break}o=o.slice(1)}return{heartbeatsToSend:t,unsentEntries:o}}(i._heartbeatsCache.heartbeats),f=Ta(JSON.stringify({version:2,heartbeats:o}));return i._heartbeatsCache.lastSentHeartbeatDate=t,p.length>0?(i._heartbeatsCache.heartbeats=p,yield i._storage.overwrite(i._heartbeatsCache)):(i._heartbeatsCache.heartbeats=[],i._storage.overwrite(i._heartbeatsCache)),f})()}}function mh(){return(new Date).toISOString().substring(0,10)}class gh{constructor(i){this.app=i,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,xr.Z)(function*(){return"object"==typeof indexedDB&&new Promise((n,i)=>{try{let t=!0;const o="validate-browser-context-for-indexeddb-analytics-module",p=self.indexedDB.open(o);p.onsuccess=()=>{p.result.close(),t||self.indexedDB.deleteDatabase(o),n(!0)},p.onupgradeneeded=()=>{t=!1},p.onerror=()=>{var f;i((null===(f=p.error)||void 0===f?void 0:f.message)||"")}}catch(t){i(t)}}).then(()=>!0).catch(()=>!1)})()}read(){var i=this;return(0,xr.Z)(function*(){return(yield i._canUseIndexedDBPromise)&&(yield function(n){return Vi.apply(this,arguments)}(i.app))||{heartbeats:[]}})()}overwrite(i){var t=this;return(0,xr.Z)(function*(){var o;if(yield t._canUseIndexedDBPromise){const f=yield t.read();return td(t.app,{lastSentHeartbeatDate:null!==(o=i.lastSentHeartbeatDate)&&void 0!==o?o:f.lastSentHeartbeatDate,heartbeats:i.heartbeats})}})()}add(i){var t=this;return(0,xr.Z)(function*(){var o;if(yield t._canUseIndexedDBPromise){const f=yield t.read();return td(t.app,{lastSentHeartbeatDate:null!==(o=i.lastSentHeartbeatDate)&&void 0!==o?o:f.lastSentHeartbeatDate,heartbeats:[...f.heartbeats,...i.heartbeats]})}})()}}function _p(n){return Ta(JSON.stringify({version:2,heartbeats:n})).length}ea(new cr("platform-logger",i=>new fe(i),"PRIVATE")),ea(new cr("heartbeat",i=>new _f(i),"PRIVATE")),fs(xe,"0.7.26",""),fs(xe,"0.7.26","esm2017"),fs("fire-js","");const Jl="@firebase/database";let vp="";class xf{constructor(i){this.domStorage_=i,this.prefix_="firebase:"}set(i,t){null==t?this.domStorage_.removeItem(this.prefixedName_(i)):this.domStorage_.setItem(this.prefixedName_(i),ri(t))}get(i){const t=this.domStorage_.getItem(this.prefixedName_(i));return null==t?null:Qo(t)}remove(i){this.domStorage_.removeItem(this.prefixedName_(i))}prefixedName_(i){return this.prefix_+i}toString(){return this.domStorage_.toString()}}class bf{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(i,t){null==t?delete this.cache_[i]:this.cache_[i]=t}get(i){return qn(this.cache_,i)?this.cache_[i]:null}remove(i){delete this.cache_[i]}}const rd=function(n){try{if("undefined"!=typeof window&&void 0!==window[n]){const i=window[n];return i.setItem("firebase:sentinel","cache"),i.removeItem("firebase:sentinel"),new xf(i)}}catch(i){}return new bf},Js=rd("localStorage"),ac=rd("sessionStorage"),eu=new ir("@firebase/database"),el=function(){let n=1;return function(){return n++}}(),od=function(n){const i=function(n){const i=[];let t=0;for(let o=0;o<n.length;o++){let p=n.charCodeAt(o);if(p>=55296&&p<=56319){const f=p-55296;o++,Ze(o<n.length,"Surrogate pair missing trail surrogate."),p=65536+(f<<10)+(n.charCodeAt(o)-56320)}p<128?i[t++]=p:p<2048?(i[t++]=p>>6|192,i[t++]=63&p|128):p<65536?(i[t++]=p>>12|224,i[t++]=p>>6&63|128,i[t++]=63&p|128):(i[t++]=p>>18|240,i[t++]=p>>12&63|128,i[t++]=p>>6&63|128,i[t++]=63&p|128)}return i}(n),t=new Cr;t.update(i);const o=t.digest();return js.encodeByteArray(o)},On=function(...n){let i="";for(let t=0;t<n.length;t++){const o=n[t];Array.isArray(o)||o&&"object"==typeof o&&"number"==typeof o.length?i+=On.apply(null,o):i+="object"==typeof o?ri(o):o,i+=" "}return i};let ta=null,yp=!0;const vi=function(...n){if(!0===yp&&(yp=!1,null===ta&&!0===ac.get("logging_enabled")&&function(n,i){Ze(!i||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(eu.logLevel=pn.VERBOSE,ta=eu.log.bind(eu),i&&ac.set("logging_enabled",!0)):"function"==typeof n?ta=n:(ta=null,ac.remove("logging_enabled"))}(!0)),ta){const i=On.apply(null,n);ta(i)}},Oa=function(n){return function(...i){vi(n,...i)}},_h=function(...n){const i="FIREBASE INTERNAL ERROR: "+On(...n);eu.error(i)},ko=function(...n){const i=`FIREBASE FATAL ERROR: ${On(...n)}`;throw eu.error(i),new Error(i)},Ei=function(...n){const i="FIREBASE WARNING: "+On(...n);eu.warn(i)},tu=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Hr="[MIN_NAME]",na="[MAX_NAME]",za=function(n,i){if(n===i)return 0;if(n===Hr||i===na)return-1;if(i===Hr||n===na)return 1;{const t=uc(n),o=uc(i);return null!==t?null!==o?t-o==0?n.length-i.length:t-o:-1:null!==o?1:n<i?-1:1}},Cf=function(n,i){return n===i?0:n<i?-1:1},tl=function(n,i){if(i&&n in i)return i[n];throw new Error("Missing required key ("+n+") in object: "+ri(i))},lc=function(n){if("object"!=typeof n||null===n)return ri(n);const i=[];for(const o in n)i.push(o);i.sort();let t="{";for(let o=0;o<i.length;o++)0!==o&&(t+=","),t+=ri(i[o]),t+=":",t+=lc(n[i[o]]);return t+="}",t},ao=function(n,i){const t=n.length;if(t<=i)return[n];const o=[];for(let p=0;p<t;p+=i)o.push(n.substring(p,p+i>t?t:p+i));return o};function Ui(n,i){for(const t in n)n.hasOwnProperty(t)&&i(t,n[t])}const ad=function(n){Ze(!tu(n),"Invalid JSON number");const o=1023;let p,f,y,C,E;0===n?(f=0,y=0,p=1/n==-1/0?1:0):(p=n<0,(n=Math.abs(n))>=Math.pow(2,1-o)?(C=Math.min(Math.floor(Math.log(n)/Math.LN2),o),f=C+o,y=Math.round(n*Math.pow(2,52-C)-Math.pow(2,52))):(f=0,y=Math.round(n/Math.pow(2,-1074))));const M=[];for(E=52;E;E-=1)M.push(y%2?1:0),y=Math.floor(y/2);for(E=11;E;E-=1)M.push(f%2?1:0),f=Math.floor(f/2);M.push(p?1:0),M.reverse();const A=M.join("");let I="";for(E=0;E<64;E+=8){let R=parseInt(A.substr(E,8),2).toString(16);1===R.length&&(R="0"+R),I+=R}return I.toLowerCase()},nu=new RegExp("^-?(0*)\\d{1,10}$"),uc=function(n){if(nu.test(n)){const i=Number(n);if(i>=-2147483648&&i<=2147483647)return i}return null},nl=function(n){try{n()}catch(i){setTimeout(()=>{throw Ei("Exception was thrown by user callback.",i.stack||""),i},Math.floor(0))}},cc=function(n,i){const t=setTimeout(n,i);return"object"==typeof t&&t.unref&&t.unref(),t};class iu{constructor(i,t){this.appName_=i,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(o=>this.appCheck=o)}getToken(i){return this.appCheck?this.appCheck.getToken(i):new Promise((t,o)=>{setTimeout(()=>{this.appCheck?this.getToken(i).then(t,o):t(null)},0)})}addTokenChangeListener(i){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(o=>o.addTokenListener(i))}notifyForInvalidToken(){Ei(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class If{constructor(i,t,o){this.appName_=i,this.firebaseOptions_=t,this.authProvider_=o,this.auth_=null,this.auth_=o.getImmediate({optional:!0}),this.auth_||o.onInit(p=>this.auth_=p)}getToken(i){return this.auth_?this.auth_.getToken(i).catch(t=>t&&"auth/token-not-initialized"===t.code?(vi("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,o)=>{setTimeout(()=>{this.auth_?this.getToken(i).then(t,o):t(null)},0)})}addTokenChangeListener(i){this.auth_?this.auth_.addAuthTokenListener(i):this.authProvider_.get().then(t=>t.addAuthTokenListener(i))}removeTokenChangeListener(i){this.authProvider_.get().then(t=>t.removeAuthTokenListener(i))}notifyForInvalidToken(){let i='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';i+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ei(i)}}let il=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const ru=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,dd="websocket",fd="long_polling";class vh{constructor(i,t,o,p,f=!1,y="",C=!1){this.secure=t,this.namespace=o,this.webSocketOnly=p,this.nodeAdmin=f,this.persistenceKey=y,this.includeNamespaceInQueryParams=C,this._host=i.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Js.get("host:"+i)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(i){i!==this.internalHost&&(this.internalHost=i,this.isCacheableHost()&&Js.set("host:"+this._host,this.internalHost))}toString(){let i=this.toURLString();return this.persistenceKey&&(i+="<"+this.persistenceKey+">"),i}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function md(n,i,t){let o;if(Ze("string"==typeof i,"typeof type must == string"),Ze("object"==typeof t,"typeof params must == object"),i===dd)o=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(i!==fd)throw new Error("Unknown connection type: "+i);o=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(t.ns=n.namespace);const p=[];return Ui(t,(f,y)=>{p.push(f+"="+y)}),o+p.join("&")}class gd{constructor(){this.counters_={}}incrementCounter(i,t=1){qn(this.counters_,i)||(this.counters_[i]=0),this.counters_[i]+=t}get(){return Yo(this.counters_)}}const yh={},Ep={};function xh(n){const i=n.toString();return yh[i]||(yh[i]=new gd),yh[i]}class Af{constructor(i){this.onMessage_=i,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(i,t){this.closeAfterResponse=i,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(i,t){for(this.pendingResponses[i]=t;this.pendingResponses[this.currentResponseNum];){const o=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let p=0;p<o.length;++p)o[p]&&nl(()=>{this.onMessage_(o[p])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class _s{constructor(i,t,o,p,f,y,C){this.connId=i,this.repoInfo=t,this.applicationId=o,this.appCheckToken=p,this.authToken=f,this.transportSessionId=y,this.lastSessionId=C,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Oa(i),this.stats_=xh(t),this.urlFn=E=>(this.appCheckToken&&(E.ac=this.appCheckToken),md(t,fd,E))}open(i,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Af(i),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if("complete"===document.readyState)n();else{let i=!1;const t=function(){document.body?i||(i=!0,n()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Mp((...f)=>{const[y,C,E,M,A]=f;if(this.incrementIncomingBytes_(f),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===y)this.id=C,this.password=E;else{if("close"!==y)throw new Error("Unrecognized command received: "+y);C?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(C,()=>{this.onClosed_()})):this.onClosed_()}},(...f)=>{const[y,C]=f;this.incrementIncomingBytes_(f),this.myPacketOrderer.handleResponse(y,C)},()=>{this.onClosed_()},this.urlFn);const o={start:"t"};o.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(o.cb=this.scriptTagHolder.uniqueCallbackIdentifier),o.v="5",this.transportSessionId&&(o.s=this.transportSessionId),this.lastSessionId&&(o.ls=this.lastSessionId),this.applicationId&&(o.p=this.applicationId),this.appCheckToken&&(o.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&ru.test(location.hostname)&&(o.r="f");const p=this.urlFn(o);this.log_("Connecting via long-poll to "+p),this.scriptTagHolder.addTag(p,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){_s.forceAllow_=!0}static forceDisallow(){_s.forceDisallow_=!0}static isAvailable(){return!(!_s.forceAllow_&&(_s.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(i){const t=ri(i);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const o=an(t),p=ao(o,1840);for(let f=0;f<p.length;f++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,p.length,p[f]),this.curSegmentNum++}addDisconnectPingFrame(i,t){this.myDisconnFrame=document.createElement("iframe");const o={dframe:"t"};o.id=i,o.pw=t,this.myDisconnFrame.src=this.urlFn(o),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(i){const t=ri(i).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Mp{constructor(i,t,o,p){this.onDisconnect=o,this.urlFn=p,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=el(),window["pLPCommand"+this.uniqueCallbackIdentifier]=i,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Mp.createIFrame_();let f="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(f='<script>document.domain="'+document.domain+'";<\/script>');const y="<html><body>"+f+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(y),this.myIFrame.doc.close()}catch(C){vi("frame writing exception"),C.stack&&vi(C.stack),vi(C)}}}static createIFrame_(){const i=document.createElement("iframe");if(i.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(i);try{i.contentWindow.document||vi("No IE domain setting required")}catch(t){const o=document.domain;i.src="javascript:void((function(){document.open();document.domain='"+o+"';document.close();})())"}return i.contentDocument?i.doc=i.contentDocument:i.contentWindow?i.doc=i.contentWindow.document:i.document&&(i.doc=i.document),i}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const i=this.onDisconnect;i&&(this.onDisconnect=null,i())}startLongPoll(i,t){for(this.myID=i,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;let t=this.urlFn(i),o="",p=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+o.length<=1870;){const y=this.pendingSegs.shift();o=o+"&seg"+p+"="+y.seg+"&ts"+p+"="+y.ts+"&d"+p+"="+y.d,p++}return t+=o,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(i,t,o){this.pendingSegs.push({seg:i,ts:t,d:o}),this.alive&&this.newRequest_()}addLongPollTag_(i,t){this.outstandingRequests.add(t);const o=()=>{this.outstandingRequests.delete(t),this.newRequest_()},p=setTimeout(o,Math.floor(25e3));this.addTag(i,()=>{clearTimeout(p),o()})}addTag(i,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const o=this.myIFrame.doc.createElement("script");o.type="text/javascript",o.async=!0,o.src=i,o.onload=o.onreadystatechange=function(){const p=o.readyState;(!p||"loaded"===p||"complete"===p)&&(o.onload=o.onreadystatechange=null,o.parentNode&&o.parentNode.removeChild(o),t())},o.onerror=()=>{vi("Long-poll script failed to load: "+i),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(o)}catch(o){}},Math.floor(1))}}let wh=null;"undefined"!=typeof MozWebSocket?wh=MozWebSocket:"undefined"!=typeof WebSocket&&(wh=WebSocket);let Ra=(()=>{class n{constructor(t,o,p,f,y,C,E){this.connId=t,this.applicationId=p,this.appCheckToken=f,this.authToken=y,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Oa(this.connId),this.stats_=xh(o),this.connURL=n.connectionURL_(o,C,E,f,p),this.nodeAdmin=o.nodeAdmin}static connectionURL_(t,o,p,f,y){const C={v:"5"};return"undefined"!=typeof location&&location.hostname&&ru.test(location.hostname)&&(C.r="f"),o&&(C.s=o),p&&(C.ls=p),f&&(C.ac=f),y&&(C.p=y),md(t,dd,C)}open(t,o){this.onDisconnect=o,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Js.set("previous_websocket_failure",!0);try{let p;0,this.mySock=new wh(this.connURL,[],p)}catch(p){this.log_("Error instantiating WebSocket.");const f=p.message||p.data;return f&&this.log_(f),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=p=>{this.handleIncomingFrame(p)},this.mySock.onerror=p=>{this.log_("WebSocket error.  Closing connection.");const f=p.message||p.data;f&&this.log_(f),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const p=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);p&&p.length>1&&parseFloat(p[1])<4.4&&(t=!0)}return!t&&null!==wh&&!n.forceDisallow_}static previouslyFailed(){return Js.isInMemoryStorage||!0===Js.get("previous_websocket_failure")}markConnectionHealthy(){Js.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const o=this.frames.join("");this.frames=null;const p=Qo(o);this.onMessage(p)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(Ze(null===this.frames,"We already have a frame buffer"),t.length<=6){const o=Number(t);if(!isNaN(o))return this.handleNewFrameCount_(o),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const o=t.data;if(this.bytesReceived+=o.length,this.stats_.incrementCounter("bytes_received",o.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(o);else{const p=this.extractFrameCount_(o);null!==p&&this.appendFrame_(p)}}send(t){this.resetKeepAlive();const o=ri(t);this.bytesSent+=o.length,this.stats_.incrementCounter("bytes_sent",o.length);const p=ao(o,16384);p.length>1&&this.sendString_(String(p.length));for(let f=0;f<p.length;f++)this.sendString_(p[f])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(o){this.log_("Exception thrown from WebSocket.send():",o.message||o.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),rl=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[_s,Ra]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){const o=Ra&&Ra.isAvailable();let p=o&&!Ra.previouslyFailed();if(t.webSocketOnly&&(o||Ei("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),p=!0),p)this.transports_=[Ra];else{const f=this.transports_=[];for(const y of n.ALL_TRANSPORTS)y&&y.isAvailable()&&f.push(y);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return n.globalTransportInitialized_=!1,n})();class Ap{constructor(i,t,o,p,f,y,C,E,M,A){this.id=i,this.repoInfo_=t,this.applicationId_=o,this.appCheckToken_=p,this.authToken_=f,this.onMessage_=y,this.onReady_=C,this.onDisconnect_=E,this.onKill_=M,this.lastSessionId=A,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Oa("c:"+this.id+":"),this.transportManager_=new rl(t),this.log_("Connection created"),this.start_()}start_(){const i=this.transportManager_.initialTransport();this.conn_=new i(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=i.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),o=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,o)},Math.floor(0));const p=i.healthyTimeout||0;p>0&&(this.healthyTimeout_=cc(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(p)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(i){return t=>{i===this.conn_?this.onConnectionLost_(t):i===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(i){return t=>{2!==this.state_&&(i===this.rx_?this.onPrimaryMessageReceived_(t):i===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(i){this.sendData_({t:"d",d:i})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(i){if("t"in i){const t=i.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(i){const t=tl("t",i),o=tl("d",i);if("c"===t)this.onSecondaryControl_(o);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(o)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(i){const t=tl("t",i),o=tl("d",i);"c"===t?this.onControl_(o):"d"===t&&this.onDataMessage_(o)}onDataMessage_(i){this.onPrimaryResponse_(),this.onMessage_(i)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(i){const t=tl("t",i);if("d"in i){const o=i.d;if("h"===t)this.onHandshake_(o);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let p=0;p<this.pendingDataMessages.length;++p)this.onDataMessage_(this.pendingDataMessages[p]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(o):"r"===t?this.onReset_(o):"e"===t?_h("Server Error: "+o):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):_h("Unknown control packet command: "+t)}}onHandshake_(i){const t=i.ts,o=i.v,p=i.h;this.sessionId=i.s,this.repoInfo_.host=p,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==o&&Ei("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const i=this.transportManager_.upgradeTransport();i&&this.startUpgrade_(i)}startUpgrade_(i){this.secondaryConn_=new i(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=i.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),o=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,o),cc(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(i){this.log_("Reset packet received.  New host: "+i),this.repoInfo_.host=i,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(i,t){this.log_("Realtime connection established."),this.conn_=i,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):cc(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const i=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===i||this.rx_===i)&&this.close()}onConnectionLost_(i){this.conn_=null,i||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Js.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(i){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(i),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(i){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(i)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Pp{put(i,t,o,p){}merge(i,t,o,p){}refreshAuthToken(i){}refreshAppCheckToken(i){}onDisconnectPut(i,t,o){}onDisconnectMerge(i,t,o){}onDisconnectCancel(i,t){}reportStats(i){}}class wd{constructor(i){this.allowedEvents_=i,this.listeners_={},Ze(Array.isArray(i)&&i.length>0,"Requires a non-empty array")}trigger(i,...t){if(Array.isArray(this.listeners_[i])){const o=[...this.listeners_[i]];for(let p=0;p<o.length;p++)o[p].callback.apply(o[p].context,t)}}on(i,t,o){this.validateEventType_(i),this.listeners_[i]=this.listeners_[i]||[],this.listeners_[i].push({callback:t,context:o});const p=this.getInitialEvent(i);p&&t.apply(o,p)}off(i,t,o){this.validateEventType_(i);const p=this.listeners_[i]||[];for(let f=0;f<p.length;f++)if(p[f].callback===t&&(!o||o===p[f].context))return void p.splice(f,1)}validateEventType_(i){Ze(this.allowedEvents_.find(t=>t===i),"Unknown event: "+i)}}class mc extends wd{constructor(){super(["online"]),this.online_=!0,"undefined"!=typeof window&&void 0!==window.addEventListener&&!Ia()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new mc}getInitialEvent(i){return Ze("online"===i,"Unknown event type: "+i),[this.online_]}currentlyOnline(){return this.online_}}class Tn{constructor(i,t){if(void 0===t){this.pieces_=i.split("/");let o=0;for(let p=0;p<this.pieces_.length;p++)this.pieces_[p].length>0&&(this.pieces_[o]=this.pieces_[p],o++);this.pieces_.length=o,this.pieceNum_=0}else this.pieces_=i,this.pieceNum_=t}toString(){let i="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(i+="/"+this.pieces_[t]);return i||"/"}}function cn(){return new Tn("")}function $t(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ia(n){return n.pieces_.length-n.pieceNum_}function Pn(n){let i=n.pieceNum_;return i<n.pieces_.length&&i++,new Tn(n.pieces_,i)}function Th(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function lu(n,i=0){return n.pieces_.slice(n.pieceNum_+i)}function kp(n){if(n.pieceNum_>=n.pieces_.length)return null;const i=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)i.push(n.pieces_[t]);return new Tn(i,0)}function Zn(n,i){const t=[];for(let o=n.pieceNum_;o<n.pieces_.length;o++)t.push(n.pieces_[o]);if(i instanceof Tn)for(let o=i.pieceNum_;o<i.pieces_.length;o++)t.push(i.pieces_[o]);else{const o=i.split("/");for(let p=0;p<o.length;p++)o[p].length>0&&t.push(o[p])}return new Tn(t,0)}function Xt(n){return n.pieceNum_>=n.pieces_.length}function fr(n,i){const t=$t(n),o=$t(i);if(null===t)return i;if(t===o)return fr(Pn(n),Pn(i));throw new Error("INTERNAL ERROR: innerPath ("+i+") is not within outerPath ("+n+")")}function Ih(n,i){if(ia(n)!==ia(i))return!1;for(let t=n.pieceNum_,o=i.pieceNum_;t<=n.pieces_.length;t++,o++)if(n.pieces_[t]!==i.pieces_[o])return!1;return!0}function Wr(n,i){let t=n.pieceNum_,o=i.pieceNum_;if(ia(n)>ia(i))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==i.pieces_[o])return!1;++t,++o}return!0}class Mh{constructor(i,t){this.errorPrefix_=t,this.parts_=lu(i,0),this.byteLength_=Math.max(1,this.parts_.length);for(let o=0;o<this.parts_.length;o++)this.byteLength_+=Tr(this.parts_[o]);gc(this)}}function gc(n){if(n.byteLength_>768)throw new Error(n.errorPrefix_+"has a key path longer than 768 bytes ("+n.byteLength_+").");if(n.parts_.length>32)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+ra(n))}function ra(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class vs extends wd{constructor(){let i,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",i="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",i="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",i="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",i="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const o=!document[i];o!==this.visible_&&(this.visible_=o,this.trigger("visible",o))},!1)}static getInstance(){return new vs}getInitialEvent(i){return Ze("visible"===i,"Unknown event type: "+i),[this.visible_]}}const _c=1e3;let kh,ys=(()=>{class n extends Pp{constructor(t,o,p,f,y,C,E,M){if(super(),this.repoInfo_=t,this.applicationId_=o,this.onDataUpdate_=p,this.onConnectStatus_=f,this.onServerInfoUpdate_=y,this.authTokenProvider_=C,this.appCheckTokenProvider_=E,this.authOverride_=M,this.id=n.nextPersistentConnectionId_++,this.log_=Oa("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=_c,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,M)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");vs.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&mc.getInstance().on("online",this.onOnline_,this)}sendRequest(t,o,p){const f=++this.requestNumber_,y={r:f,a:t,b:o};this.log_(ri(y)),Ze(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(y),p&&(this.requestCBHash_[f]=p)}get(t){this.initConnection_();const o=new Eo,p={p:t._path.toString(),q:t._queryObject},f={action:"g",request:p,onComplete:C=>{const E=C.d;"ok"===C.s?(this.onDataUpdate_(p.p,E,!1,null),o.resolve(E)):o.reject(E)}};this.outstandingGets_.push(f),this.outstandingGetCount_++;const y=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{const C=this.outstandingGets_[y];void 0===C||f!==C||(delete this.outstandingGets_[y],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+y+" timed out on connection"),o.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(y),o.promise}listen(t,o,p,f){this.initConnection_();const y=t._queryIdentifier,C=t._path.toString();this.log_("Listen called for "+C+" "+y),this.listens.has(C)||this.listens.set(C,new Map),Ze(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Ze(!this.listens.get(C).has(y),"listen() called twice for same path/queryId.");const E={onComplete:f,hashFn:o,query:t,tag:p};this.listens.get(C).set(y,E),this.connected_&&this.sendListen_(E)}sendGet_(t){const o=this.outstandingGets_[t];this.sendRequest("g",o.request,p=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),o.onComplete&&o.onComplete(p)})}sendListen_(t){const o=t.query,p=o._path.toString(),f=o._queryIdentifier;this.log_("Listen on "+p+" for "+f);const y={p};t.tag&&(y.q=o._queryObject,y.t=t.tag),y.h=t.hashFn(),this.sendRequest("q",y,E=>{const M=E.d,A=E.s;n.warnOnListenWarnings_(M,o),(this.listens.get(p)&&this.listens.get(p).get(f))===t&&(this.log_("listen response",E),"ok"!==A&&this.removeListen_(p,f),t.onComplete&&t.onComplete(A,M))})}static warnOnListenWarnings_(t,o){if(t&&"object"==typeof t&&qn(t,"w")){const p=ar(t,"w");if(Array.isArray(p)&&~p.indexOf("no_index")){const f='".indexOn": "'+o._queryParams.getIndex().toString()+'"',y=o._path.toString();Ei(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${f} at ${y} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||function(n){const i=Gi(n).claims;return"object"==typeof i&&!0===i.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,o=function(n){const t=Gi(n).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(t)?"auth":"gauth",p={cred:t};null===this.authOverride_?p.noauth=!0:"object"==typeof this.authOverride_&&(p.authvar=this.authOverride_),this.sendRequest(o,p,f=>{const y=f.s,C=f.d||"error";this.authToken_===t&&("ok"===y?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(y,C))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const o=t.s,p=t.d||"error";"ok"===o?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(o,p)})}unlisten(t,o){const p=t._path.toString(),f=t._queryIdentifier;this.log_("Unlisten called for "+p+" "+f),Ze(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(p,f)&&this.connected_&&this.sendUnlisten_(p,f,t._queryObject,o)}sendUnlisten_(t,o,p,f){this.log_("Unlisten on "+t+" for "+o);const y={p:t};f&&(y.q=p,y.t=f),this.sendRequest("n",y)}onDisconnectPut(t,o,p){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,o,p):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:o,onComplete:p})}onDisconnectMerge(t,o,p){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,o,p):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:o,onComplete:p})}onDisconnectCancel(t,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,o):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:o})}sendOnDisconnect_(t,o,p,f){const y={p:o,d:p};this.log_("onDisconnect "+t,y),this.sendRequest(t,y,C=>{f&&setTimeout(()=>{f(C.s,C.d)},Math.floor(0))})}put(t,o,p,f){this.putInternal("p",t,o,p,f)}merge(t,o,p,f){this.putInternal("m",t,o,p,f)}putInternal(t,o,p,f,y){this.initConnection_();const C={p:o,d:p};void 0!==y&&(C.h=y),this.outstandingPuts_.push({action:t,request:C,onComplete:f}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+o)}sendPut_(t){const o=this.outstandingPuts_[t].action,p=this.outstandingPuts_[t].request,f=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(o,p,y=>{this.log_(o+" response",y),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),f&&f(y.s,y.d)})}reportStats(t){if(this.connected_){const o={c:t};this.log_("reportStats",o),this.sendRequest("s",o,p=>{"ok"!==p.s&&this.log_("reportStats","Error sending stats: "+p.d)})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+ri(t));const o=t.r,p=this.requestCBHash_[o];p&&(delete this.requestCBHash_[o],p(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,o){this.log_("handleServerMessage",t,o),"d"===t?this.onDataUpdate_(o.p,o.d,!1,o.t):"m"===t?this.onDataUpdate_(o.p,o.d,!0,o.t):"c"===t?this.onListenRevoked_(o.p,o.q):"ac"===t?this.onAuthRevoked_(o.s,o.d):"apc"===t?this.onAppCheckRevoked_(o.s,o.d):"sd"===t?this.onSecurityDebugPacket_(o):_h("Unrecognized action received from server: "+ri(t)+"\nAre you using the latest client?")}onReady_(t,o){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=o,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){Ze(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=_c,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=_c,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=_c),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let o=Math.max(0,this.reconnectDelay_-t);o=Math.random()*o,this.log_("Trying to reconnect in "+o+"ms"),this.scheduleConnect_(o),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return(0,xr.Z)(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const o=t.onDataMessage_.bind(t),p=t.onReady_.bind(t),f=t.onRealtimeDisconnect_.bind(t),y=t.id+":"+n.nextConnectionId_++,C=t.lastSessionId;let E=!1,M=null;const A=function(){M?M.close():(E=!0,f())};t.realtime_={close:A,sendRequest:function(G){Ze(M,"sendRequest call when we're not connected not allowed."),M.sendRequest(G)}};const R=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[G,W]=yield Promise.all([t.authTokenProvider_.getToken(R),t.appCheckTokenProvider_.getToken(R)]);E?vi("getToken() completed but was canceled"):(vi("getToken() completed. Creating connection."),t.authToken_=G&&G.accessToken,t.appCheckToken_=W&&W.token,M=new Ap(y,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,o,p,f,se=>{Ei(se+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},C))}catch(G){t.log_("Failed to get token: "+G),E||(t.repoInfo_.nodeAdmin&&Ei(G),A())}}})()}interrupt(t){vi("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){vi("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ws(this.interruptReasons_)&&(this.reconnectDelay_=_c,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const o=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:o})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const o=this.outstandingPuts_[t];o&&"h"in o.request&&o.queued&&(o.onComplete&&o.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,o){let p;p=o?o.map(y=>lc(y)).join("$"):"default";const f=this.removeListen_(t,p);f&&f.onComplete&&f.onComplete("permission_denied")}removeListen_(t,o){const p=new Tn(t).toString();let f;if(this.listens.has(p)){const y=this.listens.get(p);f=y.get(o),y.delete(o),0===y.size&&this.listens.delete(p)}else f=void 0;return f}onAuthRevoked_(t,o){vi("Auth token revoked: "+t+"/"+o),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===t||"permission_denied"===t)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,o){vi("App check token revoked: "+t+"/"+o),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===t||"permission_denied"===t)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const o of t.values())this.sendListen_(o);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let o="js";t["sdk."+o+"."+vp.replace(/\./g,"-")]=1,Ia()?t["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=mc.getInstance().currentlyOnline();return Ws(this.interruptReasons_)&&t}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class en{constructor(i,t){this.name=i,this.node=t}static Wrap(i,t){return new en(i,t)}}class Ph{getCompare(){return this.compare.bind(this)}indexedValueChanged(i,t){const o=new en(Hr,i),p=new en(Hr,t);return 0!==this.compare(o,p)}minPost(){return en.MIN}}class vc extends Ph{static get __EMPTY_NODE(){return kh}static set __EMPTY_NODE(i){kh=i}compare(i,t){return za(i.name,t.name)}isDefinedOn(i){throw Zo("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(i,t){return!1}minPost(){return en.MIN}maxPost(){return new en(na,kh)}makePost(i,t){return Ze("string"==typeof i,"KeyIndex indexValue must always be a string."),new en(i,kh)}toString(){return".key"}}const lo=new vc;class Dh{constructor(i,t,o,p,f=null){this.isReverse_=p,this.resultGenerator_=f,this.nodeStack_=[];let y=1;for(;!i.isEmpty();)if(i=i,y=t?o(i.key,t):1,p&&(y*=-1),y<0)i=this.isReverse_?i.left:i.right;else{if(0===y){this.nodeStack_.push(i);break}this.nodeStack_.push(i),i=this.isReverse_?i.right:i.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,i=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(i.key,i.value):{key:i.key,value:i.value},this.isReverse_)for(i=i.left;!i.isEmpty();)this.nodeStack_.push(i),i=i.right;else for(i=i.right;!i.isEmpty();)this.nodeStack_.push(i),i=i.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const i=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(i.key,i.value):{key:i.key,value:i.value}}}let xs,rr=(()=>{class n{constructor(t,o,p,f,y){this.key=t,this.value=o,this.color=null!=p?p:n.RED,this.left=null!=f?f:Lt.EMPTY_NODE,this.right=null!=y?y:Lt.EMPTY_NODE}copy(t,o,p,f,y){return new n(null!=t?t:this.key,null!=o?o:this.value,null!=p?p:this.color,null!=f?f:this.left,null!=y?y:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,o,p){let f=this;const y=p(t,f.key);return f=y<0?f.copy(null,null,null,f.left.insert(t,o,p),null):0===y?f.copy(null,o,null,null,null):f.copy(null,null,null,null,f.right.insert(t,o,p)),f.fixUp_()}removeMin_(){if(this.left.isEmpty())return Lt.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,o){let p,f;if(p=this,o(t,p.key)<0)!p.left.isEmpty()&&!p.left.isRed_()&&!p.left.left.isRed_()&&(p=p.moveRedLeft_()),p=p.copy(null,null,null,p.left.remove(t,o),null);else{if(p.left.isRed_()&&(p=p.rotateRight_()),!p.right.isEmpty()&&!p.right.isRed_()&&!p.right.left.isRed_()&&(p=p.moveRedRight_()),0===o(t,p.key)){if(p.right.isEmpty())return Lt.EMPTY_NODE;f=p.right.min_(),p=p.copy(f.key,f.value,null,null,p.right.removeMin_())}p=p.copy(null,null,null,null,p.right.remove(t,o))}return p.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),o=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,o)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class Lt{constructor(i,t=Lt.EMPTY_NODE){this.comparator_=i,this.root_=t}insert(i,t){return new Lt(this.comparator_,this.root_.insert(i,t,this.comparator_).copy(null,null,rr.BLACK,null,null))}remove(i){return new Lt(this.comparator_,this.root_.remove(i,this.comparator_).copy(null,null,rr.BLACK,null,null))}get(i){let t,o=this.root_;for(;!o.isEmpty();){if(t=this.comparator_(i,o.key),0===t)return o.value;t<0?o=o.left:t>0&&(o=o.right)}return null}getPredecessorKey(i){let t,o=this.root_,p=null;for(;!o.isEmpty();){if(t=this.comparator_(i,o.key),0===t){if(o.left.isEmpty())return p?p.key:null;for(o=o.left;!o.right.isEmpty();)o=o.right;return o.key}t<0?o=o.left:t>0&&(p=o,o=o.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(i){return this.root_.inorderTraversal(i)}reverseTraversal(i){return this.root_.reverseTraversal(i)}getIterator(i){return new Dh(this.root_,null,this.comparator_,!1,i)}getIteratorFrom(i,t){return new Dh(this.root_,i,this.comparator_,!1,t)}getReverseIteratorFrom(i,t){return new Dh(this.root_,i,this.comparator_,!0,t)}getReverseIterator(i){return new Dh(this.root_,null,this.comparator_,!0,i)}}function qf(n,i){return za(n.name,i.name)}function xc(n,i){return za(n,i)}Lt.EMPTY_NODE=new class{copy(i,t,o,p,f){return this}insert(i,t,o){return new rr(i,t,null)}remove(i,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(i){return!1}reverseTraversal(i){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Sd=function(n){return"number"==typeof n?"number:"+ad(n):"string:"+n},Td=function(n){if(n.isLeafNode()){const i=n.val();Ze("string"==typeof i||"number"==typeof i||"object"==typeof i&&qn(i,".sv"),"Priority must be a string or number.")}else Ze(n===xs||n.isEmpty(),"priority of unexpected type.");Ze(n===xs||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Id,Md,Ad,uu=(()=>{class n{constructor(t,o=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=o,this.lazyHash_=null,Ze(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),Td(this.priorityNode_)}static set __childrenNodeConstructor(t){Id=t}static get __childrenNodeConstructor(){return Id}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return Xt(t)?this:".priority"===$t(t)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,o){return null}updateImmediateChild(t,o){return".priority"===t?this.updatePriority(o):o.isEmpty()&&".priority"!==t?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,o).updatePriority(this.priorityNode_)}updateChild(t,o){const p=$t(t);return null===p?o:o.isEmpty()&&".priority"!==p?this:(Ze(".priority"!==p||1===ia(t),".priority must be the last token in a path"),this.updateImmediateChild(p,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(Pn(t),o)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,o){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Sd(this.priorityNode_.val())+":");const o=typeof this.value_;t+=o+":",t+="number"===o?ad(this.value_):this.value_,this.lazyHash_=od(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(Ze(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const o=typeof t.value_,p=typeof this.value_,f=n.VALUE_TYPE_ORDER.indexOf(o),y=n.VALUE_TYPE_ORDER.indexOf(p);return Ze(f>=0,"Unknown leaf type: "+o),Ze(y>=0,"Unknown leaf type: "+p),f===y?"object"===p?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:y-f}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const o=t;return this.value_===o.value_&&this.priorityNode_.equals(o.priorityNode_)}return!1}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const zn=new class extends Ph{compare(i,t){const o=i.node.getPriority(),p=t.node.getPriority(),f=o.compareTo(p);return 0===f?za(i.name,t.name):f}isDefinedOn(i){return!i.getPriority().isEmpty()}indexedValueChanged(i,t){return!i.getPriority().equals(t.getPriority())}minPost(){return en.MIN}maxPost(){return new en(na,new uu("[PRIORITY-POST]",Ad))}makePost(i,t){const o=Md(i);return new en(t,new uu("[PRIORITY-POST]",o))}toString(){return".priority"}},Oh=Math.log(2);class sl{constructor(i){this.count=parseInt(Math.log(i+1)/Oh,10),this.current_=this.count-1;const p=(f=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=i+1&p}nextBitIsOne(){const i=!(this.bits_&1<<this.current_);return this.current_--,i}}const cu=function(n,i,t,o){n.sort(i);const p=function(E,M){const A=M-E;let I,R;if(0===A)return null;if(1===A)return I=n[E],R=t?t(I):I,new rr(R,I.node,rr.BLACK,null,null);{const G=parseInt(A/2,10)+E,W=p(E,G),se=p(G+1,M);return I=n[G],R=t?t(I):I,new rr(R,I.node,rr.BLACK,W,se)}},C=function(E){let M=null,A=null,I=n.length;const R=function(W,se){const ne=I-W,ge=I;I-=W;const we=p(ne+1,ge),_e=n[ne],Pe=t?t(_e):_e;G(new rr(Pe,_e.node,se,null,we))},G=function(W){M?(M.left=W,M=W):(A=W,M=W)};for(let W=0;W<E.count;++W){const se=E.nextBitIsOne(),ne=Math.pow(2,E.count-(W+1));se?R(ne,rr.BLACK):(R(ne,rr.BLACK),R(ne,rr.RED))}return A}(new sl(n.length));return new Lt(o||i,C)};let bs;const ll={};class yn{constructor(i,t){this.indexes_=i,this.indexSet_=t}static get Default(){return Ze(ll&&zn,"ChildrenNode.ts has not been loaded"),bs=bs||new yn({".priority":ll},{".priority":zn}),bs}get(i){const t=ar(this.indexes_,i);if(!t)throw new Error("No index defined for "+i);return t instanceof Lt?t:null}hasIndex(i){return qn(this.indexSet_,i.toString())}addIndex(i,t){Ze(i!==lo,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const o=[];let p=!1;const f=t.getIterator(en.Wrap);let C,y=f.getNext();for(;y;)p=p||i.isDefinedOn(y.node),o.push(y),y=f.getNext();C=p?cu(o,i.getCompare()):ll;const E=i.toString(),M=Object.assign({},this.indexSet_);M[E]=i;const A=Object.assign({},this.indexes_);return A[E]=C,new yn(A,M)}addToIndexes(i,t){const o=as(this.indexes_,(p,f)=>{const y=ar(this.indexSet_,f);if(Ze(y,"Missing index implementation for "+f),p===ll){if(y.isDefinedOn(i.node)){const C=[],E=t.getIterator(en.Wrap);let M=E.getNext();for(;M;)M.name!==i.name&&C.push(M),M=E.getNext();return C.push(i),cu(C,y.getCompare())}return ll}{const C=t.get(i.name);let E=p;return C&&(E=E.remove(new en(i.name,C))),E.insert(i,i.node)}});return new yn(o,this.indexSet_)}removeFromIndexes(i,t){const o=as(this.indexes_,p=>{if(p===ll)return p;{const f=t.get(i.name);return f?p.remove(new en(i.name,f)):p}});return new yn(o,this.indexSet_)}}let hn,jt=(()=>{class n{constructor(t,o,p){this.children_=t,this.priorityNode_=o,this.indexMap_=p,this.lazyHash_=null,this.priorityNode_&&Td(this.priorityNode_),this.children_.isEmpty()&&Ze(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return hn||(hn=new n(new Lt(xc),null,yn.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||hn}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const o=this.children_.get(t);return null===o?hn:o}}getChild(t){const o=$t(t);return null===o?this:this.getImmediateChild(o).getChild(Pn(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,o){if(Ze(o,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(o);{const p=new en(t,o);let f,y;o.isEmpty()?(f=this.children_.remove(t),y=this.indexMap_.removeFromIndexes(p,this.children_)):(f=this.children_.insert(t,o),y=this.indexMap_.addToIndexes(p,this.children_));const C=f.isEmpty()?hn:this.priorityNode_;return new n(f,C,y)}}updateChild(t,o){const p=$t(t);if(null===p)return o;{Ze(".priority"!==$t(t)||1===ia(t),".priority must be the last token in a path");const f=this.getImmediateChild(p).updateChild(Pn(t),o);return this.updateImmediateChild(p,f)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const o={};let p=0,f=0,y=!0;if(this.forEachChild(zn,(C,E)=>{o[C]=E.val(t),p++,y&&n.INTEGER_REGEXP_.test(C)?f=Math.max(f,Number(C)):y=!1}),!t&&y&&f<2*p){const C=[];for(const E in o)C[E]=o[E];return C}return t&&!this.getPriority().isEmpty()&&(o[".priority"]=this.getPriority().val()),o}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+Sd(this.getPriority().val())+":"),this.forEachChild(zn,(o,p)=>{const f=p.hash();""!==f&&(t+=":"+o+":"+f)}),this.lazyHash_=""===t?"":od(t)}return this.lazyHash_}getPredecessorChildName(t,o,p){const f=this.resolveIndex_(p);if(f){const y=f.getPredecessorKey(new en(t,o));return y?y.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const o=this.resolveIndex_(t);if(o){const p=o.minKey();return p&&p.name}return this.children_.minKey()}getFirstChild(t){const o=this.getFirstChildName(t);return o?new en(o,this.children_.get(o)):null}getLastChildName(t){const o=this.resolveIndex_(t);if(o){const p=o.maxKey();return p&&p.name}return this.children_.maxKey()}getLastChild(t){const o=this.getLastChildName(t);return o?new en(o,this.children_.get(o)):null}forEachChild(t,o){const p=this.resolveIndex_(t);return p?p.inorderTraversal(f=>o(f.name,f.node)):this.children_.inorderTraversal(o)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,o){const p=this.resolveIndex_(o);if(p)return p.getIteratorFrom(t,f=>f);{const f=this.children_.getIteratorFrom(t.name,en.Wrap);let y=f.peek();for(;null!=y&&o.compare(y,t)<0;)f.getNext(),y=f.peek();return f}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,o){const p=this.resolveIndex_(o);if(p)return p.getReverseIteratorFrom(t,f=>f);{const f=this.children_.getReverseIteratorFrom(t.name,en.Wrap);let y=f.peek();for(;null!=y&&o.compare(y,t)>0;)f.getNext(),y=f.peek();return f}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===hu?-1:0}withIndex(t){if(t===lo||this.indexMap_.hasIndex(t))return this;{const o=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,o)}}isIndexed(t){return t===lo||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const o=t;if(this.getPriority().equals(o.getPriority())){if(this.children_.count()===o.children_.count()){const p=this.getIterator(zn),f=o.getIterator(zn);let y=p.getNext(),C=f.getNext();for(;y&&C;){if(y.name!==C.name||!y.node.equals(C.node))return!1;y=p.getNext(),C=f.getNext()}return null===y&&null===C}return!1}return!1}}resolveIndex_(t){return t===lo?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const hu=new class extends jt{constructor(){super(new Lt(xc),jt.EMPTY_NODE,yn.Default)}compareTo(i){return i===this?0:1}equals(i){return i===this}getPriority(){return this}getImmediateChild(i){return jt.EMPTY_NODE}isEmpty(){return!1}};function ei(n,i=null){if(null===n)return jt.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(i=n[".priority"]),Ze(null===i||"string"==typeof i||"number"==typeof i||"object"==typeof i&&".sv"in i,"Invalid priority type found: "+typeof i),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new uu(n,ei(i));if(n instanceof Array){let t=jt.EMPTY_NODE;return Ui(n,(o,p)=>{if(qn(n,o)&&"."!==o.substring(0,1)){const f=ei(p);(f.isLeafNode()||!f.isEmpty())&&(t=t.updateImmediateChild(o,f))}}),t.updatePriority(ei(i))}{const t=[];let o=!1;if(Ui(n,(y,C)=>{if("."!==y.substring(0,1)){const E=ei(C);E.isEmpty()||(o=o||!E.getPriority().isEmpty(),t.push(new en(y,E)))}}),0===t.length)return jt.EMPTY_NODE;const f=cu(t,qf,y=>y.name,xc);if(o){const y=cu(t,zn.getCompare());return new jt(f,ei(i),new yn({".priority":y},{".priority":zn}))}return new jt(f,ei(i),yn.Default)}}Object.defineProperties(en,{MIN:{value:new en(Hr,jt.EMPTY_NODE)},MAX:{value:new en(na,hu)}}),vc.__EMPTY_NODE=jt.EMPTY_NODE,uu.__childrenNodeConstructor=jt,function(n){xs=n}(hu),function(n){Ad=n}(hu),function(n){Md=n}(ei);class bc extends Ph{constructor(i){super(),this.indexPath_=i,Ze(!Xt(i)&&".priority"!==$t(i),"Can't create PathIndex with empty path or .priority key")}extractChild(i){return i.getChild(this.indexPath_)}isDefinedOn(i){return!i.getChild(this.indexPath_).isEmpty()}compare(i,t){const o=this.extractChild(i.node),p=this.extractChild(t.node),f=o.compareTo(p);return 0===f?za(i.name,t.name):f}makePost(i,t){const o=ei(i),p=jt.EMPTY_NODE.updateChild(this.indexPath_,o);return new en(t,p)}maxPost(){const i=jt.EMPTY_NODE.updateChild(this.indexPath_,hu);return new en(na,i)}toString(){return lu(this.indexPath_,0).join("/")}}const Fa=new class extends Ph{compare(i,t){const o=i.node.compareTo(t.node);return 0===o?za(i.name,t.name):o}isDefinedOn(i){return!0}indexedValueChanged(i,t){return!i.equals(t)}minPost(){return en.MIN}maxPost(){return en.MAX}makePost(i,t){const o=ei(i);return new en(t,o)}toString(){return".value"}};function hl(n){return{type:"value",snapshotNode:n}}function Pr(n,i){return{type:"child_added",snapshotNode:i,childName:n}}function du(n,i){return{type:"child_removed",snapshotNode:i,childName:n}}function fu(n,i,t){return{type:"child_changed",snapshotNode:i,childName:n,oldSnap:t}}class ai{constructor(i){this.index_=i}updateChild(i,t,o,p,f,y){Ze(i.isIndexed(this.index_),"A node must be indexed if only a child is updated");const C=i.getImmediateChild(t);return C.getChild(p).equals(o.getChild(p))&&C.isEmpty()===o.isEmpty()||(null!=y&&(o.isEmpty()?i.hasChild(t)?y.trackChildChange(du(t,C)):Ze(i.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):C.isEmpty()?y.trackChildChange(Pr(t,o)):y.trackChildChange(fu(t,o,C))),i.isLeafNode()&&o.isEmpty())?i:i.updateImmediateChild(t,o).withIndex(this.index_)}updateFullNode(i,t,o){return null!=o&&(i.isLeafNode()||i.forEachChild(zn,(p,f)=>{t.hasChild(p)||o.trackChildChange(du(p,f))}),t.isLeafNode()||t.forEachChild(zn,(p,f)=>{if(i.hasChild(p)){const y=i.getImmediateChild(p);y.equals(f)||o.trackChildChange(fu(p,f,y))}else o.trackChildChange(Pr(p,f))})),t.withIndex(this.index_)}updatePriority(i,t){return i.isEmpty()?jt.EMPTY_NODE:i.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class uo{constructor(i){this.indexedFilter_=new ai(i.getIndex()),this.index_=i.getIndex(),this.startPost_=uo.getStartPost_(i),this.endPost_=uo.getEndPost_(i)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(i){return this.index_.compare(this.getStartPost(),i)<=0&&this.index_.compare(i,this.getEndPost())<=0}updateChild(i,t,o,p,f,y){return this.matches(new en(t,o))||(o=jt.EMPTY_NODE),this.indexedFilter_.updateChild(i,t,o,p,f,y)}updateFullNode(i,t,o){t.isLeafNode()&&(t=jt.EMPTY_NODE);let p=t.withIndex(this.index_);p=p.updatePriority(jt.EMPTY_NODE);const f=this;return t.forEachChild(zn,(y,C)=>{f.matches(new en(y,C))||(p=p.updateImmediateChild(y,jt.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(i,p,o)}updatePriority(i,t){return i}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(i){if(i.hasStart()){const t=i.getIndexStartName();return i.getIndex().makePost(i.getIndexStartValue(),t)}return i.getIndex().minPost()}static getEndPost_(i){if(i.hasEnd()){const t=i.getIndexEndName();return i.getIndex().makePost(i.getIndexEndValue(),t)}return i.getIndex().maxPost()}}class Ld{constructor(i){this.rangedFilter_=new uo(i),this.index_=i.getIndex(),this.limit_=i.getLimit(),this.reverse_=!i.isViewFromLeft()}updateChild(i,t,o,p,f,y){return this.rangedFilter_.matches(new en(t,o))||(o=jt.EMPTY_NODE),i.getImmediateChild(t).equals(o)?i:i.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(i,t,o,p,f,y):this.fullLimitUpdateChild_(i,t,o,f,y)}updateFullNode(i,t,o){let p;if(t.isLeafNode()||t.isEmpty())p=jt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let f;p=jt.EMPTY_NODE.withIndex(this.index_),f=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let y=0;for(;f.hasNext()&&y<this.limit_;){const C=f.getNext();let E;if(E=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),C)<=0:this.index_.compare(C,this.rangedFilter_.getEndPost())<=0,!E)break;p=p.updateImmediateChild(C.name,C.node),y++}}else{let f,y,C,E;if(p=t.withIndex(this.index_),p=p.updatePriority(jt.EMPTY_NODE),this.reverse_){E=p.getReverseIterator(this.index_),f=this.rangedFilter_.getEndPost(),y=this.rangedFilter_.getStartPost();const I=this.index_.getCompare();C=(R,G)=>I(G,R)}else E=p.getIterator(this.index_),f=this.rangedFilter_.getStartPost(),y=this.rangedFilter_.getEndPost(),C=this.index_.getCompare();let M=0,A=!1;for(;E.hasNext();){const I=E.getNext();!A&&C(f,I)<=0&&(A=!0),A&&M<this.limit_&&C(I,y)<=0?M++:p=p.updateImmediateChild(I.name,jt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(i,p,o)}updatePriority(i,t){return i}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(i,t,o,p,f){let y;if(this.reverse_){const I=this.index_.getCompare();y=(R,G)=>I(G,R)}else y=this.index_.getCompare();const C=i;Ze(C.numChildren()===this.limit_,"");const E=new en(t,o),M=this.reverse_?C.getFirstChild(this.index_):C.getLastChild(this.index_),A=this.rangedFilter_.matches(E);if(C.hasChild(t)){const I=C.getImmediateChild(t);let R=p.getChildAfterChild(this.index_,M,this.reverse_);for(;null!=R&&(R.name===t||C.hasChild(R.name));)R=p.getChildAfterChild(this.index_,R,this.reverse_);const G=null==R?1:y(R,E);if(A&&!o.isEmpty()&&G>=0)return null!=f&&f.trackChildChange(fu(t,o,I)),C.updateImmediateChild(t,o);{null!=f&&f.trackChildChange(du(t,I));const se=C.updateImmediateChild(t,jt.EMPTY_NODE);return null!=R&&this.rangedFilter_.matches(R)?(null!=f&&f.trackChildChange(Pr(R.name,R.node)),se.updateImmediateChild(R.name,R.node)):se}}return o.isEmpty()?i:A&&y(M,E)>=0?(null!=f&&(f.trackChildChange(du(M.name,M.node)),f.trackChildChange(Pr(t,o))),C.updateImmediateChild(t,o).updateImmediateChild(M.name,jt.EMPTY_NODE)):i}}class e{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=zn}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Ze(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Ze(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Hr}hasEnd(){return this.endSet_}getIndexEndValue(){return Ze(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Ze(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:na}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Ze(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===zn}copy(){const i=new e;return i.limitSet_=this.limitSet_,i.limit_=this.limit_,i.startSet_=this.startSet_,i.indexStartValue_=this.indexStartValue_,i.startNameSet_=this.startNameSet_,i.indexStartName_=this.indexStartName_,i.endSet_=this.endSet_,i.indexEndValue_=this.indexEndValue_,i.endNameSet_=this.endNameSet_,i.indexEndName_=this.indexEndName_,i.index_=this.index_,i.viewFrom_=this.viewFrom_,i}}function P(n){const i={};if(n.isDefault())return i;let t;return n.index_===zn?t="$priority":n.index_===Fa?t="$value":n.index_===lo?t="$key":(Ze(n.index_ instanceof bc,"Unrecognized index type!"),t=n.index_.toString()),i.orderBy=ri(t),n.startSet_&&(i.startAt=ri(n.indexStartValue_),n.startNameSet_&&(i.startAt+=","+ri(n.indexStartName_))),n.endSet_&&(i.endAt=ri(n.indexEndValue_),n.endNameSet_&&(i.endAt+=","+ri(n.indexEndName_))),n.limitSet_&&(n.isViewFromLeft()?i.limitToFirst=n.limit_:i.limitToLast=n.limit_),i}function D(n){const i={};if(n.startSet_&&(i.sp=n.indexStartValue_,n.startNameSet_&&(i.sn=n.indexStartName_)),n.endSet_&&(i.ep=n.indexEndValue_,n.endNameSet_&&(i.en=n.indexEndName_)),n.limitSet_){i.l=n.limit_;let t=n.viewFrom_;""===t&&(t=n.isViewFromLeft()?"l":"r"),i.vf=t}return n.index_!==zn&&(i.i=n.index_.toString()),i}class O extends Pp{constructor(i,t,o,p){super(),this.repoInfo_=i,this.onDataUpdate_=t,this.authTokenProvider_=o,this.appCheckTokenProvider_=p,this.log_=Oa("p:rest:"),this.listens_={}}reportStats(i){throw new Error("Method not implemented.")}static getListenId_(i,t){return void 0!==t?"tag$"+t:(Ze(i._queryParams.isDefault(),"should have a tag if it's not a default query."),i._path.toString())}listen(i,t,o,p){const f=i._path.toString();this.log_("Listen called for "+f+" "+i._queryIdentifier);const y=O.getListenId_(i,o),C={};this.listens_[y]=C;const E=P(i._queryParams);this.restRequest_(f+".json",E,(M,A)=>{let I=A;if(404===M&&(I=null,M=null),null===M&&this.onDataUpdate_(f,I,!1,o),ar(this.listens_,y)===C){let R;R=M?401===M?"permission_denied":"rest_error:"+M:"ok",p(R,null)}})}unlisten(i,t){const o=O.getListenId_(i,t);delete this.listens_[o]}get(i){const t=P(i._queryParams),o=i._path.toString(),p=new Eo;return this.restRequest_(o+".json",t,(f,y)=>{let C=y;404===f&&(C=null,f=null),null===f?(this.onDataUpdate_(o,C,!1,null),p.resolve(C)):p.reject(new Error(C))}),p.promise}refreshAuthToken(i){}restRequest_(i,t={},o){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([p,f])=>{p&&p.accessToken&&(t.auth=p.accessToken),f&&f.token&&(t.ac=f.token);const y=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+function(n){const i=[];for(const[t,o]of Object.entries(n))Array.isArray(o)?o.forEach(p=>{i.push(encodeURIComponent(t)+"="+encodeURIComponent(p))}):i.push(encodeURIComponent(t)+"="+encodeURIComponent(o));return i.length?"&"+i.join("&"):""}(t);this.log_("Sending REST request for "+y);const C=new XMLHttpRequest;C.onreadystatechange=()=>{if(o&&4===C.readyState){this.log_("REST Response for "+y+" received. status:",C.status,"response:",C.responseText);let E=null;if(C.status>=200&&C.status<300){try{E=Qo(C.responseText)}catch(M){Ei("Failed to parse JSON response for "+y+": "+C.responseText)}o(null,E)}else 401!==C.status&&404!==C.status&&Ei("Got unsuccessful REST response for "+y+" Status: "+C.status),o(C.status);o=null}},C.open("GET",y,!0),C.send()})}}class N{constructor(){this.rootNode_=jt.EMPTY_NODE}getNode(i){return this.rootNode_.getChild(i)}updateSnapshot(i,t){this.rootNode_=this.rootNode_.updateChild(i,t)}}function U(){return{value:null,children:new Map}}function Y(n,i,t){if(Xt(i))n.value=t,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(i,t);else{const o=$t(i);n.children.has(o)||n.children.set(o,U()),Y(n.children.get(o),i=Pn(i),t)}}function le(n,i,t){null!==n.value?t(i,n.value):function(n,i){n.children.forEach((t,o)=>{i(o,t)})}(n,(o,p)=>{le(p,new Tn(i.toString()+"/"+o),t)})}class de{constructor(i){this.collection_=i,this.last_=null}get(){const i=this.collection_.get(),t=Object.assign({},i);return this.last_&&Ui(this.last_,(o,p)=>{t[o]=t[o]-p}),this.last_=i,t}}class Me{constructor(i,t){this.server_=t,this.statsToReport_={},this.statsListener_=new de(i);const o=1e4+2e4*Math.random();cc(this.reportStats_.bind(this),Math.floor(o))}reportStats_(){const i=this.statsListener_.get(),t={};let o=!1;Ui(i,(p,f)=>{f>0&&qn(this.statsToReport_,p)&&(t[p]=f,o=!0)}),o&&this.server_.reportStats(t),cc(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Le=(()=>(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Le||(Le={})),Le))();function qe(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class lt{constructor(i,t,o){this.path=i,this.affectedTree=t,this.revert=o,this.type=Le.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(i){if(Xt(this.path)){if(null!=this.affectedTree.value)return Ze(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Tn(i));return new lt(cn(),t,this.revert)}}return Ze($t(this.path)===i,"operationForChild called for unrelated child."),new lt(Pn(this.path),this.affectedTree,this.revert)}}class He{constructor(i,t){this.source=i,this.path=t,this.type=Le.LISTEN_COMPLETE}operationForChild(i){return Xt(this.path)?new He(this.source,cn()):new He(this.source,Pn(this.path))}}class St{constructor(i,t,o){this.source=i,this.path=t,this.snap=o,this.type=Le.OVERWRITE}operationForChild(i){return Xt(this.path)?new St(this.source,cn(),this.snap.getImmediateChild(i)):new St(this.source,Pn(this.path),this.snap)}}class gt{constructor(i,t,o){this.source=i,this.path=t,this.children=o,this.type=Le.MERGE}operationForChild(i){if(Xt(this.path)){const t=this.children.subtree(new Tn(i));return t.isEmpty()?null:t.value?new St(this.source,cn(),t.value):new gt(this.source,cn(),t)}return Ze($t(this.path)===i,"Can't get a merge for a child not on the path of the operation"),new gt(this.source,Pn(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Qe{constructor(i,t,o){this.node_=i,this.fullyInitialized_=t,this.filtered_=o}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(i){if(Xt(i))return this.isFullyInitialized()&&!this.filtered_;const t=$t(i);return this.isCompleteForChild(t)}isCompleteForChild(i){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(i)}getNode(){return this.node_}}class Rt{constructor(i){this.query_=i,this.index_=this.query_._queryParams.getIndex()}}function Bt(n,i,t,o,p,f){const y=o.filter(C=>C.type===t);y.sort((C,E)=>function(n,i,t){if(null==i.childName||null==t.childName)throw Zo("Should only compare child_ events.");const o=new en(i.childName,i.snapshotNode),p=new en(t.childName,t.snapshotNode);return n.index_.compare(o,p)}(n,C,E)),y.forEach(C=>{const E=function(n,i,t){return"value"===i.type||"child_removed"===i.type||(i.prevName=t.getPredecessorChildName(i.childName,i.snapshotNode,n.index_)),i}(n,C,f);p.forEach(M=>{M.respondsTo(C.type)&&i.push(M.createEvent(E,n.query_))})})}function dn(n,i){return{eventCache:n,serverCache:i}}function In(n,i,t,o){return dn(new Qe(i,t,o),n.serverCache)}function kn(n,i,t,o){return dn(n.eventCache,new Qe(i,t,o))}function fn(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function mn(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let ti;class Gt{constructor(i,t=(()=>(ti||(ti=new Lt(Cf)),ti))()){this.value=i,this.children=t}static fromObject(i){let t=new Gt(null);return Ui(i,(o,p)=>{t=t.set(new Tn(o),p)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(i,t){if(null!=this.value&&t(this.value))return{path:cn(),value:this.value};if(Xt(i))return null;{const o=$t(i),p=this.children.get(o);if(null!==p){const f=p.findRootMostMatchingPathAndValue(Pn(i),t);return null!=f?{path:Zn(new Tn(o),f.path),value:f.value}:null}return null}}findRootMostValueAndPath(i){return this.findRootMostMatchingPathAndValue(i,()=>!0)}subtree(i){if(Xt(i))return this;{const t=$t(i),o=this.children.get(t);return null!==o?o.subtree(Pn(i)):new Gt(null)}}set(i,t){if(Xt(i))return new Gt(t,this.children);{const o=$t(i),f=(this.children.get(o)||new Gt(null)).set(Pn(i),t),y=this.children.insert(o,f);return new Gt(this.value,y)}}remove(i){if(Xt(i))return this.children.isEmpty()?new Gt(null):new Gt(null,this.children);{const t=$t(i),o=this.children.get(t);if(o){const p=o.remove(Pn(i));let f;return f=p.isEmpty()?this.children.remove(t):this.children.insert(t,p),null===this.value&&f.isEmpty()?new Gt(null):new Gt(this.value,f)}return this}}get(i){if(Xt(i))return this.value;{const t=$t(i),o=this.children.get(t);return o?o.get(Pn(i)):null}}setTree(i,t){if(Xt(i))return t;{const o=$t(i),f=(this.children.get(o)||new Gt(null)).setTree(Pn(i),t);let y;return y=f.isEmpty()?this.children.remove(o):this.children.insert(o,f),new Gt(this.value,y)}}fold(i){return this.fold_(cn(),i)}fold_(i,t){const o={};return this.children.inorderTraversal((p,f)=>{o[p]=f.fold_(Zn(i,p),t)}),t(i,this.value,o)}findOnPath(i,t){return this.findOnPath_(i,cn(),t)}findOnPath_(i,t,o){const p=!!this.value&&o(t,this.value);if(p)return p;if(Xt(i))return null;{const f=$t(i),y=this.children.get(f);return y?y.findOnPath_(Pn(i),Zn(t,f),o):null}}foreachOnPath(i,t){return this.foreachOnPath_(i,cn(),t)}foreachOnPath_(i,t,o){if(Xt(i))return this;{this.value&&o(t,this.value);const p=$t(i),f=this.children.get(p);return f?f.foreachOnPath_(Pn(i),Zn(t,p),o):new Gt(null)}}foreach(i){this.foreach_(cn(),i)}foreach_(i,t){this.children.inorderTraversal((o,p)=>{p.foreach_(Zn(i,o),t)}),this.value&&t(i,this.value)}foreachChild(i){this.children.inorderTraversal((t,o)=>{o.value&&i(t,o.value)})}}class xn{constructor(i){this.writeTree_=i}static empty(){return new xn(new Gt(null))}}function hi(n,i,t){if(Xt(i))return new xn(new Gt(t));{const o=n.writeTree_.findRootMostValueAndPath(i);if(null!=o){const p=o.path;let f=o.value;const y=fr(p,i);return f=f.updateChild(y,t),new xn(n.writeTree_.set(p,f))}{const p=new Gt(t),f=n.writeTree_.setTree(i,p);return new xn(f)}}}function Ln(n,i,t){let o=n;return Ui(t,(p,f)=>{o=hi(o,Zn(i,p),f)}),o}function pi(n,i){if(Xt(i))return xn.empty();{const t=n.writeTree_.setTree(i,new Gt(null));return new xn(t)}}function Ft(n,i){return null!=Kt(n,i)}function Kt(n,i){const t=n.writeTree_.findRootMostValueAndPath(i);return null!=t?n.writeTree_.get(t.path).getChild(fr(t.path,i)):null}function nn(n){const i=[],t=n.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(zn,(o,p)=>{i.push(new en(o,p))}):n.writeTree_.children.inorderTraversal((o,p)=>{null!=p.value&&i.push(new en(o,p.value))}),i}function Ot(n,i){if(Xt(i))return n;{const t=Kt(n,i);return new xn(null!=t?new Gt(t):n.writeTree_.subtree(i))}}function Pi(n){return n.writeTree_.isEmpty()}function ni(n,i){return bn(cn(),n.writeTree_,i)}function bn(n,i,t){if(null!=i.value)return t.updateChild(n,i.value);{let o=null;return i.children.inorderTraversal((p,f)=>{".priority"===p?(Ze(null!==f.value,"Priority writes must always be leaf nodes"),o=f.value):t=bn(Zn(n,p),f,t)}),!t.getChild(n).isEmpty()&&null!==o&&(t=t.updateChild(Zn(n,".priority"),o)),t}}function Rn(n,i){return fl(i,n)}function sa(n,i){if(n.snap)return Wr(n.path,i);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Wr(Zn(n.path,t),i))return!0;return!1}function la(n){return n.visible}function Zr(n,i,t){let o=xn.empty();for(let p=0;p<n.length;++p){const f=n[p];if(i(f)){const y=f.path;let C;if(f.snap)Wr(t,y)?(C=fr(t,y),o=hi(o,C,f.snap)):Wr(y,t)&&(C=fr(y,t),o=hi(o,cn(),f.snap.getChild(C)));else{if(!f.children)throw Zo("WriteRecord should have .snap or .children");if(Wr(t,y))C=fr(t,y),o=Ln(o,C,f.children);else if(Wr(y,t))if(C=fr(y,t),Xt(C))o=Ln(o,cn(),f.children);else{const E=ar(f.children,$t(C));if(E){const M=E.getChild(Pn(C));o=hi(o,cn(),M)}}}}}return o}function pl(n,i,t,o,p){if(o||p){const f=Ot(n.visibleWrites,i);return!p&&Pi(f)?t:p||null!=t||Ft(f,cn())?ni(Zr(n.allWrites,function(M){return(M.visible||p)&&(!o||!~o.indexOf(M.writeId))&&(Wr(M.path,i)||Wr(i,M.path))},i),t||jt.EMPTY_NODE):null}{const f=Kt(n.visibleWrites,i);if(null!=f)return f;{const y=Ot(n.visibleWrites,i);return Pi(y)?t:null!=t||Ft(y,cn())?ni(y,t||jt.EMPTY_NODE):null}}}function ws(n,i,t,o){return pl(n.writeTree,n.treePath,i,t,o)}function vu(n,i){return function(n,i,t){let o=jt.EMPTY_NODE;const p=Kt(n.visibleWrites,i);if(p)return p.isLeafNode()||p.forEachChild(zn,(f,y)=>{o=o.updateImmediateChild(f,y)}),o;if(t){const f=Ot(n.visibleWrites,i);return t.forEachChild(zn,(y,C)=>{const E=ni(Ot(f,new Tn(y)),C);o=o.updateImmediateChild(y,E)}),nn(f).forEach(y=>{o=o.updateImmediateChild(y.name,y.node)}),o}return nn(Ot(n.visibleWrites,i)).forEach(y=>{o=o.updateImmediateChild(y.name,y.node)}),o}(n.writeTree,n.treePath,i)}function Cc(n,i,t,o){return function(n,i,t,o,p){Ze(o||p,"Either existingEventSnap or existingServerSnap must exist");const f=Zn(i,t);if(Ft(n.visibleWrites,f))return null;{const y=Ot(n.visibleWrites,f);return Pi(y)?p.getChild(t):ni(y,p.getChild(t))}}(n.writeTree,n.treePath,i,t,o)}function co(n,i){return function(n,i){return Kt(n.visibleWrites,i)}(n.writeTree,Zn(n.treePath,i))}function Cs(n,i,t){return function(n,i,t,o){const p=Zn(i,t),f=Kt(n.visibleWrites,p);return null!=f?f:o.isCompleteForChild(t)?ni(Ot(n.visibleWrites,p),o.getNode().getImmediateChild(t)):null}(n.writeTree,n.treePath,i,t)}function Ba(n,i){return fl(Zn(n.treePath,i),n.writeTree)}function fl(n,i){return{treePath:n,writeTree:i}}class Fh{constructor(){this.changeMap=new Map}trackChildChange(i){const t=i.type,o=i.childName;Ze("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Ze(".priority"!==o,"Only non-priority child changes can be tracked.");const p=this.changeMap.get(o);if(p){const f=p.type;if("child_added"===t&&"child_removed"===f)this.changeMap.set(o,fu(o,i.snapshotNode,p.snapshotNode));else if("child_removed"===t&&"child_added"===f)this.changeMap.delete(o);else if("child_removed"===t&&"child_changed"===f)this.changeMap.set(o,du(o,p.oldSnap));else if("child_changed"===t&&"child_added"===f)this.changeMap.set(o,Pr(o,i.snapshotNode));else{if("child_changed"!==t||"child_changed"!==f)throw Zo("Illegal combination of changes: "+i+" occurred after "+p);this.changeMap.set(o,fu(o,i.snapshotNode,p.oldSnap))}}else this.changeMap.set(o,i)}getChanges(){return Array.from(this.changeMap.values())}}const yu=new class{getCompleteChild(i){return null}getChildAfterChild(i,t,o){return null}};class ml{constructor(i,t,o=null){this.writes_=i,this.viewCache_=t,this.optCompleteServerCache_=o}getCompleteChild(i){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(i))return t.getNode().getImmediateChild(i);{const o=null!=this.optCompleteServerCache_?new Qe(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Cs(this.writes_,i,o)}}getChildAfterChild(i,t,o){const p=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:mn(this.viewCache_),f=function(n,i,t,o,p,f){return function(n,i,t,o,p,f,y){let C;const E=Ot(n.visibleWrites,i),M=Kt(E,cn());if(null!=M)C=M;else{if(null==t)return[];C=ni(E,t)}if(C=C.withIndex(y),C.isEmpty()||C.isLeafNode())return[];{const A=[],I=y.getCompare(),R=f?C.getReverseIteratorFrom(o,y):C.getIteratorFrom(o,y);let G=R.getNext();for(;G&&A.length<p;)0!==I(G,o)&&A.push(G),G=R.getNext();return A}}(n.writeTree,n.treePath,i,t,o,p,f)}(this.writes_,p,t,1,o,i);return 0===f.length?null:f[0]}}function Mc(n,i,t,o,p,f){const y=i.eventCache;if(null!=co(o,t))return i;{let C,E;if(Xt(t))if(Ze(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),i.serverCache.isFiltered()){const M=mn(i),I=vu(o,M instanceof jt?M:jt.EMPTY_NODE);C=n.filter.updateFullNode(i.eventCache.getNode(),I,f)}else{const M=ws(o,mn(i));C=n.filter.updateFullNode(i.eventCache.getNode(),M,f)}else{const M=$t(t);if(".priority"===M){Ze(1===ia(t),"Can't have a priority with additional path components");const A=y.getNode();E=i.serverCache.getNode();const I=Cc(o,t,A,E);C=null!=I?n.filter.updatePriority(A,I):y.getNode()}else{const A=Pn(t);let I;if(y.isCompleteForChild(M)){E=i.serverCache.getNode();const R=Cc(o,t,y.getNode(),E);I=null!=R?y.getNode().getImmediateChild(M).updateChild(A,R):y.getNode().getImmediateChild(M)}else I=Cs(o,M,i.serverCache);C=null!=I?n.filter.updateChild(y.getNode(),M,I,A,p,f):y.getNode()}}return In(i,C,y.isFullyInitialized()||Xt(t),n.filter.filtersNodes())}}function Va(n,i,t,o,p,f,y,C){const E=i.serverCache;let M;const A=y?n.filter:n.filter.getIndexedFilter();if(Xt(t))M=A.updateFullNode(E.getNode(),o,null);else if(A.filtersNodes()&&!E.isFiltered()){const G=E.getNode().updateChild(t,o);M=A.updateFullNode(E.getNode(),G,null)}else{const G=$t(t);if(!E.isCompleteForPath(t)&&ia(t)>1)return i;const W=Pn(t),ne=E.getNode().getImmediateChild(G).updateChild(W,o);M=".priority"===G?A.updatePriority(E.getNode(),ne):A.updateChild(E.getNode(),G,ne,W,yu,null)}const I=kn(i,M,E.isFullyInitialized()||Xt(t),A.filtersNodes());return Mc(n,I,t,p,new ml(p,I,f),C)}function xu(n,i,t,o,p,f,y){const C=i.eventCache;let E,M;const A=new ml(p,i,f);if(Xt(t))M=n.filter.updateFullNode(i.eventCache.getNode(),o,y),E=In(i,M,!0,n.filter.filtersNodes());else{const I=$t(t);if(".priority"===I)M=n.filter.updatePriority(i.eventCache.getNode(),o),E=In(i,M,C.isFullyInitialized(),C.isFiltered());else{const R=Pn(t),G=C.getNode().getImmediateChild(I);let W;if(Xt(R))W=o;else{const se=A.getCompleteChild(I);W=null!=se?".priority"===Th(R)&&se.getChild(kp(R)).isEmpty()?se:se.updateChild(R,o):jt.EMPTY_NODE}E=G.equals(W)?i:In(i,n.filter.updateChild(C.getNode(),I,W,R,A,y),C.isFullyInitialized(),n.filter.filtersNodes())}}return E}function gl(n,i){return n.eventCache.isCompleteForChild(i)}function Es(n,i,t){return t.foreach((o,p)=>{i=i.updateChild(o,p)}),i}function _l(n,i,t,o,p,f,y,C){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let M,E=i;M=Xt(t)?o:new Gt(null).setTree(t,o);const A=i.serverCache.getNode();return M.children.inorderTraversal((I,R)=>{if(A.hasChild(I)){const W=Es(0,i.serverCache.getNode().getImmediateChild(I),R);E=Va(n,E,new Tn(I),W,p,f,y,C)}}),M.children.inorderTraversal((I,R)=>{const G=!i.serverCache.isCompleteForChild(I)&&void 0===R.value;if(!A.hasChild(I)&&!G){const se=Es(0,i.serverCache.getNode().getImmediateChild(I),R);E=Va(n,E,new Tn(I),se,p,f,y,C)}}),E}class Rp{constructor(i,t){this.query_=i,this.eventRegistrations_=[];const o=this.query_._queryParams,p=new ai(o.getIndex()),f=function(n){return n.loadsAllData()?new ai(n.getIndex()):n.hasLimit()?new Ld(n):new uo(n)}(o);this.processor_=function(n){return{filter:n}}(f);const y=t.serverCache,C=t.eventCache,E=p.updateFullNode(jt.EMPTY_NODE,y.getNode(),null),M=f.updateFullNode(jt.EMPTY_NODE,C.getNode(),null),A=new Qe(E,y.isFullyInitialized(),p.filtersNodes()),I=new Qe(M,C.isFullyInitialized(),f.filtersNodes());this.viewCache_=dn(I,A),this.eventGenerator_=new Rt(this.query_)}get query(){return this.query_}}function Wf(n,i){const t=mn(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Xt(i)&&!t.getImmediateChild($t(i)).isEmpty())?t.getChild(i):null}function wu(n){return 0===n.eventRegistrations_.length}function ho(n,i,t){const o=[];if(t){Ze(null==i,"A cancel should cancel all event registrations.");const p=n.query._path;n.eventRegistrations_.forEach(f=>{const y=f.createCancelEvent(t,p);y&&o.push(y)})}if(i){let p=[];for(let f=0;f<n.eventRegistrations_.length;++f){const y=n.eventRegistrations_[f];if(y.matches(i)){if(i.hasAnyCallback()){p=p.concat(n.eventRegistrations_.slice(f+1));break}}else p.push(y)}n.eventRegistrations_=p}else n.eventRegistrations_=[];return o}function Nd(n,i,t,o){i.type===Le.MERGE&&null!==i.source.queryId&&(Ze(mn(n.viewCache_),"We should always have a full cache before handling merges"),Ze(fn(n.viewCache_),"Missing event cache, even though we have a server cache"));const p=n.viewCache_,f=function(n,i,t,o,p){const f=new Fh;let y,C;if(t.type===Le.OVERWRITE){const M=t;M.source.fromUser?y=xu(n,i,M.path,M.snap,o,p,f):(Ze(M.source.fromServer,"Unknown source."),C=M.source.tagged||i.serverCache.isFiltered()&&!Xt(M.path),y=Va(n,i,M.path,M.snap,o,p,C,f))}else if(t.type===Le.MERGE){const M=t;M.source.fromUser?y=function(n,i,t,o,p,f,y){let C=i;return o.foreach((E,M)=>{const A=Zn(t,E);gl(i,$t(A))&&(C=xu(n,C,A,M,p,f,y))}),o.foreach((E,M)=>{const A=Zn(t,E);gl(i,$t(A))||(C=xu(n,C,A,M,p,f,y))}),C}(n,i,M.path,M.children,o,p,f):(Ze(M.source.fromServer,"Unknown source."),C=M.source.tagged||i.serverCache.isFiltered(),y=_l(n,i,M.path,M.children,o,p,C,f))}else if(t.type===Le.ACK_USER_WRITE){const M=t;y=M.revert?function(n,i,t,o,p,f){let y;if(null!=co(o,t))return i;{const C=new ml(o,i,p),E=i.eventCache.getNode();let M;if(Xt(t)||".priority"===$t(t)){let A;if(i.serverCache.isFullyInitialized())A=ws(o,mn(i));else{const I=i.serverCache.getNode();Ze(I instanceof jt,"serverChildren would be complete if leaf node"),A=vu(o,I)}A=A,M=n.filter.updateFullNode(E,A,f)}else{const A=$t(t);let I=Cs(o,A,i.serverCache);null==I&&i.serverCache.isCompleteForChild(A)&&(I=E.getImmediateChild(A)),M=null!=I?n.filter.updateChild(E,A,I,Pn(t),C,f):i.eventCache.getNode().hasChild(A)?n.filter.updateChild(E,A,jt.EMPTY_NODE,Pn(t),C,f):E,M.isEmpty()&&i.serverCache.isFullyInitialized()&&(y=ws(o,mn(i)),y.isLeafNode()&&(M=n.filter.updateFullNode(M,y,f)))}return y=i.serverCache.isFullyInitialized()||null!=co(o,cn()),In(i,M,y,n.filter.filtersNodes())}}(n,i,M.path,o,p,f):function(n,i,t,o,p,f,y){if(null!=co(p,t))return i;const C=i.serverCache.isFiltered(),E=i.serverCache;if(null!=o.value){if(Xt(t)&&E.isFullyInitialized()||E.isCompleteForPath(t))return Va(n,i,t,E.getNode().getChild(t),p,f,C,y);if(Xt(t)){let M=new Gt(null);return E.getNode().forEachChild(lo,(A,I)=>{M=M.set(new Tn(A),I)}),_l(n,i,t,M,p,f,C,y)}return i}{let M=new Gt(null);return o.foreach((A,I)=>{const R=Zn(t,A);E.isCompleteForPath(R)&&(M=M.set(A,E.getNode().getChild(R)))}),_l(n,i,t,M,p,f,C,y)}}(n,i,M.path,M.affectedTree,o,p,f)}else{if(t.type!==Le.LISTEN_COMPLETE)throw Zo("Unknown operation type: "+t.type);y=function(n,i,t,o,p){const f=i.serverCache;return Mc(n,kn(i,f.getNode(),f.isFullyInitialized()||Xt(t),f.isFiltered()),t,o,yu,p)}(n,i,t.path,o,f)}const E=f.getChanges();return function(n,i,t){const o=i.eventCache;if(o.isFullyInitialized()){const p=o.getNode().isLeafNode()||o.getNode().isEmpty(),f=fn(n);(t.length>0||!n.eventCache.isFullyInitialized()||p&&!o.getNode().equals(f)||!o.getNode().getPriority().equals(f.getPriority()))&&t.push(hl(fn(i)))}}(i,y,E),{viewCache:y,changes:E}}(n.processor_,p,i,t,o);return function(n,i){Ze(i.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),Ze(i.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,f.viewCache),Ze(f.viewCache.serverCache.isFullyInitialized()||!p.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=f.viewCache,Vh(n,f.changes,f.viewCache.eventCache.getNode(),null)}function Vh(n,i,t,o){return function(n,i,t,o){const p=[],f=[];return i.forEach(y=>{"child_changed"===y.type&&n.index_.indexedValueChanged(y.oldSnap,y.snapshotNode)&&f.push(function(n,i){return{type:"child_moved",snapshotNode:i,childName:n}}(y.childName,y.snapshotNode))}),Bt(n,p,"child_removed",i,o,t),Bt(n,p,"child_added",i,o,t),Bt(n,p,"child_moved",f,o,t),Bt(n,p,"child_changed",i,o,t),Bt(n,p,"value",i,o,t),p}(n.eventGenerator_,i,t,o?[o]:n.eventRegistrations_)}let Pc,Zi;class kc{constructor(){this.views=new Map}}function Cu(n,i,t,o){const p=i.source.queryId;if(null!==p){const f=n.views.get(p);return Ze(null!=f,"SyncTree gave us an op for an invalid query."),Nd(f,i,t,o)}{let f=[];for(const y of n.views.values())f=f.concat(Nd(y,i,t,o));return f}}function Np(n,i,t,o,p,f){const y=function(n,i,t,o,p){const y=n.views.get(i._queryIdentifier);if(!y){let C=ws(t,p?o:null),E=!1;C?E=!0:o instanceof jt?(C=vu(t,o),E=!1):(C=jt.EMPTY_NODE,E=!1);const M=dn(new Qe(C,E,!1),new Qe(o,p,!1));return new Rp(i,M)}return y}(n,i,o,p,f);return n.views.has(i._queryIdentifier)||n.views.set(i._queryIdentifier,y),function(n,i){n.eventRegistrations_.push(i)}(y,t),function(n,i){const t=n.viewCache_.eventCache,o=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(zn,(f,y)=>{o.push(Pr(f,y))}),t.isFullyInitialized()&&o.push(hl(t.getNode())),Vh(n,o,t.getNode(),i)}(y,t)}function Eu(n){const i=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||i.push(t);return i}function Ua(n,i){let t=null;for(const o of n.views.values())t=t||Wf(o,i);return t}function Bp(n,i){return i._queryParams.loadsAllData()?zc(n):n.views.get(i._queryIdentifier)}function Vp(n,i){return null!=Bp(n,i)}function $a(n){return null!=zc(n)}function zc(n){for(const i of n.views.values())if(i.query._queryParams.loadsAllData())return i;return null}let ca=1;class Ud{constructor(i){this.listenProvider_=i,this.syncPointTree_=new Gt(null),this.pendingWriteTree_={visibleWrites:xn.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function jh(n,i,t,o,p){return function(n,i,t,o,p){Ze(o>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===p&&(p=!0),n.allWrites.push({path:i,snap:t,writeId:o,visible:p}),p&&(n.visibleWrites=hi(n.visibleWrites,i,t)),n.lastWriteId=o}(n.pendingWriteTree_,i,t,o,p),p?yl(n,new St({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},i,t)):[]}function Xr(n,i,t=!1){const o=function(n,i){for(let t=0;t<n.allWrites.length;t++){const o=n.allWrites[t];if(o.writeId===i)return o}return null}(n.pendingWriteTree_,i);if(function(n,i){const t=n.allWrites.findIndex(C=>C.writeId===i);Ze(t>=0,"removeWrite called with nonexistent writeId.");const o=n.allWrites[t];n.allWrites.splice(t,1);let p=o.visible,f=!1,y=n.allWrites.length-1;for(;p&&y>=0;){const C=n.allWrites[y];C.visible&&(y>=t&&sa(C,o.path)?p=!1:Wr(o.path,C.path)&&(f=!0)),y--}return!!p&&(f?(function(n){n.visibleWrites=Zr(n.allWrites,la,cn()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(o.snap?n.visibleWrites=pi(n.visibleWrites,o.path):Ui(o.children,E=>{n.visibleWrites=pi(n.visibleWrites,Zn(o.path,E))}),!0))}(n.pendingWriteTree_,i)){let f=new Gt(null);return null!=o.snap?f=f.set(cn(),!0):Ui(o.children,y=>{f=f.set(new Tn(y),!0)}),yl(n,new lt(o.path,f,t))}return[]}function ha(n,i,t){return yl(n,new St({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},i,t))}function qh(n,i,t,o){const p=i._path,f=n.syncPointTree_.get(p);let y=[];if(f&&("default"===i._queryIdentifier||Vp(f,i))){const C=function(n,i,t,o){const p=i._queryIdentifier,f=[];let y=[];const C=$a(n);if("default"===p)for(const[E,M]of n.views.entries())y=y.concat(ho(M,t,o)),wu(M)&&(n.views.delete(E),M.query._queryParams.loadsAllData()||f.push(M.query));else{const E=n.views.get(p);E&&(y=y.concat(ho(E,t,o)),wu(E)&&(n.views.delete(p),E.query._queryParams.loadsAllData()||f.push(E.query)))}return C&&!$a(n)&&f.push(new(Ze(Pc,"Reference.ts has not been loaded"),Pc)(i._repo,i._path)),{removed:f,events:y}}(f,i,t,o);(function(n){return 0===n.views.size})(f)&&(n.syncPointTree_=n.syncPointTree_.remove(p));const E=C.removed;y=C.events;const M=-1!==E.findIndex(I=>I._queryParams.loadsAllData()),A=n.syncPointTree_.findOnPath(p,(I,R)=>$a(R));if(M&&!A){const I=n.syncPointTree_.subtree(p);if(!I.isEmpty()){const R=function(n){return n.fold((i,t,o)=>{if(t&&$a(t))return[zc(t)];{let p=[];return t&&(p=Eu(t)),Ui(o,(f,y)=>{p=p.concat(y)}),p}})}(I);for(let G=0;G<R.length;++G){const W=R[G],se=W.query,ne=Up(n,W);n.listenProvider_.startListening(Au(se),Mu(n,se),ne.hashFn,ne.onComplete)}}}if(!A&&E.length>0&&!o)if(M){const I=null;n.listenProvider_.stopListening(Au(i),I)}else E.forEach(I=>{const R=n.queryToTagMap.get(Lc(I));n.listenProvider_.stopListening(Au(I),R)});!function(n,i){for(let t=0;t<i.length;++t){const o=i[t];if(!o._queryParams.loadsAllData()){const p=Lc(o),f=n.queryToTagMap.get(p);n.queryToTagMap.delete(p),n.tagToQueryMap.delete(f)}}}(n,E)}return y}function Gh(n,i,t){const o=i._path;let p=null,f=!1;n.syncPointTree_.foreachOnPath(o,(I,R)=>{const G=fr(I,o);p=p||Ua(R,G),f=f||$a(R)});let C,y=n.syncPointTree_.get(o);y?(f=f||$a(y),p=p||Ua(y,cn())):(y=new kc,n.syncPointTree_=n.syncPointTree_.set(o,y)),null!=p?C=!0:(C=!1,p=jt.EMPTY_NODE,n.syncPointTree_.subtree(o).foreachChild((R,G)=>{const W=Ua(G,cn());W&&(p=p.updateImmediateChild(R,W))}));const E=Vp(y,i);if(!E&&!i._queryParams.loadsAllData()){const I=Lc(i);Ze(!n.queryToTagMap.has(I),"View does not exist, but we have a tag");const R=ca++;n.queryToTagMap.set(I,R),n.tagToQueryMap.set(R,I)}let A=Np(y,i,t,Rn(n.pendingWriteTree_,o),p,C);if(!E&&!f){const I=Bp(y,i);A=A.concat(function(n,i,t){const o=i._path,p=Mu(n,i),f=Up(n,t),y=n.listenProvider_.startListening(Au(i),p,f.hashFn,f.onComplete),C=n.syncPointTree_.subtree(o);if(p)Ze(!$a(C.value),"If we're adding a query, it shouldn't be shadowed");else{const E=C.fold((M,A,I)=>{if(!Xt(M)&&A&&$a(A))return[zc(A).query];{let R=[];return A&&(R=R.concat(Eu(A).map(G=>G.query))),Ui(I,(G,W)=>{R=R.concat(W)}),R}});for(let M=0;M<E.length;++M){const A=E[M];n.listenProvider_.stopListening(Au(A),Mu(n,A))}}return y}(n,i,I))}return A}function Iu(n,i,t){const p=n.pendingWriteTree_,f=n.syncPointTree_.findOnPath(i,(y,C)=>{const M=Ua(C,fr(y,i));if(M)return M});return pl(p,i,f,t,!0)}function yl(n,i){return Hh(i,n.syncPointTree_,null,Rn(n.pendingWriteTree_,cn()))}function Hh(n,i,t,o){if(Xt(n.path))return Wh(n,i,t,o);{const p=i.get(cn());null==t&&null!=p&&(t=Ua(p,cn()));let f=[];const y=$t(n.path),C=n.operationForChild(y),E=i.children.get(y);if(E&&C){const M=t?t.getImmediateChild(y):null,A=Ba(o,y);f=f.concat(Hh(C,E,M,A))}return p&&(f=f.concat(Cu(p,n,o,t))),f}}function Wh(n,i,t,o){const p=i.get(cn());null==t&&null!=p&&(t=Ua(p,cn()));let f=[];return i.children.inorderTraversal((y,C)=>{const E=t?t.getImmediateChild(y):null,M=Ba(o,y),A=n.operationForChild(y);A&&(f=f.concat(Wh(A,C,E,M)))}),p&&(f=f.concat(Cu(p,n,o,t))),f}function Up(n,i){const t=i.query,o=Mu(n,t);return{hashFn:()=>(function(n){return n.viewCache_.serverCache.getNode()}(i)||jt.EMPTY_NODE).hash(),onComplete:p=>{if("ok"===p)return o?function(n,i,t){const o=Zh(n,t);if(o){const p=Rc(o),f=p.path,y=p.queryId,C=fr(f,i);return Xh(n,f,new He(qe(y),C))}return[]}(n,t._path,o):function(n,i){return yl(n,new He({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},i))}(n,t._path);{const f=function(n,i){let t="Unknown Error";"too_big"===n?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?t="Client doesn't have permission to access the desired data.":"unavailable"===n&&(t="The service is unavailable");const o=new Error(n+" at "+i._path.toString()+": "+t);return o.code=n.toUpperCase(),o}(p,t);return qh(n,t,null,f)}}}}function Mu(n,i){const t=Lc(i);return n.queryToTagMap.get(t)}function Lc(n){return n._path.toString()+"$"+n._queryIdentifier}function Zh(n,i){return n.tagToQueryMap.get(i)}function Rc(n){const i=n.indexOf("$");return Ze(-1!==i&&i<n.length-1,"Bad queryKey."),{queryId:n.substr(i+1),path:new Tn(n.substr(0,i))}}function Xh(n,i,t){const o=n.syncPointTree_.get(i);return Ze(o,"Missing sync point for query tag that we're tracking"),Cu(o,t,Rn(n.pendingWriteTree_,i),null)}function Au(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Ze(Zi,"Reference.ts has not been loaded"),Zi)(n._repo,n._path):n}class $p{constructor(i){this.node_=i}getImmediateChild(i){const t=this.node_.getImmediateChild(i);return new $p(t)}node(){return this.node_}}class jp{constructor(i,t){this.syncTree_=i,this.path_=t}getImmediateChild(i){const t=Zn(this.path_,i);return new jp(this.syncTree_,t)}node(){return Iu(this.syncTree_,this.path_)}}const Hd=function(n,i,t){return n&&"object"==typeof n?(Ze(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?Yf(n[".sv"],i,t):"object"==typeof n[".sv"]?Kf(n[".sv"],i):void Ze(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},Yf=function(n,i,t){if("timestamp"===n)return t.timestamp;Ze(!1,"Unexpected server value: "+n)},Kf=function(n,i,t){n.hasOwnProperty("increment")||Ze(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const o=n.increment;"number"!=typeof o&&Ze(!1,"Unexpected increment value: "+o);const p=i.node();if(Ze(null!=p,"Expected ChildrenNode.EMPTY_NODE for nulls"),!p.isLeafNode())return o;const y=p.getValue();return"number"!=typeof y?o:y+o},qp=function(n,i,t){return po(n,new $p(i),t)};function po(n,i,t){const o=n.getPriority().val(),p=Hd(o,i.getImmediateChild(".priority"),t);let f;if(n.isLeafNode()){const y=n,C=Hd(y.getValue(),i,t);return C!==y.getValue()||p!==y.getPriority().val()?new uu(C,ei(p)):n}{const y=n;return f=y,p!==y.getPriority().val()&&(f=f.updatePriority(new uu(p))),y.forEachChild(zn,(C,E)=>{const M=po(E,i.getImmediateChild(C),t);M!==E&&(f=f.updateImmediateChild(C,M))}),f}}class Pu{constructor(i="",t=null,o={children:{},childCount:0}){this.name=i,this.parent=t,this.node=o}}function Nc(n,i){let t=i instanceof Tn?i:new Tn(i),o=n,p=$t(t);for(;null!==p;){const f=ar(o.node.children,p)||{children:{},childCount:0};o=new Pu(p,o,f),t=Pn(t),p=$t(t)}return o}function Do(n){return n.node.value}function Kh(n,i){n.node.value=i,Qf(n)}function bm(n){return n.node.childCount>0}function Zd(n,i){Ui(n.node.children,(t,o)=>{i(new Pu(t,n,o))})}function wm(n,i,t,o){t&&!o&&i(n),Zd(n,p=>{wm(p,i,!0,o)}),t&&o&&i(n)}function Gp(n){return new Tn(null===n.parent?n.name:Gp(n.parent)+"/"+n.name)}function Qf(n){null!==n.parent&&function(n,i,t){const o=function(n){return void 0===Do(n)&&!bm(n)}(t),p=qn(n.node.children,i);o&&p?(delete n.node.children[i],n.node.childCount--,Qf(n)):!o&&!p&&(n.node.children[i]=t.node,n.node.childCount++,Qf(n))}(n.parent,n.name,n)}const vg=/[\[\].#$\/\u0000-\u001F\u007F]/,yg=/[\[\].#$\u0000-\u001F\u007F]/,Jf=10485760,Xd=function(n){return"string"==typeof n&&0!==n.length&&!vg.test(n)},Cm=function(n){return"string"==typeof n&&0!==n.length&&!yg.test(n)},Wp=function(n,i,t){const o=t instanceof Tn?new Mh(t,n):t;if(void 0===i)throw new Error(n+"contains undefined "+ra(o));if("function"==typeof i)throw new Error(n+"contains a function "+ra(o)+" with contents = "+i.toString());if(tu(i))throw new Error(n+"contains "+i.toString()+" "+ra(o));if("string"==typeof i&&i.length>Jf/3&&Tr(i)>Jf)throw new Error(n+"contains a string greater than "+Jf+" utf8 bytes "+ra(o)+" ('"+i.substring(0,50)+"...')");if(i&&"object"==typeof i){let p=!1,f=!1;if(Ui(i,(y,C)=>{if(".value"===y)p=!0;else if(".priority"!==y&&".sv"!==y&&(f=!0,!Xd(y)))throw new Error(n+" contains an invalid key ("+y+") "+ra(o)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function(n,i){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(i),n.byteLength_+=Tr(i),gc(n)})(o,y),Wp(n,C,o),function(n){const i=n.parts_.pop();n.byteLength_-=Tr(i),n.parts_.length>0&&(n.byteLength_-=1)}(o)}),p&&f)throw new Error(n+' contains ".value" child '+ra(o)+" in addition to actual children.")}},tm=function(n,i,t,o){if(!(o&&void 0===t||Cm(t)))throw new Error(jr(n,i)+'was an invalid path = "'+t+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')};class Cg{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Yd(n,i){let t=null;for(let o=0;o<i.length;o++){const p=i[o],f=p.getPath();null!==t&&!Ih(f,t.path)&&(n.eventLists_.push(t),t=null),null===t&&(t={events:[],path:f}),t.events.push(p)}t&&n.eventLists_.push(t)}function nm(n,i,t){Yd(n,t),Tm(n,o=>Ih(o,i))}function pa(n,i,t){Yd(n,t),Tm(n,o=>Wr(o,i)||Wr(i,o))}function Tm(n,i){n.recursionDepth_++;let t=!0;for(let o=0;o<n.eventLists_.length;o++){const p=n.eventLists_[o];p&&(i(p.path)?(Eg(n.eventLists_[o]),n.eventLists_[o]=null):t=!1)}t&&(n.eventLists_=[]),n.recursionDepth_--}function Eg(n){for(let i=0;i<n.events.length;i++){const t=n.events[i];if(null!==t){n.events[i]=null;const o=t.getEventRunner();ta&&vi("event: "+t.toString()),nl(o)}}}class Tg{constructor(i,t,o,p){this.repoInfo_=i,this.forceRestClient_=t,this.authTokenProvider_=o,this.appCheckProvider_=p,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Cg,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=U(),this.transactionQueueTree_=new Pu,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Mm(n){const t=n.infoData_.getNode(new Tn(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Xp(n){return function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n}({timestamp:Mm(n)})}function Am(n,i,t,o,p){n.dataUpdateCount++;const f=new Tn(i);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(i,t):t;let y=[];if(p)if(o){const E=as(t,M=>ei(M));y=function(n,i,t,o){const p=Zh(n,o);if(p){const f=Rc(p),y=f.path,C=f.queryId,E=fr(y,i),M=Gt.fromObject(t);return Xh(n,y,new gt(qe(C),E,M))}return[]}(n.serverSyncTree_,f,E,p)}else{const E=ei(t);y=function(n,i,t,o){const p=Zh(n,o);if(null!=p){const f=Rc(p),y=f.path,C=f.queryId,E=fr(y,i);return Xh(n,y,new St(qe(C),E,t))}return[]}(n.serverSyncTree_,f,E,p)}else if(o){const E=as(t,M=>ei(M));y=function(n,i,t){const o=Gt.fromObject(t);return yl(n,new gt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},i,o))}(n.serverSyncTree_,f,E)}else{const E=ei(t);y=ha(n.serverSyncTree_,f,E)}let C=f;y.length>0&&(C=Jh(n,f)),pa(n.eventQueue_,C,y)}function Pm(n,i){im(n,"connected",i),!1===i&&function(n){Qh(n,"onDisconnectEvents");const i=Xp(n),t=U();le(n.onDisconnect_,cn(),(p,f)=>{const y=function(n,i,t,o){return po(i,new jp(t,n),o)}(p,f,n.serverSyncTree_,i);Y(t,p,y)});let o=[];le(t,cn(),(p,f)=>{o=o.concat(ha(n.serverSyncTree_,p,f));const y=function(n,i){const t=Gp(Om(n,i)),o=Nc(n.transactionQueueTree_,i);return function(n,i,t){let o=void 0?n:n.parent;for(;null!==o;){if(i(o))return!0;o=o.parent}}(o,p=>{lm(n,p)}),lm(n,o),wm(o,p=>{lm(n,p)}),t}(n,p);Jh(n,y)}),n.onDisconnect_=U(),pa(n.eventQueue_,cn(),o)}(n)}function im(n,i,t){const o=new Tn("/.info/"+i),p=ei(t);n.infoData_.updateSnapshot(o,p);const f=ha(n.infoSyncTree_,o,p);pa(n.eventQueue_,o,f)}function Kd(n){return n.nextWriteId_++}function om(n,i,t){let o;o=".info"===$t(i._path)?qh(n.infoSyncTree_,i,t):qh(n.serverSyncTree_,i,t),nm(n.eventQueue_,i._path,o)}function Qh(n,...i){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),vi(t,...i)}function am(n,i,t){return Iu(n.serverSyncTree_,i,t)||jt.EMPTY_NODE}function Qd(n,i=n.transactionQueueTree_){if(i||Jd(n,i),Do(i)){const t=zm(n,i);Ze(t.length>0,"Sending zero length transaction queue"),t.every(p=>0===p.status)&&function(n,i,t){const o=t.map(M=>M.currentWriteId),p=am(n,i,o);let f=p;const y=p.hash();for(let M=0;M<t.length;M++){const A=t[M];Ze(0===A.status,"tryToSendTransactionQueue_: items in queue should all be run."),A.status=1,A.retryCount++;const I=fr(i,A.path);f=f.updateChild(I,A.currentOutputSnapshotRaw)}const C=f.val(!0),E=i;n.server_.put(E.toString(),C,M=>{Qh(n,"transaction put response",{path:E.toString(),status:M});let A=[];if("ok"===M){const I=[];for(let R=0;R<t.length;R++)t[R].status=2,A=A.concat(Xr(n.serverSyncTree_,t[R].currentWriteId)),t[R].onComplete&&I.push(()=>t[R].onComplete(null,!0,t[R].currentOutputSnapshotResolved)),t[R].unwatcher();Jd(n,Nc(n.transactionQueueTree_,i)),Qd(n,n.transactionQueueTree_),pa(n.eventQueue_,i,A);for(let R=0;R<I.length;R++)nl(I[R])}else{if("datastale"===M)for(let I=0;I<t.length;I++)t[I].status=3===t[I].status?4:0;else{Ei("transaction at "+E.toString()+" failed: "+M);for(let I=0;I<t.length;I++)t[I].status=4,t[I].abortReason=M}Jh(n,i)}},y)}(n,Gp(i),t)}else bm(i)&&Zd(i,t=>{Qd(n,t)})}function Jh(n,i){const t=Om(n,i),o=Gp(t);return function(n,i,t){if(0===i.length)return;const o=[];let p=[];const y=i.filter(C=>0===C.status).map(C=>C.currentWriteId);for(let C=0;C<i.length;C++){const E=i[C],M=fr(t,E.path);let I,A=!1;if(Ze(null!==M,"rerunTransactionsUnderNode_: relativePath should not be null."),4===E.status)A=!0,I=E.abortReason,p=p.concat(Xr(n.serverSyncTree_,E.currentWriteId,!0));else if(0===E.status)if(E.retryCount>=25)A=!0,I="maxretry",p=p.concat(Xr(n.serverSyncTree_,E.currentWriteId,!0));else{const R=am(n,E.path,y);E.currentInputSnapshot=R;const G=i[C].update(R.val());if(void 0!==G){Wp("transaction failed: Data returned ",G,E.path);let W=ei(G);"object"==typeof G&&null!=G&&qn(G,".priority")||(W=W.updatePriority(R.getPriority()));const ne=E.currentWriteId,ge=Xp(n),we=qp(W,R,ge);E.currentOutputSnapshotRaw=W,E.currentOutputSnapshotResolved=we,E.currentWriteId=Kd(n),y.splice(y.indexOf(ne),1),p=p.concat(jh(n.serverSyncTree_,E.path,we,E.currentWriteId,E.applyLocally)),p=p.concat(Xr(n.serverSyncTree_,ne,!0))}else A=!0,I="nodata",p=p.concat(Xr(n.serverSyncTree_,E.currentWriteId,!0))}pa(n.eventQueue_,t,p),p=[],A&&(i[C].status=2,setTimeout(i[C].unwatcher,Math.floor(0)),i[C].onComplete&&o.push("nodata"===I?()=>i[C].onComplete(null,!1,i[C].currentInputSnapshot):()=>i[C].onComplete(new Error(I),!1,null)))}Jd(n,n.transactionQueueTree_);for(let C=0;C<o.length;C++)nl(o[C]);Qd(n,n.transactionQueueTree_)}(n,zm(n,t),o),o}function Om(n,i){let t,o=n.transactionQueueTree_;for(t=$t(i);null!==t&&void 0===Do(o);)o=Nc(o,t),t=$t(i=Pn(i));return o}function zm(n,i){const t=[];return Lm(n,i,t),t.sort((o,p)=>o.order-p.order),t}function Lm(n,i,t){const o=Do(i);if(o)for(let p=0;p<o.length;p++)t.push(o[p]);Zd(i,p=>{Lm(n,p,t)})}function Jd(n,i){const t=Do(i);if(t){let o=0;for(let p=0;p<t.length;p++)2!==t[p].status&&(t[o]=t[p],o++);t.length=o,Kh(i,t.length>0?t:void 0)}Zd(i,o=>{Jd(n,o)})}function lm(n,i){const t=Do(i);if(t){const o=[];let p=[],f=-1;for(let y=0;y<t.length;y++)3===t[y].status||(1===t[y].status?(Ze(f===y-1,"All SENT items should be at beginning of queue."),f=y,t[y].status=3,t[y].abortReason="set"):(Ze(0===t[y].status,"Unexpected transaction status in abort"),t[y].unwatcher(),p=p.concat(Xr(n.serverSyncTree_,t[y].currentWriteId,!0)),t[y].onComplete&&o.push(t[y].onComplete.bind(null,new Error("set"),!1,null))));-1===f?Kh(i,void 0):t.length=f+1,pa(n.eventQueue_,Gp(i),p);for(let y=0;y<o.length;y++)nl(o[y])}}const um=function(n,i){const t=$g(n),o=t.namespace;return"firebase.com"===t.domain&&ko(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!o||"undefined"===o)&&"localhost"!==t.domain&&ko("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Ei("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new vh(t.host,t.secure,o,"ws"===t.scheme||"wss"===t.scheme,i,"",o!==t.subdomain),path:new Tn(t.pathString)}},$g=function(n){let i="",t="",o="",p="",f="",y=!0,C="https",E=443;if("string"==typeof n){let M=n.indexOf("//");M>=0&&(C=n.substring(0,M-1),n=n.substring(M+2));let A=n.indexOf("/");-1===A&&(A=n.length);let I=n.indexOf("?");-1===I&&(I=n.length),i=n.substring(0,Math.min(A,I)),A<I&&(p=function(n){let i="";const t=n.split("/");for(let o=0;o<t.length;o++)if(t[o].length>0){let p=t[o];try{p=decodeURIComponent(p.replace(/\+/g," "))}catch(f){}i+="/"+p}return i}(n.substring(A,I)));const R=function(n){const i={};"?"===n.charAt(0)&&(n=n.substring(1));for(const t of n.split("&")){if(0===t.length)continue;const o=t.split("=");2===o.length?i[decodeURIComponent(o[0])]=decodeURIComponent(o[1]):Ei(`Invalid query segment '${t}' in query '${n}'`)}return i}(n.substring(Math.min(n.length,I)));M=i.indexOf(":"),M>=0?(y="https"===C||"wss"===C,E=parseInt(i.substring(M+1),10)):M=i.length;const G=i.slice(0,M);if("localhost"===G.toLowerCase())t="localhost";else if(G.split(".").length<=2)t=G;else{const W=i.indexOf(".");o=i.substring(0,W).toLowerCase(),t=i.substring(W+1),f=o}"ns"in R&&(f=R.ns)}return{host:i,port:E,domain:t,subdomain:o,secure:y,scheme:C,pathString:p,namespace:f}};class Rm{constructor(i,t,o,p){this.eventType=i,this.eventRegistration=t,this.snapshot=o,this.prevName=p}getPath(){const i=this.snapshot.ref;return"value"===this.eventType?i._path:i.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ri(this.snapshot.exportVal())}}class Fm{constructor(i,t,o){this.eventRegistration=i,this.error=t,this.path=o}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Nm{constructor(i,t){this.snapshotCallback=i,this.cancelCallback=t}onValue(i,t){this.snapshotCallback.call(null,i,t)}onCancel(i){return Ze(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,i)}get hasCancelCallback(){return!!this.cancelCallback}matches(i){return this.snapshotCallback===i.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===i.snapshotCallback.userCallback&&this.snapshotCallback.context===i.snapshotCallback.context}}class Oo{constructor(i,t,o,p){this._repo=i,this._path=t,this._queryParams=o,this._orderByCalled=p}get key(){return Xt(this._path)?null:Th(this._path)}get ref(){return new qa(this._repo,this._path)}get _queryIdentifier(){const i=D(this._queryParams),t=lc(i);return"{}"===t?"default":t}get _queryObject(){return D(this._queryParams)}isEqual(i){if(!((i=Ma(i))instanceof Oo))return!1;const t=this._repo===i._repo,o=Ih(this._path,i._path);return t&&o&&this._queryIdentifier===i._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(n){let i="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)""!==n.pieces_[t]&&(i+="/"+encodeURIComponent(String(n.pieces_[t])));return i||"/"}(this._path)}}class qa extends Oo{constructor(i,t){super(i,t,new e,!1)}get parent(){const i=kp(this._path);return null===i?null:new qa(this._repo,i)}get root(){let i=this;for(;null!==i.parent;)i=i.parent;return i}}class Bc{constructor(i,t,o){this._node=i,this.ref=t,this._index=o}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(i){const t=new Tn(i),o=ep(this.ref,i);return new Bc(this._node.getChild(t),o,zn)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(i){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(o,p)=>i(new Bc(p,ep(this.ref,o),zn)))}hasChild(i){const t=new Tn(i);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ep(n,i){return null===$t((n=Ma(n))._path)?(t=i,t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),tm("child","path",t,!1)):tm("child","path",i,!1),new qa(n._repo,Zn(n._path,i));var t}class nf{constructor(i){this.callbackContext=i}respondsTo(i){return"value"===i}createEvent(i,t){const o=t._queryParams.getIndex();return new Rm("value",this,new Bc(i.snapshotNode,new qa(t._repo,t._path),o))}getEventRunner(i){return"cancel"===i.getEventType()?()=>this.callbackContext.onCancel(i.error):()=>this.callbackContext.onValue(i.snapshot,null)}createCancelEvent(i,t){return this.callbackContext.hasCancelCallback?new Fm(this,i,t):null}matches(i){return i instanceof nf&&(!i.callbackContext||!this.callbackContext||i.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class rf{constructor(i,t){this.eventType=i,this.callbackContext=t}respondsTo(i){let t="children_added"===i?"child_added":i;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(i,t){return this.callbackContext.hasCancelCallback?new Fm(this,i,t):null}createEvent(i,t){Ze(null!=i.childName,"Child events should have a childName.");const o=ep(new qa(t._repo,t._path),i.childName),p=t._queryParams.getIndex();return new Rm(i.type,this,new Bc(i.snapshotNode,o,p),i.prevName)}getEventRunner(i){return"cancel"===i.getEventType()?()=>this.callbackContext.onCancel(i.error):()=>this.callbackContext.onValue(i.snapshot,i.prevName)}matches(i){return i instanceof rf&&this.eventType===i.eventType&&(!this.callbackContext||!i.callbackContext||this.callbackContext.matches(i.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function Um(n,i,t,o){return function(n,i,t,o,p){let f;if("object"==typeof o&&(f=void 0,p=o),"function"==typeof o&&(f=o),p&&p.onlyOnce){const E=t,M=(A,I)=>{om(n._repo,n,C),E(A,I)};M.userCallback=t.userCallback,M.context=t.context,t=M}const y=new Nm(t,f||void 0),C="value"===i?new nf(y):new rf(i,y);return function(n,i,t){let o;o=".info"===$t(i._path)?Gh(n.infoSyncTree_,i,t):Gh(n.serverSyncTree_,i,t),nm(n.eventQueue_,i._path,o)}(n._repo,n,C),()=>om(n._repo,n,C)}(n,"value",i,t,o)}(function(n){Ze(!Pc,"__referenceConstructor has already been defined"),Pc=n})(qa),function(n){Ze(!Zi,"__referenceConstructor has already been defined"),Zi=n}(qa);const cm={};function t_(n,i,t,o,p){let f=o||n.options.databaseURL;void 0===f&&(n.options.projectId||ko("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),vi("Using default host for project ",n.options.projectId),f=`${n.options.projectId}-default-rtdb.firebaseio.com`);let E,M,y=um(f,p),C=y.repoInfo;"undefined"!=typeof process&&process.env&&(M=process.env.FIREBASE_DATABASE_EMULATOR_HOST),M?(E=!0,f=`http://${M}?ns=${C.namespace}`,y=um(f,p),C=y.repoInfo):E=!y.repoInfo.secure;const A=p&&E?new il(il.OWNER):new If(n.name,n.options,i);(function(n,i){const t=i.path.toString();if("string"!=typeof i.repoInfo.host||0===i.repoInfo.host.length||!Xd(i.repoInfo.namespace)&&"localhost"!==i.repoInfo.host.split(":")[0]||0!==t.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Cm(n)}(t))throw new Error(jr(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",y),Xt(y.path)||ko("Database URL must point to the root of a Firebase Database (not including a child path).");const I=function(n,i,t,o){let p=cm[i.name];p||(p={},cm[i.name]=p);let f=p[n.toURLString()];return f&&ko("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),f=new Tg(n,false,t,o),p[n.toURLString()]=f,f}(C,n,A,new iu(n.name,t));return new o_(I,n)}class o_{constructor(i,t){this._repoInternal=i,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function(n,i,t){if(n.stats_=xh(n.repoInfo_),n.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)n.server_=new O(n.repoInfo_,(o,p,f,y)=>{Am(n,o,p,f,y)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Pm(n,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ri(t)}catch(o){throw new Error("Invalid authOverride provided: "+o)}}n.persistentConnection_=new ys(n.repoInfo_,i,(o,p,f,y)=>{Am(n,o,p,f,y)},o=>{Pm(n,o)},o=>{!function(n,i){Ui(i,(t,o)=>{im(n,t,o)})}(n,o)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(o=>{n.server_.refreshAuthToken(o)}),n.appCheckProvider_.addTokenChangeListener(o=>{n.server_.refreshAppCheckToken(o.token)}),n.statsReporter_=function(n,i){const t=n.toString();return Ep[t]||(Ep[t]=i()),Ep[t]}(n.repoInfo_,()=>new Me(n.stats_,n.server_)),n.infoData_=new N,n.infoSyncTree_=new Ud({startListening:(o,p,f,y)=>{let C=[];const E=n.infoData_.getNode(o._path);return E.isEmpty()||(C=ha(n.infoSyncTree_,o._path,E),setTimeout(()=>{y("ok")},0)),C},stopListening:()=>{}}),im(n,"connected",!1),n.serverSyncTree_=new Ud({startListening:(o,p,f,y)=>(n.server_.listen(o,f,p,(C,E)=>{const M=y(C,E);pa(n.eventQueue_,o._path,M)}),[]),stopListening:(o,p)=>{n.server_.unlisten(o,p)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new qa(this._repo,cn())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(n,i){const t=cm[i];(!t||t[n.key]!==n)&&ko(`Database ${i}(${n.repoInfo_}) has already been deleted.`),function(n){n.persistentConnection_&&n.persistentConnection_.interrupt("repo_interrupt")}(n),delete t[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(i){null===this._rootInternal&&ko("Cannot call "+i+" on a deleted database.")}}ys.prototype.simpleListen=function(n,i){this.sendRequest("q",{p:n},i)},ys.prototype.echo=function(n,i){this.sendRequest("echo",{d:n},i)},vp="9.8.3",ea(new cr("database",(i,{instanceIdentifier:t})=>t_(i.getProvider("app").getImmediate(),i.getProvider("auth-internal"),i.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),fs(Jl,"0.13.1",void 0),fs(Jl,"0.13.1","esm2017"),fs("firebase","9.8.3","app");var F=Vt(865),p_=Vt(5762),d_=Vt(5415);let f_=(()=>{class n{constructor(){}getLatLngBounds(t=[]){let o,p,f,y;return t.map(M=>{null==o?(o=p=M[0],f=y=M[1]):(M[0]>p&&(p=M[0]),M[0]<o&&(o=M[0]),M[1]>y&&(y=M[1]),M[1]<f&&(f=M[1]))}),[[p,y],[o,f]]}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=F.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var hm=Vt(3405),of=Vt(1346);class Hm extends hm.xQ{constructor(){super(...arguments),this.value=null,this.hasNext=!1,this.hasCompleted=!1}_subscribe(i){return this.hasError?(i.error(this.thrownError),of.w.EMPTY):this.hasCompleted&&this.hasNext?(i.next(this.value),i.complete(),of.w.EMPTY):super._subscribe(i)}next(i){this.hasCompleted||(this.value=i,this.hasNext=!0)}error(i){this.hasCompleted||super.error(i)}complete(){this.hasCompleted=!0,this.hasNext&&super.next(this.value),super.complete()}}var Wm=Vt(6087),m_=Vt(739),Zm=Vt(8735),Xm=Vt(4168),pm=Vt(6339),dm=Vt(5192);const g_=new dm.v(pm.o);class v_{constructor(i,t){this.dueTime=i,this.scheduler=t}call(i,t){return t.subscribe(new y_(i,this.dueTime,this.scheduler))}}class y_ extends Xm.L{constructor(i,t,o){super(i),this.dueTime=t,this.scheduler=o,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(i){this.clearDebounce(),this.lastValue=i,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(x_,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:i}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(i)}}clearDebounce(){const i=this.debouncedSubscription;null!==i&&(this.remove(i),i.unsubscribe(),this.debouncedSubscription=null)}}function x_(n){n.debouncedNext()}var b_=Vt(9204);class C_{constructor(i){this.value=i}call(i,t){return t.subscribe(new E_(i,this.value))}}class E_ extends Xm.L{constructor(i,t){super(i),this.value=t}_next(i){this.destination.next(this.value)}}var S_=Vt(1125);const T_=["container"];let af=(()=>{class n{constructor(t){this.zone=t,this.mapCreated=new Hm,this.mapLoaded=new Hm,this.markersToRemove=[],this.popupsToRemove=[],this.imageIdsToRemove=[],this.subscription=new of.w,this.mapCreated$=this.mapCreated.asObservable(),this.mapLoaded$=this.mapLoaded.asObservable()}setup(t){this.zone.onStable.pipe((0,m_.P)()).subscribe(()=>{t.customMapboxApiUrl&&this.assign(jn,"config.API_URL",t.customMapboxApiUrl),this.createMap(t.mapOptions),this.hookEvents(t.mapEvents),this.mapEvents=t.mapEvents,this.mapCreated.next(void 0),this.mapCreated.complete()})}destroyMap(){this.mapInstance&&(this.subscription.unsubscribe(),this.mapInstance.remove())}updateMinZoom(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinZoom(t)})}updateMaxZoom(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxZoom(t)})}updateMinPitch(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinPitch(t)})}updateMaxPitch(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxPitch(t)})}updateRenderWorldCopies(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setRenderWorldCopies(t)})}updateScrollZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.scrollZoom.enable():this.mapInstance.scrollZoom.disable()})}updateDragRotate(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.dragRotate.enable():this.mapInstance.dragRotate.disable()})}updateTouchPitch(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.touchPitch.enable():this.mapInstance.touchPitch.disable()})}updateTouchZoomRotate(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.touchZoomRotate.enable():this.mapInstance.touchZoomRotate.disable()})}updateDoubleClickZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.doubleClickZoom.enable():this.mapInstance.doubleClickZoom.disable()})}updateKeyboard(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.keyboard.enable():this.mapInstance.keyboard.disable()})}updateDragPan(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.dragPan.enable():this.mapInstance.dragPan.disable()})}updateBoxZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.boxZoom.enable():this.mapInstance.boxZoom.disable()})}updateStyle(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setStyle(t)})}updateMaxBounds(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxBounds(t)})}changeCanvasCursor(t){this.mapInstance.getCanvasContainer().style.cursor=t}queryRenderedFeatures(t,o){return this.mapInstance.queryRenderedFeatures(t,o)}panTo(t,o){return this.zone.runOutsideAngular(()=>{this.mapInstance.panTo(t,o)})}move(t,o,p,f,y,C){return this.zone.runOutsideAngular(()=>{this.mapInstance[t](Object.assign(Object.assign({},o),{zoom:p||this.mapInstance.getZoom(),center:f||this.mapInstance.getCenter(),bearing:y||this.mapInstance.getBearing(),pitch:C||this.mapInstance.getPitch()}))})}addLayer(t,o,p){this.zone.runOutsideAngular(()=>{Object.keys(t.layerOptions).forEach(f=>{void 0===t.layerOptions[f]&&delete t.layerOptions[f]}),this.mapInstance.addLayer(t.layerOptions,p),o&&((t.layerEvents.layerClick.observers.length||t.layerEvents.click.observers.length)&&this.mapInstance.on("click",t.layerOptions.id,f=>{this.zone.run(()=>{t.layerEvents.layerClick.emit(f),t.layerEvents.click.emit(f)})}),(t.layerEvents.layerDblClick.observers.length||t.layerEvents.dblClick.observers.length)&&this.mapInstance.on("dblclick",t.layerOptions.id,f=>{this.zone.run(()=>{t.layerEvents.layerDblClick.emit(f),t.layerEvents.dblClick.emit(f)})}),(t.layerEvents.layerMouseDown.observers.length||t.layerEvents.mouseDown.observers.length)&&this.mapInstance.on("mousedown",t.layerOptions.id,f=>{this.zone.run(()=>{t.layerEvents.layerMouseDown.emit(f),t.layerEvents.mouseDown.emit(f)})}),(t.layerEvents.layerMouseUp.observers.length||t.layerEvents.mouseUp.observers.length)&&this.mapInstance.on("mouseup",t.layerOptions.id,f=>{this.zone.run(()=>{t.layerEvents.layerMouseUp.emit(f),t.layerEvents.mouseUp.emit(f)})}),(t.layerEvents.layerMouseEnter.observers.length||t.layerEvents.mouseEnter.observers.length)&&this.mapInstance.on("mouseenter",t.layerOptions.id,f=>{this.zone.run(()=>{t.layerEvents.layerMouseEnter.emit(f),t.layerEvents.mouseEnter.emit(f)})}),(t.layerEvents.layerMouseLeave.observers.length||t.layerEvents.mouseLeave.observers.length)&&this.mapInstance.on("mouseleave",t.layerOptions.id,f=>{this.zone.run(()=>{t.layerEvents.layerMouseLeave.emit(f),t.layerEvents.mouseLeave.emit(f)})}),(t.layerEvents.layerMouseMove.observers.length||t.layerEvents.mouseMove.observers.length)&&this.mapInstance.on("mousemove",t.layerOptions.id,f=>{this.zone.run(()=>{t.layerEvents.layerMouseMove.emit(f),t.layerEvents.mouseMove.emit(f)})}),(t.layerEvents.layerMouseOver.observers.length||t.layerEvents.mouseOver.observers.length)&&this.mapInstance.on("mouseover",t.layerOptions.id,f=>{this.zone.run(()=>{t.layerEvents.layerMouseOver.emit(f),t.layerEvents.mouseOver.emit(f)})}),(t.layerEvents.layerMouseOut.observers.length||t.layerEvents.mouseOut.observers.length)&&this.mapInstance.on("mouseout",t.layerOptions.id,f=>{this.zone.run(()=>{t.layerEvents.layerMouseOut.emit(f),t.layerEvents.mouseOut.emit(f)})}),(t.layerEvents.layerContextMenu.observers.length||t.layerEvents.contextMenu.observers.length)&&this.mapInstance.on("contextmenu",t.layerOptions.id,f=>{this.zone.run(()=>{t.layerEvents.layerContextMenu.emit(f),t.layerEvents.contextMenu.emit(f)})}),(t.layerEvents.layerTouchStart.observers.length||t.layerEvents.touchStart.observers.length)&&this.mapInstance.on("touchstart",t.layerOptions.id,f=>{this.zone.run(()=>{t.layerEvents.layerTouchStart.emit(f),t.layerEvents.touchStart.emit(f)})}),(t.layerEvents.layerTouchEnd.observers.length||t.layerEvents.touchEnd.observers.length)&&this.mapInstance.on("touchend",t.layerOptions.id,f=>{this.zone.run(()=>{t.layerEvents.layerTouchEnd.emit(f),t.layerEvents.touchEnd.emit(f)})}),(t.layerEvents.layerTouchCancel.observers.length||t.layerEvents.touchCancel.observers.length)&&this.mapInstance.on("touchcancel",t.layerOptions.id,f=>{this.zone.run(()=>{t.layerEvents.layerTouchCancel.emit(f),t.layerEvents.touchCancel.emit(f)})}))})}removeLayer(t){this.zone.runOutsideAngular(()=>{null!=this.mapInstance.getLayer(t)&&this.mapInstance.removeLayer(t)})}addMarker(t){const o={offset:t.markersOptions.offset,anchor:t.markersOptions.anchor,draggable:!!t.markersOptions.draggable,rotationAlignment:t.markersOptions.rotationAlignment,pitchAlignment:t.markersOptions.pitchAlignment,clickTolerance:t.markersOptions.clickTolerance};t.markersOptions.element.childNodes.length>0&&(o.element=t.markersOptions.element);const p=new jn.Marker(o);return(t.markersEvents.markerDragStart.observers.length||t.markersEvents.dragStart.observers.length)&&p.on("dragstart",y=>{if(y){const{target:C}=y;this.zone.run(()=>{t.markersEvents.markerDragStart.emit(C),t.markersEvents.dragStart.emit(C)})}}),(t.markersEvents.markerDrag.observers.length||t.markersEvents.drag.observers.length)&&p.on("drag",y=>{if(y){const{target:C}=y;this.zone.run(()=>{t.markersEvents.markerDrag.emit(C),t.markersEvents.drag.emit(C)})}}),(t.markersEvents.markerDragEnd.observers.length||t.markersEvents.dragEnd.observers.length)&&p.on("dragend",y=>{if(y){const{target:C}=y;this.zone.run(()=>{t.markersEvents.markerDragEnd.emit(C),t.markersEvents.dragEnd.emit(C)})}}),p.setLngLat(t.markersOptions.feature?t.markersOptions.feature.geometry.coordinates:t.markersOptions.lngLat),this.zone.runOutsideAngular(()=>(p.addTo(this.mapInstance),p))}removeMarker(t){this.markersToRemove.push(t)}createPopup(t,o){return this.zone.runOutsideAngular(()=>{Object.keys(t.popupOptions).forEach(f=>void 0===t.popupOptions[f]&&delete t.popupOptions[f]);const p=new jn.Popup(t.popupOptions);return p.setDOMContent(o),(t.popupEvents.popupClose.observers.length||t.popupEvents.close.observers.length)&&p.on("close",()=>{this.zone.run(()=>{t.popupEvents.popupClose.emit(),t.popupEvents.close.emit()})}),(t.popupEvents.popupOpen.observers.length||t.popupEvents.open.observers.length)&&p.on("open",()=>{this.zone.run(()=>{t.popupEvents.popupOpen.emit(),t.popupEvents.open.emit()})}),p})}addPopupToMap(t,o,p=!1){return this.zone.runOutsideAngular(()=>{p&&t._listeners&&delete t._listeners.open,t.setLngLat(o),t.addTo(this.mapInstance)})}addPopupToMarker(t,o){return this.zone.runOutsideAngular(()=>{t.setPopup(o)})}removePopupFromMap(t,o=!1){o&&t._listeners&&delete t._listeners.close,this.popupsToRemove.push(t)}removePopupFromMarker(t){return this.zone.runOutsideAngular(()=>{t.setPopup(void 0)})}addControl(t,o){return this.zone.runOutsideAngular(()=>{this.mapInstance.addControl(t,o)})}removeControl(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.removeControl(t)})}loadAndAddImage(t,o,p){return(0,Re.mG)(this,void 0,void 0,function*(){return this.zone.runOutsideAngular(()=>new Promise((f,y)=>{this.mapInstance.loadImage(o,(C,E)=>{C?y(C):(this.addImage(t,E,p),f())})}))})}addImage(t,o,p){return this.zone.runOutsideAngular(()=>{this.mapInstance.addImage(t,o,p)})}removeImage(t){this.imageIdsToRemove.push(t)}addSource(t,o){return this.zone.runOutsideAngular(()=>{Object.keys(o).forEach(p=>void 0===o[p]&&delete o[p]),this.mapInstance.addSource(t,o)})}getSource(t){return this.mapInstance.getSource(t)}removeSource(t){this.zone.runOutsideAngular(()=>{this.findLayersBySourceId(t).forEach(o=>this.mapInstance.removeLayer(o.id)),this.mapInstance.removeSource(t)})}setAllLayerPaintProperty(t,o){return this.zone.runOutsideAngular(()=>{Object.keys(o).forEach(p=>{this.mapInstance.setPaintProperty(t,p,o[p])})})}setAllLayerLayoutProperty(t,o){return this.zone.runOutsideAngular(()=>{Object.keys(o).forEach(p=>{this.mapInstance.setLayoutProperty(t,p,o[p])})})}setLayerFilter(t,o){return this.zone.runOutsideAngular(()=>{this.mapInstance.setFilter(t,o)})}setLayerBefore(t,o){return this.zone.runOutsideAngular(()=>{this.mapInstance.moveLayer(t,o)})}setLayerZoomRange(t,o,p){return this.zone.runOutsideAngular(()=>{this.mapInstance.setLayerZoomRange(t,o||0,p||20)})}fitBounds(t,o){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitBounds(t,o)})}fitScreenCoordinates(t,o,p){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitScreenCoordinates(t[0],t[1],o,p)})}applyChanges(){this.zone.runOutsideAngular(()=>{this.removeMarkers(),this.removePopups(),this.removeImages()})}createMap(t){F.R0b.assertNotInAngularZone(),Object.keys(t).forEach(p=>{void 0===t[p]&&delete t[p]}),this.mapInstance=new jn.Map(t),window&&/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)&&this.mapInstance.setStyle(t.style),this.subscription.add(this.zone.onMicrotaskEmpty.subscribe(()=>this.applyChanges()))}removeMarkers(){for(const t of this.markersToRemove)t.remove();this.markersToRemove=[]}removePopups(){for(const t of this.popupsToRemove)t.remove();this.popupsToRemove=[]}removeImages(){for(const t of this.imageIdsToRemove)this.mapInstance.removeImage(t);this.imageIdsToRemove=[]}findLayersBySourceId(t){const o=this.mapInstance.getStyle().layers;return null==o?[]:o.filter(p=>"source"in p&&p.source===t)}hookEvents(t){this.mapInstance.on("load",o=>{this.mapLoaded.next(void 0),this.mapLoaded.complete(),this.zone.run(()=>{t.mapLoad.emit(o.target),t.load.emit(o.target)})}),(t.mapResize.observers.length||t.resize.observers.length)&&this.mapInstance.on("resize",o=>this.zone.run(()=>{t.mapResize.emit(o),t.resize.emit(o)})),(t.mapRemove.observers.length||t.remove.observers.length)&&this.mapInstance.on("remove",o=>this.zone.run(()=>{t.mapRemove.emit(o),t.remove.emit(o)})),(t.mapMouseDown.observers.length||t.mouseDown.observers.length)&&this.mapInstance.on("mousedown",o=>this.zone.run(()=>{t.mapMouseDown.emit(o),t.mouseDown.emit(o)})),(t.mapMouseUp.observers.length||t.mouseUp.observers.length)&&this.mapInstance.on("mouseup",o=>this.zone.run(()=>{t.mapMouseUp.emit(o),t.mouseUp.emit(o)})),(t.mapMouseMove.observers.length||t.mouseMove.observers.length)&&this.mapInstance.on("mousemove",o=>this.zone.run(()=>{t.mapMouseMove.emit(o),t.mouseMove.emit(o)})),(t.mapClick.observers.length||t.click.observers.length)&&this.mapInstance.on("click",o=>this.zone.run(()=>{t.mapClick.emit(o),t.click.emit(o)})),(t.mapDblClick.observers.length||t.dblClick.observers.length)&&this.mapInstance.on("dblclick",o=>this.zone.run(()=>{t.mapDblClick.emit(o),t.dblClick.emit(o)})),(t.mapMouseOver.observers.length||t.mouseOver.observers.length)&&this.mapInstance.on("mouseover",o=>this.zone.run(()=>{t.mapMouseOver.emit(o),t.mouseOver.emit(o)})),(t.mapMouseOut.observers.length||t.mouseOut.observers.length)&&this.mapInstance.on("mouseout",o=>this.zone.run(()=>{t.mapMouseOut.emit(o),t.mouseOut.emit(o)})),(t.mapContextMenu.observers.length||t.contextMenu.observers.length)&&this.mapInstance.on("contextmenu",o=>this.zone.run(()=>{t.mapContextMenu.emit(o),t.contextMenu.emit(o)})),(t.mapTouchStart.observers.length||t.touchStart.observers.length)&&this.mapInstance.on("touchstart",o=>this.zone.run(()=>{t.mapTouchStart.emit(o),t.touchStart.emit(o)})),(t.mapTouchEnd.observers.length||t.touchEnd.observers.length)&&this.mapInstance.on("touchend",o=>this.zone.run(()=>{t.mapTouchEnd.emit(o),t.touchEnd.emit(o)})),(t.mapTouchMove.observers.length||t.touchMove.observers.length)&&this.mapInstance.on("touchmove",o=>this.zone.run(()=>{t.mapTouchMove.emit(o),t.touchMove.emit(o)})),(t.mapTouchCancel.observers.length||t.touchCancel.observers.length)&&this.mapInstance.on("touchcancel",o=>this.zone.run(()=>{t.mapTouchCancel.emit(o),t.touchCancel.emit(o)})),(t.mapWheel.observers.length||t.wheel.observers.length)&&this.mapInstance.on("wheel",o=>this.zone.run(()=>{t.mapWheel.emit(o),t.wheel.emit(o)})),t.moveStart.observers.length&&this.mapInstance.on("movestart",o=>this.zone.run(()=>t.moveStart.emit(o))),t.move.observers.length&&this.mapInstance.on("move",o=>this.zone.run(()=>t.move.emit(o))),t.moveEnd.observers.length&&this.mapInstance.on("moveend",o=>this.zone.run(()=>t.moveEnd.emit(o))),(t.mapDragStart.observers.length||t.dragStart.observers.length)&&this.mapInstance.on("dragstart",o=>this.zone.run(()=>{t.mapDragStart.emit(o),t.dragStart.emit(o)})),(t.mapDrag.observers.length||t.drag.observers.length)&&this.mapInstance.on("drag",o=>this.zone.run(()=>{t.mapDrag.emit(o),t.drag.emit(o)})),(t.mapDragEnd.observers.length||t.dragEnd.observers.length)&&this.mapInstance.on("dragend",o=>this.zone.run(()=>{t.mapDragEnd.emit(o),t.dragEnd.emit(o)})),t.zoomStart.observers.length&&this.mapInstance.on("zoomstart",o=>this.zone.run(()=>t.zoomStart.emit(o))),t.zoomEvt.observers.length&&this.mapInstance.on("zoom",o=>this.zone.run(()=>t.zoomEvt.emit(o))),t.zoomEnd.observers.length&&this.mapInstance.on("zoomend",o=>this.zone.run(()=>t.zoomEnd.emit(o))),t.rotateStart.observers.length&&this.mapInstance.on("rotatestart",o=>this.zone.run(()=>t.rotateStart.emit(o))),t.rotate.observers.length&&this.mapInstance.on("rotate",o=>this.zone.run(()=>t.rotate.emit(o))),t.rotateEnd.observers.length&&this.mapInstance.on("rotateend",o=>this.zone.run(()=>t.rotateEnd.emit(o))),t.pitchStart.observers.length&&this.mapInstance.on("pitchstart",o=>this.zone.run(()=>t.pitchStart.emit(o))),t.pitchEvt.observers.length&&this.mapInstance.on("pitch",o=>this.zone.run(()=>t.pitchEvt.emit(o))),t.pitchEnd.observers.length&&this.mapInstance.on("pitchend",o=>this.zone.run(()=>t.pitchEnd.emit(o))),t.boxZoomStart.observers.length&&this.mapInstance.on("boxzoomstart",o=>this.zone.run(()=>t.boxZoomStart.emit(o))),t.boxZoomEnd.observers.length&&this.mapInstance.on("boxzoomend",o=>this.zone.run(()=>t.boxZoomEnd.emit(o))),t.boxZoomCancel.observers.length&&this.mapInstance.on("boxzoomcancel",o=>this.zone.run(()=>t.boxZoomCancel.emit(o))),t.webGlContextLost.observers.length&&this.mapInstance.on("webglcontextlost",o=>this.zone.run(()=>t.webGlContextLost.emit(o))),t.webGlContextRestored.observers.length&&this.mapInstance.on("webglcontextrestored",o=>this.zone.run(()=>t.webGlContextRestored.emit(o))),t.render.observers.length&&this.mapInstance.on("render",o=>this.zone.run(()=>t.render.emit(o))),(t.mapError.observers.length||t.error.observers.length)&&this.mapInstance.on("error",o=>this.zone.run(()=>{t.mapError.emit(o),t.error.emit(o)})),t.data.observers.length&&this.mapInstance.on("data",o=>this.zone.run(()=>t.data.emit(o))),t.styleData.observers.length&&this.mapInstance.on("styledata",o=>this.zone.run(()=>t.styleData.emit(o))),t.sourceData.observers.length&&this.mapInstance.on("sourcedata",o=>this.zone.run(()=>t.sourceData.emit(o))),t.dataLoading.observers.length&&this.mapInstance.on("dataloading",o=>this.zone.run(()=>t.dataLoading.emit(o))),t.styleDataLoading.observers.length&&this.mapInstance.on("styledataloading",o=>this.zone.run(()=>t.styleDataLoading.emit(o))),t.sourceDataLoading.observers.length&&this.mapInstance.on("sourcedataloading",o=>this.zone.run(()=>t.sourceDataLoading.emit(o))),t.styleImageMissing.observers.length&&this.mapInstance.on("styleimagemissing",o=>this.zone.run(()=>t.styleImageMissing.emit(o))),t.idle.observers.length&&this.mapInstance.on("idle",o=>this.zone.run(()=>t.idle.emit(o)))}assign(t,o,p){if("string"==typeof o&&(o=o.split(".")),o.length>1){const f=o.shift();this.assign(t[f]="[object Object]"===Object.prototype.toString.call(t[f])?t[f]:{},o,p)}else t[o[0]]=p}}return n.\u0275fac=function(t){return new(t||n)(F.LFG(F.R0b))},n.\u0275prov=F.Yz7({token:n,factory:n.\u0275fac}),n})();function Km(n,i,t){console.warn(`[ngx-maplibre-gl]: ${n}: ${i} is deprecated, please use ${t} instead.`)}let k_=(()=>{class n{constructor(t,o){this.MapService=t,this.zone=o,this.updateFeatureData=new hm.xQ,this.sub=new of.w,this.sourceAdded=!1,this.featureIdCounter=0}ngOnInit(){this.data||(this.data={type:"FeatureCollection",features:[]});const t=this.MapService.mapLoaded$.subscribe(()=>{this.init();const o=(0,Wm.R)(this.MapService.mapInstance,"styledata").pipe((0,Zm.h)(()=>!this.MapService.mapInstance.getSource(this.id))).subscribe(()=>{this.init()});this.sub.add(o)});this.sub.add(t)}ngOnChanges(t){!this.sourceAdded||((t.maxzoom&&!t.maxzoom.isFirstChange()||t.attribution&&!t.attribution.isFirstChange()||t.buffer&&!t.buffer.isFirstChange()||t.tolerance&&!t.tolerance.isFirstChange()||t.cluster&&!t.cluster.isFirstChange()||t.clusterRadius&&!t.clusterRadius.isFirstChange()||t.clusterMaxZoom&&!t.clusterMaxZoom.isFirstChange()||t.clusterMinPoints&&!t.clusterMinPoints.isFirstChange()||t.clusterProperties&&!t.clusterProperties.isFirstChange()||t.lineMetrics&&!t.lineMetrics.isFirstChange()||t.generateId&&!t.generateId.isFirstChange()||t.promoteId&&!t.promoteId.isFirstChange()||t.filter&&!t.filter.isFirstChange())&&(this.ngOnDestroy(),this.ngOnInit()),t.data&&!t.data.isFirstChange()&&setTimeout(()=>{this.MapService.getSource(this.id).setData(this.data)},0))}ngOnDestroy(){this.sub.unsubscribe(),this.sourceAdded&&(this.MapService.removeSource(this.id),this.sourceAdded=!1)}getClusterExpansionZoom(t){return(0,Re.mG)(this,void 0,void 0,function*(){const o=this.MapService.getSource(this.id);return this.zone.run(()=>(0,Re.mG)(this,void 0,void 0,function*(){return new Promise((p,f)=>{o.getClusterExpansionZoom(t,(y,C)=>{y?f(y):p(C)})})}))})}getClusterChildren(t){return(0,Re.mG)(this,void 0,void 0,function*(){const o=this.MapService.getSource(this.id);return this.zone.run(()=>(0,Re.mG)(this,void 0,void 0,function*(){return new Promise((p,f)=>{o.getClusterChildren(t,(y,C)=>{y?f(y):p(C)})})}))})}getClusterLeaves(t,o,p){return(0,Re.mG)(this,void 0,void 0,function*(){const f=this.MapService.getSource(this.id);return this.zone.run(()=>(0,Re.mG)(this,void 0,void 0,function*(){return new Promise((y,C)=>{f.getClusterLeaves(t,o,p,(E,M)=>{E?C(E):y(M)})})}))})}_addFeature(t){this.data.features.push(t),this.updateFeatureData.next()}_removeFeature(t){const o=this.data,p=o.features.indexOf(t);p>-1&&o.features.splice(p,1),this.updateFeatureData.next()}_getNewFeatureId(){return++this.featureIdCounter}init(){this.MapService.addSource(this.id,{type:"geojson",data:this.data,maxzoom:this.maxzoom,attribution:this.attribution,buffer:this.buffer,tolerance:this.tolerance,cluster:this.cluster,clusterRadius:this.clusterRadius,clusterMaxZoom:this.clusterMaxZoom,clusterMinPoints:this.clusterMinPoints,clusterProperties:this.clusterProperties,lineMetrics:this.lineMetrics,generateId:this.generateId,promoteId:this.promoteId,filter:this.filter});const o=this.updateFeatureData.pipe(function(n,i=g_){return t=>t.lift(new v_(n,i))}(0)).subscribe(()=>{this.MapService.getSource(this.id).setData(this.data)});this.sub.add(o),this.sourceAdded=!0}}return n.\u0275fac=function(t){return new(t||n)(F.Y36(af),F.Y36(F.R0b))},n.\u0275cmp=F.Xpm({type:n,selectors:[["mgl-geojson-source"]],inputs:{id:"id",data:"data",maxzoom:"maxzoom",attribution:"attribution",buffer:"buffer",tolerance:"tolerance",cluster:"cluster",clusterRadius:"clusterRadius",clusterMaxZoom:"clusterMaxZoom",clusterMinPoints:"clusterMinPoints",clusterProperties:"clusterProperties",lineMetrics:"lineMetrics",generateId:"generateId",promoteId:"promoteId",filter:"filter"},features:[F.TTD],decls:0,vars:0,template:function(t,o){},encapsulation:2,changeDetection:0}),n})(),D_=(()=>{class n{constructor(t){this.MapService=t,this.layerClick=new F.vpe,this.layerDblClick=new F.vpe,this.layerMouseDown=new F.vpe,this.layerMouseUp=new F.vpe,this.layerMouseEnter=new F.vpe,this.layerMouseLeave=new F.vpe,this.layerMouseMove=new F.vpe,this.layerMouseOver=new F.vpe,this.layerMouseOut=new F.vpe,this.layerContextMenu=new F.vpe,this.layerTouchStart=new F.vpe,this.layerTouchEnd=new F.vpe,this.layerTouchCancel=new F.vpe,this.click=new F.vpe,this.dblClick=new F.vpe,this.mouseDown=new F.vpe,this.mouseUp=new F.vpe,this.mouseEnter=new F.vpe,this.mouseLeave=new F.vpe,this.mouseMove=new F.vpe,this.mouseOver=new F.vpe,this.mouseOut=new F.vpe,this.contextMenu=new F.vpe,this.touchStart=new F.vpe,this.touchEnd=new F.vpe,this.touchCancel=new F.vpe,this.layerAdded=!1}ngOnInit(){this.warnDeprecatedOutputs(),this.sub=this.MapService.mapLoaded$.pipe((0,b_.w)(()=>(0,Wm.R)(this.MapService.mapInstance,"styledata").pipe(i=>i.lift(new C_(!1)),(0,Zm.h)(()=>!this.MapService.mapInstance.getLayer(this.id)),(0,S_.O)(!0)))).subscribe(t=>this.init(t))}ngOnChanges(t){!this.layerAdded||(t.paint&&!t.paint.isFirstChange()&&this.MapService.setAllLayerPaintProperty(this.id,t.paint.currentValue),t.layout&&!t.layout.isFirstChange()&&this.MapService.setAllLayerLayoutProperty(this.id,t.layout.currentValue),t.filter&&!t.filter.isFirstChange()&&this.MapService.setLayerFilter(this.id,t.filter.currentValue),t.before&&!t.before.isFirstChange()&&this.MapService.setLayerBefore(this.id,t.before.currentValue),(t.minzoom&&!t.minzoom.isFirstChange()||t.maxzoom&&!t.maxzoom.isFirstChange())&&this.MapService.setLayerZoomRange(this.id,this.minzoom,this.maxzoom))}ngOnDestroy(){this.layerAdded&&this.MapService.removeLayer(this.id),this.sub&&this.sub.unsubscribe()}init(t){this.MapService.addLayer({layerOptions:{id:this.id,type:this.type,source:this.source,metadata:this.metadata,"source-layer":this.sourceLayer,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this.layout,paint:this.paint},layerEvents:{layerClick:this.layerClick,layerDblClick:this.layerDblClick,layerMouseDown:this.layerMouseDown,layerMouseUp:this.layerMouseUp,layerMouseEnter:this.layerMouseEnter,layerMouseLeave:this.layerMouseLeave,layerMouseMove:this.layerMouseMove,layerMouseOver:this.layerMouseOver,layerMouseOut:this.layerMouseOut,layerContextMenu:this.layerContextMenu,layerTouchStart:this.layerTouchStart,layerTouchEnd:this.layerTouchEnd,layerTouchCancel:this.layerTouchCancel,click:this.click,dblClick:this.dblClick,mouseDown:this.mouseDown,mouseUp:this.mouseUp,mouseEnter:this.mouseEnter,mouseLeave:this.mouseLeave,mouseMove:this.mouseMove,mouseOver:this.mouseOver,mouseOut:this.mouseOut,contextMenu:this.contextMenu,touchStart:this.touchStart,touchEnd:this.touchEnd,touchCancel:this.touchCancel}},t,this.before),this.layerAdded=!0}warnDeprecatedOutputs(){const t=Km.bind(void 0,n.name);this.click.observers.length&&t("click","layerClick"),this.dblClick.observers.length&&t("dblClick","layerDblClick"),this.mouseDown.observers.length&&t("mouseDown","layerMouseDown"),this.mouseUp.observers.length&&t("mouseUp","layerMouseUp"),this.mouseEnter.observers.length&&t("mouseEnter","layerMouseEnter"),this.mouseLeave.observers.length&&t("mouseLeave","layerMouseLeave"),this.mouseMove.observers.length&&t("mouseMove","layerMouseMove"),this.mouseOver.observers.length&&t("mouseOver","layerMouseOver"),this.mouseOut.observers.length&&t("mouseOut","layerMouseOut"),this.contextMenu.observers.length&&t("contextMenu","layerContextMenu"),this.touchStart.observers.length&&t("touchStart","layerTouchStart"),this.touchEnd.observers.length&&t("touchEnd","layerTouchEnd"),this.touchCancel.observers.length&&t("touchCancel","layerTouchCancel")}}return n.\u0275fac=function(t){return new(t||n)(F.Y36(af))},n.\u0275cmp=F.Xpm({type:n,selectors:[["mgl-layer"]],inputs:{id:"id",source:"source",type:"type",metadata:"metadata",sourceLayer:"sourceLayer",filter:"filter",layout:"layout",paint:"paint",before:"before",minzoom:"minzoom",maxzoom:"maxzoom"},outputs:{layerClick:"layerClick",layerDblClick:"layerDblClick",layerMouseDown:"layerMouseDown",layerMouseUp:"layerMouseUp",layerMouseEnter:"layerMouseEnter",layerMouseLeave:"layerMouseLeave",layerMouseMove:"layerMouseMove",layerMouseOver:"layerMouseOver",layerMouseOut:"layerMouseOut",layerContextMenu:"layerContextMenu",layerTouchStart:"layerTouchStart",layerTouchEnd:"layerTouchEnd",layerTouchCancel:"layerTouchCancel",click:"click",dblClick:"dblClick",mouseDown:"mouseDown",mouseUp:"mouseUp",mouseEnter:"mouseEnter",mouseLeave:"mouseLeave",mouseMove:"mouseMove",mouseOver:"mouseOver",mouseOut:"mouseOut",contextMenu:"contextMenu",touchStart:"touchStart",touchEnd:"touchEnd",touchCancel:"touchCancel"},features:[F.TTD],decls:0,vars:0,template:function(t,o){},encapsulation:2}),n})(),O_=(()=>{class n{constructor(t){this.MapService=t,this.movingMethod="flyTo",this.mapResize=new F.vpe,this.mapRemove=new F.vpe,this.mapMouseDown=new F.vpe,this.mapMouseUp=new F.vpe,this.mapMouseMove=new F.vpe,this.mapClick=new F.vpe,this.mapDblClick=new F.vpe,this.mapMouseOver=new F.vpe,this.mapMouseOut=new F.vpe,this.mapContextMenu=new F.vpe,this.mapTouchStart=new F.vpe,this.mapTouchEnd=new F.vpe,this.mapTouchMove=new F.vpe,this.mapTouchCancel=new F.vpe,this.mapWheel=new F.vpe,this.moveStart=new F.vpe,this.move=new F.vpe,this.moveEnd=new F.vpe,this.mapDragStart=new F.vpe,this.mapDrag=new F.vpe,this.mapDragEnd=new F.vpe,this.zoomStart=new F.vpe,this.zoomEvt=new F.vpe,this.zoomEnd=new F.vpe,this.rotateStart=new F.vpe,this.rotate=new F.vpe,this.rotateEnd=new F.vpe,this.pitchStart=new F.vpe,this.pitchEvt=new F.vpe,this.pitchEnd=new F.vpe,this.boxZoomStart=new F.vpe,this.boxZoomEnd=new F.vpe,this.boxZoomCancel=new F.vpe,this.webGlContextLost=new F.vpe,this.webGlContextRestored=new F.vpe,this.mapLoad=new F.vpe,this.idle=new F.vpe,this.render=new F.vpe,this.mapError=new F.vpe,this.data=new F.vpe,this.styleData=new F.vpe,this.sourceData=new F.vpe,this.dataLoading=new F.vpe,this.styleDataLoading=new F.vpe,this.sourceDataLoading=new F.vpe,this.styleImageMissing=new F.vpe,this.resize=new F.vpe,this.remove=new F.vpe,this.mouseDown=new F.vpe,this.mouseUp=new F.vpe,this.mouseMove=new F.vpe,this.click=new F.vpe,this.dblClick=new F.vpe,this.mouseOver=new F.vpe,this.mouseOut=new F.vpe,this.contextMenu=new F.vpe,this.touchStart=new F.vpe,this.touchEnd=new F.vpe,this.touchMove=new F.vpe,this.touchCancel=new F.vpe,this.wheel=new F.vpe,this.dragStart=new F.vpe,this.drag=new F.vpe,this.dragEnd=new F.vpe,this.load=new F.vpe,this.error=new F.vpe}get mapInstance(){return this.MapService.mapInstance}ngAfterViewInit(){this.warnDeprecatedOutputs(),this.MapService.setup({customMapboxApiUrl:this.customMapboxApiUrl,mapOptions:{collectResourceTiming:this.collectResourceTiming,container:this.mapContainer.nativeElement,crossSourceCollisions:this.crossSourceCollisions,fadeDuration:this.fadeDuration,minZoom:this.minZoom,maxZoom:this.maxZoom,minPitch:this.minPitch,maxPitch:this.maxPitch,style:this.style,hash:this.hash,interactive:this.interactive,bearingSnap:this.bearingSnap,pitchWithRotate:this.pitchWithRotate,clickTolerance:this.clickTolerance,attributionControl:this.attributionControl,logoPosition:this.logoPosition,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.preserveDrawingBuffer,refreshExpiredTiles:this.refreshExpiredTiles,maxBounds:this.maxBounds,scrollZoom:this.scrollZoom,boxZoom:this.boxZoom,dragRotate:this.dragRotate,dragPan:this.dragPan,keyboard:this.keyboard,doubleClickZoom:this.doubleClickZoom,touchPitch:this.touchPitch,touchZoomRotate:this.touchZoomRotate,trackResize:this.trackResize,center:this.center,zoom:this.zoom,bearing:this.bearing,pitch:this.pitch,renderWorldCopies:this.renderWorldCopies,maxTileCacheSize:this.maxTileCacheSize,localIdeographFontFamily:this.localIdeographFontFamily,transformRequest:this.transformRequest,bounds:this.bounds?this.bounds:this.fitBounds,fitBoundsOptions:this.fitBoundsOptions,antialias:this.antialias,locale:this.locale},mapEvents:this}),this.cursorStyle&&this.MapService.changeCanvasCursor(this.cursorStyle)}ngOnDestroy(){this.MapService.destroyMap()}ngOnChanges(t){return(0,Re.mG)(this,void 0,void 0,function*(){yield this.MapService.mapCreated$.toPromise(),t.cursorStyle&&!t.cursorStyle.isFirstChange()&&this.MapService.changeCanvasCursor(t.cursorStyle.currentValue),t.minZoom&&!t.minZoom.isFirstChange()&&this.MapService.updateMinZoom(t.minZoom.currentValue),t.maxZoom&&!t.maxZoom.isFirstChange()&&this.MapService.updateMaxZoom(t.maxZoom.currentValue),t.minPitch&&!t.minPitch.isFirstChange()&&this.MapService.updateMinPitch(t.minPitch.currentValue),t.maxPitch&&!t.maxPitch.isFirstChange()&&this.MapService.updateMaxPitch(t.maxPitch.currentValue),t.renderWorldCopies&&!t.renderWorldCopies.isFirstChange()&&this.MapService.updateRenderWorldCopies(t.renderWorldCopies.currentValue),t.scrollZoom&&!t.scrollZoom.isFirstChange()&&this.MapService.updateScrollZoom(t.scrollZoom.currentValue),t.dragRotate&&!t.dragRotate.isFirstChange()&&this.MapService.updateDragRotate(t.dragRotate.currentValue),t.touchPitch&&!t.touchPitch.isFirstChange()&&this.MapService.updateTouchPitch(t.touchPitch.currentValue),t.touchZoomRotate&&!t.touchZoomRotate.isFirstChange()&&this.MapService.updateTouchZoomRotate(t.touchZoomRotate.currentValue),t.doubleClickZoom&&!t.doubleClickZoom.isFirstChange()&&this.MapService.updateDoubleClickZoom(t.doubleClickZoom.currentValue),t.keyboard&&!t.keyboard.isFirstChange()&&this.MapService.updateKeyboard(t.keyboard.currentValue),t.dragPan&&!t.dragPan.isFirstChange()&&this.MapService.updateDragPan(t.dragPan.currentValue),t.boxZoom&&!t.boxZoom.isFirstChange()&&this.MapService.updateBoxZoom(t.boxZoom.currentValue),t.style&&!t.style.isFirstChange()&&this.MapService.updateStyle(t.style.currentValue),t.maxBounds&&!t.maxBounds.isFirstChange()&&this.MapService.updateMaxBounds(t.maxBounds.currentValue),t.fitBounds&&t.fitBounds.currentValue&&!t.fitBounds.isFirstChange()&&this.MapService.fitBounds(t.fitBounds.currentValue,this.fitBoundsOptions),t.fitScreenCoordinates&&t.fitScreenCoordinates.currentValue&&((this.center||this.zoom||this.pitch||this.fitBounds)&&t.fitScreenCoordinates.isFirstChange()&&console.warn("[ngx-mapbox-gl] center / zoom / pitch / fitBounds inputs are being overridden by fitScreenCoordinates input"),this.MapService.fitScreenCoordinates(t.fitScreenCoordinates.currentValue,this.bearing?this.bearing[0]:0,this.movingOptions)),!this.centerWithPanTo||!t.center||t.center.isFirstChange()||t.zoom||t.bearing||t.pitch?(t.center&&!t.center.isFirstChange()||t.zoom&&!t.zoom.isFirstChange()||t.bearing&&!t.bearing.isFirstChange()&&!t.fitScreenCoordinates||t.pitch&&!t.pitch.isFirstChange())&&this.MapService.move(this.movingMethod,this.movingOptions,t.zoom&&this.zoom?this.zoom[0]:void 0,t.center?this.center:void 0,t.bearing&&this.bearing?this.bearing[0]:void 0,t.pitch&&this.pitch?this.pitch[0]:void 0):this.MapService.panTo(this.center,this.panToOptions)})}warnDeprecatedOutputs(){const t=Km.bind(void 0,n.name);this.resize.observers.length&&t("resize","mapResize"),this.remove.observers.length&&t("remove","mapRemove"),this.mouseDown.observers.length&&t("mouseDown","mapMouseDown"),this.mouseUp.observers.length&&t("mouseUp","mapMouseUp"),this.mouseMove.observers.length&&t("mouseMove","mapMouseMove"),this.click.observers.length&&t("click","mapClick"),this.dblClick.observers.length&&t("dblClick","mapDblClick"),this.mouseOver.observers.length&&t("mouseOver","mapMouseOver"),this.mouseOut.observers.length&&t("mouseOut","mapMouseOut"),this.contextMenu.observers.length&&t("contextMenu","mapContextMenu"),this.touchStart.observers.length&&t("touchStart","mapTouchStart"),this.touchEnd.observers.length&&t("touchEnd","mapTouchEnd"),this.touchMove.observers.length&&t("touchMove","mapTouchMove"),this.touchCancel.observers.length&&t("touchCancel","mapTouchCancel"),this.wheel.observers.length&&t("wheel","mapWheel"),this.dragStart.observers.length&&t("dragStart","mapDragStart"),this.drag.observers.length&&t("drag","mapDrag"),this.dragEnd.observers.length&&t("dragEnd","mapDragEnd"),this.load.observers.length&&t("load","mapLoad"),this.error.observers.length&&t("error","mapError")}}return n.\u0275fac=function(t){return new(t||n)(F.Y36(af))},n.\u0275cmp=F.Xpm({type:n,selectors:[["mgl-map"]],viewQuery:function(t,o){if(1&t&&F.Gf(T_,7),2&t){let p;F.iGM(p=F.CRH())&&(o.mapContainer=p.first)}},inputs:{collectResourceTiming:"collectResourceTiming",crossSourceCollisions:"crossSourceCollisions",customMapboxApiUrl:"customMapboxApiUrl",fadeDuration:"fadeDuration",hash:"hash",refreshExpiredTiles:"refreshExpiredTiles",failIfMajorPerformanceCaveat:"failIfMajorPerformanceCaveat",bearingSnap:"bearingSnap",interactive:"interactive",pitchWithRotate:"pitchWithRotate",clickTolerance:"clickTolerance",attributionControl:"attributionControl",logoPosition:"logoPosition",maxTileCacheSize:"maxTileCacheSize",localIdeographFontFamily:"localIdeographFontFamily",preserveDrawingBuffer:"preserveDrawingBuffer",trackResize:"trackResize",transformRequest:"transformRequest",bounds:"bounds",antialias:"antialias",locale:"locale",minZoom:"minZoom",maxZoom:"maxZoom",minPitch:"minPitch",maxPitch:"maxPitch",scrollZoom:"scrollZoom",dragRotate:"dragRotate",touchPitch:"touchPitch",touchZoomRotate:"touchZoomRotate",doubleClickZoom:"doubleClickZoom",keyboard:"keyboard",dragPan:"dragPan",boxZoom:"boxZoom",style:"style",center:"center",maxBounds:"maxBounds",zoom:"zoom",bearing:"bearing",pitch:"pitch",fitBoundsOptions:"fitBoundsOptions",renderWorldCopies:"renderWorldCopies",movingMethod:"movingMethod",movingOptions:"movingOptions",fitBounds:"fitBounds",fitScreenCoordinates:"fitScreenCoordinates",centerWithPanTo:"centerWithPanTo",panToOptions:"panToOptions",cursorStyle:"cursorStyle"},outputs:{mapResize:"mapResize",mapRemove:"mapRemove",mapMouseDown:"mapMouseDown",mapMouseUp:"mapMouseUp",mapMouseMove:"mapMouseMove",mapClick:"mapClick",mapDblClick:"mapDblClick",mapMouseOver:"mapMouseOver",mapMouseOut:"mapMouseOut",mapContextMenu:"mapContextMenu",mapTouchStart:"mapTouchStart",mapTouchEnd:"mapTouchEnd",mapTouchMove:"mapTouchMove",mapTouchCancel:"mapTouchCancel",mapWheel:"mapWheel",moveStart:"moveStart",move:"move",moveEnd:"moveEnd",mapDragStart:"mapDragStart",mapDrag:"mapDrag",mapDragEnd:"mapDragEnd",zoomStart:"zoomStart",zoomEvt:"zoomEvt",zoomEnd:"zoomEnd",rotateStart:"rotateStart",rotate:"rotate",rotateEnd:"rotateEnd",pitchStart:"pitchStart",pitchEvt:"pitchEvt",pitchEnd:"pitchEnd",boxZoomStart:"boxZoomStart",boxZoomEnd:"boxZoomEnd",boxZoomCancel:"boxZoomCancel",webGlContextLost:"webGlContextLost",webGlContextRestored:"webGlContextRestored",mapLoad:"mapLoad",idle:"idle",render:"render",mapError:"mapError",data:"data",styleData:"styleData",sourceData:"sourceData",dataLoading:"dataLoading",styleDataLoading:"styleDataLoading",sourceDataLoading:"sourceDataLoading",styleImageMissing:"styleImageMissing",resize:"resize",remove:"remove",mouseDown:"mouseDown",mouseUp:"mouseUp",mouseMove:"mouseMove",click:"click",dblClick:"dblClick",mouseOver:"mouseOver",mouseOut:"mouseOut",contextMenu:"contextMenu",touchStart:"touchStart",touchEnd:"touchEnd",touchMove:"touchMove",touchCancel:"touchCancel",wheel:"wheel",dragStart:"dragStart",drag:"drag",dragEnd:"dragEnd",load:"load",error:"error"},features:[F._Bn([af]),F.TTD],decls:2,vars:0,consts:[["container",""]],template:function(t,o){1&t&&F._UZ(0,"div",null,0)},styles:["[_nghost-%COMP%] {\n        display: block;\n      }\n      div[_ngcontent-%COMP%] {\n        height: 100%;\n        width: 100%;\n      }"],changeDetection:0}),n})(),z_=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=F.oAB({type:n}),n.\u0275inj=F.cJS({imports:[[Ti.ez]]}),n})();var fm=Vt(2411);const L_=["prevElRef"],R_=["nextElRef"],F_=["scrollbarElRef"],N_=["paginationElRef"];function B_(n,i){1&n&&(F.ynx(0),F._UZ(1,"div",6,7),F._UZ(3,"div",8,9),F.BQk())}function V_(n,i){1&n&&F._UZ(0,"div",10,11)}function U_(n,i){1&n&&F._UZ(0,"div",12,13)}function $_(n,i){}function j_(n,i){1&n&&F.YNc(0,$_,0,0,"ng-template")}function q_(n,i){}function G_(n,i){1&n&&F.YNc(0,q_,0,0,"ng-template")}function H_(n,i){}function W_(n,i){1&n&&F.YNc(0,H_,0,0,"ng-template")}function Z_(n,i){}const Qm=function(n){return{$implicit:n}};function X_(n,i){if(1&n&&(F.TgZ(0,"div",3),F.YNc(1,Z_,0,0,"ng-template",18),F.qZA()),2&n){const t=F.oxw().$implicit,o=F.oxw(2);F.Q6J("ngClass",o.zoomContainerClass),F.xp6(1),F.Q6J("ngTemplateOutlet",t.template)("ngTemplateOutletContext",F.VKq(3,Qm,t.slideData))}}function Y_(n,i){}function K_(n,i){if(1&n&&(F.ynx(0),F.YNc(1,Y_,0,0,"ng-template",18),F.BQk()),2&n){const t=F.oxw().$implicit;F.xp6(1),F.Q6J("ngTemplateOutlet",t.template)("ngTemplateOutletContext",F.VKq(2,Qm,t.slideData))}}function Q_(n,i){if(1&n&&(F.TgZ(0,"div",15),F.YNc(1,X_,2,5,"div",16),F.YNc(2,K_,2,4,"ng-container",17),F.qZA()),2&n){const t=i.$implicit,o=F.oxw().key,p=F.oxw();F.Akn(p.style),F.Q6J("ngClass",(t.class?t.class+" ":"")+p.slideClass+(""!==o?" "+p.slideDuplicateClass:""))("ngSwitch",t.zoom),F.uIk("data-swiper-slide-index",t.virtualIndex?t.virtualIndex:t.slideIndex)("data-swiper-autoplay",t.autoplayDelay),F.xp6(1),F.Q6J("ngSwitchCase",!0)}}function J_(n,i){1&n&&(F.YNc(0,Q_,3,7,"div",14),F.ALo(1,"async")),2&n&&F.Q6J("ngForOf",F.lcZ(1,1,i.loopSlides))}const ev=[[["","slot","container-start"]],[["","slot","wrapper-start"]],[["","slot","wrapper-end"]],[["","slot","container-end"]]],tv=function(n){return{loopSlides:n,key:"prepend"}},nv=function(n){return{loopSlides:n,key:""}},iv=function(n){return{loopSlides:n,key:"append"}},rv=["[slot=container-start]","[slot=wrapper-start]","[slot=wrapper-end]","[slot=container-end]"];function tp(n){return"object"==typeof n&&null!==n&&n.constructor&&"Object"===Object.prototype.toString.call(n).slice(8,-1)}function Jm(n,i,t){return!0===sf(n)&&i&&!i.el||!("boolean"!=typeof i&&i.el!==(null==t?void 0:t.nativeElement)&&("string"==typeof i.el||"object"==typeof i.el))}function Ou(n,i){const t=["__proto__","constructor","prototype"];Object.keys(i).filter(o=>t.indexOf(o)<0).forEach(o=>{void 0!==n[o]?n[o]&&!i[o]||(tp(i[o])&&tp(n[o])&&Object.keys(i[o]).length>0?i[o].__swiper__?n[o]=i[o]:Ou(n[o],i[o]):n[o]=i[o]):n[o]=i[o]})}function sf(n){return null!=n&&"false"!=`${n}`}const ov=["pagination","navigation","scrollbar","virtual"];function lf(n,i={}){return tp(n)?n:!0===sf(n)&&i}const eg=["init","enabled","_direction","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","_spaceBetween","_slidesPerView","_grid","_slidesPerGroup","_slidesPerGroupSkip","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_preloadImages","updateOnImagesReady","_loop","_loopAdditionalSlides","_loopedSlides","_loopFillGroupWithBlank","loopPreventsSlide","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideBlankClass","slideActiveClass","slideDuplicateActiveClass","slideVisibleClass","slideDuplicateClass","slideNextClass","slideDuplicateNextClass","slidePrevClass","slideDuplicatePrevClass","wrapperClass","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","lazy","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","on"];function mm(n={}){const i={on:{}},o={};Ou(i,Wo.defaults),Ou(i,Wo.extendedDefaults),i._emitClasses=!0,i.init=!1;const p={},f=eg.map(y=>y.replace(/_/,""));return Object.keys(n).forEach(y=>{const C=y.replace(/^_/,"");f.indexOf(C)>=0?tp(n[y])?(i[C]={},o[C]={},Ou(i[C],n[y]),Ou(o[C],n[y])):(i[C]=n[y],o[C]=n[y]):p[C]=n[y]}),["navigation","pagination","scrollbar"].forEach(y=>{!0===i[y]&&(i[y]={}),!1===i[y]&&delete i[y]}),{params:i,passedParams:o,rest:p}}eg.map(n=>n.replace(/_/,""));let tg=(()=>{class n{constructor(t){this.template=t,this.class="",this.autoplayDelay=null,this.slideData={isActive:!1,isPrev:!1,isNext:!1,isVisible:!1,isDuplicate:!1}}set zoom(t){this._zoom=sf(t)}get zoom(){return this._zoom}get classNames(){return this._classNames}set classNames(t){this._classNames!==t&&(this._classNames=t,this.slideData={isActive:this._hasClass(["swiper-slide-active","swiper-slide-duplicate-active"]),isVisible:this._hasClass(["swiper-slide-visible"]),isDuplicate:this._hasClass(["swiper-slide-duplicate"]),isPrev:this._hasClass(["swiper-slide-prev","swiper-slide-duplicate-prev"]),isNext:this._hasClass(["swiper-slide-next","swiper-slide-duplicate-next"])})}_hasClass(t){return t.some(o=>this._classNames.indexOf(o)>=0)}}return n.\u0275fac=function(t){return new(t||n)(F.Y36(F.Rgc))},n.\u0275dir=F.lG2({type:n,selectors:[["ng-template","swiperSlide",""]],inputs:{virtualIndex:"virtualIndex",class:"class",autoplayDelay:["data-swiper-autoplay","autoplayDelay"],zoom:"zoom"}}),n})(),av=(()=>{class n{constructor(t,o,p,f){this._ngZone=t,this.elementRef=o,this._changeDetectorRef=p,this._platformId=f,this.slideClass="swiper-slide",this.wrapperClass="swiper-wrapper",this.showNavigation=!0,this.showPagination=!0,this.showScrollbar=!0,this.s__beforeBreakpoint=new F.vpe,this.s__containerClasses=new F.vpe,this.s__slideClass=new F.vpe,this.s__swiper=new F.vpe,this.s_activeIndexChange=new F.vpe,this.s_afterInit=new F.vpe,this.s_autoplay=new F.vpe,this.s_autoplayStart=new F.vpe,this.s_autoplayStop=new F.vpe,this.s_beforeDestroy=new F.vpe,this.s_beforeInit=new F.vpe,this.s_beforeLoopFix=new F.vpe,this.s_beforeResize=new F.vpe,this.s_beforeSlideChangeStart=new F.vpe,this.s_beforeTransitionStart=new F.vpe,this.s_breakpoint=new F.vpe,this.s_changeDirection=new F.vpe,this.s_click=new F.vpe,this.s_doubleTap=new F.vpe,this.s_doubleClick=new F.vpe,this.s_destroy=new F.vpe,this.s_fromEdge=new F.vpe,this.s_hashChange=new F.vpe,this.s_hashSet=new F.vpe,this.s_imagesReady=new F.vpe,this.s_init=new F.vpe,this.s_keyPress=new F.vpe,this.s_lazyImageLoad=new F.vpe,this.s_lazyImageReady=new F.vpe,this.s_loopFix=new F.vpe,this.s_momentumBounce=new F.vpe,this.s_navigationHide=new F.vpe,this.s_navigationShow=new F.vpe,this.s_observerUpdate=new F.vpe,this.s_orientationchange=new F.vpe,this.s_paginationHide=new F.vpe,this.s_paginationRender=new F.vpe,this.s_paginationShow=new F.vpe,this.s_paginationUpdate=new F.vpe,this.s_progress=new F.vpe,this.s_reachBeginning=new F.vpe,this.s_reachEnd=new F.vpe,this.s_realIndexChange=new F.vpe,this.s_resize=new F.vpe,this.s_scroll=new F.vpe,this.s_scrollbarDragEnd=new F.vpe,this.s_scrollbarDragMove=new F.vpe,this.s_scrollbarDragStart=new F.vpe,this.s_setTransition=new F.vpe,this.s_setTranslate=new F.vpe,this.s_slideChange=new F.vpe,this.s_slideChangeTransitionEnd=new F.vpe,this.s_slideChangeTransitionStart=new F.vpe,this.s_slideNextTransitionEnd=new F.vpe,this.s_slideNextTransitionStart=new F.vpe,this.s_slidePrevTransitionEnd=new F.vpe,this.s_slidePrevTransitionStart=new F.vpe,this.s_slideResetTransitionStart=new F.vpe,this.s_slideResetTransitionEnd=new F.vpe,this.s_sliderMove=new F.vpe,this.s_sliderFirstMove=new F.vpe,this.s_slidesLengthChange=new F.vpe,this.s_slidesGridLengthChange=new F.vpe,this.s_snapGridLengthChange=new F.vpe,this.s_snapIndexChange=new F.vpe,this.s_tap=new F.vpe,this.s_toEdge=new F.vpe,this.s_touchEnd=new F.vpe,this.s_touchMove=new F.vpe,this.s_touchMoveOpposite=new F.vpe,this.s_touchStart=new F.vpe,this.s_transitionEnd=new F.vpe,this.s_transitionStart=new F.vpe,this.s_update=new F.vpe,this.s_zoomChange=new F.vpe,this.s_lock=new F.vpe,this.s_unlock=new F.vpe,this.s_swiper=new F.vpe,this.indexChange=new F.vpe,this._activeSlides=new hm.xQ,this.containerClasses="swiper",this.slidesChanges=y=>{this.slides=y.map((C,E)=>(C.slideIndex=E,C.classNames=this.slideClass||"",C)),this.loop&&!this.loopedSlides&&this.calcLoopedSlides(),this.virtual?this.swiperRef&&this.swiperRef.virtual&&this._ngZone.runOutsideAngular(()=>{this.swiperRef.virtual.slides=this.slides,this.swiperRef.virtual.update(!0)}):this.loopedSlides&&(this.prependSlides=(0,fm.of)(this.slides.slice(this.slides.length-this.loopedSlides)),this.appendSlides=(0,fm.of)(this.slides.slice(0,this.loopedSlides))),this._changeDetectorRef.detectChanges()},this.style=null,this.updateVirtualSlides=y=>{!this.swiperRef||this.currentVirtualData&&this.currentVirtualData.from===y.from&&this.currentVirtualData.to===y.to&&this.currentVirtualData.offset===y.offset||(this.style=this.swiperRef.isHorizontal()?{[this.swiperRef.rtlTranslate?"right":"left"]:`${y.offset}px`}:{top:`${y.offset}px`},this.currentVirtualData=y,this._activeSlides.next(y.slides),this._ngZone.run(()=>{this._changeDetectorRef.detectChanges()}),this._ngZone.runOutsideAngular(()=>{this.swiperRef.updateSlides(),this.swiperRef.updateProgress(),this.swiperRef.updateSlidesClasses(),this.swiperRef.lazy&&this.swiperRef.params.lazy.enabled&&this.swiperRef.lazy.load(),this.swiperRef.virtual.update(!0)}))}}set navigation(t){var o,p,f;const y="boolean"!=typeof this._navigation&&""!==this._navigation?null===(o=this._navigation)||void 0===o?void 0:o.nextEl:null,C="boolean"!=typeof this._navigation&&""!==this._navigation?null===(p=this._navigation)||void 0===p?void 0:p.prevEl:null;this._navigation=lf(t,{nextEl:y||null,prevEl:C||null}),this.showNavigation=!(!0!==sf(t)||this._navigation&&"boolean"!=typeof this._navigation&&this._navigation.prevEl!==(null===(f=this._prevElRef)||void 0===f?void 0:f.nativeElement)&&(null!==this._navigation.prevEl||null!==this._navigation.nextEl)&&("string"==typeof this._navigation.nextEl||"string"==typeof this._navigation.prevEl||"object"==typeof this._navigation.nextEl||"object"==typeof this._navigation.prevEl))}get navigation(){return this._navigation}set pagination(t){var o;const p="boolean"!=typeof this._pagination&&""!==this._pagination?null===(o=this._pagination)||void 0===o?void 0:o.el:null;this._pagination=lf(t,{el:p||null}),this.showPagination=Jm(t,this._pagination,this._paginationElRef)}get pagination(){return this._pagination}set scrollbar(t){var o;const p="boolean"!=typeof this._scrollbar&&""!==this._scrollbar?null===(o=this._scrollbar)||void 0===o?void 0:o.el:null;this._scrollbar=lf(t,{el:p||null}),this.showScrollbar=Jm(t,this._scrollbar,this._scrollbarElRef)}get scrollbar(){return this._scrollbar}set virtual(t){this._virtual=lf(t)}get virtual(){return this._virtual}set index(t){console.warn("`[(index)]` prop is deprecated and will be removed in upcoming versions"),this.setIndex(t)}set config(t){this.updateSwiper(t);const{params:o}=mm(t);Object.assign(this,o)}set prevElRef(t){this._prevElRef=t,this._setElement(t,this.navigation,"navigation","prevEl")}set nextElRef(t){this._nextElRef=t,this._setElement(t,this.navigation,"navigation","nextEl")}set scrollbarElRef(t){this._scrollbarElRef=t,this._setElement(t,this.scrollbar,"scrollbar")}set paginationElRef(t){this._paginationElRef=t,this._setElement(t,this.pagination,"pagination")}get activeSlides(){return this.virtual?this._activeSlides:(0,fm.of)(this.slides)}get zoomContainerClass(){return this.zoom&&"boolean"!=typeof this.zoom?this.zoom.containerClass:"swiper-zoom-container"}_setElement(t,o,p,f="el"){if(!o||!t)return;if(t.nativeElement){if(o[f]===t.nativeElement)return;o[f]=t.nativeElement}const y={};y[p]=!0,this.updateInitSwiper(y)}ngOnInit(){const{params:t}=mm(this);Object.assign(this,t)}ngAfterViewInit(){this.childrenSlidesInit(),this.initSwiper(),this._changeDetectorRef.detectChanges(),setTimeout(()=>{this.s_swiper.emit(this.swiperRef)})}childrenSlidesInit(){this.slidesChanges(this.slidesEl),this.slidesEl.changes.subscribe(this.slidesChanges)}get isSwiperActive(){return this.swiperRef&&!this.swiperRef.destroyed}initSwiper(){const{params:t}=mm(this);Object.assign(this,t),this._ngZone.runOutsideAngular(()=>{t.init=!1,t.virtual||(t.observer=!0),t.onAny=(E,...M)=>{const A=this["s_"+E];A&&A.emit(...M)},Object.assign(t.on,{_containerClasses:(E,M)=>{setTimeout(()=>{this.containerClasses=M})},_slideClasses:(E,M)=>{M.forEach(({slideEl:A,classNames:I},R)=>{const G=A.getAttribute("data-swiper-slide-index"),W=G?parseInt(G):R;if(this.virtual){const se=this.slides.find(ne=>ne.virtualIndex&&ne.virtualIndex===W);if(se)return void(se.classNames=I)}this.slides[W]&&(this.slides[W].classNames=I)}),this._changeDetectorRef.detectChanges()}});const y=new Wo(t);if(y.loopCreate=()=>{},y.loopDestroy=()=>{},t.loop&&(y.loopedSlides=this.loopedSlides),y.virtual&&void 0!==y.params.virtual&&"boolean"!=typeof y.params.virtual&&y.params.virtual.enabled){y.virtual.slides=this.slides;const E={cache:!1,slides:this.slides,renderExternal:this.updateVirtualSlides,renderExternalUpdate:!1};Ou(y.params.virtual,E),Ou(y.originalParams.virtual,E)}if((0,Ti.NF)(this._platformId)){this.swiperRef=y.init(this.elementRef.nativeElement);const E=void 0!==this.swiperRef.params.virtual&&"boolean"!=typeof this.swiperRef.params.virtual&&this.swiperRef.params.virtual.enabled;this.swiperRef.virtual&&E&&this.swiperRef.virtual.update(!0),this._changeDetectorRef.detectChanges(),y.on("slideChange",()=>{this.indexChange.emit(this.swiperRef.realIndex)})}})}ngOnChanges(t){this.updateSwiper(t),this._changeDetectorRef.detectChanges()}updateInitSwiper(t){!t||!this.swiperRef||this.swiperRef.destroyed||this._ngZone.runOutsideAngular(()=>{const{pagination:p,navigation:f,scrollbar:y,thumbs:E}=this.swiperRef;t.pagination&&(this.pagination&&"boolean"!=typeof this.pagination&&this.pagination.el&&p&&!p.el?(this.updateParameter("pagination",this.pagination),p.init(),p.render(),p.update()):(p.destroy(),p.el=null)),t.scrollbar&&(this.scrollbar&&"boolean"!=typeof this.scrollbar&&this.scrollbar.el&&y&&!y.el?(this.updateParameter("scrollbar",this.scrollbar),y.init(),y.updateSize(),y.setTranslate()):(y.destroy(),y.el=null)),t.navigation&&(this.navigation&&"boolean"!=typeof this.navigation&&this.navigation.prevEl&&this.navigation.nextEl&&f&&!f.prevEl&&!f.nextEl?(this.updateParameter("navigation",this.navigation),f.init(),f.update()):f.prevEl&&f.nextEl&&(f.destroy(),f.nextEl=null,f.prevEl=null)),t.thumbs&&this.thumbs&&this.thumbs.swiper&&(this.updateParameter("thumbs",this.thumbs),E.init()&&E.update(!0)),t.controller&&this.controller&&this.controller.control&&(this.swiperRef.controller.control=this.controller.control),this.swiperRef.update()})}updateSwiper(t){this._ngZone.runOutsideAngular(()=>{var o,p;if(!t.config&&t&&this.swiperRef&&!this.swiperRef.destroyed){for(const f in t){if(ov.indexOf(f)>=0)continue;const y=null!==(p=null===(o=t[f])||void 0===o?void 0:o.currentValue)&&void 0!==p?p:t[f];this.updateParameter(f,y)}t.allowSlideNext&&(this.swiperRef.allowSlideNext=this.allowSlideNext),t.allowSlidePrev&&(this.swiperRef.allowSlidePrev=this.allowSlidePrev),t.direction&&this.swiperRef.changeDirection(this.direction,!1),t.breakpoints&&(this.loop&&!this.loopedSlides&&this.calcLoopedSlides(),this.swiperRef.currentBreakpoint=null,this.swiperRef.setBreakpoint()),(t.thumbs||t.controller)&&this.updateInitSwiper(t),this.swiperRef.update()}})}calcLoopedSlides(){if(!this.loop)return;let t=this.slidesPerView;if(this.breakpoints){const p=Wo.prototype.getBreakpoint(this.breakpoints),f=p in this.breakpoints?this.breakpoints[p]:void 0;f&&f.slidesPerView&&(t=f.slidesPerView)}if("auto"===t)return this.loopedSlides=this.slides.length,this.slides.length;let o=this.loopedSlides||t;return o?(this.loopAdditionalSlides&&(o+=this.loopAdditionalSlides),o>this.slides.length&&(o=this.slides.length),this.loopedSlides=o,o):void 0}updateParameter(t,o){if(!this.swiperRef||this.swiperRef.destroyed)return;const p=t.replace(/^_/,""),f=tp(this.swiperRef.params[p]);"enabled"!==p?f&&tp(o)?Ou(this.swiperRef.params[p],o):this.swiperRef.params[p]=o:!0===o?this.swiperRef.enable():!1===o&&this.swiperRef.disable()}setIndex(t,o,p){this.isSwiperActive?t!==this.swiperRef.activeIndex&&this._ngZone.runOutsideAngular(()=>{this.loop?this.swiperRef.slideToLoop(t,o,!p):this.swiperRef.slideTo(t,o,!p)}):this.initialSlide=t}ngOnDestroy(){this._ngZone.runOutsideAngular(()=>{var t;null===(t=this.swiperRef)||void 0===t||t.destroy(!0,!1)})}}return n.\u0275fac=function(t){return new(t||n)(F.Y36(F.R0b),F.Y36(F.SBq),F.Y36(F.sBO),F.Y36(F.Lbi))},n.\u0275cmp=F.Xpm({type:n,selectors:[["swiper"],["","swiper",""]],contentQueries:function(t,o,p){if(1&t&&F.Suo(p,tg,4),2&t){let f;F.iGM(f=F.CRH())&&(o.slidesEl=f)}},viewQuery:function(t,o){if(1&t&&(F.Gf(L_,5),F.Gf(R_,5),F.Gf(F_,5),F.Gf(N_,5)),2&t){let p;F.iGM(p=F.CRH())&&(o.prevElRef=p.first),F.iGM(p=F.CRH())&&(o.nextElRef=p.first),F.iGM(p=F.CRH())&&(o.scrollbarElRef=p.first),F.iGM(p=F.CRH())&&(o.paginationElRef=p.first)}},hostVars:2,hostBindings:function(t,o){2&t&&F.Tol(o.containerClasses)},inputs:{enabled:"enabled",on:"on",direction:"direction",touchEventsTarget:"touchEventsTarget",initialSlide:"initialSlide",speed:"speed",cssMode:"cssMode",updateOnWindowResize:"updateOnWindowResize",resizeObserver:"resizeObserver",nested:"nested",focusableElements:"focusableElements",width:"width",height:"height",preventInteractionOnTransition:"preventInteractionOnTransition",userAgent:"userAgent",url:"url",edgeSwipeDetection:"edgeSwipeDetection",edgeSwipeThreshold:"edgeSwipeThreshold",freeMode:"freeMode",autoHeight:"autoHeight",setWrapperSize:"setWrapperSize",virtualTranslate:"virtualTranslate",effect:"effect",breakpoints:"breakpoints",spaceBetween:"spaceBetween",slidesPerView:"slidesPerView",grid:"grid",slidesPerGroup:"slidesPerGroup",slidesPerGroupSkip:"slidesPerGroupSkip",centeredSlides:"centeredSlides",centeredSlidesBounds:"centeredSlidesBounds",slidesOffsetBefore:"slidesOffsetBefore",slidesOffsetAfter:"slidesOffsetAfter",normalizeSlideIndex:"normalizeSlideIndex",centerInsufficientSlides:"centerInsufficientSlides",watchOverflow:"watchOverflow",roundLengths:"roundLengths",touchRatio:"touchRatio",touchAngle:"touchAngle",simulateTouch:"simulateTouch",shortSwipes:"shortSwipes",longSwipes:"longSwipes",longSwipesRatio:"longSwipesRatio",longSwipesMs:"longSwipesMs",followFinger:"followFinger",allowTouchMove:"allowTouchMove",threshold:"threshold",touchMoveStopPropagation:"touchMoveStopPropagation",touchStartPreventDefault:"touchStartPreventDefault",touchStartForcePreventDefault:"touchStartForcePreventDefault",touchReleaseOnEdges:"touchReleaseOnEdges",uniqueNavElements:"uniqueNavElements",resistance:"resistance",resistanceRatio:"resistanceRatio",watchSlidesProgress:"watchSlidesProgress",grabCursor:"grabCursor",preventClicks:"preventClicks",preventClicksPropagation:"preventClicksPropagation",slideToClickedSlide:"slideToClickedSlide",preloadImages:"preloadImages",updateOnImagesReady:"updateOnImagesReady",loop:"loop",loopAdditionalSlides:"loopAdditionalSlides",loopedSlides:"loopedSlides",loopFillGroupWithBlank:"loopFillGroupWithBlank",loopPreventsSlide:"loopPreventsSlide",rewind:"rewind",allowSlidePrev:"allowSlidePrev",allowSlideNext:"allowSlideNext",swipeHandler:"swipeHandler",noSwiping:"noSwiping",noSwipingClass:"noSwipingClass",noSwipingSelector:"noSwipingSelector",passiveListeners:"passiveListeners",containerModifierClass:"containerModifierClass",slideClass:"slideClass",slideBlankClass:"slideBlankClass",slideActiveClass:"slideActiveClass",slideDuplicateActiveClass:"slideDuplicateActiveClass",slideVisibleClass:"slideVisibleClass",slideDuplicateClass:"slideDuplicateClass",slideNextClass:"slideNextClass",slideDuplicateNextClass:"slideDuplicateNextClass",slidePrevClass:"slidePrevClass",slideDuplicatePrevClass:"slideDuplicatePrevClass",wrapperClass:"wrapperClass",runCallbacksOnInit:"runCallbacksOnInit",observeParents:"observeParents",observeSlideChildren:"observeSlideChildren",a11y:"a11y",autoplay:"autoplay",controller:"controller",coverflowEffect:"coverflowEffect",cubeEffect:"cubeEffect",fadeEffect:"fadeEffect",flipEffect:"flipEffect",creativeEffect:"creativeEffect",cardsEffect:"cardsEffect",hashNavigation:"hashNavigation",history:"history",keyboard:"keyboard",lazy:"lazy",mousewheel:"mousewheel",parallax:"parallax",thumbs:"thumbs",zoom:"zoom",class:"class",id:"id",navigation:"navigation",pagination:"pagination",scrollbar:"scrollbar",virtual:"virtual",index:"index",config:"config"},outputs:{s__beforeBreakpoint:"_beforeBreakpoint",s__containerClasses:"_containerClasses",s__slideClass:"_slideClass",s__swiper:"_swiper",s_activeIndexChange:"activeIndexChange",s_afterInit:"afterInit",s_autoplay:"autoplay",s_autoplayStart:"autoplayStart",s_autoplayStop:"autoplayStop",s_beforeDestroy:"beforeDestroy",s_beforeInit:"beforeInit",s_beforeLoopFix:"beforeLoopFix",s_beforeResize:"beforeResize",s_beforeSlideChangeStart:"beforeSlideChangeStart",s_beforeTransitionStart:"beforeTransitionStart",s_breakpoint:"breakpoint",s_changeDirection:"changeDirection",s_click:"click",s_doubleTap:"doubleTap",s_doubleClick:"doubleClick",s_destroy:"destroy",s_fromEdge:"fromEdge",s_hashChange:"hashChange",s_hashSet:"hashSet",s_imagesReady:"imagesReady",s_init:"init",s_keyPress:"keyPress",s_lazyImageLoad:"lazyImageLoad",s_lazyImageReady:"lazyImageReady",s_loopFix:"loopFix",s_momentumBounce:"momentumBounce",s_navigationHide:"navigationHide",s_navigationShow:"navigationShow",s_observerUpdate:"observerUpdate",s_orientationchange:"orientationchange",s_paginationHide:"paginationHide",s_paginationRender:"paginationRender",s_paginationShow:"paginationShow",s_paginationUpdate:"paginationUpdate",s_progress:"progress",s_reachBeginning:"reachBeginning",s_reachEnd:"reachEnd",s_realIndexChange:"realIndexChange",s_resize:"resize",s_scroll:"scroll",s_scrollbarDragEnd:"scrollbarDragEnd",s_scrollbarDragMove:"scrollbarDragMove",s_scrollbarDragStart:"scrollbarDragStart",s_setTransition:"setTransition",s_setTranslate:"setTranslate",s_slideChange:"slideChange",s_slideChangeTransitionEnd:"slideChangeTransitionEnd",s_slideChangeTransitionStart:"slideChangeTransitionStart",s_slideNextTransitionEnd:"slideNextTransitionEnd",s_slideNextTransitionStart:"slideNextTransitionStart",s_slidePrevTransitionEnd:"slidePrevTransitionEnd",s_slidePrevTransitionStart:"slidePrevTransitionStart",s_slideResetTransitionStart:"slideResetTransitionStart",s_slideResetTransitionEnd:"slideResetTransitionEnd",s_sliderMove:"sliderMove",s_sliderFirstMove:"sliderFirstMove",s_slidesLengthChange:"slidesLengthChange",s_slidesGridLengthChange:"slidesGridLengthChange",s_snapGridLengthChange:"snapGridLengthChange",s_snapIndexChange:"snapIndexChange",s_tap:"tap",s_toEdge:"toEdge",s_touchEnd:"touchEnd",s_touchMove:"touchMove",s_touchMoveOpposite:"touchMoveOpposite",s_touchStart:"touchStart",s_transitionEnd:"transitionEnd",s_transitionStart:"transitionStart",s_update:"update",s_zoomChange:"zoomChange",s_lock:"lock",s_unlock:"unlock",s_swiper:"swiper",indexChange:"indexChange"},features:[F.TTD],ngContentSelectors:rv,decls:13,vars:17,consts:[[4,"ngIf"],["class","swiper-scrollbar",4,"ngIf"],["class","swiper-pagination",4,"ngIf"],[3,"ngClass"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["slidesTemplate",""],[1,"swiper-button-prev"],["prevElRef",""],[1,"swiper-button-next"],["nextElRef",""],[1,"swiper-scrollbar"],["scrollbarElRef",""],[1,"swiper-pagination"],["paginationElRef",""],[3,"ngClass","style","ngSwitch",4,"ngFor","ngForOf"],[3,"ngClass","ngSwitch"],[3,"ngClass",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(t,o){if(1&t&&(F.F$t(ev),F.Hsn(0),F.YNc(1,B_,5,0,"ng-container",0),F.YNc(2,V_,2,0,"div",1),F.YNc(3,U_,2,0,"div",2),F.TgZ(4,"div",3),F.Hsn(5,1),F.YNc(6,j_,1,0,void 0,4),F.YNc(7,G_,1,0,void 0,4),F.YNc(8,W_,1,0,void 0,4),F.Hsn(9,2),F.qZA(),F.Hsn(10,3),F.YNc(11,J_,2,3,"ng-template",null,5,F.W1O)),2&t){const p=F.MAs(12);F.xp6(1),F.Q6J("ngIf",o.navigation&&o.showNavigation),F.xp6(1),F.Q6J("ngIf",o.scrollbar&&o.showScrollbar),F.xp6(1),F.Q6J("ngIf",o.pagination&&o.showPagination),F.xp6(1),F.Q6J("ngClass",o.wrapperClass),F.uIk("id",o.id),F.xp6(2),F.Q6J("ngTemplateOutlet",p)("ngTemplateOutletContext",F.VKq(11,tv,o.prependSlides)),F.xp6(1),F.Q6J("ngTemplateOutlet",p)("ngTemplateOutletContext",F.VKq(13,nv,o.activeSlides)),F.xp6(1),F.Q6J("ngTemplateOutlet",p)("ngTemplateOutletContext",F.VKq(15,iv,o.appendSlides))}},directives:[Ti.O5,Ti.mk,Ti.tP,Ti.sg,Ti.RF,Ti.n9,Ti.ED],pipes:[Ti.Ov],styles:["\n      swiper {\n        display: block;\n      }\n    "],encapsulation:2,changeDetection:0}),n})(),sv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=F.oAB({type:n}),n.\u0275inj=F.cJS({imports:[[Ti.ez]]}),n})();var gm=Vt(5924);const lv=["searchContainer"],uv=["mapContainer"],cv=["aboutBtnContainer"],hv=["swiperStrutture"];function pv(n,i){if(1&n){const t=F.EpF();F.TgZ(0,"ion-chip",24),F.NdJ("click",function(){const f=F.CHM(t).$implicit;return F.oxw().onChipClick(f)}),F.TgZ(1,"ion-label"),F._uU(2),F.qZA(),F._UZ(3,"ion-icon",25),F.qZA()}if(2&n){const t=i.$implicit;F.uIk("data-filterPropertyValue",t.mood)("data-mood",t.mood),F.xp6(2),F.Oqu(t.nome)}}function dv(n,i){if(1&n&&F._UZ(0,"mgl-geojson-source",26),2&n){const t=F.oxw();F.Q6J("data",t.metersGeoJson)}}function fv(n,i){if(1&n&&F._UZ(0,"mgl-layer",27),2&n){const t=F.oxw();F.Q6J("minzoom",10)("layout",t.struttureLabelLayout)("paint",t.labelPaint)}}function mv(n,i){if(1&n&&F._UZ(0,"mgl-layer",28),2&n){const t=F.oxw();F.Q6J("paint",t.struttureCirclePaint)}}function gv(n,i){if(1&n&&(F.TgZ(0,"ion-grid",31),F.TgZ(1,"ion-row",31),F.TgZ(2,"ion-col",31),F.TgZ(3,"h5",32),F._uU(4),F.ALo(5,"titlecase"),F.qZA(),F.qZA(),F.qZA(),F.TgZ(6,"ion-row",31),F.TgZ(7,"ion-col",31),F.TgZ(8,"div",33),F._uU(9),F.ALo(10,"titlecase"),F.ALo(11,"transloco"),F.qZA(),F.qZA(),F.qZA(),F.qZA()),2&n){const t=F.oxw(2).$implicit;F.xp6(4),F.hij("",F.lcZ(5,2,t.nome)," "),F.xp6(5),F.Oqu(F.lcZ(10,4,F.lcZ(11,6,"mood_"+t.mood)))}}function _v(n,i){1&n&&F.YNc(0,gv,12,8,"ng-template",30)}function vv(n,i){1&n&&(F.ynx(0),F.YNc(1,_v,1,0,void 0,29),F.BQk())}const yv=function(){return[9]},xv=function(){return[12.5510662,45.6331619]},bv=function(n){return{visible_slides:n}};Wo.use([function({swiper:n,extendParams:i,on:t}){let o;function p(A,I){const R=n.params.virtual;if(R.cache&&n.virtual.cache[I])return n.virtual.cache[I];const G=ht(R.renderSlide?R.renderSlide.call(n,A,I):`<div class="${n.params.slideClass}" data-swiper-slide-index="${I}">${A}</div>`);return G.attr("data-swiper-slide-index")||G.attr("data-swiper-slide-index",I),R.cache&&(n.virtual.cache[I]=G),G}function f(A){const{slidesPerView:I,slidesPerGroup:R,centeredSlides:G}=n.params,{addSlidesBefore:W,addSlidesAfter:se}=n.params.virtual,{from:ne,to:ge,slides:we,slidesGrid:_e,offset:Pe}=n.virtual;n.params.cssMode||n.updateActiveIndex();const Ve=n.activeIndex||0;let Ge,Ye,Te;Ge=n.rtlTranslate?"right":n.isHorizontal()?"left":"top",G?(Ye=Math.floor(I/2)+R+se,Te=Math.floor(I/2)+R+W):(Ye=I+(R-1)+se,Te=R+W);const Se=Math.max((Ve||0)-Te,0),Fe=Math.min((Ve||0)+Ye,we.length-1),De=(n.slidesGrid[Se]||0)-(n.slidesGrid[0]||0);function rt(){n.updateSlides(),n.updateProgress(),n.updateSlidesClasses(),n.lazy&&n.params.lazy.enabled&&n.lazy.load()}if(Object.assign(n.virtual,{from:Se,to:Fe,offset:De,slidesGrid:n.slidesGrid}),ne===Se&&ge===Fe&&!A)return n.slidesGrid!==_e&&De!==Pe&&n.slides.css(Ge,`${De}px`),void n.updateProgress();if(n.params.virtual.renderExternal)return n.params.virtual.renderExternal.call(n,{offset:De,from:Se,to:Fe,slides:function(){const Oe=[];for(let vt=Se;vt<=Fe;vt+=1)Oe.push(we[vt]);return Oe}()}),void(n.params.virtual.renderExternalUpdate&&rt());const ct=[],Jt=[];if(A)n.$wrapperEl.find(`.${n.params.slideClass}`).remove();else for(let zt=ne;zt<=ge;zt+=1)(zt<Se||zt>Fe)&&n.$wrapperEl.find(`.${n.params.slideClass}[data-swiper-slide-index="${zt}"]`).remove();for(let zt=0;zt<we.length;zt+=1)zt>=Se&&zt<=Fe&&(void 0===ge||A?Jt.push(zt):(zt>ge&&Jt.push(zt),zt<ne&&ct.push(zt)));Jt.forEach(zt=>{n.$wrapperEl.append(p(we[zt],zt))}),ct.sort((zt,Oe)=>Oe-zt).forEach(zt=>{n.$wrapperEl.prepend(p(we[zt],zt))}),n.$wrapperEl.children(".swiper-slide").css(Ge,`${De}px`),rt()}i({virtual:{enabled:!1,slides:[],cache:!0,renderSlide:null,renderExternal:null,renderExternalUpdate:!0,addSlidesBefore:0,addSlidesAfter:0}}),n.virtual={cache:{},from:void 0,to:void 0,slides:[],offset:0,slidesGrid:[]},t("beforeInit",()=>{!n.params.virtual.enabled||(n.virtual.slides=n.params.virtual.slides,n.classNames.push(`${n.params.containerModifierClass}virtual`),n.params.watchSlidesProgress=!0,n.originalParams.watchSlidesProgress=!0,n.params.initialSlide||f())}),t("setTranslate",()=>{!n.params.virtual.enabled||(n.params.cssMode&&!n._immediateVirtual?(clearTimeout(o),o=setTimeout(()=>{f()},100)):f())}),t("init update resize",()=>{!n.params.virtual.enabled||n.params.cssMode&&Un(n.wrapperEl,"--swiper-virtual-size",`${n.virtualSize}px`)}),Object.assign(n.virtual,{appendSlide:function(A){if("object"==typeof A&&"length"in A)for(let I=0;I<A.length;I+=1)A[I]&&n.virtual.slides.push(A[I]);else n.virtual.slides.push(A);f(!0)},prependSlide:function(A){const I=n.activeIndex;let R=I+1,G=1;if(Array.isArray(A)){for(let W=0;W<A.length;W+=1)A[W]&&n.virtual.slides.unshift(A[W]);R=I+A.length,G=A.length}else n.virtual.slides.unshift(A);if(n.params.virtual.cache){const W=n.virtual.cache,se={};Object.keys(W).forEach(ne=>{const ge=W[ne],we=ge.attr("data-swiper-slide-index");we&&ge.attr("data-swiper-slide-index",parseInt(we,10)+G),se[parseInt(ne,10)+G]=ge}),n.virtual.cache=se}f(!0),n.slideTo(R,0)},removeSlide:function(A){if(null==A)return;let I=n.activeIndex;if(Array.isArray(A))for(let R=A.length-1;R>=0;R-=1)n.virtual.slides.splice(A[R],1),n.params.virtual.cache&&delete n.virtual.cache[A[R]],A[R]<I&&(I-=1),I=Math.max(I,0);else n.virtual.slides.splice(A,1),n.params.virtual.cache&&delete n.virtual.cache[A],A<I&&(I-=1),I=Math.max(I,0);f(!0),n.slideTo(I,0)},removeAllSlides:function(){n.virtual.slides=[],n.params.virtual.cache&&(n.virtual.cache={}),f(!0),n.slideTo(0,0)},update:f})}]);const wv=[{path:"",component:(()=>{class n{constructor(t,o,p,f){this.featureTransformer=t,this.filterService=o,this.mapUtils=p,this.modalController=f,this.selectedFeature={lngLat:[0,0]},this.mapStyle=fp.N.mapStyle,this.metersGeoJson={type:"FeatureCollection",features:[]},this.comuneSelezionato="",this.meters=[],this.comuni=[],this.moods=[],this.slidesVisible=!1,this.moodSelezionati=[],this.firebaseConfig={apiKey:"AIzaSyBrrHj-LuFs9IvKsNoHIq5a7-jJWK95QBk",authDomain:"moodmetervoid.firebaseapp.com",databaseURL:"https://moodmetervoid-default-rtdb.europe-west1.firebasedatabase.app",projectId:"moodmetervoid",storageBucket:"moodmetervoid.appspot.com",messagingSenderId:"45331867927",appId:"1:45331867927:web:cd34e172e861e40daf6f52"},this.struttureCirclePaint={"circle-radius":{base:1.75,stops:[[0,2],[6,4],[8,5],[11,6],[12,12]]},"circle-color":["case",["all",["==",["get","mood"],"1"]],$r.W[1],["all",["==",["get","mood"],"2"]],$r.W[2],["all",["==",["get","mood"],"3"]],$r.W[3],$r.W[4]],"circle-stroke-color":"transparent","circle-stroke-width":1,"circle-opacity":["case",["!",["boolean",["feature-state","isHighlighted"],!0]],.5,1]},this.struttureLabelLayout={visibility:"visible","text-field":["get","nome"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[.5,.5],"text-anchor":"top","text-size":["interpolate",["linear"],["zoom"],10,12,30,30]},this.labelPaint={"text-opacity":["case",1,0],"text-color":["case",["all",["==",["get","mood"],"1"]],$r.W[1],["all",["==",["get","mood"],"2"]],$r.W[2],["all",["==",["get","mood"],"3"]],$r.W[3],$r.W[4]]}}ngOnInit(){this.openAboutModal();let t=this.metersGeoJson.features.map(o=>this.featureTransformer.featureToMeter(o));this.moods=(0,yt.uniq)(t.map(o=>`${o.mood}`)).sort(),this.moodSelezionati=[...this.moods],this.filterService.addFilter({property:"mood",operator:mp.p.eq,value:this.moodSelezionati})}ngAfterViewInit(){this.mapContainer.nativeElement.style.height=`${window.innerHeight}px`,this.swiperStrutture.elementRef.nativeElement.style.top=`calc(${window.innerHeight}px - 26vh)`,this.aboutBtnContainer.nativeElement.style.top=`calc(${window.innerHeight}px - 48px)`}mapLoaded(t){this.homeMap=t;const o=function(n,i={}){"object"!=typeof i&&(i={name:i});const t=Object.assign({name:Mr,automaticDataCollectionEnabled:!1},i),o=t.name;if("string"!=typeof o||!o)throw Bi.create("bad-app-name",{appName:String(o)});const p=Mo.get(o);if(p){if(Zs(n,p.options)&&Zs(t,p.config))return p;throw Bi.create("duplicate-app",{appName:o})}const f=new ls(o);for(const C of qr.values())f.addComponent(C);const y=new Gr(n,t,f);return Mo.set(o,y),y}(this.firebaseConfig);Um(function(n,i){return(n=Ma(n))._checkNotDeleted("ref"),void 0!==i?ep(n._root,i):n._root}(function(n=function(n=Mr){const i=Mo.get(n);if(!i)throw Bi.create("no-app",{appName:n});return i}(),i){return function(n,i){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(i)}(n,"database").getImmediate({identifier:i})}(o),"/"),C=>{const E=C.val();let M=Or().cloneDeep(this.metersGeoJson);this.metersGeoJson={},M.features=Or().chain(E).map((A,I)=>({type:"Feature",geometry:{type:"Point",coordinates:[A.lon,A.lat]},properties:{nome:I,mood:A.mood+"",posizione:{lat:A.lat,lon:A.lon}}})).value(),this.metersGeoJson=Object.assign({},M),this.meters=this.metersGeoJson.features.map(A=>this.featureTransformer.featureToMeter(A))}),this.homeMap.on("mouseenter","strutture-layer",()=>{this.homeMap.getCanvas().style.cursor="pointer"}),this.homeMap.on("mouseleave","strutture-layer",()=>{this.homeMap.getCanvas().style.cursor=""}),this.homeMap.on("mouseenter","strutture-label-layer",()=>{this.homeMap.getCanvas().style.cursor="pointer"}),this.homeMap.on("mouseleave","strutture-label-layer",()=>{this.homeMap.getCanvas().style.cursor=""}),this.homeMap.on("click","strutture-layer",C=>{let E=(0,yt.get)(C,"features[0]",null);(0,yt.isNil)(E)||this.handleLayerClick(E)}),this.homeMap.on("click","strutture-label-layer",C=>{let E=(0,yt.get)(C,"features[0]",null);(0,yt.isNil)(E)||this.handleLayerClick(E)}),t.resize();let y=this.metersGeoJson.features.map(C=>C.geometry.coordinates);this.fitResultsBBox(y)}onDragEnd(t){}mapZoomEnd(t){}refreshSlides(){}fitResultsBBox(t){let o={top:this.searchContainer.nativeElement.getBoundingClientRect().height+100,left:50,right:50,bottom:this.swiperStrutture.elementRef.nativeElement.getBoundingClientRect().height+100};this.homeMap.fitBounds(this.mapUtils.getLatLngBounds(t),{padding:o})}handleLayerClick(t){let o=this.meters.findIndex(p=>p.nome===t.id);this.swiperStrutture.swiperRef.slideTo(o,1200)}searchComune(t="",o){return t=t.toLowerCase(),o.toLowerCase().replace(" ","").indexOf(t)>-1}onComuneChange(t=""){let o=Ku.find(y=>y.name.toUpperCase()===t.toUpperCase()),f={center:[o.long,o.lat],duration:1200};this.homeMap.getZoom()<13&&(f.zoom=13),this.homeMap.easeTo(f)}onChipClick(t){console.log(t);let o=this.meters.findIndex(f=>f.nome===t.nome);this.swiperStrutture.swiperRef.slideTo(o,1200);let p={center:[t.posizione.lon,t.posizione.lat],duration:1200};this.homeMap.getZoom()<13&&(p.zoom=13),this.homeMap.easeTo(p)}createMarker(t="red"){const o=document.createElement("div");o.className="marker-container";const p=document.createElement("div");return p.className="marker",o.appendChild(p),new jn.Marker({color:t})}onUserLocationClick(){navigator.geolocation.getCurrentPosition(p=>{let C={center:[p.coords.longitude,p.coords.latitude],duration:1200};this.homeMap.getZoom()<13&&(C.zoom=13),this.homeMap.easeTo(C)},p=>console.error(p))}onSlideChange(t){let p=this.meters[t.activeIndex],f=this.metersGeoJson.features.find(C=>C.properties.nome==p.nome);const y=(0,yt.get)(f,"geometry.coordinates",[]).slice();this.homeMap.panTo(y,{duration:250})}openSearchModal(){return(0,Re.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:jl.a,cssClass:"monithon-about-modal"});return t.onDidDismiss().then(o=>{null!==o&&((0,yt.get)(o,"data.filters",[]).map(f=>this.filterService.addFilter(f)),this.refreshSlides())}),yield t.present()})}openAboutModal(){return(0,Re.mG)(this,void 0,void 0,function*(){return yield(yield this.modalController.create({component:sh.t,cssClass:"monithon-about-modal"})).present()})}}return n.\u0275fac=function(t){return new(t||n)(F.Y36(p_.a),F.Y36(d_.F),F.Y36(f_),F.Y36(Dr.IN))},n.\u0275cmp=F.Xpm({type:n,selectors:[["app-home"]],viewQuery:function(t,o){if(1&t&&(F.Gf(lv,5),F.Gf(uv,5),F.Gf(cv,5),F.Gf(hv,5)),2&t){let p;F.iGM(p=F.CRH())&&(o.searchContainer=p.first),F.iGM(p=F.CRH())&&(o.mapContainer=p.first),F.iGM(p=F.CRH())&&(o.aboutBtnContainer=p.first),F.iGM(p=F.CRH())&&(o.swiperStrutture=p.first)}},decls:24,vars:22,consts:[[3,"fullscreen"],["id","container"],[1,"search_container"],["searchContainer",""],[1,"top-search-tools"],[1,"horizontal_scroll_flex"],["tipologieFilter",""],["mode","md","class","filter_chip chip_selected","data-filterPropertyName","mood",3,"click",4,"ngFor","ngForOf"],["id","user_locator",3,"click"],["name","locate-outline"],["id","mapContainer"],["mapContainer",""],[3,"attributionControl","zoom","center","mapLoad","zoomEnd","mapDragEnd"],["homeMap",""],["id","strutture","promoteId","nome",3,"data",4,"ngIf"],["id","strutture-label-layer","type","symbol","source","strutture",3,"minzoom","layout","paint",4,"ngIf"],["id","strutture-layer","type","circle","source","strutture",3,"paint",4,"ngIf"],[3,"slidesPerView","ngClass","noSwiping","allowTouchMove","centeredSlides","spaceBetween","virtual","slideChange"],["swiperStrutture",""],[4,"ngFor","ngForOf"],[1,"about_btn_container"],["aboutBtnContainer",""],["shape","round","size","small","color","light",3,"click"],["slot","icon-only","name","information-circle-outline"],["mode","md","data-filterPropertyName","mood",1,"filter_chip","chip_selected",3,"click"],["name","ellipse","color","dark"],["id","strutture","promoteId","nome",3,"data"],["id","strutture-label-layer","type","symbol","source","strutture",3,"minzoom","layout","paint"],["id","strutture-layer","type","circle","source","strutture",3,"paint"],[4,"transloco"],["class","struttura_slide","swiperSlide",""],[1,"ion-no-margin"],[1,"struttura_slide_titolo"],[1,"struttura_slide_tipologia"]],template:function(t,o){1&t&&(F.TgZ(0,"ion-content",0),F.TgZ(1,"div",1),F.TgZ(2,"div",2,3),F.TgZ(4,"div",4),F.TgZ(5,"div",5,6),F.YNc(7,pv,4,3,"ion-chip",7),F.qZA(),F.TgZ(8,"ion-fab-button",8),F.NdJ("click",function(){return o.onUserLocationClick()}),F._UZ(9,"ion-icon",9),F.qZA(),F.qZA(),F.qZA(),F.TgZ(10,"div",10,11),F.TgZ(12,"mgl-map",12,13),F.NdJ("mapLoad",function(f){return o.mapLoaded(f)})("zoomEnd",function(f){return o.mapZoomEnd(f)})("mapDragEnd",function(f){return o.onDragEnd(f)}),F.YNc(14,dv,1,1,"mgl-geojson-source",14),F.YNc(15,fv,1,3,"mgl-layer",15),F.YNc(16,mv,1,1,"mgl-layer",16),F.qZA(),F.qZA(),F.TgZ(17,"swiper",17,18),F.NdJ("slideChange",function(f){return o.onSlideChange(f)}),F.YNc(19,vv,2,0,"ng-container",19),F.qZA(),F.TgZ(20,"div",20,21),F.TgZ(22,"ion-button",22),F.NdJ("click",function(){return o.openAboutModal()}),F._UZ(23,"ion-icon",23),F.qZA(),F.qZA(),F.qZA(),F.qZA()),2&t&&(F.Q6J("fullscreen",!0),F.xp6(7),F.Q6J("ngForOf",o.meters),F.xp6(5),F.Akn(o.mapStyle),F.Q6J("attributionControl",!1)("zoom",F.DdM(18,yv))("center",F.DdM(19,xv)),F.xp6(2),F.Q6J("ngIf",o.metersGeoJson.features.length),F.xp6(1),F.Q6J("ngIf",o.metersGeoJson.features.length),F.xp6(1),F.Q6J("ngIf",o.metersGeoJson.features.length),F.xp6(1),F.Q6J("slidesPerView",1.5)("ngClass",F.VKq(20,bv,o.meters.length))("noSwiping",!1)("allowTouchMove",!0)("centeredSlides",!0)("spaceBetween",10)("virtual",!0),F.xp6(2),F.Q6J("ngForOf",o.meters))},directives:[Dr.W2,Ti.sg,Dr.W4,Dr.gu,O_,Ti.O5,av,Ti.mk,Dr.YG,Dr.hM,Dr.Q$,k_,D_,gm.KI,tg,Dr.jY,Dr.Nd,Dr.wI],pipes:[Ti.rS,gm.Ot],styles:['.filter_chip[_ngcontent-%COMP%]{width:auto;text-align:center;flex-grow:3;display:inline-table;white-space:nowrap;background-color:transparent;border-style:solid;border-width:1px;border-color:var(--ion-color-medium)}.filter_chip[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{fill:none;stroke:var(--ion-color-medium);stroke-width:1px}.filter_chip.chip_selected[_ngcontent-%COMP%]{background-color:#d0d0d0}.filter_chip.chip_selected[data-filterPropertyName=mood][_ngcontent-%COMP%]{background-color:var(--ion-color-primary-contrast)}.filter_chip[data-filterPropertyValue="1"].chip_selected[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{fill:var(--mood-1)}.filter_chip[data-filterPropertyValue="2"].chip_selected[_ngcontent-%COMP%]{color:var(--ion-color-dark)}.filter_chip[data-filterPropertyValue="2"].chip_selected[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{fill:var(--mood-2)}.filter_chip[data-filterPropertyValue="3"].chip_selected[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{fill:var(--mood-3)}.advanced_search[_ngcontent-%COMP%]{background-color:#fff;opacity:1;border-width:0;display:inline-table}#container[_ngcontent-%COMP%]{text-align:center;position:absolute;left:0;right:0}#mapContainer[_ngcontent-%COMP%]{width:100vw;height:100vh;position:absolute;top:0;margin:0;padding:0}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}mgl-map[_ngcontent-%COMP%], .maplibregl-canvas[_ngcontent-%COMP%]{height:100%;width:100%}.maplibregl-canvas-container[_ngcontent-%COMP%]{height:100%}.horizontal_scroll_flex[_ngcontent-%COMP%]{width:80vw;display:flex;justify-content:space-between;flex-wrap:nowrap;overflow-x:scroll;margin:auto;-ms-overflow-style:none;scrollbar-width:none}.horizontal_scroll_flex[_ngcontent-%COMP%]::-webkit-scrollbar{width:0!important}.swiper[_ngcontent-%COMP%]{height:0;top:75vh}.swiper.visible_slides[_ngcontent-%COMP%]{height:25vh}.swiper[_ngcontent-%COMP%]     .swiper-slide{background-color:#fff;border-radius:14px;color:var(--ionic-primary, black)}.search_container[_ngcontent-%COMP%]{z-index:100;position:absolute;margin:auto;width:100vw}.top-search-tools[_ngcontent-%COMP%]{width:100%;display:flex}#user_locator[_ngcontent-%COMP%]{margin:auto 15px auto auto;aspect-ratio:1}.search-comuni-select[_ngcontent-%COMP%]{background:white;padding-left:24px!important;padding-right:12px!important;width:95%;max-width:66vw;border-radius:0 0 20px 20px}.search-comuni-select[_ngcontent-%COMP%]     .ng-select-container   .ng-value{margin-top:10px}.search-comuni-select[_ngcontent-%COMP%]     .ng-select-container   .ng-value-container   .ng-placeholder{margin-top:10px}.search-comuni-select[_ngcontent-%COMP%]     .ng-select-container .ng-arrow-wrapper{visibility:hidden}.search-comuni-select.ng-select-opened[_ngcontent-%COMP%]   .ng-select-container[_ngcontent-%COMP%]{border-top-left-radius:0;border-top-right-radius:0;z-index:2000}.search-comuni-select.ng-select-opened[_ngcontent-%COMP%]   .ng-select-container[_ngcontent-%COMP%]   .ng-placeholder[_ngcontent-%COMP%]{display:none}.search-comuni-select[_ngcontent-%COMP%]   .ng-has-value[_ngcontent-%COMP%]   .ng-placeholder[_ngcontent-%COMP%]{display:none}.search-comuni-select[_ngcontent-%COMP%]   .ng-dropdown-panel[_ngcontent-%COMP%]{margin-left:24px;width:calc(100% - 36px);border-top-left-radius:18px;border-bottom-left-radius:0;border-top-right-radius:18px;margin-bottom:12px}.advanced_seach_icon[_ngcontent-%COMP%]{margin:auto}.about_btn_container[_ngcontent-%COMP%]{position:absolute;right:0;top:calc(100vh - 48px);margin-right:17px}']}),n})()}];let Cv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=F.oAB({type:n}),n.\u0275inj=F.cJS({imports:[[Xi.Bz.forChild(wv)],Xi.Bz]}),n})();new class extends dm.v{flush(i){this.active=!0,this.scheduled=void 0;const{actions:t}=this;let o,p=-1,f=t.length;i=i||t.shift();do{if(o=i.execute(i.state,i.delay))break}while(++p<f&&(i=t.shift()));if(this.active=!1,o){for(;++p<f&&(i=t.shift());)i.unsubscribe();throw o}}}(class extends pm.o{constructor(i,t){super(i,t),this.scheduler=i,this.work=t}requestAsyncId(i,t,o=0){return null!==o&&o>0?super.requestAsyncId(i,t,o):(i.actions.push(this),i.scheduled||(i.scheduled=requestAnimationFrame(()=>i.flush(null))))}recycleAsyncId(i,t,o=0){if(null!==o&&o>0||null===o&&this.delay>0)return super.recycleAsyncId(i,t,o);0===i.actions.length&&(cancelAnimationFrame(t),i.scheduled=void 0)}});let Iv=1;const Mv=Promise.resolve(),uf={};function ng(n){return n in uf&&(delete uf[n],!0)}const ig={setImmediate(n){const i=Iv++;return uf[i]=!0,Mv.then(()=>ng(i)&&n()),i},clearImmediate(n){ng(n)}};new class extends dm.v{flush(i){this.active=!0,this.scheduled=void 0;const{actions:t}=this;let o,p=-1,f=t.length;i=i||t.shift();do{if(o=i.execute(i.state,i.delay))break}while(++p<f&&(i=t.shift()));if(this.active=!1,o){for(;++p<f&&(i=t.shift());)i.unsubscribe();throw o}}}(class extends pm.o{constructor(i,t){super(i,t),this.scheduler=i,this.work=t}requestAsyncId(i,t,o=0){return null!==o&&o>0?super.requestAsyncId(i,t,o):(i.actions.push(this),i.scheduled||(i.scheduled=ig.setImmediate(i.flush.bind(i,null))))}recycleAsyncId(i,t,o=0){if(null!==o&&o>0||null===o&&this.delay>0)return super.recycleAsyncId(i,t,o);0===i.actions.length&&(ig.clearImmediate(t),i.scheduled=void 0)}});RegExp(/[&<>"']/g.source);const ay=new F.OlP("ng-select-selection-model");function sy(){return new ly}class ly{constructor(){this._selected=[]}get value(){return this._selected}select(i,t,o){if(i.selected=!0,(!i.children||!t&&o)&&this._selected.push(i),t)if(i.parent){const p=i.parent.children.length,f=i.parent.children.filter(y=>y.selected).length;i.parent.selected=p===f}else i.children&&(this._setChildrenSelectedState(i.children,!0),this._removeChildren(i),this._selected=o&&this._activeChildren(i)?[...this._selected.filter(p=>p.parent!==i),i]:[...this._selected,...i.children.filter(p=>!p.disabled)])}unselect(i,t){if(this._selected=this._selected.filter(o=>o!==i),i.selected=!1,t)if(i.parent&&i.parent.selected){const o=i.parent.children;this._removeParent(i.parent),this._removeChildren(i.parent),this._selected.push(...o.filter(p=>p!==i&&!p.disabled)),i.parent.selected=!1}else i.children&&(this._setChildrenSelectedState(i.children,!1),this._removeChildren(i))}clear(i){this._selected=i?this._selected.filter(t=>t.disabled):[]}_setChildrenSelectedState(i,t){for(const o of i)o.disabled||(o.selected=t)}_removeChildren(i){this._selected=[...this._selected.filter(t=>t.parent!==i),...i.children.filter(t=>t.parent===i&&t.disabled&&t.selected)]}_removeParent(i){this._selected=this._selected.filter(t=>t!==i)}_activeChildren(i){return i.children.every(t=>!t.disabled||t.selected)}}let uy=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=F.oAB({type:n}),n.\u0275inj=F.cJS({providers:[{provide:ay,useValue:sy}],imports:[[Ti.ez]]}),n})(),cy=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=F.oAB({type:n}),n.\u0275inj=F.cJS({imports:[[Ti.ez,m.u5,Dr.Pc,Cv,z_,sv,gm.y4,uy,m.u5]]}),n})()}}]);